This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
backend/__init__.py
backend/api/__init__.py
backend/api/annotation_routes.py
backend/api/data_routes.py
backend/api/inference_routes.py
backend/api/main.py
backend/api/training_routes.py
backend/core/__init__.py
backend/core/dicom_reader.py
backend/core/distortion_correction.py
backend/core/mesh_generator.py
backend/core/volume_processor.py
backend/data/annotations/ann_20251210_010404_398f4a1a/project.json
backend/data/annotations/ann_20251210_143954_0057e27c/project.json
backend/data/processed/vol_20251205_145234_40bbedec/meshes/mesh_t0.50.ply
backend/data/processed/vol_20251205_145234_40bbedec/metadata.json
backend/data/processed/vol_20251205_145234_40bbedec/previews/preview_x.png
backend/data/processed/vol_20251205_145234_40bbedec/previews/preview_y.png
backend/data/processed/vol_20251205_145234_40bbedec/previews/preview_z.png
backend/data/processed/vol_20251205_145234_40bbedec/vol_20251205_145234_40bbedec.nii.gz
backend/data/processed/vol_20251205_145234_40bbedec/volume.npy
backend/data/processed/vol_20251205_184159_1c530d6d/meshes/mesh_t0.50.ply
backend/data/processed/vol_20251205_184159_1c530d6d/metadata.json
backend/data/processed/vol_20251205_184159_1c530d6d/previews/preview_x.png
backend/data/processed/vol_20251205_184159_1c530d6d/previews/preview_y.png
backend/data/processed/vol_20251205_184159_1c530d6d/previews/preview_z.png
backend/data/processed/vol_20251205_184159_1c530d6d/vol_20251205_184159_1c530d6d.nii.gz
backend/data/processed/vol_20251205_184159_1c530d6d/volume.npy
backend/data/uploads/vol_20251205_145234_40bbedec/2023.08.16_14.44.06_3DprintSample.oct-Flow_edNM.dcm
backend/data/uploads/vol_20251205_184159_1c530d6d/7.oct-Stru.dcm
backend/models/__init__.py
backend/models/combined.py
backend/models/diffusion.py
backend/models/unet3d.py
backend/requirements.txt
backend/training/__init__.py
backend/training/dataset.py
backend/training/losses.py
backend/training/trainer.py
docs/api_reference.md
docs/usage.md
frontend/electron/main.js
frontend/electron/preload.js
frontend/index.html
frontend/package.json
frontend/postcss.config.js
frontend/src/App.tsx
frontend/src/components/Layout.tsx
frontend/src/main.tsx
frontend/src/pages/AnnotationPage.tsx
frontend/src/pages/DataPage.tsx
frontend/src/pages/HomePage.tsx
frontend/src/pages/InferencePage.tsx
frontend/src/pages/TrainingPage.tsx
frontend/src/pages/VisualizationPage.tsx
frontend/src/styles/index.css
frontend/src/utils/api.ts
frontend/tailwind.config.js
frontend/tsconfig.json
frontend/tsconfig.node.json
frontend/vite.config.ts
README_zh.md
scripts/build-windows.bat
scripts/dev-start.bat
scripts/install.bat
scripts/start.bat
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="backend/__init__.py">
# OCTA 血管网络分析系统 - 后端模块
</file>

<file path="backend/api/__init__.py">
# API 路由模块
</file>

<file path="backend/api/annotation_routes.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管标注 - V7版本（重大优化）

核心改进：
1. 真正的椭圆拟合（cv2.fitEllipse）
2. CLAHE 对比度增强
3. 多尺度 Blob 检测（LoG/DoG）
4. 边缘引导检测（Canny + 轮廓分析）
5. 区域生长 + 智能边界检测
6. 点击自动拟合优化
"""

CODE_VERSION = "V7.1_FAST_PARALLEL"

import os
import json
import uuid
from pathlib import Path
from datetime import datetime
from typing import Optional, List, Dict, Any, Tuple
import math

from fastapi import APIRouter, HTTPException, Body
from fastapi.responses import FileResponse
from pydantic import BaseModel
import numpy as np
import cv2
from scipy import ndimage
from scipy.ndimage import label, center_of_mass
from skimage import feature, filters, morphology, measure
from skimage.feature import blob_log, blob_dog
from skimage.segmentation import watershed
from skimage.measure import regionprops, label as sk_label

router = APIRouter()

DATA_DIR = Path(__file__).parent.parent / "data"
ANNOTATIONS_DIR = DATA_DIR / "annotations"
PROCESSED_DIR = DATA_DIR / "processed"
ANNOTATIONS_DIR.mkdir(parents=True, exist_ok=True)

print(f"[ANNOTATION] 版本: {CODE_VERSION}")

# ============================================================================
# 数据模型（与V6兼容）
# ============================================================================

class AnnotationPoint(BaseModel):
    x: float
    y: float

class EllipseAnnotation(BaseModel):
    id: str
    center_x: float
    center_y: float
    radius_x: float
    radius_y: float
    rotation: float = 0.0
    slice_index: int
    axis: str
    vessel_id: Optional[str] = None
    confidence: float = 1.0
    is_manual: bool = False
    created_at: str = ""

class BrushStroke(BaseModel):
    id: str
    points: List[AnnotationPoint]
    brush_size: float
    is_eraser: bool = False
    slice_index: int
    axis: str

class AnnotationLayer(BaseModel):
    slice_index: int
    axis: str
    ellipses: List[EllipseAnnotation] = []
    brush_strokes: List[BrushStroke] = []

class AnnotationProject(BaseModel):
    id: str
    volume_id: str
    name: str
    created_at: str
    modified_at: str
    layers: Dict[str, AnnotationLayer] = {}
    undo_stack: List[Dict] = []
    redo_stack: List[Dict] = []

class CreateProjectRequest(BaseModel):
    volume_id: str
    name: str

class SaveAnnotationRequest(BaseModel):
    project_id: str
    layer_key: str
    ellipses: List[EllipseAnnotation] = []
    brush_strokes: List[BrushStroke] = []

class AutoFitAtPointRequest(BaseModel):
    slice_index: int
    axis: str
    click_x: float
    click_y: float
    roi_size: int = 50
    method: str = "auto"  # auto, edge, region, blob

class AutoLabelRequest(BaseModel):
    axis: str = "y"
    min_radius: int = 2
    max_radius: int = 15
    continuity_threshold: float = 20.0
    min_slices: int = 1
    regen: bool = True
    sensitivity: str = "medium"
    use_clahe: bool = True
    detect_method: str = "combined"  # blob, edge, combined

# ============================================================================
# 项目存储（与V6兼容）
# ============================================================================

def get_project_path(project_id: str) -> Path:
    return ANNOTATIONS_DIR / project_id / "project.json"

def load_project(project_id: str) -> Optional[AnnotationProject]:
    path = get_project_path(project_id)
    if not path.exists():
        return None
    try:
        with open(path, 'r', encoding='utf-8') as f:
            data = json.load(f)
        return AnnotationProject(**data)
    except:
        return None

def save_project(project: AnnotationProject):
    path = get_project_path(project.id)
    path.parent.mkdir(parents=True, exist_ok=True)
    with open(path, 'w', encoding='utf-8') as f:
        json.dump(project.model_dump(), f, ensure_ascii=False, indent=2)

# ============================================================================
# 图像预处理工具
# ============================================================================

def apply_clahe(img: np.ndarray, clip_limit: float = 3.0, grid_size: int = 8) -> np.ndarray:
    """
    CLAHE (Contrast Limited Adaptive Histogram Equalization)
    显著提升低对比度区域的血管可见性
    """
    if img.dtype != np.uint8:
        img = ((img - img.min()) / (img.max() - img.min() + 1e-8) * 255).astype(np.uint8)
    
    clahe = cv2.createCLAHE(clipLimit=clip_limit, tileGridSize=(grid_size, grid_size))
    return clahe.apply(img)


def enhance_vessels(img: np.ndarray) -> np.ndarray:
    """
    血管增强预处理流水线
    """
    # 1. CLAHE 增强
    enhanced = apply_clahe(img, clip_limit=3.0)
    
    # 2. 高斯平滑去噪
    enhanced = cv2.GaussianBlur(enhanced, (3, 3), 0.8)
    
    # 3. 可选：顶帽变换突出亮结构
    kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (15, 15))
    tophat = cv2.morphologyEx(enhanced, cv2.MORPH_TOPHAT, kernel)
    
    # 4. 融合
    result = cv2.addWeighted(enhanced, 0.7, tophat, 0.3, 0)
    
    return result


def compute_gradient_magnitude(img: np.ndarray) -> np.ndarray:
    """计算梯度幅值图"""
    sobelx = cv2.Sobel(img, cv2.CV_64F, 1, 0, ksize=3)
    sobely = cv2.Sobel(img, cv2.CV_64F, 0, 1, ksize=3)
    magnitude = np.sqrt(sobelx**2 + sobely**2)
    return (magnitude / magnitude.max() * 255).astype(np.uint8)


# ============================================================================
# 核心：V7 椭圆检测算法
# ============================================================================

def detect_vessels_v7(
    img: np.ndarray,
    min_r: int,
    max_r: int,
    sensitivity: str = "medium",
    use_clahe: bool = True,
    detect_method: str = "combined"
) -> List[Dict]:
    """
    V7 血管检测 - 真正的椭圆拟合
    
    三种检测方法：
    1. blob: 多尺度 Blob 检测（LoG/DoG）
    2. edge: 边缘轮廓检测 + 椭圆拟合
    3. combined: 融合多种方法
    
    返回：椭圆参数列表 [{cx, cy, rx, ry, angle, confidence, method}, ...]
    """
    # 归一化到 uint8
    if img.max() <= 1.0:
        img = (img * 255).astype(np.uint8)
    else:
        img = img.astype(np.uint8)
    
    h, w = img.shape
    candidates = []
    
    # 灵敏度参数
    params = {
        "low": {"blob_thresh": 0.02, "edge_thresh": (80, 160), "min_area_ratio": 0.5, "max_count": 10},
        "medium": {"blob_thresh": 0.01, "edge_thresh": (50, 120), "min_area_ratio": 0.3, "max_count": 20},
        "high": {"blob_thresh": 0.005, "edge_thresh": (30, 80), "min_area_ratio": 0.2, "max_count": 40},
    }.get(sensitivity, {"blob_thresh": 0.01, "edge_thresh": (50, 120), "min_area_ratio": 0.3, "max_count": 20})
    
    # ========================================
    # 预处理
    # ========================================
    if use_clahe:
        enhanced = enhance_vessels(img)
    else:
        enhanced = cv2.GaussianBlur(img, (3, 3), 0.8)
    
    # ========================================
    # 方法1: 多尺度 Blob 检测 (LoG)
    # ========================================
    if detect_method in ["blob", "combined"]:
        try:
            img_float = enhanced.astype(np.float32) / 255.0
            
            # LoG Blob 检测
            blobs = blob_log(
                img_float,
                min_sigma=max(1, min_r / 2),
                max_sigma=max_r,
                num_sigma=10,
                threshold=params["blob_thresh"]
            )
            
            for blob in blobs:
                y, x, sigma = blob
                r = sigma * math.sqrt(2)
                
                if not (min_r * 0.7 <= r <= max_r * 1.3):
                    continue
                if not (max_r < x < w - max_r and max_r < y < h - max_r):
                    continue
                
                # 在 blob 位置尝试精确椭圆拟合
                ellipse = refine_ellipse_at_point(enhanced, int(x), int(y), int(r * 2), min_r, max_r)
                
                if ellipse:
                    ellipse["method"] = "blob_log"
                    ellipse["confidence"] = min(0.9, 0.5 + 0.4 * (1 - params["blob_thresh"] / 0.02))
                    candidates.append(ellipse)
                else:
                    # 退化为圆形
                    candidates.append({
                        "cx": float(x), "cy": float(y),
                        "rx": float(r), "ry": float(r),
                        "angle": 0, "confidence": 0.5, "method": "blob_circle"
                    })
        except Exception as e:
            print(f"[V7] Blob 检测异常: {e}")
    
    # ========================================
    # 方法2: 边缘轮廓 + 椭圆拟合
    # ========================================
    if detect_method in ["edge", "combined"]:
        try:
            # Canny 边缘检测
            edges = cv2.Canny(enhanced, params["edge_thresh"][0], params["edge_thresh"][1])
            
            # 形态学闭运算连接断边
            kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (3, 3))
            edges = cv2.dilate(edges, kernel, iterations=1)
            edges = cv2.erode(edges, kernel, iterations=1)
            
            # 查找轮廓
            contours, _ = cv2.findContours(edges, cv2.RETR_LIST, cv2.CHAIN_APPROX_SIMPLE)
            
            for contour in contours:
                # 轮廓点数检查（椭圆拟合至少需要5个点）
                if len(contour) < 5:
                    continue
                
                # 面积过滤
                area = cv2.contourArea(contour)
                min_area = math.pi * (min_r * params["min_area_ratio"]) ** 2
                max_area = math.pi * (max_r * 1.5) ** 2
                
                if not (min_area < area < max_area):
                    continue
                
                # 椭圆拟合
                try:
                    ellipse = cv2.fitEllipse(contour)
                    (cx, cy), (axis1, axis2), angle = ellipse
                    
                    # axis1, axis2 是直径，转为半径
                    rx, ry = axis1 / 2, axis2 / 2
                    
                    # 确保 rx >= ry
                    if rx < ry:
                        rx, ry = ry, rx
                        angle = (angle + 90) % 180
                    
                    # 尺寸过滤
                    if not (min_r * 0.7 <= min(rx, ry) and max(rx, ry) <= max_r * 1.3):
                        continue
                    
                    # 边界检查
                    if not (max_r < cx < w - max_r and max_r < cy < h - max_r):
                        continue
                    
                    # 椭圆率检查（避免过于扁平）
                    aspect = max(rx, ry) / (min(rx, ry) + 1e-6)
                    if aspect > 4:
                        continue
                    
                    # 计算拟合质量（轮廓点到椭圆的平均距离）
                    fit_quality = compute_ellipse_fit_quality(contour, ellipse)
                    
                    if fit_quality < 5:  # 平均误差小于5像素
                        candidates.append({
                            "cx": float(cx), "cy": float(cy),
                            "rx": float(rx), "ry": float(ry),
                            "angle": float(angle),
                            "confidence": min(0.95, 0.6 + 0.35 * (1 - fit_quality / 5)),
                            "method": "edge_fit"
                        })
                except cv2.error:
                    continue
        except Exception as e:
            print(f"[V7] 边缘检测异常: {e}")
    
    # ========================================
    # 方法3: 自适应阈值 + 连通域
    # ========================================
    if detect_method == "combined":
        try:
            # 自适应阈值
            binary = cv2.adaptiveThreshold(
                enhanced, 255, cv2.ADAPTIVE_THRESH_GAUSSIAN_C,
                cv2.THRESH_BINARY, 21, -5
            )
            
            # 形态学清理
            kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (3, 3))
            binary = cv2.morphologyEx(binary, cv2.MORPH_OPEN, kernel)
            binary = cv2.morphologyEx(binary, cv2.MORPH_CLOSE, kernel)
            
            # 连通域分析
            num_labels, labels, stats, centroids = cv2.connectedComponentsWithStats(binary)
            
            for i in range(1, num_labels):
                area = stats[i, cv2.CC_STAT_AREA]
                
                min_area = math.pi * (min_r * 0.5) ** 2
                max_area = math.pi * (max_r * 1.5) ** 2
                
                if not (min_area < area < max_area):
                    continue
                
                # 提取该连通域的轮廓
                mask = (labels == i).astype(np.uint8)
                contours, _ = cv2.findContours(mask, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
                
                if not contours or len(contours[0]) < 5:
                    continue
                
                contour = contours[0]
                
                try:
                    ellipse = cv2.fitEllipse(contour)
                    (cx, cy), (axis1, axis2), angle = ellipse
                    rx, ry = axis1 / 2, axis2 / 2
                    
                    if rx < ry:
                        rx, ry = ry, rx
                        angle = (angle + 90) % 180
                    
                    if not (min_r * 0.7 <= min(rx, ry) and max(rx, ry) <= max_r * 1.3):
                        continue
                    
                    if not (max_r < cx < w - max_r and max_r < cy < h - max_r):
                        continue
                    
                    # 验证该区域确实较亮
                    region_mean = img[mask > 0].mean() if (mask > 0).sum() > 0 else 0
                    global_mean = img.mean()
                    
                    if region_mean < global_mean * 1.1:
                        continue
                    
                    candidates.append({
                        "cx": float(cx), "cy": float(cy),
                        "rx": float(rx), "ry": float(ry),
                        "angle": float(angle),
                        "confidence": 0.6,
                        "method": "adaptive_thresh"
                    })
                except cv2.error:
                    continue
        except Exception as e:
            print(f"[V7] 自适应阈值检测异常: {e}")
    
    # ========================================
    # 去重与合并
    # ========================================
    candidates = merge_overlapping_ellipses(candidates, overlap_thresh=0.5)
    
    # 按置信度排序
    candidates = sorted(candidates, key=lambda x: -x["confidence"])
    
    return candidates[:params["max_count"]]


def compute_ellipse_fit_quality(contour: np.ndarray, ellipse: Tuple) -> float:
    """
    计算轮廓点到拟合椭圆的平均距离（拟合质量）
    越小越好
    """
    (cx, cy), (axis1, axis2), angle = ellipse
    a, b = axis1 / 2, axis2 / 2
    theta = math.radians(angle)
    
    cos_t, sin_t = math.cos(theta), math.sin(theta)
    
    total_dist = 0
    for pt in contour:
        px, py = pt[0]
        
        # 转换到椭圆坐标系
        dx, dy = px - cx, py - cy
        x_rot = dx * cos_t + dy * sin_t
        y_rot = -dx * sin_t + dy * cos_t
        
        # 到椭圆边界的近似距离
        if a > 0 and b > 0:
            # 归一化坐标
            nx, ny = x_rot / a, y_rot / b
            r = math.sqrt(nx**2 + ny**2)
            if r > 0:
                dist = abs(r - 1) * min(a, b)
                total_dist += dist
    
    return total_dist / len(contour) if len(contour) > 0 else float('inf')


def merge_overlapping_ellipses(candidates: List[Dict], overlap_thresh: float = 0.5) -> List[Dict]:
    """
    合并重叠的椭圆检测结果
    保留置信度更高的
    """
    if not candidates:
        return []
    
    # 按置信度排序
    sorted_cands = sorted(candidates, key=lambda x: -x["confidence"])
    merged = []
    
    for cand in sorted_cands:
        is_duplicate = False
        
        for m in merged:
            # 计算中心距离
            dist = math.sqrt((cand["cx"] - m["cx"])**2 + (cand["cy"] - m["cy"])**2)
            
            # 计算重叠判断阈值
            avg_r = (cand["rx"] + cand["ry"] + m["rx"] + m["ry"]) / 4
            
            if dist < avg_r * overlap_thresh:
                is_duplicate = True
                break
        
        if not is_duplicate:
            merged.append(cand)
    
    return merged


def refine_ellipse_at_point(
    img: np.ndarray,
    cx: int,
    cy: int,
    roi_size: int,
    min_r: int,
    max_r: int
) -> Optional[Dict]:
    """
    在指定点位置精确拟合椭圆
    使用边缘检测 + 轮廓分析
    """
    h, w = img.shape
    
    # 提取 ROI
    half = roi_size // 2
    x1, x2 = max(0, cx - half), min(w, cx + half)
    y1, y2 = max(0, cy - half), min(h, cy + half)
    
    roi = img[y1:y2, x1:x2]
    if roi.size == 0:
        return None
    
    # 边缘检测
    edges = cv2.Canny(roi, 30, 80)
    
    # 膨胀连接
    kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (3, 3))
    edges = cv2.dilate(edges, kernel, iterations=1)
    
    # 查找轮廓
    contours, _ = cv2.findContours(edges, cv2.RETR_LIST, cv2.CHAIN_APPROX_SIMPLE)
    
    if not contours:
        return None
    
    # 找到包含中心点或最近的轮廓
    local_cx, local_cy = cx - x1, cy - y1
    best_contour = None
    best_dist = float('inf')
    
    for contour in contours:
        if len(contour) < 5:
            continue
        
        # 检查轮廓是否包含点击位置
        inside = cv2.pointPolygonTest(contour, (local_cx, local_cy), False)
        
        if inside >= 0:
            # 点在轮廓内部或边界上
            area = cv2.contourArea(contour)
            if math.pi * (min_r * 0.5)**2 < area < math.pi * (max_r * 2)**2:
                best_contour = contour
                break
        else:
            # 计算到轮廓的距离
            dist = abs(cv2.pointPolygonTest(contour, (local_cx, local_cy), True))
            if dist < best_dist:
                best_dist = dist
                best_contour = contour
    
    if best_contour is None or len(best_contour) < 5:
        return None
    
    # 椭圆拟合
    try:
        ellipse = cv2.fitEllipse(best_contour)
        (ecx, ecy), (axis1, axis2), angle = ellipse
        rx, ry = axis1 / 2, axis2 / 2
        
        if rx < ry:
            rx, ry = ry, rx
            angle = (angle + 90) % 180
        
        # 尺寸检查
        if not (min_r * 0.5 <= min(rx, ry) and max(rx, ry) <= max_r * 2):
            return None
        
        # 转换回全局坐标
        return {
            "cx": float(ecx + x1),
            "cy": float(ecy + y1),
            "rx": float(rx),
            "ry": float(ry),
            "angle": float(angle)
        }
    except cv2.error:
        return None


# ============================================================================
# 点击自动拟合（核心改进）
# ============================================================================

def auto_fit_ellipse_at_click(
    img: np.ndarray,
    click_x: int,
    click_y: int,
    roi_size: int = 50,
    min_r: int = 2,
    max_r: int = 20,
    method: str = "auto"
) -> Optional[Dict]:
    """
    点击位置自动拟合椭圆
    
    方法：
    - auto: 自动选择最佳方法
    - edge: 边缘检测 + 椭圆拟合
    - region: 区域生长 + 椭圆拟合
    - blob: Blob 检测
    """
    h, w = img.shape
    
    if not (0 <= click_x < w and 0 <= click_y < h):
        return None
    
    # 归一化
    if img.max() <= 1.0:
        img = (img * 255).astype(np.uint8)
    else:
        img = img.astype(np.uint8)
    
    # 增强
    enhanced = enhance_vessels(img)
    
    results = []
    
    # ========================================
    # 方法1: 边缘引导拟合
    # ========================================
    if method in ["auto", "edge"]:
        result = fit_ellipse_by_edge(enhanced, click_x, click_y, roi_size, min_r, max_r)
        if result:
            result["method"] = "edge"
            results.append(result)
    
    # ========================================
    # 方法2: 区域生长拟合
    # ========================================
    if method in ["auto", "region"]:
        result = fit_ellipse_by_region_growing(enhanced, click_x, click_y, roi_size, min_r, max_r)
        if result:
            result["method"] = "region"
            results.append(result)
    
    # ========================================
    # 方法3: 局部 Blob 检测
    # ========================================
    if method in ["auto", "blob"]:
        result = fit_ellipse_by_local_blob(enhanced, click_x, click_y, roi_size, min_r, max_r)
        if result:
            result["method"] = "blob"
            results.append(result)
    
    # ========================================
    # 方法4: 梯度引导分水岭
    # ========================================
    if method == "auto":
        result = fit_ellipse_by_watershed(enhanced, click_x, click_y, roi_size, min_r, max_r)
        if result:
            result["method"] = "watershed"
            results.append(result)
    
    if not results:
        return None
    
    # 选择最佳结果（离点击位置最近 + 置信度最高）
    best = min(results, key=lambda r: 
        math.sqrt((r["cx"] - click_x)**2 + (r["cy"] - click_y)**2) / (r.get("confidence", 0.5) + 0.1)
    )
    
    return best


def fit_ellipse_by_edge(
    img: np.ndarray,
    cx: int,
    cy: int,
    roi_size: int,
    min_r: int,
    max_r: int
) -> Optional[Dict]:
    """边缘检测方法拟合椭圆"""
    h, w = img.shape
    half = roi_size // 2
    
    x1, x2 = max(0, cx - half), min(w, cx + half)
    y1, y2 = max(0, cy - half), min(h, cy + half)
    
    roi = img[y1:y2, x1:x2]
    if roi.size == 0:
        return None
    
    # 多尺度边缘检测
    edges_list = []
    for low, high in [(20, 50), (30, 80), (50, 120)]:
        edges = cv2.Canny(roi, low, high)
        edges_list.append(edges)
    
    # 合并边缘
    combined_edges = np.maximum.reduce(edges_list)
    
    # 闭运算连接
    kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (3, 3))
    combined_edges = cv2.morphologyEx(combined_edges, cv2.MORPH_CLOSE, kernel)
    
    # 查找轮廓
    contours, _ = cv2.findContours(combined_edges, cv2.RETR_LIST, cv2.CHAIN_APPROX_SIMPLE)
    
    local_cx, local_cy = cx - x1, cy - y1
    best_ellipse = None
    best_score = float('inf')
    
    for contour in contours:
        if len(contour) < 5:
            continue
        
        area = cv2.contourArea(contour)
        if not (math.pi * (min_r * 0.3)**2 < area < math.pi * (max_r * 2)**2):
            continue
        
        # 检查是否包含点击位置
        inside = cv2.pointPolygonTest(contour, (local_cx, local_cy), True)
        
        try:
            ellipse = cv2.fitEllipse(contour)
            (ecx, ecy), (axis1, axis2), angle = ellipse
            rx, ry = axis1 / 2, axis2 / 2
            
            if rx < ry:
                rx, ry = ry, rx
                angle = (angle + 90) % 180
            
            if not (min_r * 0.5 <= min(rx, ry) and max(rx, ry) <= max_r * 1.5):
                continue
            
            # 评分：距离 + 面积匹配 + 是否包含点击点
            dist = math.sqrt((ecx - local_cx)**2 + (ecy - local_cy)**2)
            
            if inside >= 0:
                dist *= 0.5  # 包含点击点的轮廓优先
            
            if dist < best_score:
                best_score = dist
                best_ellipse = {
                    "cx": float(ecx + x1),
                    "cy": float(ecy + y1),
                    "rx": float(rx),
                    "ry": float(ry),
                    "angle": float(angle),
                    "confidence": max(0.5, min(0.95, 1 - dist / roi_size))
                }
        except cv2.error:
            continue
    
    return best_ellipse


def fit_ellipse_by_region_growing(
    img: np.ndarray,
    cx: int,
    cy: int,
    roi_size: int,
    min_r: int,
    max_r: int
) -> Optional[Dict]:
    """区域生长方法拟合椭圆"""
    h, w = img.shape
    half = roi_size // 2
    
    x1, x2 = max(0, cx - half), min(w, cx + half)
    y1, y2 = max(0, cy - half), min(h, cy + half)
    
    roi = img[y1:y2, x1:x2].astype(np.float32)
    if roi.size == 0:
        return None
    
    local_cx, local_cy = cx - x1, cy - y1
    
    # 种子点亮度
    seed_value = roi[local_cy, local_cx]
    
    # 计算局部统计
    local_mean = roi.mean()
    local_std = roi.std()
    
    # 如果种子点不够亮，可能点击位置不对
    if seed_value < local_mean:
        return None
    
    # 区域生长
    threshold = max(local_mean, seed_value - 2 * local_std)
    
    mask = np.zeros_like(roi, dtype=np.uint8)
    visited = np.zeros_like(roi, dtype=bool)
    stack = [(local_cx, local_cy)]
    
    while stack:
        x, y = stack.pop()
        
        if x < 0 or x >= roi.shape[1] or y < 0 or y >= roi.shape[0]:
            continue
        if visited[y, x]:
            continue
        
        visited[y, x] = True
        
        if roi[y, x] >= threshold:
            mask[y, x] = 255
            
            # 限制生长范围
            if math.sqrt((x - local_cx)**2 + (y - local_cy)**2) < max_r * 1.5:
                for dx, dy in [(-1, 0), (1, 0), (0, -1), (0, 1)]:
                    stack.append((x + dx, y + dy))
    
    # 形态学清理
    kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (3, 3))
    mask = cv2.morphologyEx(mask, cv2.MORPH_CLOSE, kernel)
    mask = cv2.morphologyEx(mask, cv2.MORPH_OPEN, kernel)
    
    # 查找轮廓
    contours, _ = cv2.findContours(mask, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
    
    if not contours:
        return None
    
    # 找最大轮廓
    largest = max(contours, key=cv2.contourArea)
    
    if len(largest) < 5:
        return None
    
    area = cv2.contourArea(largest)
    if not (math.pi * (min_r * 0.3)**2 < area < math.pi * (max_r * 2)**2):
        return None
    
    try:
        ellipse = cv2.fitEllipse(largest)
        (ecx, ecy), (axis1, axis2), angle = ellipse
        rx, ry = axis1 / 2, axis2 / 2
        
        if rx < ry:
            rx, ry = ry, rx
            angle = (angle + 90) % 180
        
        if not (min_r * 0.5 <= min(rx, ry) and max(rx, ry) <= max_r * 1.5):
            return None
        
        return {
            "cx": float(ecx + x1),
            "cy": float(ecy + y1),
            "rx": float(rx),
            "ry": float(ry),
            "angle": float(angle),
            "confidence": 0.75
        }
    except cv2.error:
        return None


def fit_ellipse_by_local_blob(
    img: np.ndarray,
    cx: int,
    cy: int,
    roi_size: int,
    min_r: int,
    max_r: int
) -> Optional[Dict]:
    """局部 Blob 检测方法"""
    h, w = img.shape
    half = roi_size // 2
    
    x1, x2 = max(0, cx - half), min(w, cx + half)
    y1, y2 = max(0, cy - half), min(h, cy + half)
    
    roi = img[y1:y2, x1:x2]
    if roi.size == 0:
        return None
    
    roi_float = roi.astype(np.float32) / 255.0
    
    try:
        blobs = blob_log(
            roi_float,
            min_sigma=max(1, min_r / 2),
            max_sigma=max_r,
            num_sigma=8,
            threshold=0.008
        )
    except Exception:
        return None
    
    if len(blobs) == 0:
        return None
    
    local_cx, local_cy = cx - x1, cy - y1
    
    # 找最近的 blob
    best_blob = None
    best_dist = float('inf')
    
    for blob in blobs:
        by, bx, sigma = blob
        dist = math.sqrt((bx - local_cx)**2 + (by - local_cy)**2)
        
        if dist < best_dist:
            best_dist = dist
            best_blob = blob
    
    if best_blob is None:
        return None
    
    by, bx, sigma = best_blob
    r = sigma * math.sqrt(2)
    
    # 在 blob 位置尝试精确拟合
    refined = refine_ellipse_at_point(img, int(bx + x1), int(by + y1), int(r * 3), min_r, max_r)
    
    if refined:
        refined["confidence"] = 0.7
        return refined
    
    # 退化为圆
    return {
        "cx": float(bx + x1),
        "cy": float(by + y1),
        "rx": float(r),
        "ry": float(r),
        "angle": 0,
        "confidence": 0.5
    }


def fit_ellipse_by_watershed(
    img: np.ndarray,
    cx: int,
    cy: int,
    roi_size: int,
    min_r: int,
    max_r: int
) -> Optional[Dict]:
    """分水岭分割方法"""
    h, w = img.shape
    half = roi_size // 2
    
    x1, x2 = max(0, cx - half), min(w, cx + half)
    y1, y2 = max(0, cy - half), min(h, cy + half)
    
    roi = img[y1:y2, x1:x2]
    if roi.size == 0:
        return None
    
    local_cx, local_cy = cx - x1, cy - y1
    
    # 计算梯度
    gradient = compute_gradient_magnitude(roi)
    
    # 标记前景（点击位置）
    markers = np.zeros_like(roi, dtype=np.int32)
    markers[local_cy, local_cx] = 1
    
    # 标记背景（边界）
    markers[0, :] = 2
    markers[-1, :] = 2
    markers[:, 0] = 2
    markers[:, -1] = 2
    
    # 分水岭
    roi_color = cv2.cvtColor(roi, cv2.COLOR_GRAY2BGR)
    cv2.watershed(roi_color, markers)
    
    # 提取前景区域
    mask = (markers == 1).astype(np.uint8) * 255
    
    # 形态学清理
    kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (3, 3))
    mask = cv2.morphologyEx(mask, cv2.MORPH_CLOSE, kernel)
    
    # 查找轮廓
    contours, _ = cv2.findContours(mask, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
    
    if not contours:
        return None
    
    largest = max(contours, key=cv2.contourArea)
    
    if len(largest) < 5:
        return None
    
    area = cv2.contourArea(largest)
    if not (math.pi * (min_r * 0.3)**2 < area < math.pi * (max_r * 2)**2):
        return None
    
    try:
        ellipse = cv2.fitEllipse(largest)
        (ecx, ecy), (axis1, axis2), angle = ellipse
        rx, ry = axis1 / 2, axis2 / 2
        
        if rx < ry:
            rx, ry = ry, rx
            angle = (angle + 90) % 180
        
        if not (min_r * 0.5 <= min(rx, ry) and max(rx, ry) <= max_r * 1.5):
            return None
        
        return {
            "cx": float(ecx + x1),
            "cy": float(ecy + y1),
            "rx": float(rx),
            "ry": float(ry),
            "angle": float(angle),
            "confidence": 0.65
        }
    except cv2.error:
        return None


# ============================================================================
# API 路由
# ============================================================================

@router.post("/projects", response_model=AnnotationProject)
async def create_project(request: CreateProjectRequest):
    volume_path = PROCESSED_DIR / request.volume_id / "volume.npy"
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")
    project_id = f"ann_{datetime.now().strftime('%Y%m%d_%H%M%S')}_{uuid.uuid4().hex[:8]}"
    now = datetime.now().isoformat()
    project = AnnotationProject(id=project_id, volume_id=request.volume_id, name=request.name, created_at=now, modified_at=now)
    save_project(project)
    return project

@router.get("/projects")
async def list_projects():
    projects = []
    if ANNOTATIONS_DIR.exists():
        for proj_dir in ANNOTATIONS_DIR.iterdir():
            if proj_dir.is_dir():
                project = load_project(proj_dir.name)
                if project:
                    projects.append({"id": project.id, "name": project.name, "volume_id": project.volume_id, "created_at": project.created_at, "modified_at": project.modified_at, "layer_count": len(project.layers)})
    return projects

@router.get("/projects/{project_id}")
async def get_project(project_id: str):
    project = load_project(project_id)
    if not project:
        raise HTTPException(status_code=404, detail="项目不存在")
    return project.model_dump()

@router.delete("/projects/{project_id}")
async def delete_project(project_id: str):
    import shutil
    proj_dir = ANNOTATIONS_DIR / project_id
    if proj_dir.exists():
        shutil.rmtree(proj_dir)
    return {"message": "已删除"}

@router.post("/projects/{project_id}/save")
async def save_annotation(project_id: str, request: SaveAnnotationRequest):
    project = load_project(project_id)
    if not project:
        raise HTTPException(status_code=404, detail="项目不存在")
    if request.layer_key in project.layers:
        project.undo_stack.append({"action": "update_layer", "layer_key": request.layer_key, "old_data": project.layers[request.layer_key].model_dump()})
        if len(project.undo_stack) > 50:
            project.undo_stack = project.undo_stack[-50:]
    project.redo_stack = []
    parts = request.layer_key.split('_')
    layer = AnnotationLayer(slice_index=int(parts[1]), axis=parts[0], ellipses=request.ellipses, brush_strokes=request.brush_strokes)
    project.layers[request.layer_key] = layer
    project.modified_at = datetime.now().isoformat()
    save_project(project)
    return {"message": "已保存", "ellipse_count": len(request.ellipses)}

@router.get("/projects/{project_id}/layer/{layer_key}")
async def get_layer(project_id: str, layer_key: str):
    project = load_project(project_id)
    if not project:
        raise HTTPException(status_code=404, detail="项目不存在")
    if layer_key not in project.layers:
        return {"ellipses": [], "brush_strokes": [], "slice_index": 0, "axis": "y"}
    layer = project.layers[layer_key]
    return {"ellipses": [e.model_dump() for e in layer.ellipses], "brush_strokes": [s.model_dump() for s in layer.brush_strokes], "slice_index": layer.slice_index, "axis": layer.axis}

@router.post("/projects/{project_id}/undo")
async def undo(project_id: str):
    project = load_project(project_id)
    if not project or not project.undo_stack:
        return {"message": "无操作"}
    action = project.undo_stack.pop()
    if action["action"] == "update_layer":
        lk = action["layer_key"]
        if lk in project.layers:
            project.redo_stack.append({"action": "update_layer", "layer_key": lk, "old_data": project.layers[lk].model_dump()})
        project.layers[lk] = AnnotationLayer(**action["old_data"])
    save_project(project)
    return {"message": "已撤销"}

@router.post("/projects/{project_id}/redo")
async def redo(project_id: str):
    project = load_project(project_id)
    if not project or not project.redo_stack:
        return {"message": "无操作"}
    action = project.redo_stack.pop()
    if action["action"] == "update_layer":
        lk = action["layer_key"]
        if lk in project.layers:
            project.undo_stack.append({"action": "update_layer", "layer_key": lk, "old_data": project.layers[lk].model_dump()})
        project.layers[lk] = AnnotationLayer(**action["old_data"])
    save_project(project)
    return {"message": "已重做"}

@router.post("/projects/{project_id}/generate-mask")
async def generate_gold_standard_mask(project_id: str):
    project = load_project(project_id)
    if not project:
        raise HTTPException(status_code=404, detail="项目不存在")
    volume_path = PROCESSED_DIR / project.volume_id / "volume.npy"
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")
    volume = np.load(volume_path)
    X, Y, Z = volume.shape
    mask = np.zeros((X, Y, Z), dtype=np.uint8)
    
    for layer_key, layer in project.layers.items():
        axis, slice_idx = layer.axis, layer.slice_index
        if axis == 'x': slice_shape = (Y, Z)
        elif axis == 'y': slice_shape = (X, Z)
        else: slice_shape = (X, Y)
        slice_mask = np.zeros(slice_shape, dtype=np.uint8)
        
        for e in layer.ellipses:
            # 支持旋转的椭圆绘制
            cv2.ellipse(
                slice_mask, 
                (int(e.center_x), int(e.center_y)), 
                (max(1, int(e.radius_x)), max(1, int(e.radius_y))), 
                e.rotation,  # 使用旋转角度
                0, 360, 1, -1
            )
        
        for s in layer.brush_strokes:
            pts = [(int(p.x), int(p.y)) for p in s.points]
            for i in range(len(pts) - 1):
                cv2.line(slice_mask, pts[i], pts[i + 1], 0 if s.is_eraser else 1, max(1, int(s.brush_size)))
        
        if axis == 'x': mask[slice_idx, :, :] = np.maximum(mask[slice_idx, :, :], slice_mask)
        elif axis == 'y': mask[:, slice_idx, :] = np.maximum(mask[:, slice_idx, :], slice_mask)
        else: mask[:, :, slice_idx] = np.maximum(mask[:, :, slice_idx], slice_mask)
    
    mask_dir = ANNOTATIONS_DIR / project_id / "masks"
    mask_dir.mkdir(parents=True, exist_ok=True)
    np.save(mask_dir / "gold_standard.npy", mask)
    return {"message": "已生成", "vessel_voxels": int(mask.sum()), "vessel_fraction": f"{mask.sum() / mask.size * 100:.2f}%"}

@router.get("/projects/{project_id}/mask")
async def get_mask(project_id: str):
    p = ANNOTATIONS_DIR / project_id / "masks" / "gold_standard.npy"
    if not p.exists():
        raise HTTPException(status_code=404, detail="不存在")
    return FileResponse(str(p))


# ============================================================================
# 点击自动拟合 API（核心改进）
# ============================================================================

@router.post("/projects/{project_id}/auto-fit-at-point")
async def auto_fit_at_point(project_id: str, request: AutoFitAtPointRequest):
    """
    V7 改进的点击自动拟合
    支持多种拟合方法：auto, edge, region, blob
    """
    project = load_project(project_id)
    if not project:
        raise HTTPException(status_code=404, detail="项目不存在")
    
    volume_path = PROCESSED_DIR / project.volume_id / "volume.npy"
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")
    
    vol = np.load(volume_path).astype(np.float32)
    vol_norm = ((vol - vol.min()) / (vol.max() - vol.min() + 1e-8) * 255).astype(np.uint8)
    
    axis_map = {'x': 0, 'y': 1, 'z': 2}
    ax = axis_map.get(request.axis, 1)
    
    if ax == 0: sl = vol_norm[request.slice_index, :, :]
    elif ax == 1: sl = vol_norm[:, request.slice_index, :]
    else: sl = vol_norm[:, :, request.slice_index]
    
    h, w = sl.shape
    cx, cy = int(request.click_x), int(request.click_y)
    
    if not (0 <= cx < w and 0 <= cy < h):
        raise HTTPException(status_code=400, detail="点击位置超出范围")
    
    # 调用 V7 自动拟合
    result = auto_fit_ellipse_at_click(
        sl, cx, cy,
        roi_size=request.roi_size,
        min_r=2,
        max_r=20,
        method=request.method
    )
    
    if not result:
        raise HTTPException(status_code=400, detail="未检测到椭圆，请尝试点击血管中心位置")
    
    return {
        "center_x": result["cx"],
        "center_y": result["cy"],
        "radius_x": result["rx"],
        "radius_y": result["ry"],
        "rotation": result.get("angle", 0),
        "confidence": result.get("confidence", 0.8),
        "method": result.get("method", "unknown")
    }


# ============================================================================
# 快速检测算法（优化版）
# ============================================================================

def detect_vessels_fast(
    img: np.ndarray,
    min_r: int,
    max_r: int,
    sensitivity: str = "medium",
    use_clahe: bool = True,
) -> List[Dict]:
    """
    快速血管检测 - 单一优化算法，速度提升 5-10 倍
    
    核心优化：
    1. 只用自适应阈值 + 连通域（最快）
    2. 简化椭圆拟合
    3. 去除冗余计算
    """
    if img.max() <= 1.0:
        img = (img * 255).astype(np.uint8)
    else:
        img = img.astype(np.uint8)
    
    h, w = img.shape
    
    # 灵敏度参数
    params = {
        "low": {"block_size": 25, "c": -3, "min_area_ratio": 0.5, "max_count": 15},
        "medium": {"block_size": 21, "c": -5, "min_area_ratio": 0.3, "max_count": 25},
        "high": {"block_size": 17, "c": -7, "min_area_ratio": 0.2, "max_count": 40},
    }.get(sensitivity, {"block_size": 21, "c": -5, "min_area_ratio": 0.3, "max_count": 25})
    
    # 预处理
    if use_clahe:
        clahe = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8, 8))
        enhanced = clahe.apply(img)
    else:
        enhanced = img
    
    enhanced = cv2.GaussianBlur(enhanced, (3, 3), 0.5)
    
    # 自适应阈值（最快的检测方法）
    binary = cv2.adaptiveThreshold(
        enhanced, 255, cv2.ADAPTIVE_THRESH_GAUSSIAN_C,
        cv2.THRESH_BINARY, params["block_size"], params["c"]
    )
    
    # 形态学清理
    kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (3, 3))
    binary = cv2.morphologyEx(binary, cv2.MORPH_OPEN, kernel, iterations=1)
    
    # 连通域分析
    num_labels, labels, stats, centroids = cv2.connectedComponentsWithStats(binary)
    
    candidates = []
    min_area = math.pi * (min_r * params["min_area_ratio"]) ** 2
    max_area = math.pi * (max_r * 1.5) ** 2
    
    for i in range(1, min(num_labels, 100)):  # 限制最大处理数量
        area = stats[i, cv2.CC_STAT_AREA]
        
        if not (min_area < area < max_area):
            continue
        
        # 快速边界框检查
        bx, by = stats[i, cv2.CC_STAT_LEFT], stats[i, cv2.CC_STAT_TOP]
        bw, bh = stats[i, cv2.CC_STAT_WIDTH], stats[i, cv2.CC_STAT_HEIGHT]
        
        if bx < max_r or by < max_r or bx + bw > w - max_r or by + bh > h - max_r:
            continue
        
        # 宽高比检查
        aspect = max(bw, bh) / (min(bw, bh) + 1e-6)
        if aspect > 4:
            continue
        
        # 提取轮廓
        mask = (labels == i).astype(np.uint8)
        contours, _ = cv2.findContours(mask, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
        
        if not contours or len(contours[0]) < 5:
            continue
        
        contour = contours[0]
        
        # 椭圆拟合
        try:
            ellipse = cv2.fitEllipse(contour)
            (cx, cy), (axis1, axis2), angle = ellipse
            rx, ry = axis1 / 2, axis2 / 2
            
            if rx < ry:
                rx, ry = ry, rx
                angle = (angle + 90) % 180
            
            # 尺寸过滤
            if not (min_r * 0.6 <= min(rx, ry) and max(rx, ry) <= max_r * 1.4):
                continue
            
            # 验证亮度
            region_mean = img[mask > 0].mean() if (mask > 0).sum() > 0 else 0
            if region_mean < img.mean() * 1.05:
                continue
            
            candidates.append({
                "cx": float(cx), "cy": float(cy),
                "rx": float(rx), "ry": float(ry),
                "angle": float(angle),
                "confidence": 0.7,
                "method": "fast"
            })
        except cv2.error:
            continue
    
    # 简单去重
    candidates = merge_overlapping_ellipses(candidates, overlap_thresh=0.4)
    
    return candidates[:params["max_count"]]


def process_slice_batch(args):
    """单切片处理函数（用于并行）"""
    idx, slice_data, min_r, max_r, sensitivity, use_clahe, detect_method = args
    
    if detect_method == "fast":
        cands = detect_vessels_fast(slice_data, min_r, max_r, sensitivity, use_clahe)
    else:
        cands = detect_vessels_v7(slice_data, min_r, max_r, sensitivity, use_clahe, detect_method)
    
    return idx, cands


# ============================================================================
# 自动标注 API（优化版）
# ============================================================================

@router.post("/projects/{project_id}/autolabel")
async def auto_label(project_id: str, req: AutoLabelRequest = Body(...)):
    """
    V7 改进的自动标注 - 支持快速模式和并行处理
    
    detect_method:
    - "fast": 快速模式，速度提升 5-10x（推荐）
    - "edge": 边缘检测模式
    - "blob": Blob 检测模式  
    - "combined": 融合模式（最慢但最准）
    """
    import time
    from concurrent.futures import ThreadPoolExecutor, as_completed
    
    start_time = time.time()
    
    print(f"[V7] 检测: axis={req.axis}, r={req.min_radius}-{req.max_radius}, sens={req.sensitivity}, method={req.detect_method}")
    
    project = load_project(project_id)
    if not project:
        raise HTTPException(status_code=404, detail="项目不存在")
    
    volume_path = PROCESSED_DIR / project.volume_id / "volume.npy"
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")
    
    vol = np.load(volume_path).astype(np.float32)
    vol_norm = ((vol - vol.min()) / (vol.max() - vol.min() + 1e-8) * 255).astype(np.uint8)
    
    axis_map = {'x': 0, 'y': 1, 'z': 2}
    ax = axis_map.get(req.axis, 1)
    total = vol_norm.shape[ax]
    
    if req.regen:
        for k in list(project.layers.keys()):
            if k.startswith(f"{req.axis}_"):
                project.layers.pop(k)
    
    # 提取所有切片
    slices = []
    for idx in range(total):
        if ax == 0: sl = vol_norm[idx, :, :]
        elif ax == 1: sl = vol_norm[:, idx, :]
        else: sl = vol_norm[:, :, idx]
        slices.append((idx, sl, req.min_radius, req.max_radius, req.sensitivity, req.use_clahe, req.detect_method))
    
    # 并行处理
    results = {}
    num_workers = min(8, os.cpu_count() or 4)  # 限制线程数
    
    print(f"[V7] 使用 {num_workers} 线程并行处理 {total} 切片...")
    
    with ThreadPoolExecutor(max_workers=num_workers) as executor:
        futures = {executor.submit(process_slice_batch, args): args[0] for args in slices}
        
        done_count = 0
        for future in as_completed(futures):
            idx, cands = future.result()
            if cands:
                results[idx] = cands
            
            done_count += 1
            if done_count % 100 == 0:
                elapsed = time.time() - start_time
                speed = done_count / elapsed
                eta = (total - done_count) / speed if speed > 0 else 0
                print(f"[V7] 进度: {done_count}/{total} ({done_count/total*100:.1f}%), 速度: {speed:.1f} 切片/秒, 预计剩余: {eta:.0f}秒")
    
    # 保存结果
    added = 0
    ellipse_with_rotation = 0
    
    for idx, cands in results.items():
        lk = f"{req.axis}_{idx}"
        ellipses = []
        
        for i, c in enumerate(cands):
            angle = c.get("angle", 0)
            if abs(angle) > 1:
                ellipse_with_rotation += 1
            
            ellipses.append(EllipseAnnotation(
                id=f"auto_{uuid.uuid4().hex[:8]}",
                center_x=c["cx"], center_y=c["cy"],
                radius_x=c["rx"], radius_y=c["ry"],
                rotation=angle,
                slice_index=idx, axis=req.axis,
                vessel_id=f"v{i}", confidence=c.get("confidence", 0.7),
                is_manual=False, created_at=datetime.now().isoformat()
            ))
            added += 1
        
        project.layers[lk] = AnnotationLayer(slice_index=idx, axis=req.axis, ellipses=ellipses, brush_strokes=[])
    
    project.modified_at = datetime.now().isoformat()
    save_project(project)
    
    elapsed = time.time() - start_time
    slices_done = len(results)
    
    print(f"[V7] 完成: {added} 椭圆, {slices_done} 切片, 耗时 {elapsed:.1f}秒")
    
    return {
        "message": "检测完成",
        "code_version": CODE_VERSION,
        "added_ellipses": added,
        "ellipses_with_rotation": ellipse_with_rotation,
        "labeled_slices": slices_done,
        "total_slices": total,
        "coverage_percent": f"{slices_done/total*100:.1f}%",
        "time_seconds": round(elapsed, 1),
        "speed_slices_per_sec": round(total / elapsed, 1) if elapsed > 0 else 0,
        "axis": req.axis,
        "params_used": {
            "min_radius": req.min_radius, 
            "max_radius": req.max_radius, 
            "sensitivity": req.sensitivity,
            "use_clahe": req.use_clahe,
            "detect_method": req.detect_method
        }
    }


@router.post("/fit-ellipse")
async def fit_ellipse_from_points(points: List[AnnotationPoint]):
    """从用户标注的点拟合椭圆"""
    if len(points) < 5:
        raise HTTPException(status_code=400, detail="椭圆拟合至少需要5个点")
    
    pts = np.array([[p.x, p.y] for p in points], dtype=np.float32)
    
    try:
        ellipse = cv2.fitEllipse(pts)
        (cx, cy), (axis1, axis2), angle = ellipse
        rx, ry = axis1 / 2, axis2 / 2
        
        # 标准化：确保 rx >= ry
        if rx < ry:
            rx, ry = ry, rx
            angle = (angle + 90) % 180
        
        return {
            "center_x": float(cx),
            "center_y": float(cy),
            "radius_x": float(rx),
            "radius_y": float(ry),
            "rotation": float(angle)
        }
    except cv2.error as e:
        raise HTTPException(status_code=400, detail=f"椭圆拟合失败: {str(e)}")


# ============================================================================
# 辅助 API
# ============================================================================

@router.get("/version")
async def get_version():
    """获取当前版本信息"""
    return {
        "version": CODE_VERSION,
        "features": [
            "真正的椭圆拟合 (cv2.fitEllipse)",
            "CLAHE 对比度增强",
            "⚡ 快速检测模式 (fast)",
            "8线程并行处理",
            "多尺度 Blob 检测 (LoG)",
            "边缘引导检测",
            "区域生长拟合",
            "多方法融合"
        ]
    }
</file>

<file path="backend/api/data_routes.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 数据管理路由

功能：
1. DICOM/OCTA 数据上传
2. 数据解析和预览
3. 3D 体数据切片获取
4. 网格数据生成与获取
"""

import os
import uuid
import json
from pathlib import Path
from typing import Optional, List
from datetime import datetime

from fastapi import APIRouter, UploadFile, File, HTTPException, Query, BackgroundTasks, Body
from fastapi.responses import FileResponse, StreamingResponse
from pydantic import BaseModel
import numpy as np
import trimesh  # 新增：用于读取/返回网格数据

# 导入核心处理模块
from core.dicom_reader import DicomReader
from core.volume_processor import VolumeProcessor
from core.mesh_generator import MeshGenerator
from core.distortion_correction import DistortionCorrector

router = APIRouter()

# 数据目录配置
DATA_DIR = Path(__file__).parent.parent / "data"
UPLOADS_DIR = DATA_DIR / "uploads"
PROCESSED_DIR = DATA_DIR / "processed"

# ============================================================================
# 数据模型定义
# ============================================================================

class VolumeInfo(BaseModel):
    """体数据信息模型"""
    id: str
    filename: str
    shape: List[int]
    spacing: List[float]
    origin: List[float]
    axis_labels: List[str]  # 如 ["X", "Y", "Z"]
    value_range: List[float]
    vessel_fraction: float  # 血管占比
    created_at: str

class SliceRequest(BaseModel):
    """切片请求模型"""
    volume_id: str
    axis: str  # "x", "y", "z"
    index: int
    apply_correction: bool = False  # 是否应用畸变矫正

class MeshRequest(BaseModel):
    """网格生成请求模型"""
    threshold: float = 0.5          # 等值面阈值
    smooth: bool = True             # 是否平滑
    decimate_ratio: float = 0.5     # 网格简化比例（0-1，1 表示不简化）

# ============================================================================
# 全局数据存储（生产环境应使用数据库）
# ============================================================================

loaded_volumes = {}

# ============================================================================
# 辅助函数
# ============================================================================

def generate_volume_id() -> str:
    return f"vol_{datetime.now().strftime('%Y%m%d_%H%M%S')}_{uuid.uuid4().hex[:8]}"

def save_volume_metadata(volume_id: str, info: dict):
    meta_path = PROCESSED_DIR / volume_id / "metadata.json"
    meta_path.parent.mkdir(parents=True, exist_ok=True)
    with open(meta_path, 'w', encoding='utf-8') as f:
        json.dump(info, f, ensure_ascii=False, indent=2)

def load_volume_metadata(volume_id: str) -> Optional[dict]:
    meta_path = PROCESSED_DIR / volume_id / "metadata.json"
    if meta_path.exists():
        with open(meta_path, 'r', encoding='utf-8') as f:
            return json.load(f)
    return None

# ============================================================================
# 数据上传和解析接口
# ============================================================================

@router.post("/upload", response_model=VolumeInfo)
async def upload_volume(
    file: UploadFile = File(...),
    background_tasks: BackgroundTasks = None
):
    volume_id = generate_volume_id()

    upload_path = UPLOADS_DIR / volume_id
    upload_path.mkdir(parents=True, exist_ok=True)

    file_path = upload_path / file.filename
    with open(file_path, 'wb') as f:
        content = await file.read()
        f.write(content)

    try:
        reader = DicomReader()
        volume_data, metadata = reader.read_volume(str(file_path))

        processor = VolumeProcessor()
        processed_data = processor.preprocess(volume_data)

        processed_path = PROCESSED_DIR / volume_id
        processed_path.mkdir(parents=True, exist_ok=True)
        np.save(processed_path / "volume.npy", processed_data)

        _generate_preview_slices(volume_id, processed_data)

        info = VolumeInfo(
            id=volume_id,
            filename=file.filename,
            shape=list(processed_data.shape),
            spacing=metadata.get('spacing', [1.0, 1.0, 1.0]),
            origin=metadata.get('origin', [0.0, 0.0, 0.0]),
            axis_labels=metadata.get('axis_labels', ['X', 'Y', 'Z']),
            value_range=[float(processed_data.min()), float(processed_data.max())],
            vessel_fraction=float(np.sum(processed_data > 0.5) / processed_data.size),
            created_at=datetime.now().isoformat()
        )

        save_volume_metadata(volume_id, info.model_dump())
        loaded_volumes[volume_id] = info.model_dump()

        return info

    except Exception as e:
        import shutil
        if upload_path.exists():
            shutil.rmtree(upload_path)
        raise HTTPException(status_code=400, detail=f"数据解析失败: {str(e)}")

def _generate_preview_slices(volume_id: str, data: np.ndarray):
    import cv2

    preview_dir = PROCESSED_DIR / volume_id / "previews"
    preview_dir.mkdir(parents=True, exist_ok=True)

    for axis, axis_name in enumerate(['x', 'y', 'z']):
        mid_idx = data.shape[axis] // 2

        if axis == 0:
            slice_data = data[mid_idx, :, :]
        elif axis == 1:
            slice_data = data[:, mid_idx, :]
        else:
            slice_data = data[:, :, mid_idx]

        slice_norm = ((slice_data - slice_data.min()) /
                      (slice_data.max() - slice_data.min() + 1e-8) * 255).astype(np.uint8)

        cv2.imwrite(str(preview_dir / f"preview_{axis_name}.png"), slice_norm)

@router.get("/list")
async def list_volumes():
    volumes = []
    for vol_dir in PROCESSED_DIR.iterdir():
        if vol_dir.is_dir():
            meta = load_volume_metadata(vol_dir.name)
            if meta:
                volumes.append(meta)
    return volumes

@router.get("/{volume_id}/info")
async def get_volume_info(volume_id: str):
    meta = load_volume_metadata(volume_id)
    if not meta:
        raise HTTPException(status_code=404, detail="体数据不存在")
    return meta

@router.delete("/{volume_id}")
async def delete_volume(volume_id: str):
    import shutil

    upload_path = UPLOADS_DIR / volume_id
    if upload_path.exists():
        shutil.rmtree(upload_path)

    processed_path = PROCESSED_DIR / volume_id
    if processed_path.exists():
        shutil.rmtree(processed_path)

    if volume_id in loaded_volumes:
        del loaded_volumes[volume_id]

    return {"message": f"体数据 {volume_id} 已删除"}

# ============================================================================
# 切片获取接口
# ============================================================================

@router.get("/{volume_id}/slice/{axis}/{index}")
async def get_slice(
    volume_id: str,
    axis: str,
    index: int,
    apply_correction: bool = Query(False, description="是否应用畸变矫正")
):
    import cv2
    import io

    volume_path = PROCESSED_DIR / volume_id / "volume.npy"
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")

    data = np.load(volume_path)

    axis_map = {'x': 0, 'y': 1, 'z': 2}
    if axis.lower() not in axis_map:
        raise HTTPException(status_code=400, detail="无效的轴向，必须是 x, y, z")

    axis_idx = axis_map[axis.lower()]
    if index < 0 or index >= data.shape[axis_idx]:
        raise HTTPException(
            status_code=400,
            detail=f"索引超出范围，{axis} 轴范围: [0, {data.shape[axis_idx] - 1}]"
        )

    if axis_idx == 0:
        slice_data = data[index, :, :]
    elif axis_idx == 1:
        slice_data = data[:, index, :]
    else:
        slice_data = data[:, :, index]

    if apply_correction:
        corrector = DistortionCorrector()
        slice_data = corrector.correct_slice(slice_data, axis=axis.lower())

    slice_norm = ((slice_data - slice_data.min()) /
                  (slice_data.max() - slice_data.min() + 1e-8) * 255).astype(np.uint8)

    _, buffer = cv2.imencode('.png', slice_norm)

    return StreamingResponse(
        io.BytesIO(buffer.tobytes()),
        media_type="image/png",
        headers={"Content-Disposition": f"inline; filename=slice_{axis}_{index}.png"}
    )

@router.get("/{volume_id}/slices/{axis}")
async def get_all_slice_indices(volume_id: str, axis: str):
    meta = load_volume_metadata(volume_id)
    if not meta:
        raise HTTPException(status_code=404, detail="体数据不存在")

    axis_map = {'x': 0, 'y': 1, 'z': 2}
    if axis.lower() not in axis_map:
        raise HTTPException(status_code=400, detail="无效的轴向")

    axis_idx = axis_map[axis.lower()]
    max_index = meta['shape'][axis_idx]

    return {
        "axis": axis,
        "count": max_index,
        "indices": list(range(max_index))
    }

# ============================================================================
# 网格生成与获取接口
# ============================================================================

@router.post("/{volume_id}/mesh")
async def generate_mesh(
    volume_id: str,
    request: MeshRequest = Body(default_factory=MeshRequest)  # 允许空 body
):
    volume_path = PROCESSED_DIR / volume_id / "volume.npy"
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")

    data = np.load(volume_path)

    generator = MeshGenerator()
    mesh = generator.generate(
        data,
        threshold=request.threshold,
        smooth=request.smooth,
        decimate_ratio=request.decimate_ratio
    )

    mesh_dir = PROCESSED_DIR / volume_id / "meshes"
    mesh_dir.mkdir(parents=True, exist_ok=True)

    mesh_filename = f"mesh_t{request.threshold:.2f}.ply"
    mesh_path = mesh_dir / mesh_filename
    mesh.export(str(mesh_path))

    return {
        "message": "网格生成成功",
        "mesh_path": str(mesh_path),
        "download_url": f"/api/data/{volume_id}/mesh/download/{mesh_filename}",
        "vertices": len(mesh.vertices),
        "faces": len(mesh.faces)
    }

@router.get("/{volume_id}/mesh-data")
async def get_mesh_data(
    volume_id: str,
    threshold: float = Query(0.5, ge=0.0, le=1.0),
    smooth: bool = Query(True),
    decimate_ratio: float = Query(0.5, ge=0.0, le=1.0),
    regenerate: bool = Query(False, description="强制重新生成网格")
):
    """
    返回网格的顶点/面数据（前端可直接 Three.js 使用）。
    若已有对应网格文件则直接读取，否则生成后再返回。
    """
    volume_path = PROCESSED_DIR / volume_id / "volume.npy"
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")

    mesh_dir = PROCESSED_DIR / volume_id / "meshes"
    mesh_dir.mkdir(parents=True, exist_ok=True)
    mesh_filename = f"mesh_t{threshold:.2f}.ply"
    mesh_path = mesh_dir / mesh_filename

    mesh = None
    if regenerate or not mesh_path.exists():
        data = np.load(volume_path)
        generator = MeshGenerator()
        mesh = generator.generate(
            data,
            threshold=threshold,
            smooth=smooth,
            decimate_ratio=decimate_ratio
        )
        mesh.export(str(mesh_path))
    else:
        try:
            mesh = trimesh.load(str(mesh_path), process=False)
        except Exception:
            # 读取失败则重新生成
            data = np.load(volume_path)
            generator = MeshGenerator()
            mesh = generator.generate(
                data,
                threshold=threshold,
                smooth=smooth,
                decimate_ratio=decimate_ratio
            )
            mesh.export(str(mesh_path))

    return {
        "vertices": mesh.vertices.tolist(),
        "faces": mesh.faces.tolist(),
        "metadata": {
            "threshold": threshold,
            "smooth": smooth,
            "decimate_ratio": decimate_ratio,
            "vertex_count": int(mesh.vertices.shape[0]),
            "face_count": int(mesh.faces.shape[0]),
            "mesh_file": str(mesh_path)
        }
    }

@router.get("/{volume_id}/mesh/download/{filename}")
async def download_mesh(volume_id: str, filename: str):
    mesh_path = PROCESSED_DIR / volume_id / "meshes" / filename
    if not mesh_path.exists():
        raise HTTPException(status_code=404, detail="网格文件不存在")

    return FileResponse(
        str(mesh_path),
        media_type="application/octet-stream",
        filename=filename
    )

# ============================================================================
# 体数据导出接口
# ============================================================================

@router.get("/{volume_id}/export/{format}")
async def export_volume(
    volume_id: str,
    format: str = "npy"
):
    volume_path = PROCESSED_DIR / volume_id / "volume.npy"
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")  # 修正 status_code

    if format.lower() == "npy":
        return FileResponse(
            str(volume_path),
            media_type="application/octet-stream",
            filename=f"{volume_id}.npy"
        )
    elif format.lower() == "nii":
        import nibabel as nib

        data = np.load(volume_path)
        _ = load_volume_metadata(volume_id)

        nii_img = nib.Nifti1Image(data, np.eye(4))
        nii_path = PROCESSED_DIR / volume_id / f"{volume_id}.nii.gz"
        nib.save(nii_img, str(nii_path))

        return FileResponse(
            str(nii_path),
            media_type="application/gzip",
            filename=f"{volume_id}.nii.gz"
        )
    else:
        raise HTTPException(status_code=400, detail=f"不支持的格式: {format}")
</file>

<file path="backend/api/inference_routes.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 推理相关路由

功能：
1. 使用训练好的模型进行推理
2. 支持分割网络和 Diffusion 网络的单独或级联推理
3. 导出结果（NIfTI、STL 等格式）
"""

import os
import json
import uuid
import threading
from pathlib import Path
from datetime import datetime
from typing import Optional, List, Dict, Any

from fastapi import APIRouter, HTTPException, BackgroundTasks
from fastapi.responses import FileResponse
from pydantic import BaseModel
import numpy as np
import torch

# 导入模型
from models.unet3d import UNet3D
from models.diffusion import OCTADiffusionModel
from core.mesh_generator import MeshGenerator

router = APIRouter()

# 数据目录
DATA_DIR = Path(__file__).parent.parent / "data"
PROCESSED_DIR = DATA_DIR / "processed"
MODELS_DIR = DATA_DIR / "models"
RESULTS_DIR = DATA_DIR / "results"

RESULTS_DIR.mkdir(parents=True, exist_ok=True)

# ============================================================================
# 数据模型
# ============================================================================

class InferenceConfig(BaseModel):
    """推理配置"""
    volume_id: str
    checkpoint_name: str
    mode: str = "segmentation"  # "segmentation", "diffusion", "combined"
    patch_size: int = 32
    overlap: int = 8
    threshold: float = 0.5
    use_ddim: bool = True
    ddim_steps: int = 50

class InferenceResult(BaseModel):
    """推理结果"""
    id: str
    volume_id: str
    checkpoint_name: str
    mode: str
    status: str
    created_at: str
    completed_at: Optional[str] = None
    result_path: Optional[str] = None
    metrics: Optional[Dict[str, float]] = None

# ============================================================================
# 推理状态管理
# ============================================================================

# 推理任务状态
inference_tasks: Dict[str, InferenceResult] = {}
current_inference_thread: Optional[threading.Thread] = None

# ============================================================================
# 推理核心函数
# ============================================================================

def sliding_window_inference(
    model: torch.nn.Module,
    volume: np.ndarray,
    patch_size: int = 32,
    overlap: int = 8,
    device: str = 'cuda',
    is_diffusion: bool = False,
    diffusion_config: Optional[Dict] = None
) -> np.ndarray:
    """
    滑动窗口推理
    
    对大型体数据进行分块推理，然后合并结果
    
    参数：
        model: 训练好的模型
        volume: 输入体数据 (X, Y, Z)
        patch_size: patch 大小
        overlap: 重叠区域大小
        device: 计算设备
        is_diffusion: 是否是 Diffusion 模型
        diffusion_config: Diffusion 配置
    
    返回：
        output: 推理结果 (X, Y, Z)
    """
    model.eval()
    
    X, Y, Z = volume.shape
    stride = patch_size - overlap
    
    # 输出和权重累加
    output = np.zeros((X, Y, Z), dtype=np.float32)
    weights = np.zeros((X, Y, Z), dtype=np.float32)
    
    # 创建高斯权重（用于平滑拼接）
    weight_patch = _create_gaussian_weight(patch_size)
    
    # 计算 patch 数量
    x_steps = max(1, (X - patch_size) // stride + 1)
    y_steps = max(1, (Y - patch_size) // stride + 1)
    z_steps = max(1, (Z - patch_size) // stride + 1)
    
    total_patches = x_steps * y_steps * z_steps
    processed = 0
    
    with torch.no_grad():
        for xi, x in enumerate(range(0, X - patch_size + 1, stride)):
            for yi, y in enumerate(range(0, Y - patch_size + 1, stride)):
                for zi, z in enumerate(range(0, Z - patch_size + 1, stride)):
                    # 提取 patch
                    patch = volume[x:x+patch_size, y:y+patch_size, z:z+patch_size]
                    
                    # 转换为 tensor
                    input_tensor = torch.from_numpy(patch).float().unsqueeze(0).unsqueeze(0).to(device)
                    
                    # 推理
                    if is_diffusion and diffusion_config:
                        # Diffusion 推理
                        pred = model.sample(
                            input_tensor,
                            use_ddim=diffusion_config.get('use_ddim', True),
                            ddim_steps=diffusion_config.get('ddim_steps', 50),
                            progress=False
                        )
                    else:
                        # 分割网络推理
                        pred = model(input_tensor)
                        if isinstance(pred, tuple):
                            pred = pred[0]
                        pred = torch.sigmoid(pred)
                    
                    # 转换回 numpy
                    pred_np = pred.squeeze().cpu().numpy()
                    
                    # 累加到输出
                    output[x:x+patch_size, y:y+patch_size, z:z+patch_size] += pred_np * weight_patch
                    weights[x:x+patch_size, y:y+patch_size, z:z+patch_size] += weight_patch
                    
                    processed += 1
                    if processed % 100 == 0:
                        print(f"推理进度: {processed}/{total_patches} ({100*processed/total_patches:.1f}%)")
    
    # 处理边界（未被覆盖的区域）
    # 简化处理：直接用最近的预测填充
    weights = np.maximum(weights, 1e-8)
    output = output / weights
    
    return output

def _create_gaussian_weight(size: int) -> np.ndarray:
    """创建 3D 高斯权重"""
    x = np.linspace(-1, 1, size)
    y = np.linspace(-1, 1, size)
    z = np.linspace(-1, 1, size)
    
    xx, yy, zz = np.meshgrid(x, y, z, indexing='ij')
    dist = np.sqrt(xx**2 + yy**2 + zz**2)
    
    # 高斯权重
    sigma = 0.5
    weight = np.exp(-dist**2 / (2 * sigma**2))
    
    return weight.astype(np.float32)

def run_inference(task_id: str, config: InferenceConfig):
    """
    执行推理任务（在后台线程中运行）
    """
    global inference_tasks
    
    try:
        device = 'cuda' if torch.cuda.is_available() else 'cpu'
        
        # 更新状态
        inference_tasks[task_id].status = "running"
        
        # 加载体数据
        volume_path = PROCESSED_DIR / config.volume_id / "volume.npy"
        volume = np.load(volume_path)
        
        # 加载模型
        checkpoint_path = MODELS_DIR / config.checkpoint_name
        checkpoint = torch.load(checkpoint_path, map_location=device)
        
        # 根据模式选择模型
        if config.mode == "segmentation":
            model = UNet3D(
                in_channels=1,
                out_channels=1,
                base_features=32,
                use_attention=True
            ).to(device)
            model.load_state_dict(checkpoint['model_state_dict'])
            
            output = sliding_window_inference(
                model, volume,
                patch_size=config.patch_size,
                overlap=config.overlap,
                device=device,
                is_diffusion=False
            )
            
        elif config.mode == "diffusion":
            model = OCTADiffusionModel(
                timesteps=1000,
                beta_schedule='cosine',
                base_features=64,
                device=device
            ).to(device)
            model.load_state_dict(checkpoint['model_state_dict'])
            
            output = sliding_window_inference(
                model, volume,
                patch_size=config.patch_size,
                overlap=config.overlap,
                device=device,
                is_diffusion=True,
                diffusion_config={
                    'use_ddim': config.use_ddim,
                    'ddim_steps': config.ddim_steps
                }
            )
            
        elif config.mode == "combined":
            # 级联推理：先分割后扩散
            # 第一阶段：分割
            seg_model = UNet3D(
                in_channels=1,
                out_channels=1,
                base_features=32,
                use_attention=True
            ).to(device)
            # 假设分割和扩散模型在同一个 checkpoint 中
            seg_model.load_state_dict(checkpoint['segmentation_state_dict'])
            
            seg_output = sliding_window_inference(
                seg_model, volume,
                patch_size=config.patch_size,
                overlap=config.overlap,
                device=device,
                is_diffusion=False
            )
            
            # 第二阶段：扩散精修
            diff_model = OCTADiffusionModel(
                timesteps=1000,
                beta_schedule='cosine',
                base_features=64,
                device=device
            ).to(device)
            diff_model.load_state_dict(checkpoint['diffusion_state_dict'])
            
            output = sliding_window_inference(
                diff_model, seg_output,
                patch_size=config.patch_size,
                overlap=config.overlap,
                device=device,
                is_diffusion=True,
                diffusion_config={
                    'use_ddim': config.use_ddim,
                    'ddim_steps': config.ddim_steps
                }
            )
        
        else:
            raise ValueError(f"未知的推理模式: {config.mode}")
        
        # 二值化
        binary_output = (output > config.threshold).astype(np.uint8)
        
        # 保存结果
        result_dir = RESULTS_DIR / task_id
        result_dir.mkdir(parents=True, exist_ok=True)
        
        # 保存概率图
        np.save(result_dir / "probability.npy", output)
        
        # 保存二值 mask
        np.save(result_dir / "binary_mask.npy", binary_output)
        
        # 计算指标
        vessel_voxels = int(binary_output.sum())
        total_voxels = binary_output.size
        
        metrics = {
            "vessel_voxels": vessel_voxels,
            "vessel_fraction": vessel_voxels / total_voxels,
            "output_range": [float(output.min()), float(output.max())],
            "threshold": config.threshold
        }
        
        # 保存元信息
        with open(result_dir / "metadata.json", 'w') as f:
            json.dump({
                "task_id": task_id,
                "config": config.model_dump(),
                "metrics": metrics,
                "shape": list(binary_output.shape)
            }, f, indent=2)
        
        # 更新任务状态
        inference_tasks[task_id].status = "completed"
        inference_tasks[task_id].completed_at = datetime.now().isoformat()
        inference_tasks[task_id].result_path = str(result_dir)
        inference_tasks[task_id].metrics = metrics
        
    except Exception as e:
        inference_tasks[task_id].status = "error"
        inference_tasks[task_id].metrics = {"error": str(e)}

# ============================================================================
# 推理 API 接口
# ============================================================================

@router.post("/start", response_model=InferenceResult)
async def start_inference(config: InferenceConfig, background_tasks: BackgroundTasks):
    """
    启动推理任务
    """
    global current_inference_thread
    
    # 验证输入
    volume_path = PROCESSED_DIR / config.volume_id / "volume.npy"
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")
    
    checkpoint_path = MODELS_DIR / config.checkpoint_name
    if not checkpoint_path.exists():
        raise HTTPException(status_code=404, detail="模型检查点不存在")
    
    # 检查是否有正在进行的推理
    if current_inference_thread and current_inference_thread.is_alive():
        raise HTTPException(status_code=400, detail="已有推理任务正在运行")
    
    # 创建任务
    task_id = f"inf_{datetime.now().strftime('%Y%m%d_%H%M%S')}_{uuid.uuid4().hex[:8]}"
    
    result = InferenceResult(
        id=task_id,
        volume_id=config.volume_id,
        checkpoint_name=config.checkpoint_name,
        mode=config.mode,
        status="pending",
        created_at=datetime.now().isoformat()
    )
    
    inference_tasks[task_id] = result
    
    # 在后台启动推理
    current_inference_thread = threading.Thread(
        target=run_inference,
        args=(task_id, config)
    )
    current_inference_thread.start()
    
    return result

@router.get("/status/{task_id}")
async def get_inference_status(task_id: str):
    """获取推理任务状态"""
    if task_id not in inference_tasks:
        raise HTTPException(status_code=404, detail="任务不存在")
    
    return inference_tasks[task_id]

@router.get("/list")
async def list_inference_results():
    """列出所有推理结果"""
    results = []
    
    if RESULTS_DIR.exists():
        for result_dir in RESULTS_DIR.iterdir():
            if result_dir.is_dir():
                meta_path = result_dir / "metadata.json"
                if meta_path.exists():
                    with open(meta_path, 'r') as f:
                        meta = json.load(f)
                    results.append(meta)
    
    return results

@router.get("/result/{task_id}/slice/{axis}/{index}")
async def get_result_slice(task_id: str, axis: str, index: int):
    """获取推理结果的切片图像"""
    import cv2
    import io
    from fastapi.responses import StreamingResponse
    
    result_dir = RESULTS_DIR / task_id
    prob_path = result_dir / "probability.npy"
    
    if not prob_path.exists():
        raise HTTPException(status_code=404, detail="结果不存在")
    
    data = np.load(prob_path)
    
    # 提取切片
    axis_map = {'x': 0, 'y': 1, 'z': 2}
    axis_idx = axis_map.get(axis.lower())
    
    if axis_idx is None:
        raise HTTPException(status_code=400, detail="无效的轴向")
    
    if index < 0 or index >= data.shape[axis_idx]:
        raise HTTPException(status_code=400, detail="索引超出范围")
    
    if axis_idx == 0:
        slice_data = data[index, :, :]
    elif axis_idx == 1:
        slice_data = data[:, index, :]
    else:
        slice_data = data[:, :, index]
    
    # 转换为图像
    slice_img = (slice_data * 255).astype(np.uint8)
    _, buffer = cv2.imencode('.png', slice_img)
    
    return StreamingResponse(
        io.BytesIO(buffer.tobytes()),
        media_type="image/png"
    )

@router.get("/result/{task_id}/download/{format}")
async def download_result(task_id: str, format: str = "npy"):
    """下载推理结果"""
    result_dir = RESULTS_DIR / task_id
    
    if format.lower() == "npy":
        file_path = result_dir / "binary_mask.npy"
        media_type = "application/octet-stream"
        filename = f"{task_id}_mask.npy"
        
    elif format.lower() == "nii":
        import nibabel as nib
        
        mask = np.load(result_dir / "binary_mask.npy")
        nii_img = nib.Nifti1Image(mask.astype(np.float32), np.eye(4))
        
        nii_path = result_dir / f"{task_id}.nii.gz"
        nib.save(nii_img, str(nii_path))
        
        file_path = nii_path
        media_type = "application/gzip"
        filename = f"{task_id}.nii.gz"
        
    elif format.lower() in ["stl", "ply"]:
        # 生成网格
        mask = np.load(result_dir / "binary_mask.npy")
        
        generator = MeshGenerator()
        mesh = generator.generate(mask, threshold=0.5, smooth=True)
        
        mesh_path = result_dir / f"{task_id}.{format.lower()}"
        mesh.export(str(mesh_path))
        
        file_path = mesh_path
        media_type = "application/octet-stream"
        filename = f"{task_id}.{format.lower()}"
        
    else:
        raise HTTPException(status_code=400, detail=f"不支持的格式: {format}")
    
    if not file_path.exists():
        raise HTTPException(status_code=404, detail="文件不存在")
    
    return FileResponse(
        str(file_path),
        media_type=media_type,
        filename=filename
    )

@router.delete("/result/{task_id}")
async def delete_result(task_id: str):
    """删除推理结果"""
    import shutil
    
    result_dir = RESULTS_DIR / task_id
    
    if result_dir.exists():
        shutil.rmtree(result_dir)
    
    if task_id in inference_tasks:
        del inference_tasks[task_id]
    
    return {"message": f"结果 {task_id} 已删除"}
</file>

<file path="backend/api/main.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 主 API 入口

功能：
1. 启动 FastAPI 服务
2. 注册所有路由
3. 配置 CORS 和静态文件服务
"""

import os
import sys
from pathlib import Path

# 添加项目根目录到路径
PROJECT_ROOT = Path(__file__).parent.parent
sys.path.insert(0, str(PROJECT_ROOT))

from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from fastapi.responses import JSONResponse
import uvicorn

# 导入各功能模块的路由
from api.data_routes import router as data_router
from api.annotation_routes import router as annotation_router
from api.training_routes import router as training_router
from api.inference_routes import router as inference_router

# ============================================================================
# 应用配置
# ============================================================================

# 数据目录配置
DATA_DIR = PROJECT_ROOT / "data"
UPLOADS_DIR = DATA_DIR / "uploads"
PROCESSED_DIR = DATA_DIR / "processed"
ANNOTATIONS_DIR = DATA_DIR / "annotations"
MODELS_DIR = DATA_DIR / "models"
RESULTS_DIR = DATA_DIR / "results"

# 创建必要的目录
for dir_path in [UPLOADS_DIR, PROCESSED_DIR, ANNOTATIONS_DIR, MODELS_DIR, RESULTS_DIR]:
    dir_path.mkdir(parents=True, exist_ok=True)

# ============================================================================
# FastAPI 应用实例
# ============================================================================

app = FastAPI(
    title="OCTA 血管网络分析系统",
    description="""
    ## 功能概述
    
    本系统提供完整的 OCTA 数据处理和分析功能：
    
    - **数据管理**: DICOM/OCTA 数据上传、解析、预览
    - **3D 可视化**: 交互式血管网络渲染
    - **标注工具**: 血管横截面手动标注，生成金标准
    - **深度学习**: 3D U-Net + Diffusion 模型训练与推理
    - **三维重建**: 血管网络导出为 mesh 格式
    
    ## 技术特点
    
    - 几何畸变矫正：解决 OCT 纵向拉伸问题
    - 拖尾伪影消除：基于深度学习的血管清理
    - 高效处理：支持大体积数据分块加载
    """,
    version="1.0.0",
    docs_url="/docs",
    redoc_url="/redoc"
)

# ============================================================================
# 中间件配置
# ============================================================================

# CORS 配置，允许前端跨域访问
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # 生产环境应限制为具体域名
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ============================================================================
# 静态文件服务
# ============================================================================

# 挂载处理后的数据目录，供前端访问切片图像等
if PROCESSED_DIR.exists():
    app.mount("/static/processed", StaticFiles(directory=str(PROCESSED_DIR)), name="processed")
if ANNOTATIONS_DIR.exists():
    app.mount("/static/annotations", StaticFiles(directory=str(ANNOTATIONS_DIR)), name="annotations")

# ============================================================================
# 注册路由
# ============================================================================

# 数据管理路由
app.include_router(data_router, prefix="/api/data", tags=["数据管理"])

# 标注相关路由
app.include_router(annotation_router, prefix="/api/annotation", tags=["标注工具"])

# 训练相关路由
app.include_router(training_router, prefix="/api/training", tags=["模型训练"])

# 推理相关路由
app.include_router(inference_router, prefix="/api/inference", tags=["模型推理"])

# ============================================================================
# 根路由和健康检查
# ============================================================================

@app.get("/", tags=["系统"])
async def root():
    """系统根路由，返回基本信息"""
    return {
        "name": "OCTA 血管网络分析系统",
        "version": "1.0.0",
        "status": "running",
        "docs_url": "/docs"
    }


def _get_health_data():
    """获取健康检查数据（内部函数）"""
    return {
        "status": "healthy",
        "data_dir_exists": DATA_DIR.exists(),
        "uploads_count": len(list(UPLOADS_DIR.glob("*"))) if UPLOADS_DIR.exists() else 0,
        "models_count": len(list(MODELS_DIR.glob("*.pt"))) if MODELS_DIR.exists() else 0
    }


@app.get("/health", tags=["系统"])
async def health_check():
    """健康检查接口"""
    return _get_health_data()


@app.get("/api/health", tags=["系统"])
async def api_health_check():
    """健康检查接口（兼容前端 /api/health 路径）"""
    return _get_health_data()


@app.get("/api/config", tags=["系统"])
async def get_config():
    """获取系统配置信息"""
    return {
        "data_dir": str(DATA_DIR),
        "uploads_dir": str(UPLOADS_DIR),
        "processed_dir": str(PROCESSED_DIR),
        "annotations_dir": str(ANNOTATIONS_DIR),
        "models_dir": str(MODELS_DIR),
        "results_dir": str(RESULTS_DIR),
        "max_upload_size_mb": 2048,
        "supported_formats": [".dcm", ".dicom", ".nii", ".nii.gz", ".npy", ".mat"]
    }

# ============================================================================
# 异常处理
# ============================================================================

@app.exception_handler(HTTPException)
async def http_exception_handler(request, exc):
    """HTTP 异常处理"""
    return JSONResponse(
        status_code=exc.status_code,
        content={
            "error": True,
            "message": exc.detail,
            "status_code": exc.status_code
        }
    )

@app.exception_handler(Exception)
async def general_exception_handler(request, exc):
    """通用异常处理"""
    import traceback
    traceback.print_exc()
    return JSONResponse(
        status_code=500,
        content={
            "error": True,
            "message": f"内部服务器错误: {str(exc)}",
            "status_code": 500
        }
    )

# ============================================================================
# 启动入口
# ============================================================================

def main():
    """主函数：启动 API 服务"""
    print("=" * 60)
    print("OCTA 血管网络分析系统 - 后端服务")
    print("=" * 60)
    print(f"数据目录: {DATA_DIR}")
    print(f"API 文档: http://localhost:8000/docs")
    print(f"健康检查: http://localhost:8000/health")
    print(f"健康检查: http://localhost:8000/api/health")
    print("=" * 60)
    
    uvicorn.run(
        "api.main:app",
        host="0.0.0.0",
        port=8000,
        reload=True,
        workers=1
    )

if __name__ == "__main__":
    main()
</file>

<file path="backend/api/training_routes.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 训练相关路由

功能：
1. 创建和管理训练任务
2. 启动/停止/暂停训练
3. 查询训练进度
4. 管理模型检查点
"""

import os
import json
from pathlib import Path
from datetime import datetime
from typing import Optional, List, Dict, Any

from fastapi import APIRouter, HTTPException, BackgroundTasks
from pydantic import BaseModel
import numpy as np

# 导入训练管理器
from training.trainer import TrainingManager, TrainingState

router = APIRouter()

# 数据目录
DATA_DIR = Path(__file__).parent.parent / "data"
PROCESSED_DIR = DATA_DIR / "processed"
ANNOTATIONS_DIR = DATA_DIR / "annotations"
MODELS_DIR = DATA_DIR / "models"

# 全局训练管理器实例
training_manager: Optional[TrainingManager] = None

# ============================================================================
# 数据模型
# ============================================================================

class TrainingConfig(BaseModel):
    """训练配置"""
    # 数据配置
    volume_id: str
    annotation_project_id: str
    
    # 训练模式
    mode: str = "segmentation"  # "segmentation", "diffusion", "combined"
    
    # 超参数
    epochs: int = 100
    batch_size: int = 4
    learning_rate: float = 1e-4
    patch_size: int = 32
    
    # Diffusion 特定参数
    diffusion_timesteps: int = 1000
    diffusion_beta_schedule: str = "cosine"  # "linear", "cosine", "quadratic"
    
    # 其他
    save_every: int = 10
    num_workers: int = 4
    use_amp: bool = True  # 混合精度训练

class TrainingTask(BaseModel):
    """训练任务"""
    id: str
    config: TrainingConfig
    status: str = "pending"  # pending, running, paused, completed, error
    created_at: str
    started_at: Optional[str] = None
    completed_at: Optional[str] = None

# ============================================================================
# 辅助函数
# ============================================================================

def get_training_manager() -> TrainingManager:
    """获取或创建训练管理器"""
    global training_manager
    if training_manager is None:
        training_manager = TrainingManager(
            data_dir=DATA_DIR,
            models_dir=MODELS_DIR
        )
    return training_manager

def load_training_data(volume_id: str, annotation_project_id: str):
    """加载训练数据"""
    # 加载 OCTA 体数据
    volume_path = PROCESSED_DIR / volume_id / "volume.npy"
    if not volume_path.exists():
        raise ValueError(f"体数据不存在: {volume_id}")
    
    octa_data = np.load(volume_path)
    
    # 加载金标准 mask
    mask_path = ANNOTATIONS_DIR / annotation_project_id / "masks" / "gold_standard.npy"
    if not mask_path.exists():
        raise ValueError(f"金标准 mask 不存在，请先生成")
    
    label_data = np.load(mask_path)
    
    # 验证形状匹配
    if octa_data.shape != label_data.shape:
        raise ValueError(f"数据形状不匹配: OCTA {octa_data.shape}, 标签 {label_data.shape}")
    
    return octa_data, label_data

# ============================================================================
# 训练任务管理接口
# ============================================================================

@router.post("/start")
async def start_training(config: TrainingConfig, background_tasks: BackgroundTasks):
    """
    启动训练任务
    
    根据配置选择训练模式：
    - segmentation: 仅训练 3D U-Net 分割网络
    - diffusion: 仅训练 Diffusion 网络
    - combined: 级联训练（先分割后扩散）
    """
    manager = get_training_manager()
    
    # 检查是否有正在进行的训练
    if manager.state.status == "running":
        raise HTTPException(status_code=400, detail="已有训练任务正在运行")
    
    try:
        # 加载数据
        octa_data, label_data = load_training_data(
            config.volume_id, 
            config.annotation_project_id
        )
        
        # 划分训练集和验证集（按 Y 维度划分）
        X, Y, Z = octa_data.shape
        split_idx = int(Y * 0.8)
        
        octa_train = octa_data[:, :split_idx, :]
        label_train = label_data[:, :split_idx, :]
        octa_val = octa_data[:, split_idx:, :]
        label_val = label_data[:, split_idx:, :]
        
        # 准备数据加载器
        train_loader, val_loader = manager.prepare_dataloaders(
            octa_train, label_train,
            octa_val, label_val,
            patch_size=config.patch_size,
            batch_size=config.batch_size,
            num_workers=config.num_workers
        )
        
        # 根据模式启动训练
        if config.mode == "segmentation":
            manager.model = manager.create_segmentation_model()
            manager.train_segmentation(
                train_loader, val_loader,
                epochs=config.epochs,
                learning_rate=config.learning_rate,
                save_every=config.save_every
            )
        
        elif config.mode == "diffusion":
            manager.model = manager.create_diffusion_model(
                timesteps=config.diffusion_timesteps
            )
            manager.train_diffusion(
                train_loader, val_loader,
                epochs=config.epochs,
                learning_rate=config.learning_rate,
                save_every=config.save_every
            )
        
        elif config.mode == "combined":
            # 级联训练：先分割后扩散
            # 第一阶段：分割
            manager.model = manager.create_segmentation_model()
            manager.train_segmentation(
                train_loader, val_loader,
                epochs=config.epochs // 2,
                learning_rate=config.learning_rate,
                save_every=config.save_every
            )
            
            # TODO: 第二阶段需要等第一阶段完成后启动
            # 这里简化处理，实际应该使用更复杂的调度
        
        else:
            raise HTTPException(status_code=400, detail=f"未知的训练模式: {config.mode}")
        
        return {
            "message": "训练任务已启动",
            "mode": config.mode,
            "status": "running"
        }
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"启动训练失败: {str(e)}")

@router.post("/stop")
async def stop_training():
    """停止训练"""
    manager = get_training_manager()
    manager.stop_training()
    
    return {"message": "训练已停止", "status": manager.state.status}

@router.post("/pause")
async def pause_training():
    """暂停训练"""
    manager = get_training_manager()
    manager.pause_training()
    
    return {"message": "训练已暂停", "status": manager.state.status}

@router.post("/resume")
async def resume_training():
    """恢复训练"""
    manager = get_training_manager()
    manager.resume_training()
    
    return {"message": "训练已恢复", "status": manager.state.status}

@router.get("/status")
async def get_training_status():
    """获取训练状态"""
    manager = get_training_manager()
    return manager.get_state()

@router.get("/logs")
async def get_training_logs(limit: int = 100):
    """获取训练日志"""
    manager = get_training_manager()
    state = manager.get_state()
    
    return {
        "status": state["status"],
        "current_epoch": state["current_epoch"],
        "total_epochs": state["total_epochs"],
        "train_losses": state["train_losses"][-limit:],
        "val_losses": state["val_losses"][-limit:],
        "dice_scores": state["dice_scores"][-limit:],
        "elapsed_time": state["elapsed_time"],
        "eta": state["eta"],
        "message": state["message"]
    }

# ============================================================================
# 模型检查点管理接口
# ============================================================================

@router.get("/checkpoints")
async def list_checkpoints():
    """列出所有模型检查点"""
    checkpoints = []
    
    if MODELS_DIR.exists():
        for ckpt_file in MODELS_DIR.glob("*.pt"):
            stat = ckpt_file.stat()
            checkpoints.append({
                "name": ckpt_file.name,
                "path": str(ckpt_file),
                "size_mb": stat.st_size / (1024 * 1024),
                "modified_at": datetime.fromtimestamp(stat.st_mtime).isoformat()
            })
    
    return sorted(checkpoints, key=lambda x: x["modified_at"], reverse=True)

@router.delete("/checkpoints/{filename}")
async def delete_checkpoint(filename: str):
    """删除检查点"""
    ckpt_path = MODELS_DIR / filename
    
    if not ckpt_path.exists():
        raise HTTPException(status_code=404, detail="检查点不存在")
    
    ckpt_path.unlink()
    
    return {"message": f"检查点 {filename} 已删除"}

@router.post("/checkpoints/load/{filename}")
async def load_checkpoint(filename: str):
    """加载检查点"""
    manager = get_training_manager()
    
    success = manager.load_checkpoint(filename)
    
    if not success:
        raise HTTPException(status_code=404, detail="检查点不存在或加载失败")
    
    return {"message": f"检查点 {filename} 已加载"}

# ============================================================================
# 训练数据验证接口
# ============================================================================

@router.post("/validate-data")
async def validate_training_data(volume_id: str, annotation_project_id: str):
    """验证训练数据的有效性"""
    try:
        octa_data, label_data = load_training_data(volume_id, annotation_project_id)
        
        # 统计信息
        vessel_voxels = int(label_data.sum())
        total_voxels = label_data.size
        vessel_fraction = vessel_voxels / total_voxels
        
        return {
            "valid": True,
            "octa_shape": list(octa_data.shape),
            "label_shape": list(label_data.shape),
            "octa_range": [float(octa_data.min()), float(octa_data.max())],
            "vessel_voxels": vessel_voxels,
            "vessel_fraction": f"{vessel_fraction * 100:.2f}%",
            "message": "数据验证通过"
        }
        
    except Exception as e:
        return {
            "valid": False,
            "message": str(e)
        }

# ============================================================================
# 推荐配置接口
# ============================================================================

@router.get("/recommended-config")
async def get_recommended_config(volume_id: str):
    """根据数据大小推荐训练配置"""
    volume_path = PROCESSED_DIR / volume_id / "volume.npy"
    
    if not volume_path.exists():
        raise HTTPException(status_code=404, detail="体数据不存在")
    
    # 加载数据获取形状
    data = np.load(volume_path)
    X, Y, Z = data.shape
    total_voxels = X * Y * Z
    
    # 根据数据大小推荐配置
    if total_voxels < 50_000_000:  # < 50M 体素
        batch_size = 8
        patch_size = 32
    elif total_voxels < 100_000_000:  # < 100M 体素
        batch_size = 4
        patch_size = 32
    else:  # >= 100M 体素
        batch_size = 2
        patch_size = 48
    
    return {
        "data_shape": [X, Y, Z],
        "total_voxels": total_voxels,
        "recommended": {
            "batch_size": batch_size,
            "patch_size": patch_size,
            "epochs": 100,
            "learning_rate": 1e-4,
            "diffusion_timesteps": 1000,
            "diffusion_beta_schedule": "cosine",
            "save_every": 10
        },
        "gpu_memory_estimate_gb": batch_size * patch_size ** 3 * 4 * 2 / (1024 ** 3)
    }
</file>

<file path="backend/core/__init__.py">
# 核心处理模块
</file>

<file path="backend/core/dicom_reader.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - DICOM/OCTA 数据读取模块

功能：
1. 支持多种医学图像格式（DICOM、NIfTI、MATLAB、NumPy）
2. 解析并返回3D体数据及元信息
3. 处理DICOM序列（多文件）

兼容原有 scripts.zip 中的数据格式
"""

import os
import zipfile
import tempfile
from pathlib import Path
from typing import Tuple, Dict, Any, Optional, List
import numpy as np

class DicomReader:
    """
    医学图像数据读取器
    
    支持的格式：
    - DICOM (.dcm, .dicom) - 单文件或序列
    - NIfTI (.nii, .nii.gz)
    - MATLAB (.mat) - 兼容原有项目格式
    - NumPy (.npy)
    - ZIP 压缩包 - 包含多个 DICOM 切片
    """
    
    def __init__(self):
        # 默认的轴向标签
        self.default_axis_labels = ['X', 'Y', 'Z']
        
        # 默认的体素间距（微米）
        self.default_spacing = [12.0, 12.0, 8.73]  # 根据原项目参数
        
    def read_volume(self, file_path: str) -> Tuple[np.ndarray, Dict[str, Any]]:
        """
        读取体数据文件
        
        参数：
            file_path: 文件路径
            
        返回：
            volume: 3D numpy 数组，形状为 (X, Y, Z)
            metadata: 元信息字典
        """
        file_path = Path(file_path)
        suffix = file_path.suffix.lower()
        
        # 处理 .gz 后缀
        if suffix == '.gz':
            # 可能是 .nii.gz
            stem = file_path.stem
            if stem.endswith('.nii'):
                suffix = '.nii.gz'
        
        # 根据文件类型选择读取方法
        if suffix in ['.dcm', '.dicom']:
            return self._read_dicom(file_path)
        elif suffix in ['.nii', '.nii.gz']:
            return self._read_nifti(file_path)
        elif suffix == '.mat':
            return self._read_matlab(file_path)
        elif suffix == '.npy':
            return self._read_numpy(file_path)
        elif suffix == '.zip':
            return self._read_dicom_zip(file_path)
        else:
            raise ValueError(f"不支持的文件格式: {suffix}")
    
    def _read_dicom(self, file_path: Path) -> Tuple[np.ndarray, Dict[str, Any]]:
        """
        读取单个 DICOM 文件
        
        注意：单个 DICOM 文件通常是 2D 图像，
        如果需要 3D 体数据，应该使用 DICOM 序列或 ZIP 包
        """
        import pydicom
        
        ds = pydicom.dcmread(str(file_path))
        
        # 获取像素数据
        pixel_array = ds.pixel_array.astype(np.float32)
        
        # 如果是 2D，扩展为 3D
        if pixel_array.ndim == 2:
            pixel_array = pixel_array[:, :, np.newaxis]
        
        # 归一化到 [0, 1]
        pixel_array = self._normalize(pixel_array)
        
        # 提取元信息
        metadata = self._extract_dicom_metadata(ds)
        
        return pixel_array, metadata
    
    def _read_dicom_series(self, directory: Path) -> Tuple[np.ndarray, Dict[str, Any]]:
        """
        读取 DICOM 序列（目录中的多个 DICOM 文件）
        """
        import pydicom
        from pydicom.errors import InvalidDicomError
        
        # 收集所有 DICOM 文件
        dicom_files = []
        for f in directory.iterdir():
            if f.is_file():
                try:
                    ds = pydicom.dcmread(str(f))
                    dicom_files.append((f, ds))
                except InvalidDicomError:
                    continue
        
        if not dicom_files:
            raise ValueError("目录中没有有效的 DICOM 文件")
        
        # 按实例编号或位置排序
        def sort_key(item):
            ds = item[1]
            if hasattr(ds, 'InstanceNumber'):
                return int(ds.InstanceNumber)
            elif hasattr(ds, 'SliceLocation'):
                return float(ds.SliceLocation)
            else:
                return 0
        
        dicom_files.sort(key=sort_key)
        
        # 堆叠切片
        slices = []
        for _, ds in dicom_files:
            slice_data = ds.pixel_array.astype(np.float32)
            slices.append(slice_data)
        
        volume = np.stack(slices, axis=-1)  # 形状: (H, W, D)
        volume = self._normalize(volume)
        
        # 提取元信息
        metadata = self._extract_dicom_metadata(dicom_files[0][1])
        metadata['num_slices'] = len(dicom_files)
        
        return volume, metadata
    
    def _read_dicom_zip(self, zip_path: Path) -> Tuple[np.ndarray, Dict[str, Any]]:
        """
        读取包含 DICOM 序列的 ZIP 文件
        """
        # 解压到临时目录
        with tempfile.TemporaryDirectory() as temp_dir:
            with zipfile.ZipFile(str(zip_path), 'r') as zf:
                zf.extractall(temp_dir)
            
            # 读取 DICOM 序列
            return self._read_dicom_series(Path(temp_dir))
    
    def _read_nifti(self, file_path: Path) -> Tuple[np.ndarray, Dict[str, Any]]:
        """
        读取 NIfTI 格式文件
        """
        import nibabel as nib
        
        img = nib.load(str(file_path))
        volume = img.get_fdata().astype(np.float32)
        volume = self._normalize(volume)
        
        # 提取元信息
        header = img.header
        affine = img.affine
        
        metadata = {
            'spacing': list(header.get_zooms()[:3]),
            'origin': list(affine[:3, 3]),
            'axis_labels': self.default_axis_labels,
            'format': 'NIfTI'
        }
        
        return volume, metadata
    
    def _read_matlab(self, file_path: Path) -> Tuple[np.ndarray, Dict[str, Any]]:
        """
        读取 MATLAB .mat 格式文件
        
        兼容原项目中的数据格式：
        - 使用 h5py 读取 MATLAB v7.3 格式
        - 使用 scipy.io 读取旧版格式
        """
        import h5py
        from scipy import io as sio
        
        try:
            # 尝试使用 h5py 读取（MATLAB v7.3 格式）
            with h5py.File(str(file_path), 'r') as f:
                # 查找数据键（排除以 # 开头的元数据键）
                data_keys = [k for k in f.keys() if not k.startswith('#')]
                
                if not data_keys:
                    raise ValueError("MAT 文件中没有找到有效数据")
                
                # 使用第一个数据键
                data_key = data_keys[0]
                print(f"从 MAT 文件读取数据键: '{data_key}'")
                
                volume = np.array(f[data_key]).astype(np.float32)
                
                # MATLAB 存储格式可能需要转置
                # 根据原项目 inspect_mat.py 的分析，可能需要调整轴顺序
                if volume.ndim == 3:
                    # 默认转置为 (X, Y, Z)
                    volume = np.transpose(volume, (2, 1, 0))
                
                volume = self._normalize(volume)
                
                metadata = {
                    'spacing': self.default_spacing,
                    'origin': [0.0, 0.0, 0.0],
                    'axis_labels': self.default_axis_labels,
                    'format': 'MATLAB_v7.3',
                    'data_key': data_key
                }
                
                return volume, metadata
                
        except Exception as e:
            print(f"h5py 读取失败，尝试 scipy: {e}")
            
            # 尝试使用 scipy.io 读取旧版格式
            mat_data = sio.loadmat(str(file_path))
            
            # 查找数据变量（排除以 __ 开头的元数据）
            data_keys = [k for k in mat_data.keys() if not k.startswith('__')]
            
            if not data_keys:
                raise ValueError("MAT 文件中没有找到有效数据")
            
            data_key = data_keys[0]
            volume = mat_data[data_key].astype(np.float32)
            volume = self._normalize(volume)
            
            metadata = {
                'spacing': self.default_spacing,
                'origin': [0.0, 0.0, 0.0],
                'axis_labels': self.default_axis_labels,
                'format': 'MATLAB',
                'data_key': data_key
            }
            
            return volume, metadata
    
    def _read_numpy(self, file_path: Path) -> Tuple[np.ndarray, Dict[str, Any]]:
        """
        读取 NumPy .npy 格式文件
        
        兼容原项目中的数据格式：
        - M_clean.npy: 血管掩模
        - I_clean.npy: 干净 OCTA
        - I_tailed.npy: 带拖尾的 OCTA
        """
        volume = np.load(str(file_path)).astype(np.float32)
        
        # 确保是 3D 数据
        if volume.ndim == 2:
            volume = volume[:, :, np.newaxis]
        elif volume.ndim != 3:
            raise ValueError(f"不支持的数组维度: {volume.ndim}")
        
        volume = self._normalize(volume)
        
        # 根据文件名推断数据类型
        filename = file_path.stem.lower()
        data_type = 'unknown'
        if 'clean' in filename and 'm_' in filename:
            data_type = 'vessel_mask'
        elif 'clean' in filename:
            data_type = 'clean_octa'
        elif 'tailed' in filename:
            data_type = 'tailed_octa'
        elif 'octa' in filename:
            data_type = 'octa'
        elif 'label' in filename:
            data_type = 'label'
        
        metadata = {
            'spacing': self.default_spacing,
            'origin': [0.0, 0.0, 0.0],
            'axis_labels': self.default_axis_labels,
            'format': 'NumPy',
            'data_type': data_type
        }
        
        return volume, metadata
    
    def _normalize(self, data: np.ndarray) -> np.ndarray:
        """
        归一化数据到 [0, 1] 范围
        """
        data = data.astype(np.float32)
        
        # 处理极小值数据（如原项目中的微小数值范围）
        data_min = data.min()
        data_max = data.max()
        data_range = data_max - data_min
        
        if data_range < 1e-10:
            # 数据几乎是常数
            return np.zeros_like(data)
        elif data_range < 0.01:
            # 极小值范围，先缩放
            scale_factor = 1.0 / data_max if data_max > 0 else 1.0
            data = data * scale_factor
            data = (data - data.min()) / (data.max() - data.min() + 1e-10)
        else:
            # 正常归一化
            data = (data - data_min) / data_range
        
        return data.astype(np.float32)
    
    def _extract_dicom_metadata(self, ds) -> Dict[str, Any]:
        """
        从 DICOM 数据集中提取元信息
        """
        metadata = {
            'axis_labels': self.default_axis_labels,
            'format': 'DICOM'
        }
        
        # 像素间距
        if hasattr(ds, 'PixelSpacing'):
            pixel_spacing = [float(x) for x in ds.PixelSpacing]
        else:
            pixel_spacing = [self.default_spacing[0], self.default_spacing[1]]
        
        # 切片厚度
        if hasattr(ds, 'SliceThickness'):
            slice_thickness = float(ds.SliceThickness)
        else:
            slice_thickness = self.default_spacing[2]
        
        metadata['spacing'] = pixel_spacing + [slice_thickness]
        
        # 原点
        if hasattr(ds, 'ImagePositionPatient'):
            metadata['origin'] = [float(x) for x in ds.ImagePositionPatient]
        else:
            metadata['origin'] = [0.0, 0.0, 0.0]
        
        # 其他有用信息
        if hasattr(ds, 'PatientID'):
            metadata['patient_id'] = str(ds.PatientID)
        if hasattr(ds, 'StudyDescription'):
            metadata['study_description'] = str(ds.StudyDescription)
        if hasattr(ds, 'Modality'):
            metadata['modality'] = str(ds.Modality)
        
        return metadata

    def read_from_directory(self, directory: str) -> Tuple[np.ndarray, Dict[str, Any]]:
        """
        从目录读取数据（DICOM 序列或单个文件）
        """
        directory = Path(directory)
        
        if not directory.exists():
            raise ValueError(f"目录不存在: {directory}")
        
        # 检查是否是 DICOM 序列目录
        dcm_files = list(directory.glob("*.dcm")) + list(directory.glob("*.dicom"))
        
        if dcm_files:
            return self._read_dicom_series(directory)
        
        # 查找其他支持的文件
        for suffix in ['.npy', '.mat', '.nii', '.nii.gz']:
            files = list(directory.glob(f"*{suffix}"))
            if files:
                return self.read_volume(str(files[0]))
        
        raise ValueError(f"目录中没有找到支持的数据文件: {directory}")
</file>

<file path="backend/core/distortion_correction.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 几何畸变矫正模块

================================================================================
OCT 纵向畸变问题深度分析
================================================================================

【问题根源】

OCT（光学相干断层扫描）成像的纵向（深度）刻度是基于 **光学路径长度（OPL）** 
而非 **物理长度**。这导致了以下问题：

1. 光学路径长度定义：
   
   OPL = n × d
   
   其中：
   - n: 介质折射率（对于皮肤组织，n ≈ 1.38-1.45）
   - d: 物理距离

2. OCT 成像原理：
   - OCT 测量的是光的飞行时间（Time of Flight）
   - 系统将飞行时间转换为距离时，使用的是 **假定的折射率**
   - 当假定折射率与实际折射率不同时，深度测量会出现误差

3. 倾斜导致的畸变：
   
   当样品表面存在倾斜角 θ 时：
   
   ┌─────────────────────────────────────┐
   │          入射光束                    │
   │              ↓                       │
   │              │                       │
   │    ─────────/\─────────  倾斜表面    │
   │            /  \                      │
   │           /    \                     │
   │          /      \  真实光路          │
   │         /        \                   │
   │        ●          ●  血管截面        │
   │         \        /                   │
   │          \      /                    │
   │           \    /                     │
   └─────────────────────────────────────┘
   
   - 真实物理深度: d_true
   - 光学路径长度: OPL = n × d_true / cos(θ)
   - OCT 显示深度: d_display = OPL / n_system
   
   由于光路倾斜穿过样品，光程变长，导致：
   - 圆形血管截面被拉伸成椭圆形
   - 出现"拖尾"现象（下半圆被拉长）
   - 倾斜角度越大，拉伸越严重

【旧代码问题分析】

从用户提供的 畸变矫正.py 分析，存在以下问题：

1. 几何校正中未正确考虑折射率与倾斜角的耦合效应
2. 对每个像素独立处理，导致血管结构不连续
3. 未考虑 OCT 的扇形扫描几何
4. 深度方向的压缩/拉伸因子计算不正确

【本模块的改进方案】

1. 基于物理模型的深度校正
2. 考虑表面倾斜的各向异性缩放
3. 引入局部倾角估计算法
4. 使用插值保持结构连续性
5. 支持 B-scan 和 3D 体数据的矫正

================================================================================
"""

import numpy as np
from scipy import ndimage
from scipy.interpolate import RectBivariateSpline, interp2d
from scipy.signal import find_peaks
from typing import Tuple, Optional, Dict, Any
import cv2


class DistortionCorrector:
    """
    OCT 几何畸变矫正器
    
    解决问题：
    1. 折射率导致的深度缩放误差
    2. 表面倾斜导致的纵向拉伸
    3. 扇形扫描导致的非线性畸变
    
    使用方法：
    ```python
    corrector = DistortionCorrector(
        n_tissue=1.40,      # 组织折射率
        n_system=1.38,      # 系统假定折射率
        pixel_size_axial=8.73,    # 纵向像素尺寸 (μm)
        pixel_size_lateral=12.0   # 横向像素尺寸 (μm)
    )
    
    # 校正单张 B-scan
    corrected = corrector.correct_bscan(bscan, auto_estimate_tilt=True)
    
    # 校正整个 3D 体数据
    corrected_volume = corrector.correct_volume(volume)
    ```
    """
    
    def __init__(
        self,
        n_tissue: float = 1.40,
        n_system: float = 1.38,
        pixel_size_axial: float = 8.73,
        pixel_size_lateral: float = 12.0
    ):
        """
        初始化矫正器
        
        参数：
            n_tissue: 组织折射率（皮肤约 1.38-1.45）
            n_system: OCT 系统假定的折射率
            pixel_size_axial: 纵向（深度方向）像素尺寸，单位 μm
            pixel_size_lateral: 横向像素尺寸，单位 μm
        """
        # ============================================================
        # 折射率相关参数
        # ============================================================
        # 组织真实折射率
        self.n_tissue = n_tissue
        
        # 系统假定折射率（OCT 系统用于计算深度的折射率）
        self.n_system = n_system
        
        # 折射率补偿因子
        # 当 n_tissue > n_system 时，真实深度比显示深度更浅
        # 因此需要将图像纵向压缩
        self.refraction_scale = n_system / n_tissue
        
        # ============================================================
        # 像素尺寸（用于计算真实物理尺度）
        # ============================================================
        self.pixel_size_axial = pixel_size_axial
        self.pixel_size_lateral = pixel_size_lateral
        
        # 各向异性比（横向/纵向），用于判断是否需要各向异性缩放
        self.anisotropy_ratio = pixel_size_lateral / pixel_size_axial
        
    def correct_slice(
        self,
        slice_data: np.ndarray,
        axis: str = 'y'
    ) -> np.ndarray:
        """
        校正单个切片（简化版，用于实时预览）
        
        参数：
            slice_data: 2D 切片数据
            axis: 切片轴向 ('x', 'y', 'z')
        
        返回：
            corrected: 校正后的切片
        """
        # 对于 Y 轴切片（B-scan），应用完整校正
        if axis.lower() == 'y':
            return self.correct_bscan(slice_data, auto_estimate_tilt=True)
        else:
            # 其他轴向只应用折射率补偿
            return self._apply_refraction_correction(slice_data)
    
    def correct_bscan(
        self,
        bscan: np.ndarray,
        tilt_angle: Optional[float] = None,
        auto_estimate_tilt: bool = True
    ) -> np.ndarray:
        """
        校正单张 B-scan 图像
        
        B-scan 定义：
        - 沿 Y 轴（扫描方向）的横截面
        - 形状为 (X, Z)，其中 X 是横向，Z 是深度
        
        校正步骤：
        1. 估计表面倾斜角度（如果需要）
        2. 应用倾斜角度校正（纵向压缩）
        3. 应用折射率补偿
        4. 插值重采样保持平滑
        
        参数：
            bscan: 2D B-scan 图像，形状 (H, W) 或 (X, Z)
            tilt_angle: 倾斜角度（度），None 则自动估计
            auto_estimate_tilt: 是否自动估计倾斜角度
        
        返回：
            corrected: 校正后的 B-scan
        """
        bscan = bscan.astype(np.float32)
        h, w = bscan.shape
        
        # ============================================================
        # 步骤 1: 估计表面倾斜角度
        # ============================================================
        if tilt_angle is None and auto_estimate_tilt:
            tilt_angle = self._estimate_surface_tilt(bscan)
        elif tilt_angle is None:
            tilt_angle = 0.0
        
        # 转换为弧度
        theta = np.radians(tilt_angle)
        
        # ============================================================
        # 步骤 2: 计算校正参数
        # ============================================================
        
        # 倾斜校正因子
        # 当光束以角度 θ 穿过样品时，光程增加 1/cos(θ) 倍
        # 因此需要将纵向压缩 cos(θ) 倍
        tilt_correction = np.cos(theta) if abs(theta) > 0.01 else 1.0
        
        # 综合缩放因子
        # 同时考虑折射率补偿和倾斜校正
        total_scale = self.refraction_scale * tilt_correction
        
        # ============================================================
        # 步骤 3: 应用校正（使用仿射变换）
        # ============================================================
        
        # 计算新的图像尺寸
        new_h = int(h * total_scale)
        
        if new_h <= 0 or new_h > h * 2:
            # 防止异常的缩放
            new_h = h
        
        # 使用 OpenCV 进行高质量插值
        corrected = cv2.resize(
            bscan, 
            (w, new_h), 
            interpolation=cv2.INTER_CUBIC
        )
        
        # ============================================================
        # 步骤 4: 可选的进一步处理
        # ============================================================
        
        # 对于倾斜的表面，还需要考虑横向的剪切变换
        if abs(tilt_angle) > 2.0:  # 倾斜角度大于 2 度时
            corrected = self._apply_shear_correction(
                corrected, 
                tilt_angle
            )
        
        return corrected
    
    def correct_volume(
        self,
        volume: np.ndarray,
        slice_by_slice: bool = True,
        progress_callback: Optional[callable] = None
    ) -> np.ndarray:
        """
        校正整个 3D 体数据
        
        参数：
            volume: 3D 体数据，形状 (X, Y, Z)
                   - X: 横向
                   - Y: B-scan 方向（扫描方向）
                   - Z: 深度方向
            slice_by_slice: 是否逐切片处理（推荐，节省内存）
            progress_callback: 进度回调函数 callback(current, total)
        
        返回：
            corrected_volume: 校正后的 3D 体数据
        """
        volume = volume.astype(np.float32)
        X, Y, Z = volume.shape
        
        if slice_by_slice:
            # 逐 B-scan 处理
            # 每个 B-scan 是 X-Z 平面的切片
            
            # 先估计所有 B-scan 的平均倾斜角
            sample_indices = np.linspace(0, Y - 1, min(10, Y)).astype(int)
            tilt_angles = []
            
            for y in sample_indices:
                bscan = volume[:, y, :]
                angle = self._estimate_surface_tilt(bscan)
                tilt_angles.append(angle)
            
            avg_tilt = np.median(tilt_angles)
            
            # 计算校正后的 Z 维度大小
            theta = np.radians(avg_tilt)
            total_scale = self.refraction_scale * np.cos(theta)
            new_Z = int(Z * total_scale)
            new_Z = max(new_Z, int(Z * 0.5))  # 至少保留一半
            new_Z = min(new_Z, Z * 2)  # 最多放大两倍
            
            # 创建输出体
            corrected_volume = np.zeros((X, Y, new_Z), dtype=np.float32)
            
            # 逐切片处理
            for y in range(Y):
                if progress_callback:
                    progress_callback(y, Y)
                
                bscan = volume[:, y, :]
                corrected_bscan = self.correct_bscan(
                    bscan, 
                    tilt_angle=avg_tilt,
                    auto_estimate_tilt=False
                )
                
                # 调整大小以匹配输出体
                if corrected_bscan.shape[1] != new_Z:
                    corrected_bscan = cv2.resize(
                        corrected_bscan,
                        (new_Z, X),
                        interpolation=cv2.INTER_CUBIC
                    )
                
                corrected_volume[:, y, :] = corrected_bscan
            
            return corrected_volume
        
        else:
            # 3D 整体处理（内存密集）
            # 使用 3D 仿射变换
            return self._apply_3d_correction(volume)
    
    def _estimate_surface_tilt(self, bscan: np.ndarray) -> float:
        """
        从 B-scan 图像中估计表面倾斜角度
        
        方法：
        1. 检测每列的第一个显著信号位置（表面）
        2. 对表面位置进行线性拟合
        3. 计算倾斜角度
        
        参数：
            bscan: 2D B-scan 图像
        
        返回：
            tilt_angle: 表面倾斜角度（度）
        """
        h, w = bscan.shape
        
        # 阈值化找到信号区域
        threshold = np.percentile(bscan, 90)  # 使用 90 百分位作为阈值
        
        surface_positions = []
        valid_columns = []
        
        for x in range(w):
            column = bscan[:, x]
            
            # 找到第一个超过阈值的位置（从顶部开始）
            above_threshold = np.where(column > threshold)[0]
            
            if len(above_threshold) > 0:
                surface_pos = above_threshold[0]
                surface_positions.append(surface_pos)
                valid_columns.append(x)
        
        if len(valid_columns) < 2:
            return 0.0
        
        # 线性拟合
        valid_columns = np.array(valid_columns)
        surface_positions = np.array(surface_positions)
        
        # 使用鲁棒的中位数滤波去除异常点
        from scipy.ndimage import median_filter
        surface_smooth = median_filter(surface_positions, size=5)
        
        # 线性拟合：z = a * x + b
        try:
            coeffs = np.polyfit(valid_columns, surface_smooth, 1)
            slope = coeffs[0]  # dz/dx
            
            # 计算角度
            # tan(θ) = (dz * pixel_z) / (dx * pixel_x)
            # 这里简化为 tan(θ) = slope * (pixel_z / pixel_x)
            tan_theta = slope * (self.pixel_size_axial / self.pixel_size_lateral)
            tilt_angle = np.degrees(np.arctan(tan_theta))
            
            # 限制在合理范围内
            tilt_angle = np.clip(tilt_angle, -30, 30)
            
            return float(tilt_angle)
            
        except Exception:
            return 0.0
    
    def _apply_refraction_correction(self, image: np.ndarray) -> np.ndarray:
        """
        应用折射率补偿（仅深度方向缩放）
        
        物理原理：
        - OCT 显示深度 = OPL / n_system
        - 真实物理深度 = OPL / n_tissue
        - 因此：真实深度 = 显示深度 × (n_system / n_tissue)
        
        当 n_tissue > n_system 时，真实深度更浅，需要压缩图像
        """
        h, w = image.shape
        
        # 计算新高度
        new_h = int(h * self.refraction_scale)
        
        if new_h == h:
            return image.copy()
        
        # 使用高质量插值
        corrected = cv2.resize(
            image,
            (w, new_h),
            interpolation=cv2.INTER_CUBIC
        )
        
        return corrected
    
    def _apply_shear_correction(
        self, 
        image: np.ndarray, 
        tilt_angle: float
    ) -> np.ndarray:
        """
        应用剪切变换校正倾斜表面
        
        当表面倾斜时，深部结构相对于浅层结构存在横向偏移
        这个偏移量与深度和倾斜角成正比
        
        参数：
            image: 输入图像
            tilt_angle: 倾斜角度（度）
        
        返回：
            校正后的图像
        """
        h, w = image.shape
        
        # 计算剪切量
        # 在深度 z 处的横向偏移 = z × tan(θ)
        theta = np.radians(tilt_angle)
        shear_factor = np.tan(theta)
        
        # 构建仿射变换矩阵
        # [1, shear, 0]
        # [0, 1,     0]
        M = np.float32([
            [1, shear_factor, -shear_factor * h / 2],
            [0, 1, 0]
        ])
        
        # 计算输出图像大小
        new_w = int(w + abs(shear_factor * h))
        
        # 应用仿射变换
        corrected = cv2.warpAffine(
            image,
            M,
            (new_w, h),
            flags=cv2.INTER_CUBIC,
            borderMode=cv2.BORDER_REPLICATE
        )
        
        # 裁剪到原始宽度
        start_x = (new_w - w) // 2
        corrected = corrected[:, start_x:start_x + w]
        
        return corrected
    
    def _apply_3d_correction(self, volume: np.ndarray) -> np.ndarray:
        """
        应用 3D 整体校正
        
        使用 3D 仿射变换一次性处理整个体数据
        适用于内存充足的情况
        """
        from scipy.ndimage import affine_transform
        
        X, Y, Z = volume.shape
        
        # 估计平均倾斜角
        mid_y = Y // 2
        mid_bscan = volume[:, mid_y, :]
        tilt_angle = self._estimate_surface_tilt(mid_bscan)
        theta = np.radians(tilt_angle)
        
        # 综合缩放因子
        total_scale_z = self.refraction_scale * np.cos(theta)
        
        # 构建 3D 变换矩阵
        # 只对 Z 轴进行缩放
        transform_matrix = np.array([
            [1, 0, 0],
            [0, 1, 0],
            [0, 0, 1 / total_scale_z]  # Z 轴缩放
        ])
        
        # 计算输出大小
        new_Z = int(Z * total_scale_z)
        new_Z = max(new_Z, int(Z * 0.5))
        
        # 应用变换
        corrected = affine_transform(
            volume,
            transform_matrix,
            output_shape=(X, Y, new_Z),
            order=3,  # 三次样条插值
            mode='constant',
            cval=0.0
        )
        
        return corrected
    
    def get_correction_info(self, volume_shape: Tuple[int, int, int]) -> Dict[str, Any]:
        """
        获取校正信息（用于 UI 显示）
        
        返回当前校正参数和预期的输出尺寸
        """
        X, Y, Z = volume_shape
        
        # 预估校正后的尺寸
        estimated_scale = self.refraction_scale * 0.95  # 假设约 5 度倾斜
        new_Z = int(Z * estimated_scale)
        
        return {
            'tissue_refractive_index': self.n_tissue,
            'system_refractive_index': self.n_system,
            'refraction_scale_factor': self.refraction_scale,
            'pixel_size_axial_um': self.pixel_size_axial,
            'pixel_size_lateral_um': self.pixel_size_lateral,
            'anisotropy_ratio': self.anisotropy_ratio,
            'input_shape': list(volume_shape),
            'estimated_output_shape': [X, Y, new_Z],
            'depth_compression_ratio': estimated_scale
        }


class TailArtifactRemover:
    """
    拖尾伪影去除器
    
    专门处理 OCTA 中血管的拖尾伪影问题
    
    拖尾原因：
    1. 红细胞散射导致信号在深度方向延展
    2. 多重散射增加了光程
    3. 系统点扩散函数（PSF）的轴向拖尾
    
    处理方法：
    1. 形态学处理（开运算、闭运算）
    2. 基于梯度的边缘检测
    3. 统计学方法（基于血管横截面形状）
    """
    
    def __init__(self, max_tail_length: int = 20):
        """
        参数：
            max_tail_length: 最大拖尾长度（像素）
        """
        self.max_tail_length = max_tail_length
    
    def remove_tail_simple(
        self, 
        bscan: np.ndarray,
        threshold: float = 0.5
    ) -> np.ndarray:
        """
        简单的拖尾去除（形态学方法）
        
        使用开运算去除细小的拖尾结构
        """
        # 二值化
        binary = (bscan > threshold).astype(np.uint8)
        
        # 设计结构元素：横向椭圆形
        # 这样可以保留横向血管结构，去除纵向拖尾
        kernel_h = 3
        kernel_w = 7
        kernel = cv2.getStructuringElement(
            cv2.MORPH_ELLIPSE, 
            (kernel_w, kernel_h)
        )
        
        # 开运算
        opened = cv2.morphologyEx(binary, cv2.MORPH_OPEN, kernel)
        
        # 闭运算填充小孔
        closed = cv2.morphologyEx(opened, cv2.MORPH_CLOSE, kernel)
        
        # 应用掩模
        result = bscan.copy()
        result[closed == 0] = 0
        
        return result
    
    def detect_vessel_centers(
        self, 
        bscan: np.ndarray,
        threshold: float = 0.5
    ) -> np.ndarray:
        """
        检测血管中心位置
        
        返回每列的血管中心深度位置
        """
        binary = (bscan > threshold)
        h, w = bscan.shape
        
        centers = np.full(w, -1, dtype=np.float32)
        
        for x in range(w):
            column = binary[:, x]
            vessel_regions = np.where(column)[0]
            
            if len(vessel_regions) > 0:
                # 找到连续区域的中心
                # 假设血管是顶部开始的区域
                if len(vessel_regions) >= 2:
                    # 找第一个连续区域
                    diffs = np.diff(vessel_regions)
                    breaks = np.where(diffs > 1)[0]
                    
                    if len(breaks) > 0:
                        first_region_end = breaks[0]
                        first_region = vessel_regions[:first_region_end + 1]
                    else:
                        first_region = vessel_regions
                    
                    # 取中心
                    center = (first_region[0] + first_region[-1]) / 2
                    centers[x] = center
                else:
                    centers[x] = vessel_regions[0]
        
        return centers
</file>

<file path="backend/core/mesh_generator.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 网格生成模块

功能：
1. 使用 Marching Cubes 从体数据生成表面网格
2. 网格平滑和简化
3. 导出为多种格式（STL、PLY、OBJ）
"""

import numpy as np
from typing import Optional, Tuple, List
from dataclasses import dataclass


@dataclass
class Mesh:
    """
    网格数据结构
    """
    vertices: np.ndarray  # (N, 3) 顶点坐标
    faces: np.ndarray     # (M, 3) 面索引
    normals: Optional[np.ndarray] = None  # (N, 3) 顶点法向量
    colors: Optional[np.ndarray] = None   # (N, 3) 顶点颜色
    
    def export(self, filepath: str):
        """导出网格文件"""
        suffix = filepath.lower().split('.')[-1]
        
        if suffix == 'stl':
            self._export_stl(filepath)
        elif suffix == 'ply':
            self._export_ply(filepath)
        elif suffix == 'obj':
            self._export_obj(filepath)
        else:
            raise ValueError(f"不支持的格式: {suffix}")
    
    def _export_stl(self, filepath: str):
        """导出 STL 格式"""
        import struct
        
        with open(filepath, 'wb') as f:
            # 头部（80 字节）
            header = b'\x00' * 80
            f.write(header)
            
            # 三角形数量
            num_triangles = len(self.faces)
            f.write(struct.pack('<I', num_triangles))
            
            # 每个三角形
            for face in self.faces:
                v0, v1, v2 = self.vertices[face]
                
                # 计算法向量
                edge1 = v1 - v0
                edge2 = v2 - v0
                normal = np.cross(edge1, edge2)
                normal = normal / (np.linalg.norm(normal) + 1e-8)
                
                # 写入法向量
                f.write(struct.pack('<3f', *normal))
                
                # 写入三个顶点
                f.write(struct.pack('<3f', *v0))
                f.write(struct.pack('<3f', *v1))
                f.write(struct.pack('<3f', *v2))
                
                # 属性字节（2 字节，通常为 0）
                f.write(struct.pack('<H', 0))
    
    def _export_ply(self, filepath: str):
        """导出 PLY 格式"""
        with open(filepath, 'w') as f:
            # 头部
            f.write('ply\n')
            f.write('format ascii 1.0\n')
            f.write(f'element vertex {len(self.vertices)}\n')
            f.write('property float x\n')
            f.write('property float y\n')
            f.write('property float z\n')
            
            if self.normals is not None:
                f.write('property float nx\n')
                f.write('property float ny\n')
                f.write('property float nz\n')
            
            if self.colors is not None:
                f.write('property uchar red\n')
                f.write('property uchar green\n')
                f.write('property uchar blue\n')
            
            f.write(f'element face {len(self.faces)}\n')
            f.write('property list uchar int vertex_indices\n')
            f.write('end_header\n')
            
            # 顶点
            for i, v in enumerate(self.vertices):
                line = f'{v[0]} {v[1]} {v[2]}'
                
                if self.normals is not None:
                    n = self.normals[i]
                    line += f' {n[0]} {n[1]} {n[2]}'
                
                if self.colors is not None:
                    c = self.colors[i]
                    line += f' {int(c[0])} {int(c[1])} {int(c[2])}'
                
                f.write(line + '\n')
            
            # 面
            for face in self.faces:
                f.write(f'3 {face[0]} {face[1]} {face[2]}\n')
    
    def _export_obj(self, filepath: str):
        """导出 OBJ 格式"""
        with open(filepath, 'w') as f:
            # 顶点
            for v in self.vertices:
                f.write(f'v {v[0]} {v[1]} {v[2]}\n')
            
            # 法向量
            if self.normals is not None:
                for n in self.normals:
                    f.write(f'vn {n[0]} {n[1]} {n[2]}\n')
            
            # 面（OBJ 索引从 1 开始）
            for face in self.faces:
                if self.normals is not None:
                    f.write(f'f {face[0]+1}//{face[0]+1} {face[1]+1}//{face[1]+1} {face[2]+1}//{face[2]+1}\n')
                else:
                    f.write(f'f {face[0]+1} {face[1]+1} {face[2]+1}\n')


class MeshGenerator:
    """
    网格生成器
    
    从体数据生成表面网格
    """
    
    def __init__(self):
        pass
    
    def generate(
        self,
        volume: np.ndarray,
        threshold: float = 0.5,
        smooth: bool = True,
        smooth_iterations: int = 3,
        decimate_ratio: float = 1.0,
        spacing: Tuple[float, float, float] = (1.0, 1.0, 1.0)
    ) -> Mesh:
        """
        从体数据生成网格
        
        使用 Marching Cubes 算法提取等值面
        
        参数：
            volume: 3D 体数据
            threshold: 等值面阈值
            smooth: 是否平滑网格
            smooth_iterations: 平滑迭代次数
            decimate_ratio: 网格简化比例（0-1，1 表示不简化）
            spacing: 体素间距 (dx, dy, dz)
        
        返回：
            Mesh 对象
        """
        from skimage import measure
        
        # 预处理：高斯平滑
        if smooth:
            from scipy.ndimage import gaussian_filter
            volume = gaussian_filter(volume.astype(float), sigma=1.0)
        
        # Marching Cubes
        try:
            verts, faces, normals, values = measure.marching_cubes(
                volume,
                level=threshold,
                spacing=spacing
            )
        except Exception as e:
            # 如果失败，尝试使用较低的阈值
            print(f"Marching Cubes 失败 (阈值={threshold}): {e}")
            print("尝试降低阈值...")
            
            verts, faces, normals, values = measure.marching_cubes(
                volume,
                level=threshold * 0.5,
                spacing=spacing
            )
        
        # 网格简化
        if decimate_ratio < 1.0 and len(faces) > 1000:
            verts, faces = self._decimate_mesh(verts, faces, decimate_ratio)
            # 重新计算法向量
            normals = self._compute_normals(verts, faces)
        
        # 网格平滑
        if smooth and smooth_iterations > 0:
            verts = self._smooth_mesh(verts, faces, smooth_iterations)
            normals = self._compute_normals(verts, faces)
        
        # 基于深度的颜色
        colors = self._generate_depth_colors(verts)
        
        return Mesh(
            vertices=verts.astype(np.float32),
            faces=faces.astype(np.int32),
            normals=normals.astype(np.float32) if normals is not None else None,
            colors=colors.astype(np.uint8)
        )
    
    def _decimate_mesh(
        self,
        vertices: np.ndarray,
        faces: np.ndarray,
        ratio: float
    ) -> Tuple[np.ndarray, np.ndarray]:
        """
        网格简化（使用简单的顶点聚类方法）
        
        注意：这是一个简化的实现，生产环境应使用更高级的算法
        """
        # 计算目标面数
        target_faces = int(len(faces) * ratio)
        
        if target_faces >= len(faces):
            return vertices, faces
        
        # 简单的均匀采样
        step = max(1, len(faces) // target_faces)
        selected_face_indices = np.arange(0, len(faces), step)[:target_faces]
        
        # 提取选中的面和相关顶点
        selected_faces = faces[selected_face_indices]
        
        # 获取唯一顶点
        unique_vertices = np.unique(selected_faces.flatten())
        
        # 建立顶点映射
        vertex_map = {old: new for new, old in enumerate(unique_vertices)}
        
        # 更新顶点和面
        new_vertices = vertices[unique_vertices]
        new_faces = np.array([
            [vertex_map[v] for v in face]
            for face in selected_faces
        ])
        
        return new_vertices, new_faces
    
    def _smooth_mesh(
        self,
        vertices: np.ndarray,
        faces: np.ndarray,
        iterations: int
    ) -> np.ndarray:
        """
        拉普拉斯网格平滑
        """
        vertices = vertices.copy()
        
        # 构建邻接关系
        num_vertices = len(vertices)
        adjacency = [set() for _ in range(num_vertices)]
        
        for face in faces:
            for i in range(3):
                v1, v2 = face[i], face[(i + 1) % 3]
                adjacency[v1].add(v2)
                adjacency[v2].add(v1)
        
        # 迭代平滑
        lambda_factor = 0.5
        
        for _ in range(iterations):
            new_vertices = vertices.copy()
            
            for i in range(num_vertices):
                if len(adjacency[i]) > 0:
                    neighbor_verts = vertices[list(adjacency[i])]
                    centroid = neighbor_verts.mean(axis=0)
                    new_vertices[i] = vertices[i] + lambda_factor * (centroid - vertices[i])
            
            vertices = new_vertices
        
        return vertices
    
    def _compute_normals(
        self,
        vertices: np.ndarray,
        faces: np.ndarray
    ) -> np.ndarray:
        """
        计算顶点法向量
        """
        normals = np.zeros_like(vertices)
        
        for face in faces:
            v0, v1, v2 = vertices[face]
            edge1 = v1 - v0
            edge2 = v2 - v0
            face_normal = np.cross(edge1, edge2)
            
            # 累加到顶点
            for i in face:
                normals[i] += face_normal
        
        # 归一化
        norms = np.linalg.norm(normals, axis=1, keepdims=True)
        norms = np.maximum(norms, 1e-8)
        normals = normals / norms
        
        return normals
    
    def _generate_depth_colors(self, vertices: np.ndarray) -> np.ndarray:
        """
        基于深度生成颜色
        """
        # 使用 Z 坐标作为深度
        z = vertices[:, 2]
        z_min, z_max = z.min(), z.max()
        z_range = z_max - z_min
        
        if z_range < 1e-8:
            z_norm = np.zeros_like(z)
        else:
            z_norm = (z - z_min) / z_range
        
        # 使用红-黄-绿色谱
        colors = np.zeros((len(vertices), 3), dtype=np.uint8)
        
        # 浅层：绿色
        # 中层：黄色
        # 深层：红色
        colors[:, 0] = (z_norm * 255).astype(np.uint8)  # R: 深度越大越红
        colors[:, 1] = ((1 - z_norm) * 255).astype(np.uint8)  # G: 深度越浅越绿
        colors[:, 2] = (np.abs(z_norm - 0.5) * 100).astype(np.uint8)  # B: 中间略蓝
        
        return colors
    
    def generate_from_binary(
        self,
        binary_volume: np.ndarray,
        spacing: Tuple[float, float, float] = (1.0, 1.0, 1.0)
    ) -> Mesh:
        """
        从二值体数据生成网格
        """
        # 对二值数据使用 0.5 作为阈值
        return self.generate(
            binary_volume.astype(float),
            threshold=0.5,
            smooth=True,
            spacing=spacing
        )
</file>

<file path="backend/core/volume_processor.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 体数据处理模块

功能：
1. 体数据预处理（归一化、去噪等）
2. 最大强度投影（MIP）生成
3. 统计分析
"""

import numpy as np
from scipy import ndimage
from scipy.ndimage import gaussian_filter, median_filter
from typing import Tuple, Optional, Dict, Any


class VolumeProcessor:
    """
    体数据处理器
    
    提供各种体数据预处理和分析功能
    """
    
    def __init__(self):
        pass
    
    def preprocess(
        self,
        volume: np.ndarray,
        normalize: bool = True,
        denoise: bool = False,
        denoise_sigma: float = 1.0
    ) -> np.ndarray:
        """
        体数据预处理
        
        参数：
            volume: 输入体数据
            normalize: 是否归一化到 [0, 1]
            denoise: 是否去噪
            denoise_sigma: 高斯去噪的 sigma
        
        返回：
            处理后的体数据
        """
        volume = volume.astype(np.float32)
        
        # 去噪
        if denoise:
            volume = gaussian_filter(volume, sigma=denoise_sigma)
        
        # 归一化
        if normalize:
            volume = self._normalize(volume)
        
        return volume
    
    def _normalize(self, data: np.ndarray) -> np.ndarray:
        """归一化到 [0, 1]"""
        data_min = data.min()
        data_max = data.max()
        data_range = data_max - data_min
        
        if data_range < 1e-10:
            return np.zeros_like(data)
        
        return (data - data_min) / data_range
    
    def compute_mip(
        self,
        volume: np.ndarray,
        axis: int = 2,
        mode: str = 'max'
    ) -> np.ndarray:
        """
        计算最大/最小/平均强度投影
        
        参数：
            volume: 3D 体数据
            axis: 投影轴 (0, 1, 2)
            mode: 投影模式 ('max', 'min', 'mean', 'sum')
        
        返回：
            2D 投影图像
        """
        if mode == 'max':
            return np.max(volume, axis=axis)
        elif mode == 'min':
            return np.min(volume, axis=axis)
        elif mode == 'mean':
            return np.mean(volume, axis=axis)
        elif mode == 'sum':
            return np.sum(volume, axis=axis)
        else:
            raise ValueError(f"未知的投影模式: {mode}")
    
    def compute_statistics(self, volume: np.ndarray) -> Dict[str, Any]:
        """
        计算体数据统计信息
        """
        return {
            'shape': list(volume.shape),
            'dtype': str(volume.dtype),
            'min': float(volume.min()),
            'max': float(volume.max()),
            'mean': float(volume.mean()),
            'std': float(volume.std()),
            'median': float(np.median(volume)),
            'non_zero_count': int(np.count_nonzero(volume)),
            'non_zero_fraction': float(np.count_nonzero(volume) / volume.size)
        }
    
    def extract_roi(
        self,
        volume: np.ndarray,
        center: Tuple[int, int, int],
        size: Tuple[int, int, int]
    ) -> np.ndarray:
        """
        提取感兴趣区域（ROI）
        
        参数：
            volume: 输入体数据
            center: ROI 中心坐标 (x, y, z)
            size: ROI 尺寸 (sx, sy, sz)
        
        返回：
            ROI 体数据
        """
        cx, cy, cz = center
        sx, sy, sz = size
        
        # 计算边界
        x1 = max(0, cx - sx // 2)
        x2 = min(volume.shape[0], cx + sx // 2 + sx % 2)
        y1 = max(0, cy - sy // 2)
        y2 = min(volume.shape[1], cy + sy // 2 + sy % 2)
        z1 = max(0, cz - sz // 2)
        z2 = min(volume.shape[2], cz + sz // 2 + sz % 2)
        
        return volume[x1:x2, y1:y2, z1:z2].copy()
    
    def downsample(
        self,
        volume: np.ndarray,
        factor: int = 2
    ) -> np.ndarray:
        """
        下采样体数据
        
        用于大数据的预览和快速处理
        """
        from scipy.ndimage import zoom
        
        scale = 1.0 / factor
        return zoom(volume, (scale, scale, scale), order=1)
    
    def apply_threshold(
        self,
        volume: np.ndarray,
        threshold: float = 0.5,
        method: str = 'binary'
    ) -> np.ndarray:
        """
        阈值处理
        
        参数：
            volume: 输入体数据
            threshold: 阈值
            method: 方法 ('binary', 'otsu', 'adaptive')
        
        返回：
            二值化后的体数据
        """
        if method == 'binary':
            return (volume > threshold).astype(np.uint8)
        
        elif method == 'otsu':
            from skimage.filters import threshold_otsu
            thresh = threshold_otsu(volume)
            return (volume > thresh).astype(np.uint8)
        
        elif method == 'adaptive':
            # 简化的自适应阈值
            local_mean = ndimage.uniform_filter(volume, size=11)
            return (volume > local_mean * threshold).astype(np.uint8)
        
        else:
            raise ValueError(f"未知的阈值方法: {method}")
    
    def morphological_clean(
        self,
        binary_volume: np.ndarray,
        opening_size: int = 2,
        closing_size: int = 2
    ) -> np.ndarray:
        """
        形态学清理
        
        用于去除噪声和填充小孔
        """
        from scipy.ndimage import binary_opening, binary_closing
        
        # 创建结构元素
        struct_open = ndimage.generate_binary_structure(3, 1)
        struct_close = ndimage.generate_binary_structure(3, 1)
        
        # 开运算（去除小物体）
        if opening_size > 0:
            binary_volume = binary_opening(
                binary_volume, 
                structure=struct_open,
                iterations=opening_size
            )
        
        # 闭运算（填充小孔）
        if closing_size > 0:
            binary_volume = binary_closing(
                binary_volume,
                structure=struct_close,
                iterations=closing_size
            )
        
        return binary_volume.astype(np.uint8)
    
    def connected_components(
        self,
        binary_volume: np.ndarray,
        min_size: int = 100
    ) -> Tuple[np.ndarray, int]:
        """
        连通区域分析
        
        参数：
            binary_volume: 二值体数据
            min_size: 最小区域大小（体素数）
        
        返回：
            labeled: 标记的体数据
            num_components: 连通区域数量
        """
        from scipy.ndimage import label
        from scipy.ndimage import sum as ndi_sum
        
        # 标记连通区域
        labeled, num_features = label(binary_volume)
        
        # 过滤小区域
        if min_size > 0:
            sizes = ndi_sum(binary_volume, labeled, range(1, num_features + 1))
            mask = sizes >= min_size
            
            # 重新标记
            new_labeled = np.zeros_like(labeled)
            new_idx = 1
            for i, keep in enumerate(mask, start=1):
                if keep:
                    new_labeled[labeled == i] = new_idx
                    new_idx += 1
            
            labeled = new_labeled
            num_features = new_idx - 1
        
        return labeled, num_features
</file>

<file path="backend/data/annotations/ann_20251210_010404_398f4a1a/project.json">
{
  "id": "ann_20251210_010404_398f4a1a",
  "volume_id": "vol_20251205_184159_1c530d6d",
  "name": "项目_7.oct-Stru.dcm_1765299844141",
  "created_at": "2025-12-10T01:04:04.146346",
  "modified_at": "2025-12-10T14:34:57.286994",
  "layers": {
    "x_0": {
      "slice_index": 0,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d85ebe3c",
          "center_x": 247.51768493652344,
          "center_y": 212.8227081298828,
          "radius_x": 133.8910675048828,
          "radius_y": 238.2633819580078,
          "rotation": 90.64720916748047,
          "slice_index": 0,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.530175"
        }
      ],
      "brush_strokes": []
    },
    "x_1": {
      "slice_index": 1,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_73767dcb",
          "center_x": 247.0855712890625,
          "center_y": 213.08456420898438,
          "radius_x": 133.85350036621094,
          "radius_y": 238.81027221679688,
          "rotation": 90.94281005859375,
          "slice_index": 1,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.547732"
        }
      ],
      "brush_strokes": []
    },
    "x_2": {
      "slice_index": 2,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cb6becfc",
          "center_x": 246.81130981445312,
          "center_y": 212.8245391845703,
          "radius_x": 133.3266143798828,
          "radius_y": 238.9330596923828,
          "rotation": 90.85092163085938,
          "slice_index": 2,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.564949"
        }
      ],
      "brush_strokes": []
    },
    "x_3": {
      "slice_index": 3,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_927e73af",
          "center_x": 247.30320739746094,
          "center_y": 212.6881866455078,
          "radius_x": 132.7576141357422,
          "radius_y": 238.35714721679688,
          "rotation": 90.78905487060547,
          "slice_index": 3,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.581877"
        }
      ],
      "brush_strokes": []
    },
    "x_4": {
      "slice_index": 4,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6e8e9f7c",
          "center_x": 246.85328674316406,
          "center_y": 213.08071899414062,
          "radius_x": 133.2599334716797,
          "radius_y": 238.69837951660156,
          "rotation": 90.89036560058594,
          "slice_index": 4,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.599267"
        }
      ],
      "brush_strokes": []
    },
    "x_5": {
      "slice_index": 5,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_261ef2ec",
          "center_x": 247.28944396972656,
          "center_y": 213.11753845214844,
          "radius_x": 133.25241088867188,
          "radius_y": 238.49063110351562,
          "rotation": 90.98909759521484,
          "slice_index": 5,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.616334"
        }
      ],
      "brush_strokes": []
    },
    "x_6": {
      "slice_index": 6,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2b96986b",
          "center_x": 247.73434448242188,
          "center_y": 212.6915740966797,
          "radius_x": 133.91409301757812,
          "radius_y": 239.46543884277344,
          "rotation": 90.5904541015625,
          "slice_index": 6,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.633042"
        }
      ],
      "brush_strokes": []
    },
    "x_7": {
      "slice_index": 7,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1cf20f44",
          "center_x": 247.28651428222656,
          "center_y": 212.89735412597656,
          "radius_x": 133.77963256835938,
          "radius_y": 239.02320861816406,
          "rotation": 90.988525390625,
          "slice_index": 7,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.649871"
        }
      ],
      "brush_strokes": []
    },
    "x_8": {
      "slice_index": 8,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9dd29a58",
          "center_x": 247.16909790039062,
          "center_y": 212.66903686523438,
          "radius_x": 133.80076599121094,
          "radius_y": 238.70648193359375,
          "rotation": 91.02828979492188,
          "slice_index": 8,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.667964"
        }
      ],
      "brush_strokes": []
    },
    "x_9": {
      "slice_index": 9,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_fd3a30c6",
          "center_x": 247.5518035888672,
          "center_y": 212.37071228027344,
          "radius_x": 133.73191833496094,
          "radius_y": 238.97030639648438,
          "rotation": 91.15917205810547,
          "slice_index": 9,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.685024"
        }
      ],
      "brush_strokes": []
    },
    "x_10": {
      "slice_index": 10,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ded10420",
          "center_x": 247.31219482421875,
          "center_y": 212.33384704589844,
          "radius_x": 133.8668212890625,
          "radius_y": 238.9938201904297,
          "rotation": 91.08238220214844,
          "slice_index": 10,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.702174"
        }
      ],
      "brush_strokes": []
    },
    "x_11": {
      "slice_index": 11,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2d0420a0",
          "center_x": 247.3508758544922,
          "center_y": 212.5178680419922,
          "radius_x": 134.0934295654297,
          "radius_y": 238.77157592773438,
          "rotation": 91.03034973144531,
          "slice_index": 11,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.719821"
        }
      ],
      "brush_strokes": []
    },
    "x_12": {
      "slice_index": 12,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6c61d54f",
          "center_x": 247.3025360107422,
          "center_y": 212.76846313476562,
          "radius_x": 133.15086364746094,
          "radius_y": 239.00914001464844,
          "rotation": 90.98316192626953,
          "slice_index": 12,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.737449"
        }
      ],
      "brush_strokes": []
    },
    "x_13": {
      "slice_index": 13,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4b699f29",
          "center_x": 247.29733276367188,
          "center_y": 212.59774780273438,
          "radius_x": 133.53285217285156,
          "radius_y": 239.0331573486328,
          "rotation": 90.92705535888672,
          "slice_index": 13,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.755020"
        }
      ],
      "brush_strokes": []
    },
    "x_14": {
      "slice_index": 14,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_414d94e5",
          "center_x": 247.00424194335938,
          "center_y": 212.89190673828125,
          "radius_x": 133.65985107421875,
          "radius_y": 238.90841674804688,
          "rotation": 90.7724380493164,
          "slice_index": 14,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.773092"
        }
      ],
      "brush_strokes": []
    },
    "x_15": {
      "slice_index": 15,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_28d4cb1f",
          "center_x": 247.58055114746094,
          "center_y": 212.52056884765625,
          "radius_x": 134.6278533935547,
          "radius_y": 238.88140869140625,
          "rotation": 90.8060531616211,
          "slice_index": 15,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.790009"
        }
      ],
      "brush_strokes": []
    },
    "x_16": {
      "slice_index": 16,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_146b8e8a",
          "center_x": 247.0382537841797,
          "center_y": 212.8316650390625,
          "radius_x": 133.8208465576172,
          "radius_y": 238.60137939453125,
          "rotation": 90.89952850341797,
          "slice_index": 16,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.808566"
        }
      ],
      "brush_strokes": []
    },
    "x_17": {
      "slice_index": 17,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a807d01e",
          "center_x": 247.25360107421875,
          "center_y": 212.8423614501953,
          "radius_x": 133.80712890625,
          "radius_y": 238.51593017578125,
          "rotation": 91.08960723876953,
          "slice_index": 17,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.826100"
        }
      ],
      "brush_strokes": []
    },
    "x_18": {
      "slice_index": 18,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9d6814cf",
          "center_x": 247.90650939941406,
          "center_y": 212.7313995361328,
          "radius_x": 133.86727905273438,
          "radius_y": 239.1021270751953,
          "rotation": 90.89530181884766,
          "slice_index": 18,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.844000"
        }
      ],
      "brush_strokes": []
    },
    "x_19": {
      "slice_index": 19,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ecdca1e4",
          "center_x": 247.6385498046875,
          "center_y": 212.12290954589844,
          "radius_x": 134.3047637939453,
          "radius_y": 238.30006408691406,
          "rotation": 91.06185913085938,
          "slice_index": 19,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.861304"
        }
      ],
      "brush_strokes": []
    },
    "x_20": {
      "slice_index": 20,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2fa7db7e",
          "center_x": 247.7860565185547,
          "center_y": 212.1243896484375,
          "radius_x": 134.51466369628906,
          "radius_y": 238.3136749267578,
          "rotation": 91.22594451904297,
          "slice_index": 20,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.877118"
        }
      ],
      "brush_strokes": []
    },
    "x_21": {
      "slice_index": 21,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0d99f712",
          "center_x": 247.708251953125,
          "center_y": 212.67886352539062,
          "radius_x": 134.07228088378906,
          "radius_y": 238.4792022705078,
          "rotation": 90.82270812988281,
          "slice_index": 21,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.896076"
        }
      ],
      "brush_strokes": []
    },
    "x_22": {
      "slice_index": 22,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6a1720c9",
          "center_x": 247.4015350341797,
          "center_y": 212.5207061767578,
          "radius_x": 133.9019317626953,
          "radius_y": 237.9613494873047,
          "rotation": 90.86334228515625,
          "slice_index": 22,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.914845"
        }
      ],
      "brush_strokes": []
    },
    "x_23": {
      "slice_index": 23,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c2cc8d1c",
          "center_x": 247.7079620361328,
          "center_y": 212.34573364257812,
          "radius_x": 133.5749969482422,
          "radius_y": 238.02157592773438,
          "rotation": 90.9324951171875,
          "slice_index": 23,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.930886"
        }
      ],
      "brush_strokes": []
    },
    "x_24": {
      "slice_index": 24,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c15b2ca9",
          "center_x": 247.9413604736328,
          "center_y": 212.08639526367188,
          "radius_x": 134.6249237060547,
          "radius_y": 238.27915954589844,
          "rotation": 90.80886840820312,
          "slice_index": 24,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.948259"
        }
      ],
      "brush_strokes": []
    },
    "x_25": {
      "slice_index": 25,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_63e04ae6",
          "center_x": 248.15908813476562,
          "center_y": 211.55767822265625,
          "radius_x": 134.82957458496094,
          "radius_y": 237.84869384765625,
          "rotation": 91.06414031982422,
          "slice_index": 25,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.965344"
        }
      ],
      "brush_strokes": []
    },
    "x_26": {
      "slice_index": 26,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dfd86e78",
          "center_x": 248.4898223876953,
          "center_y": 211.6527099609375,
          "radius_x": 135.08868408203125,
          "radius_y": 237.75306701660156,
          "rotation": 91.15882110595703,
          "slice_index": 26,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.982151"
        }
      ],
      "brush_strokes": []
    },
    "x_27": {
      "slice_index": 27,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_59000be5",
          "center_x": 247.86541748046875,
          "center_y": 211.23377990722656,
          "radius_x": 135.3623504638672,
          "radius_y": 237.5135040283203,
          "rotation": 90.86882781982422,
          "slice_index": 27,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:48.999232"
        }
      ],
      "brush_strokes": []
    },
    "x_28": {
      "slice_index": 28,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d65a711f",
          "center_x": 247.56307983398438,
          "center_y": 211.3437042236328,
          "radius_x": 134.6381072998047,
          "radius_y": 238.02574157714844,
          "rotation": 90.78219604492188,
          "slice_index": 28,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.016279"
        }
      ],
      "brush_strokes": []
    },
    "x_29": {
      "slice_index": 29,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8ad63b26",
          "center_x": 247.3218536376953,
          "center_y": 211.38534545898438,
          "radius_x": 134.44241333007812,
          "radius_y": 237.85601806640625,
          "rotation": 90.69681549072266,
          "slice_index": 29,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.032211"
        }
      ],
      "brush_strokes": []
    },
    "x_30": {
      "slice_index": 30,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e4dcff7a",
          "center_x": 247.40679931640625,
          "center_y": 211.50672912597656,
          "radius_x": 134.8698272705078,
          "radius_y": 237.23974609375,
          "rotation": 90.96198272705078,
          "slice_index": 30,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.048690"
        }
      ],
      "brush_strokes": []
    },
    "x_31": {
      "slice_index": 31,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4f2c32dd",
          "center_x": 247.1946258544922,
          "center_y": 211.57989501953125,
          "radius_x": 134.6669921875,
          "radius_y": 237.70957946777344,
          "rotation": 90.84645080566406,
          "slice_index": 31,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.067744"
        }
      ],
      "brush_strokes": []
    },
    "x_32": {
      "slice_index": 32,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bd60fc8a",
          "center_x": 247.63426208496094,
          "center_y": 211.04971313476562,
          "radius_x": 134.8417510986328,
          "radius_y": 237.63999938964844,
          "rotation": 91.06626892089844,
          "slice_index": 32,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.085268"
        }
      ],
      "brush_strokes": []
    },
    "x_33": {
      "slice_index": 33,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0408e80c",
          "center_x": 247.59259033203125,
          "center_y": 210.20108032226562,
          "radius_x": 135.6988525390625,
          "radius_y": 237.34756469726562,
          "rotation": 91.38371276855469,
          "slice_index": 33,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.102216"
        }
      ],
      "brush_strokes": []
    },
    "x_34": {
      "slice_index": 34,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2cc307ac",
          "center_x": 247.5815887451172,
          "center_y": 210.2120819091797,
          "radius_x": 135.79238891601562,
          "radius_y": 237.4121551513672,
          "rotation": 91.08963012695312,
          "slice_index": 34,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.119039"
        }
      ],
      "brush_strokes": []
    },
    "x_35": {
      "slice_index": 35,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1510952f",
          "center_x": 248.0904998779297,
          "center_y": 210.6901397705078,
          "radius_x": 136.54989624023438,
          "radius_y": 237.0675506591797,
          "rotation": 91.02970886230469,
          "slice_index": 35,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.137085"
        }
      ],
      "brush_strokes": []
    },
    "x_36": {
      "slice_index": 36,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5bbb3bd8",
          "center_x": 247.5876007080078,
          "center_y": 210.1849822998047,
          "radius_x": 136.29525756835938,
          "radius_y": 236.98568725585938,
          "rotation": 90.85215759277344,
          "slice_index": 36,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.155168"
        }
      ],
      "brush_strokes": []
    },
    "x_37": {
      "slice_index": 37,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b94fd0da",
          "center_x": 247.6023712158203,
          "center_y": 210.28443908691406,
          "radius_x": 136.48583984375,
          "radius_y": 237.05662536621094,
          "rotation": 90.89083862304688,
          "slice_index": 37,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.172889"
        }
      ],
      "brush_strokes": []
    },
    "x_38": {
      "slice_index": 38,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1ca9314a",
          "center_x": 247.66619873046875,
          "center_y": 210.5449981689453,
          "radius_x": 135.27626037597656,
          "radius_y": 237.06314086914062,
          "rotation": 91.18495178222656,
          "slice_index": 38,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.191075"
        }
      ],
      "brush_strokes": []
    },
    "x_39": {
      "slice_index": 39,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f752d453",
          "center_x": 246.827880859375,
          "center_y": 210.56704711914062,
          "radius_x": 135.1584930419922,
          "radius_y": 237.77688598632812,
          "rotation": 91.12014770507812,
          "slice_index": 39,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.208103"
        }
      ],
      "brush_strokes": []
    },
    "x_40": {
      "slice_index": 40,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d1ba9703",
          "center_x": 246.9127960205078,
          "center_y": 210.7010955810547,
          "radius_x": 135.4088592529297,
          "radius_y": 238.12924194335938,
          "rotation": 91.323974609375,
          "slice_index": 40,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.225217"
        }
      ],
      "brush_strokes": []
    },
    "x_41": {
      "slice_index": 41,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bc3c53bb",
          "center_x": 247.3358612060547,
          "center_y": 209.9334259033203,
          "radius_x": 136.30935668945312,
          "radius_y": 237.56460571289062,
          "rotation": 90.6986083984375,
          "slice_index": 41,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.241615"
        }
      ],
      "brush_strokes": []
    },
    "x_42": {
      "slice_index": 42,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1fd68d2e",
          "center_x": 248.1051788330078,
          "center_y": 209.43153381347656,
          "radius_x": 135.89312744140625,
          "radius_y": 237.55870056152344,
          "rotation": 90.951416015625,
          "slice_index": 42,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.259840"
        }
      ],
      "brush_strokes": []
    },
    "x_43": {
      "slice_index": 43,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0516af46",
          "center_x": 247.86415100097656,
          "center_y": 210.0365447998047,
          "radius_x": 136.29156494140625,
          "radius_y": 237.68287658691406,
          "rotation": 90.92355346679688,
          "slice_index": 43,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.276145"
        }
      ],
      "brush_strokes": []
    },
    "x_44": {
      "slice_index": 44,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2fd474d6",
          "center_x": 246.2412109375,
          "center_y": 209.7890625,
          "radius_x": 138.1123809814453,
          "radius_y": 236.7086181640625,
          "rotation": 91.17939758300781,
          "slice_index": 44,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.294014"
        }
      ],
      "brush_strokes": []
    },
    "x_45": {
      "slice_index": 45,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_413bce50",
          "center_x": 245.58811950683594,
          "center_y": 209.2367706298828,
          "radius_x": 137.96372985839844,
          "radius_y": 236.57345581054688,
          "rotation": 91.422119140625,
          "slice_index": 45,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.311206"
        }
      ],
      "brush_strokes": []
    },
    "x_46": {
      "slice_index": 46,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ed6b57cf",
          "center_x": 245.79898071289062,
          "center_y": 209.120849609375,
          "radius_x": 138.2136993408203,
          "radius_y": 236.5645294189453,
          "rotation": 91.53984069824219,
          "slice_index": 46,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.327954"
        }
      ],
      "brush_strokes": []
    },
    "x_47": {
      "slice_index": 47,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bac2e6dd",
          "center_x": 245.78890991210938,
          "center_y": 208.5963134765625,
          "radius_x": 139.6480712890625,
          "radius_y": 235.29681396484375,
          "rotation": 91.74186706542969,
          "slice_index": 47,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.346424"
        }
      ],
      "brush_strokes": []
    },
    "x_48": {
      "slice_index": 48,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_947a4e71",
          "center_x": 246.54995727539062,
          "center_y": 209.13818359375,
          "radius_x": 138.3380889892578,
          "radius_y": 236.3431396484375,
          "rotation": 91.70220184326172,
          "slice_index": 48,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.363272"
        }
      ],
      "brush_strokes": []
    },
    "x_49": {
      "slice_index": 49,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a7dfcae6",
          "center_x": 246.809326171875,
          "center_y": 209.13455200195312,
          "radius_x": 137.5194854736328,
          "radius_y": 236.56141662597656,
          "rotation": 91.5797119140625,
          "slice_index": 49,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.381055"
        }
      ],
      "brush_strokes": []
    },
    "x_50": {
      "slice_index": 50,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_45d21309",
          "center_x": 246.524169921875,
          "center_y": 207.93975830078125,
          "radius_x": 139.17105102539062,
          "radius_y": 235.69158935546875,
          "rotation": 92.08453369140625,
          "slice_index": 50,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.398592"
        }
      ],
      "brush_strokes": []
    },
    "x_51": {
      "slice_index": 51,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1da0b463",
          "center_x": 247.46054077148438,
          "center_y": 208.02915954589844,
          "radius_x": 138.34512329101562,
          "radius_y": 235.8125457763672,
          "rotation": 91.91032409667969,
          "slice_index": 51,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.416141"
        }
      ],
      "brush_strokes": []
    },
    "x_52": {
      "slice_index": 52,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_72a74099",
          "center_x": 247.0478973388672,
          "center_y": 207.7945556640625,
          "radius_x": 138.5521697998047,
          "radius_y": 235.672119140625,
          "rotation": 91.91234588623047,
          "slice_index": 52,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.433855"
        }
      ],
      "brush_strokes": []
    },
    "x_53": {
      "slice_index": 53,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_678e82c8",
          "center_x": 246.9425048828125,
          "center_y": 208.2294158935547,
          "radius_x": 137.82943725585938,
          "radius_y": 235.76446533203125,
          "rotation": 91.39020538330078,
          "slice_index": 53,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.451952"
        }
      ],
      "brush_strokes": []
    },
    "x_54": {
      "slice_index": 54,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2918e0a2",
          "center_x": 246.46803283691406,
          "center_y": 208.40615844726562,
          "radius_x": 138.5843963623047,
          "radius_y": 235.77357482910156,
          "rotation": 91.70581817626953,
          "slice_index": 54,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.469231"
        }
      ],
      "brush_strokes": []
    },
    "x_55": {
      "slice_index": 55,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_be89d7dc",
          "center_x": 246.68605041503906,
          "center_y": 208.27072143554688,
          "radius_x": 138.91050720214844,
          "radius_y": 235.610595703125,
          "rotation": 91.64323425292969,
          "slice_index": 55,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.486166"
        }
      ],
      "brush_strokes": []
    },
    "x_56": {
      "slice_index": 56,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d20154ff",
          "center_x": 247.4589080810547,
          "center_y": 208.808837890625,
          "radius_x": 137.7627410888672,
          "radius_y": 236.60348510742188,
          "rotation": 91.45537567138672,
          "slice_index": 56,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.504808"
        }
      ],
      "brush_strokes": []
    },
    "x_57": {
      "slice_index": 57,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bc457698",
          "center_x": 247.2470245361328,
          "center_y": 208.432373046875,
          "radius_x": 139.2031707763672,
          "radius_y": 236.74481201171875,
          "rotation": 91.55537414550781,
          "slice_index": 57,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.521077"
        }
      ],
      "brush_strokes": []
    },
    "x_58": {
      "slice_index": 58,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_93201df9",
          "center_x": 246.86097717285156,
          "center_y": 208.25718688964844,
          "radius_x": 138.8645782470703,
          "radius_y": 236.64450073242188,
          "rotation": 91.44644165039062,
          "slice_index": 58,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.538974"
        }
      ],
      "brush_strokes": []
    },
    "x_59": {
      "slice_index": 59,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a092a483",
          "center_x": 247.4552764892578,
          "center_y": 208.11773681640625,
          "radius_x": 137.79058837890625,
          "radius_y": 236.880126953125,
          "rotation": 91.25603485107422,
          "slice_index": 59,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.556075"
        }
      ],
      "brush_strokes": []
    },
    "x_60": {
      "slice_index": 60,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_61152156",
          "center_x": 247.38246154785156,
          "center_y": 208.16175842285156,
          "radius_x": 137.74993896484375,
          "radius_y": 236.6968994140625,
          "rotation": 91.14623260498047,
          "slice_index": 60,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.574182"
        }
      ],
      "brush_strokes": []
    },
    "x_61": {
      "slice_index": 61,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_737477ab",
          "center_x": 246.04298400878906,
          "center_y": 207.67190551757812,
          "radius_x": 139.00559997558594,
          "radius_y": 237.2908477783203,
          "rotation": 91.65580749511719,
          "slice_index": 61,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.591123"
        }
      ],
      "brush_strokes": []
    },
    "x_62": {
      "slice_index": 62,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b8a32e1d",
          "center_x": 246.51698303222656,
          "center_y": 208.07846069335938,
          "radius_x": 138.56735229492188,
          "radius_y": 236.7798614501953,
          "rotation": 91.75994873046875,
          "slice_index": 62,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.608265"
        }
      ],
      "brush_strokes": []
    },
    "x_63": {
      "slice_index": 63,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d878e92d",
          "center_x": 246.76475524902344,
          "center_y": 207.5264434814453,
          "radius_x": 138.0843505859375,
          "radius_y": 236.90126037597656,
          "rotation": 91.96464538574219,
          "slice_index": 63,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.626157"
        }
      ],
      "brush_strokes": []
    },
    "x_64": {
      "slice_index": 64,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b3dd1645",
          "center_x": 246.031494140625,
          "center_y": 207.68258666992188,
          "radius_x": 138.66500854492188,
          "radius_y": 236.52069091796875,
          "rotation": 91.77944946289062,
          "slice_index": 64,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.643686"
        }
      ],
      "brush_strokes": []
    },
    "x_65": {
      "slice_index": 65,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7905c565",
          "center_x": 246.6441650390625,
          "center_y": 207.66273498535156,
          "radius_x": 138.31881713867188,
          "radius_y": 236.74517822265625,
          "rotation": 91.38604736328125,
          "slice_index": 65,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.662094"
        }
      ],
      "brush_strokes": []
    },
    "x_66": {
      "slice_index": 66,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_725f2d25",
          "center_x": 246.87957763671875,
          "center_y": 207.17282104492188,
          "radius_x": 138.05014038085938,
          "radius_y": 236.42825317382812,
          "rotation": 91.4022445678711,
          "slice_index": 66,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.680143"
        }
      ],
      "brush_strokes": []
    },
    "x_67": {
      "slice_index": 67,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_aa86e193",
          "center_x": 245.8277587890625,
          "center_y": 206.85971069335938,
          "radius_x": 138.51087951660156,
          "radius_y": 237.05381774902344,
          "rotation": 91.69996643066406,
          "slice_index": 67,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.697422"
        }
      ],
      "brush_strokes": []
    },
    "x_68": {
      "slice_index": 68,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_205efabb",
          "center_x": 244.9071044921875,
          "center_y": 206.91453552246094,
          "radius_x": 139.80882263183594,
          "radius_y": 237.318359375,
          "rotation": 92.02145385742188,
          "slice_index": 68,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.714484"
        }
      ],
      "brush_strokes": []
    },
    "x_69": {
      "slice_index": 69,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_31a17933",
          "center_x": 245.28912353515625,
          "center_y": 206.71400451660156,
          "radius_x": 140.26348876953125,
          "radius_y": 237.30731201171875,
          "rotation": 92.29559326171875,
          "slice_index": 69,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.731225"
        }
      ],
      "brush_strokes": []
    },
    "x_70": {
      "slice_index": 70,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4beef5d6",
          "center_x": 244.12081909179688,
          "center_y": 205.74940490722656,
          "radius_x": 141.57981872558594,
          "radius_y": 236.8961944580078,
          "rotation": 92.65294647216797,
          "slice_index": 70,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.748758"
        }
      ],
      "brush_strokes": []
    },
    "x_71": {
      "slice_index": 71,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c7387019",
          "center_x": 245.584716796875,
          "center_y": 205.86837768554688,
          "radius_x": 140.6412811279297,
          "radius_y": 237.2255096435547,
          "rotation": 92.07249450683594,
          "slice_index": 71,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.765281"
        }
      ],
      "brush_strokes": []
    },
    "x_72": {
      "slice_index": 72,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_89c5a36a",
          "center_x": 245.2053985595703,
          "center_y": 205.72152709960938,
          "radius_x": 140.81854248046875,
          "radius_y": 236.5447540283203,
          "rotation": 92.1823501586914,
          "slice_index": 72,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.782340"
        }
      ],
      "brush_strokes": []
    },
    "x_73": {
      "slice_index": 73,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_423ef8b1",
          "center_x": 246.97262573242188,
          "center_y": 206.26405334472656,
          "radius_x": 140.42596435546875,
          "radius_y": 236.6800079345703,
          "rotation": 91.73912811279297,
          "slice_index": 73,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.801035"
        }
      ],
      "brush_strokes": []
    },
    "x_74": {
      "slice_index": 74,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_3874ac1a",
          "center_x": 247.11233520507812,
          "center_y": 205.9857177734375,
          "radius_x": 139.96646118164062,
          "radius_y": 236.51795959472656,
          "rotation": 91.83187103271484,
          "slice_index": 74,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.817293"
        }
      ],
      "brush_strokes": []
    },
    "x_75": {
      "slice_index": 75,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_950bd0fe",
          "center_x": 246.7731170654297,
          "center_y": 205.65634155273438,
          "radius_x": 139.5984344482422,
          "radius_y": 236.46522521972656,
          "rotation": 91.65922546386719,
          "slice_index": 75,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.834913"
        }
      ],
      "brush_strokes": []
    },
    "x_76": {
      "slice_index": 76,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_aa01d9f0",
          "center_x": 246.30612182617188,
          "center_y": 206.81936645507812,
          "radius_x": 139.04714965820312,
          "radius_y": 237.28292846679688,
          "rotation": 91.2870864868164,
          "slice_index": 76,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.852999"
        }
      ],
      "brush_strokes": []
    },
    "x_77": {
      "slice_index": 77,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_514bf791",
          "center_x": 247.3053436279297,
          "center_y": 206.9439697265625,
          "radius_x": 138.7855987548828,
          "radius_y": 237.0520477294922,
          "rotation": 91.2070083618164,
          "slice_index": 77,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.870057"
        }
      ],
      "brush_strokes": []
    },
    "x_78": {
      "slice_index": 78,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d4513f3b",
          "center_x": 247.48350524902344,
          "center_y": 206.8683319091797,
          "radius_x": 139.124755859375,
          "radius_y": 236.5481719970703,
          "rotation": 91.36953735351562,
          "slice_index": 78,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.885715"
        }
      ],
      "brush_strokes": []
    },
    "x_79": {
      "slice_index": 79,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_212fb47d",
          "center_x": 246.93429565429688,
          "center_y": 208.0525665283203,
          "radius_x": 138.56732177734375,
          "radius_y": 238.0368194580078,
          "rotation": 91.05487823486328,
          "slice_index": 79,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.904996"
        }
      ],
      "brush_strokes": []
    },
    "x_80": {
      "slice_index": 80,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a7844805",
          "center_x": 247.4813232421875,
          "center_y": 207.13648986816406,
          "radius_x": 138.9261016845703,
          "radius_y": 237.0782928466797,
          "rotation": 91.07533264160156,
          "slice_index": 80,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.923198"
        }
      ],
      "brush_strokes": []
    },
    "x_81": {
      "slice_index": 81,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e0a82431",
          "center_x": 247.38143920898438,
          "center_y": 207.21334838867188,
          "radius_x": 138.4325408935547,
          "radius_y": 237.26498413085938,
          "rotation": 91.02345275878906,
          "slice_index": 81,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.940166"
        }
      ],
      "brush_strokes": []
    },
    "x_82": {
      "slice_index": 82,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b02a7d7f",
          "center_x": 247.52980041503906,
          "center_y": 206.38827514648438,
          "radius_x": 139.8612060546875,
          "radius_y": 236.66676330566406,
          "rotation": 91.13139343261719,
          "slice_index": 82,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.957445"
        }
      ],
      "brush_strokes": []
    },
    "x_83": {
      "slice_index": 83,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_130fb5c6",
          "center_x": 248.51577758789062,
          "center_y": 206.68264770507812,
          "radius_x": 139.78981018066406,
          "radius_y": 236.92591857910156,
          "rotation": 90.6878890991211,
          "slice_index": 83,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.975013"
        }
      ],
      "brush_strokes": []
    },
    "x_84": {
      "slice_index": 84,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0b83d6f9",
          "center_x": 248.69287109375,
          "center_y": 206.80694580078125,
          "radius_x": 140.1641387939453,
          "radius_y": 237.16763305664062,
          "rotation": 90.7150650024414,
          "slice_index": 84,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:49.992446"
        }
      ],
      "brush_strokes": []
    },
    "x_85": {
      "slice_index": 85,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_03cfa704",
          "center_x": 247.4612274169922,
          "center_y": 206.58319091796875,
          "radius_x": 139.7071533203125,
          "radius_y": 237.37229919433594,
          "rotation": 90.98854064941406,
          "slice_index": 85,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.008544"
        }
      ],
      "brush_strokes": []
    },
    "x_86": {
      "slice_index": 86,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_419cb971",
          "center_x": 247.997802734375,
          "center_y": 205.9584197998047,
          "radius_x": 140.8575439453125,
          "radius_y": 237.19586181640625,
          "rotation": 90.99118041992188,
          "slice_index": 86,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.027593"
        }
      ],
      "brush_strokes": []
    },
    "x_87": {
      "slice_index": 87,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e75f9bf2",
          "center_x": 248.23948669433594,
          "center_y": 205.7039337158203,
          "radius_x": 141.15699768066406,
          "radius_y": 236.6371612548828,
          "rotation": 91.02581024169922,
          "slice_index": 87,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.045145"
        }
      ],
      "brush_strokes": []
    },
    "x_88": {
      "slice_index": 88,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7ddc6ab8",
          "center_x": 248.2596435546875,
          "center_y": 205.94468688964844,
          "radius_x": 140.68588256835938,
          "radius_y": 236.83905029296875,
          "rotation": 91.41664123535156,
          "slice_index": 88,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.061984"
        }
      ],
      "brush_strokes": []
    },
    "x_89": {
      "slice_index": 89,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_fcc608b0",
          "center_x": 248.18565368652344,
          "center_y": 206.0293426513672,
          "radius_x": 140.79222106933594,
          "radius_y": 237.00604248046875,
          "rotation": 91.1614990234375,
          "slice_index": 89,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.080207"
        }
      ],
      "brush_strokes": []
    },
    "x_90": {
      "slice_index": 90,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2db91b0f",
          "center_x": 248.3435516357422,
          "center_y": 205.93653869628906,
          "radius_x": 141.40786743164062,
          "radius_y": 236.3587646484375,
          "rotation": 91.37776947021484,
          "slice_index": 90,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.097240"
        }
      ],
      "brush_strokes": []
    },
    "x_91": {
      "slice_index": 91,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a50f4672",
          "center_x": 247.55140686035156,
          "center_y": 206.6702880859375,
          "radius_x": 140.14776611328125,
          "radius_y": 236.96678161621094,
          "rotation": 91.41053771972656,
          "slice_index": 91,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.113734"
        }
      ],
      "brush_strokes": []
    },
    "x_92": {
      "slice_index": 92,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f26949e7",
          "center_x": 247.95285034179688,
          "center_y": 206.555908203125,
          "radius_x": 140.4656982421875,
          "radius_y": 236.5989990234375,
          "rotation": 91.55899810791016,
          "slice_index": 92,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.131275"
        }
      ],
      "brush_strokes": []
    },
    "x_93": {
      "slice_index": 93,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_eaa31a08",
          "center_x": 247.5584716796875,
          "center_y": 207.283447265625,
          "radius_x": 139.79969787597656,
          "radius_y": 237.4498291015625,
          "rotation": 91.52273559570312,
          "slice_index": 93,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.148360"
        }
      ],
      "brush_strokes": []
    },
    "x_94": {
      "slice_index": 94,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dfdb4fd8",
          "center_x": 246.8587188720703,
          "center_y": 206.93084716796875,
          "radius_x": 140.14041137695312,
          "radius_y": 237.5309295654297,
          "rotation": 91.3832015991211,
          "slice_index": 94,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.166148"
        }
      ],
      "brush_strokes": []
    },
    "x_95": {
      "slice_index": 95,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5db1c41d",
          "center_x": 247.12832641601562,
          "center_y": 206.78466796875,
          "radius_x": 140.02627563476562,
          "radius_y": 237.3960418701172,
          "rotation": 91.59808349609375,
          "slice_index": 95,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.182896"
        }
      ],
      "brush_strokes": []
    },
    "x_96": {
      "slice_index": 96,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f5e28972",
          "center_x": 247.34437561035156,
          "center_y": 206.28053283691406,
          "radius_x": 140.77084350585938,
          "radius_y": 236.8229522705078,
          "rotation": 91.16238403320312,
          "slice_index": 96,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.199162"
        }
      ],
      "brush_strokes": []
    },
    "x_97": {
      "slice_index": 97,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_80538a40",
          "center_x": 246.44053649902344,
          "center_y": 206.20823669433594,
          "radius_x": 140.49526977539062,
          "radius_y": 237.36378479003906,
          "rotation": 91.4614028930664,
          "slice_index": 97,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.217392"
        }
      ],
      "brush_strokes": []
    },
    "x_98": {
      "slice_index": 98,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1848e83c",
          "center_x": 246.41131591796875,
          "center_y": 206.08920288085938,
          "radius_x": 140.04637145996094,
          "radius_y": 237.10504150390625,
          "rotation": 91.33145904541016,
          "slice_index": 98,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.234019"
        }
      ],
      "brush_strokes": []
    },
    "x_99": {
      "slice_index": 99,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_94232406",
          "center_x": 247.42774963378906,
          "center_y": 206.47703552246094,
          "radius_x": 140.40435791015625,
          "radius_y": 237.59437561035156,
          "rotation": 90.88053894042969,
          "slice_index": 99,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.251303"
        }
      ],
      "brush_strokes": []
    },
    "x_100": {
      "slice_index": 100,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6f9b61df",
          "center_x": 247.0401153564453,
          "center_y": 206.3342742919922,
          "radius_x": 139.56002807617188,
          "radius_y": 236.9636688232422,
          "rotation": 90.46674346923828,
          "slice_index": 100,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.268728"
        }
      ],
      "brush_strokes": []
    },
    "x_101": {
      "slice_index": 101,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9e98e9c1",
          "center_x": 247.25482177734375,
          "center_y": 206.5817108154297,
          "radius_x": 139.32322692871094,
          "radius_y": 237.4166717529297,
          "rotation": 90.59880828857422,
          "slice_index": 101,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.285766"
        }
      ],
      "brush_strokes": []
    },
    "x_102": {
      "slice_index": 102,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0f2a8037",
          "center_x": 247.24685668945312,
          "center_y": 205.60646057128906,
          "radius_x": 140.60301208496094,
          "radius_y": 236.74884033203125,
          "rotation": 91.37639617919922,
          "slice_index": 102,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.301808"
        }
      ],
      "brush_strokes": []
    },
    "x_103": {
      "slice_index": 103,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6d499a7e",
          "center_x": 246.94276428222656,
          "center_y": 204.93716430664062,
          "radius_x": 141.60391235351562,
          "radius_y": 237.2115020751953,
          "rotation": 91.03219604492188,
          "slice_index": 103,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.318620"
        }
      ],
      "brush_strokes": []
    },
    "x_104": {
      "slice_index": 104,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e0c1d932",
          "center_x": 246.2779083251953,
          "center_y": 204.62811279296875,
          "radius_x": 140.87413024902344,
          "radius_y": 237.39291381835938,
          "rotation": 90.91219329833984,
          "slice_index": 104,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.336040"
        }
      ],
      "brush_strokes": []
    },
    "x_105": {
      "slice_index": 105,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_14ac8cce",
          "center_x": 245.6498565673828,
          "center_y": 204.7386474609375,
          "radius_x": 142.48529052734375,
          "radius_y": 237.28501892089844,
          "rotation": 92.76097869873047,
          "slice_index": 105,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.353815"
        }
      ],
      "brush_strokes": []
    },
    "x_106": {
      "slice_index": 106,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_86c1ce7a",
          "center_x": 245.010498046875,
          "center_y": 205.0916290283203,
          "radius_x": 140.89956665039062,
          "radius_y": 236.92527770996094,
          "rotation": 92.4256591796875,
          "slice_index": 106,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.371224"
        }
      ],
      "brush_strokes": []
    },
    "x_107": {
      "slice_index": 107,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e7f542e5",
          "center_x": 244.3318634033203,
          "center_y": 204.78187561035156,
          "radius_x": 141.5370635986328,
          "radius_y": 236.8040313720703,
          "rotation": 92.23029327392578,
          "slice_index": 107,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.389012"
        }
      ],
      "brush_strokes": []
    },
    "x_108": {
      "slice_index": 108,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9dbe393b",
          "center_x": 246.5645294189453,
          "center_y": 205.71328735351562,
          "radius_x": 139.57313537597656,
          "radius_y": 237.6660919189453,
          "rotation": 91.28109741210938,
          "slice_index": 108,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.406049"
        }
      ],
      "brush_strokes": []
    },
    "x_109": {
      "slice_index": 109,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0089e985",
          "center_x": 247.81427001953125,
          "center_y": 206.65696716308594,
          "radius_x": 139.325439453125,
          "radius_y": 237.7720489501953,
          "rotation": 90.94450378417969,
          "slice_index": 109,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.422824"
        }
      ],
      "brush_strokes": []
    },
    "x_110": {
      "slice_index": 110,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7733cb7a",
          "center_x": 247.86219787597656,
          "center_y": 206.45010375976562,
          "radius_x": 139.67417907714844,
          "radius_y": 237.56192016601562,
          "rotation": 90.71170806884766,
          "slice_index": 110,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.440907"
        }
      ],
      "brush_strokes": []
    },
    "x_111": {
      "slice_index": 111,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1641f860",
          "center_x": 247.0629425048828,
          "center_y": 206.07752990722656,
          "radius_x": 140.51365661621094,
          "radius_y": 237.58827209472656,
          "rotation": 90.53045654296875,
          "slice_index": 111,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.458116"
        }
      ],
      "brush_strokes": []
    },
    "x_112": {
      "slice_index": 112,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c3645640",
          "center_x": 246.67001342773438,
          "center_y": 205.9404754638672,
          "radius_x": 140.00247192382812,
          "radius_y": 238.00767517089844,
          "rotation": 90.34998321533203,
          "slice_index": 112,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.475276"
        }
      ],
      "brush_strokes": []
    },
    "x_113": {
      "slice_index": 113,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5740eb24",
          "center_x": 247.13961791992188,
          "center_y": 205.8302764892578,
          "radius_x": 140.31964111328125,
          "radius_y": 237.56396484375,
          "rotation": 90.33417510986328,
          "slice_index": 113,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.492109"
        }
      ],
      "brush_strokes": []
    },
    "x_114": {
      "slice_index": 114,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4cd5c781",
          "center_x": 247.86517333984375,
          "center_y": 205.84715270996094,
          "radius_x": 140.53111267089844,
          "radius_y": 237.30140686035156,
          "rotation": 91.24462890625,
          "slice_index": 114,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.509833"
        }
      ],
      "brush_strokes": []
    },
    "x_115": {
      "slice_index": 115,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ffd92e5a",
          "center_x": 249.02523803710938,
          "center_y": 205.27947998046875,
          "radius_x": 140.7410430908203,
          "radius_y": 237.36697387695312,
          "rotation": 90.9552230834961,
          "slice_index": 115,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.525942"
        }
      ],
      "brush_strokes": []
    },
    "x_116": {
      "slice_index": 116,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cac978de",
          "center_x": 249.02438354492188,
          "center_y": 205.0864715576172,
          "radius_x": 141.14202880859375,
          "radius_y": 237.38226318359375,
          "rotation": 91.01393127441406,
          "slice_index": 116,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.543701"
        }
      ],
      "brush_strokes": []
    },
    "x_117": {
      "slice_index": 117,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_039a996a",
          "center_x": 249.2410888671875,
          "center_y": 204.9840087890625,
          "radius_x": 140.792724609375,
          "radius_y": 236.54788208007812,
          "rotation": 91.25550842285156,
          "slice_index": 117,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.562025"
        }
      ],
      "brush_strokes": []
    },
    "x_118": {
      "slice_index": 118,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_23971e84",
          "center_x": 249.02145385742188,
          "center_y": 205.21969604492188,
          "radius_x": 140.6101837158203,
          "radius_y": 236.76646423339844,
          "rotation": 91.16525268554688,
          "slice_index": 118,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.578562"
        }
      ],
      "brush_strokes": []
    },
    "x_119": {
      "slice_index": 119,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c9c77b49",
          "center_x": 248.09913635253906,
          "center_y": 205.8645477294922,
          "radius_x": 140.7374267578125,
          "radius_y": 236.8914031982422,
          "rotation": 91.1744384765625,
          "slice_index": 119,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.597668"
        }
      ],
      "brush_strokes": []
    },
    "x_120": {
      "slice_index": 120,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f3f691d5",
          "center_x": 248.31712341308594,
          "center_y": 205.95208740234375,
          "radius_x": 140.98873901367188,
          "radius_y": 238.27455139160156,
          "rotation": 90.61099243164062,
          "slice_index": 120,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.616908"
        }
      ],
      "brush_strokes": []
    },
    "x_121": {
      "slice_index": 121,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_22285c1d",
          "center_x": 248.27706909179688,
          "center_y": 205.88853454589844,
          "radius_x": 141.2836456298828,
          "radius_y": 238.18650817871094,
          "rotation": 90.62348937988281,
          "slice_index": 121,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.634962"
        }
      ],
      "brush_strokes": []
    },
    "x_122": {
      "slice_index": 122,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4bbbb47d",
          "center_x": 247.53427124023438,
          "center_y": 205.95895385742188,
          "radius_x": 141.00753784179688,
          "radius_y": 237.26637268066406,
          "rotation": 91.02831268310547,
          "slice_index": 122,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.651499"
        }
      ],
      "brush_strokes": []
    },
    "x_123": {
      "slice_index": 123,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e579520d",
          "center_x": 247.45787048339844,
          "center_y": 205.06561279296875,
          "radius_x": 140.58023071289062,
          "radius_y": 237.67184448242188,
          "rotation": 90.3140869140625,
          "slice_index": 123,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.669037"
        }
      ],
      "brush_strokes": []
    },
    "x_124": {
      "slice_index": 124,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ebaa7788",
          "center_x": 247.53857421875,
          "center_y": 204.68472290039062,
          "radius_x": 140.66397094726562,
          "radius_y": 237.35333251953125,
          "rotation": 90.25020599365234,
          "slice_index": 124,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.684861"
        }
      ],
      "brush_strokes": []
    },
    "x_125": {
      "slice_index": 125,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c4e875dc",
          "center_x": 248.7601776123047,
          "center_y": 204.6158905029297,
          "radius_x": 141.1116180419922,
          "radius_y": 238.397216796875,
          "rotation": 90.33085632324219,
          "slice_index": 125,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.703736"
        }
      ],
      "brush_strokes": []
    },
    "x_126": {
      "slice_index": 126,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1930b9fb",
          "center_x": 247.62672424316406,
          "center_y": 205.79429626464844,
          "radius_x": 140.6497344970703,
          "radius_y": 238.3583984375,
          "rotation": 90.59140014648438,
          "slice_index": 126,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.721755"
        }
      ],
      "brush_strokes": []
    },
    "x_127": {
      "slice_index": 127,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_64748a88",
          "center_x": 247.92422485351562,
          "center_y": 205.4301300048828,
          "radius_x": 140.399169921875,
          "radius_y": 237.81414794921875,
          "rotation": 90.86292266845703,
          "slice_index": 127,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.738507"
        }
      ],
      "brush_strokes": []
    },
    "x_128": {
      "slice_index": 128,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cfba2f26",
          "center_x": 247.8680877685547,
          "center_y": 205.93618774414062,
          "radius_x": 140.2108917236328,
          "radius_y": 236.98770141601562,
          "rotation": 90.79666137695312,
          "slice_index": 128,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.756236"
        }
      ],
      "brush_strokes": []
    },
    "x_129": {
      "slice_index": 129,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0ad9bf97",
          "center_x": 247.521728515625,
          "center_y": 204.49696350097656,
          "radius_x": 140.5222625732422,
          "radius_y": 236.35977172851562,
          "rotation": 90.82679748535156,
          "slice_index": 129,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.772775"
        }
      ],
      "brush_strokes": []
    },
    "x_130": {
      "slice_index": 130,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dacb6c9a",
          "center_x": 247.67388916015625,
          "center_y": 204.5869140625,
          "radius_x": 140.33580017089844,
          "radius_y": 236.42129516601562,
          "rotation": 90.89022827148438,
          "slice_index": 130,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.790517"
        }
      ],
      "brush_strokes": []
    },
    "x_131": {
      "slice_index": 131,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ab60381d",
          "center_x": 246.2905731201172,
          "center_y": 203.95709228515625,
          "radius_x": 141.01339721679688,
          "radius_y": 235.88882446289062,
          "rotation": 91.12651062011719,
          "slice_index": 131,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.808564"
        }
      ],
      "brush_strokes": []
    },
    "x_132": {
      "slice_index": 132,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_846a4890",
          "center_x": 248.54759216308594,
          "center_y": 204.2109832763672,
          "radius_x": 142.06954956054688,
          "radius_y": 235.94813537597656,
          "rotation": 91.40604400634766,
          "slice_index": 132,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.826133"
        }
      ],
      "brush_strokes": []
    },
    "x_133": {
      "slice_index": 133,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_beb83d4a",
          "center_x": 248.40762329101562,
          "center_y": 204.62176513671875,
          "radius_x": 142.367431640625,
          "radius_y": 236.45486450195312,
          "rotation": 91.43441009521484,
          "slice_index": 133,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.843207"
        }
      ],
      "brush_strokes": []
    },
    "x_134": {
      "slice_index": 134,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2e96a7de",
          "center_x": 247.5025634765625,
          "center_y": 203.12255859375,
          "radius_x": 140.49826049804688,
          "radius_y": 236.63450622558594,
          "rotation": 91.46620178222656,
          "slice_index": 134,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.863079"
        }
      ],
      "brush_strokes": []
    },
    "x_135": {
      "slice_index": 135,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6216bf4f",
          "center_x": 247.95664978027344,
          "center_y": 204.0608367919922,
          "radius_x": 141.8655548095703,
          "radius_y": 236.7763671875,
          "rotation": 91.7776870727539,
          "slice_index": 135,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.880532"
        }
      ],
      "brush_strokes": []
    },
    "x_136": {
      "slice_index": 136,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2233f169",
          "center_x": 247.68980407714844,
          "center_y": 203.7791748046875,
          "radius_x": 141.88766479492188,
          "radius_y": 236.33055114746094,
          "rotation": 91.5665054321289,
          "slice_index": 136,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.897385"
        }
      ],
      "brush_strokes": []
    },
    "x_137": {
      "slice_index": 137,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_27065cef",
          "center_x": 247.39178466796875,
          "center_y": 204.16168212890625,
          "radius_x": 141.36007690429688,
          "radius_y": 237.1845245361328,
          "rotation": 91.89655303955078,
          "slice_index": 137,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.914805"
        }
      ],
      "brush_strokes": []
    },
    "x_138": {
      "slice_index": 138,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7c766b75",
          "center_x": 247.64170837402344,
          "center_y": 204.4232177734375,
          "radius_x": 141.71153259277344,
          "radius_y": 237.34471130371094,
          "rotation": 91.66825866699219,
          "slice_index": 138,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.933051"
        }
      ],
      "brush_strokes": []
    },
    "x_139": {
      "slice_index": 139,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4a54c0d5",
          "center_x": 247.51461791992188,
          "center_y": 204.6278076171875,
          "radius_x": 141.5258331298828,
          "radius_y": 237.62744140625,
          "rotation": 91.36835479736328,
          "slice_index": 139,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.950080"
        }
      ],
      "brush_strokes": []
    },
    "x_140": {
      "slice_index": 140,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_09340759",
          "center_x": 247.4627685546875,
          "center_y": 202.80528259277344,
          "radius_x": 143.90171813964844,
          "radius_y": 237.20745849609375,
          "rotation": 91.85393524169922,
          "slice_index": 140,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.968621"
        }
      ],
      "brush_strokes": []
    },
    "x_141": {
      "slice_index": 141,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5c61e48b",
          "center_x": 246.28443908691406,
          "center_y": 201.46900939941406,
          "radius_x": 144.33370971679688,
          "radius_y": 235.65841674804688,
          "rotation": 92.34207916259766,
          "slice_index": 141,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:50.985683"
        }
      ],
      "brush_strokes": []
    },
    "x_142": {
      "slice_index": 142,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9ff7614c",
          "center_x": 246.11117553710938,
          "center_y": 201.26998901367188,
          "radius_x": 144.0858154296875,
          "radius_y": 235.52200317382812,
          "rotation": 92.16622924804688,
          "slice_index": 142,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.002828"
        }
      ],
      "brush_strokes": []
    },
    "x_143": {
      "slice_index": 143,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4ce4e621",
          "center_x": 246.15386962890625,
          "center_y": 200.9608154296875,
          "radius_x": 144.320556640625,
          "radius_y": 235.60340881347656,
          "rotation": 92.20800018310547,
          "slice_index": 143,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.020182"
        }
      ],
      "brush_strokes": []
    },
    "x_144": {
      "slice_index": 144,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e513fa3c",
          "center_x": 247.33853149414062,
          "center_y": 201.32981872558594,
          "radius_x": 143.610595703125,
          "radius_y": 236.90966796875,
          "rotation": 92.84852600097656,
          "slice_index": 144,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.037235"
        }
      ],
      "brush_strokes": []
    },
    "x_145": {
      "slice_index": 145,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9797b855",
          "center_x": 246.8620147705078,
          "center_y": 201.40037536621094,
          "radius_x": 143.4103240966797,
          "radius_y": 237.37037658691406,
          "rotation": 92.41407775878906,
          "slice_index": 145,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.054069"
        }
      ],
      "brush_strokes": []
    },
    "x_146": {
      "slice_index": 146,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cb49592a",
          "center_x": 248.2057647705078,
          "center_y": 201.8427276611328,
          "radius_x": 141.78298950195312,
          "radius_y": 237.9388885498047,
          "rotation": 92.23419189453125,
          "slice_index": 146,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.072987"
        }
      ],
      "brush_strokes": []
    },
    "x_147": {
      "slice_index": 147,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_283ac9a4",
          "center_x": 247.4569854736328,
          "center_y": 202.30348205566406,
          "radius_x": 142.1960906982422,
          "radius_y": 237.9375762939453,
          "rotation": 92.00875091552734,
          "slice_index": 147,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.090848"
        }
      ],
      "brush_strokes": []
    },
    "x_148": {
      "slice_index": 148,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_92801465",
          "center_x": 249.23330688476562,
          "center_y": 202.4048309326172,
          "radius_x": 140.801513671875,
          "radius_y": 238.78073120117188,
          "rotation": 92.13944244384766,
          "slice_index": 148,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.109780"
        }
      ],
      "brush_strokes": []
    },
    "x_149": {
      "slice_index": 149,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_194c9523",
          "center_x": 250.97998046875,
          "center_y": 201.26634216308594,
          "radius_x": 141.70835876464844,
          "radius_y": 238.43380737304688,
          "rotation": 92.01622009277344,
          "slice_index": 149,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.125868"
        }
      ],
      "brush_strokes": []
    },
    "x_150": {
      "slice_index": 150,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d0e9e61c",
          "center_x": 251.58889770507812,
          "center_y": 201.43650817871094,
          "radius_x": 141.925537109375,
          "radius_y": 238.29042053222656,
          "rotation": 91.92747497558594,
          "slice_index": 150,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.142595"
        }
      ],
      "brush_strokes": []
    },
    "x_151": {
      "slice_index": 151,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_fb46cc6b",
          "center_x": 251.14761352539062,
          "center_y": 201.57275390625,
          "radius_x": 142.95335388183594,
          "radius_y": 238.38961791992188,
          "rotation": 92.36072540283203,
          "slice_index": 151,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.160634"
        }
      ],
      "brush_strokes": []
    },
    "x_152": {
      "slice_index": 152,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_78afb484",
          "center_x": 249.63328552246094,
          "center_y": 201.93568420410156,
          "radius_x": 143.66297912597656,
          "radius_y": 237.7694091796875,
          "rotation": 92.81100463867188,
          "slice_index": 152,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.178180"
        }
      ],
      "brush_strokes": []
    },
    "x_153": {
      "slice_index": 153,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_12abd684",
          "center_x": 250.14080810546875,
          "center_y": 201.9842529296875,
          "radius_x": 142.26805114746094,
          "radius_y": 237.62295532226562,
          "rotation": 92.38861846923828,
          "slice_index": 153,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.194104"
        }
      ],
      "brush_strokes": []
    },
    "x_154": {
      "slice_index": 154,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_202f03e3",
          "center_x": 251.75759887695312,
          "center_y": 201.98866271972656,
          "radius_x": 142.17434692382812,
          "radius_y": 237.10357666015625,
          "rotation": 92.19934844970703,
          "slice_index": 154,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.210918"
        }
      ],
      "brush_strokes": []
    },
    "x_155": {
      "slice_index": 155,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_de5ddd20",
          "center_x": 249.96524047851562,
          "center_y": 201.4475555419922,
          "radius_x": 142.39239501953125,
          "radius_y": 236.6841583251953,
          "rotation": 91.91551971435547,
          "slice_index": 155,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.228452"
        }
      ],
      "brush_strokes": []
    },
    "x_156": {
      "slice_index": 156,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b9ae0933",
          "center_x": 250.24066162109375,
          "center_y": 201.7137451171875,
          "radius_x": 142.49305725097656,
          "radius_y": 236.4655303955078,
          "rotation": 91.93721771240234,
          "slice_index": 156,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.249856"
        }
      ],
      "brush_strokes": []
    },
    "x_157": {
      "slice_index": 157,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_577b7be7",
          "center_x": 248.42701721191406,
          "center_y": 201.28173828125,
          "radius_x": 142.9995880126953,
          "radius_y": 236.19395446777344,
          "rotation": 92.2718734741211,
          "slice_index": 157,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.267403"
        }
      ],
      "brush_strokes": []
    },
    "x_158": {
      "slice_index": 158,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_860454f8",
          "center_x": 248.69534301757812,
          "center_y": 203.0072479248047,
          "radius_x": 143.26429748535156,
          "radius_y": 235.32693481445312,
          "rotation": 91.89530181884766,
          "slice_index": 158,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.285046"
        }
      ],
      "brush_strokes": []
    },
    "x_159": {
      "slice_index": 159,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d64663da",
          "center_x": 247.39744567871094,
          "center_y": 202.7913360595703,
          "radius_x": 142.66102600097656,
          "radius_y": 235.5714111328125,
          "rotation": 91.5344009399414,
          "slice_index": 159,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.301598"
        }
      ],
      "brush_strokes": []
    },
    "x_160": {
      "slice_index": 160,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6218fe62",
          "center_x": 247.05235290527344,
          "center_y": 203.2952117919922,
          "radius_x": 141.66636657714844,
          "radius_y": 236.10467529296875,
          "rotation": 91.0157699584961,
          "slice_index": 160,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.318658"
        }
      ],
      "brush_strokes": []
    },
    "x_161": {
      "slice_index": 161,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2a5c8b18",
          "center_x": 248.44752502441406,
          "center_y": 203.4590606689453,
          "radius_x": 141.02944946289062,
          "radius_y": 235.5907440185547,
          "rotation": 91.36959075927734,
          "slice_index": 161,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.335716"
        }
      ],
      "brush_strokes": []
    },
    "x_162": {
      "slice_index": 162,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a538741c",
          "center_x": 247.86404418945312,
          "center_y": 203.6782989501953,
          "radius_x": 141.1707000732422,
          "radius_y": 235.40933227539062,
          "rotation": 91.07501983642578,
          "slice_index": 162,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.355261"
        }
      ],
      "brush_strokes": []
    },
    "x_163": {
      "slice_index": 163,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d116411c",
          "center_x": 248.94676208496094,
          "center_y": 204.08538818359375,
          "radius_x": 141.12457275390625,
          "radius_y": 236.39901733398438,
          "rotation": 90.76593780517578,
          "slice_index": 163,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.373056"
        }
      ],
      "brush_strokes": []
    },
    "x_164": {
      "slice_index": 164,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_50865cd9",
          "center_x": 249.26918029785156,
          "center_y": 204.53372192382812,
          "radius_x": 141.86251831054688,
          "radius_y": 236.83628845214844,
          "rotation": 90.62401580810547,
          "slice_index": 164,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.390685"
        }
      ],
      "brush_strokes": []
    },
    "x_165": {
      "slice_index": 165,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_49685d53",
          "center_x": 249.2436065673828,
          "center_y": 204.40280151367188,
          "radius_x": 141.84971618652344,
          "radius_y": 236.68072509765625,
          "rotation": 90.61992645263672,
          "slice_index": 165,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.408228"
        }
      ],
      "brush_strokes": []
    },
    "x_166": {
      "slice_index": 166,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0fff28b7",
          "center_x": 248.7857208251953,
          "center_y": 204.26577758789062,
          "radius_x": 140.1794891357422,
          "radius_y": 236.62164306640625,
          "rotation": 90.44859313964844,
          "slice_index": 166,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.425264"
        }
      ],
      "brush_strokes": []
    },
    "x_167": {
      "slice_index": 167,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f25d76d9",
          "center_x": 248.0700225830078,
          "center_y": 205.6244659423828,
          "radius_x": 140.11575317382812,
          "radius_y": 237.540771484375,
          "rotation": 90.31805419921875,
          "slice_index": 167,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.442813"
        }
      ],
      "brush_strokes": []
    },
    "x_168": {
      "slice_index": 168,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9e5837bb",
          "center_x": 248.1703338623047,
          "center_y": 205.42323303222656,
          "radius_x": 140.0357666015625,
          "radius_y": 237.51046752929688,
          "rotation": 90.44295501708984,
          "slice_index": 168,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.459228"
        }
      ],
      "brush_strokes": []
    },
    "x_169": {
      "slice_index": 169,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8b92ecbc",
          "center_x": 248.4449920654297,
          "center_y": 204.3684539794922,
          "radius_x": 142.41603088378906,
          "radius_y": 236.67315673828125,
          "rotation": 89.72425842285156,
          "slice_index": 169,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.476166"
        }
      ],
      "brush_strokes": []
    },
    "x_170": {
      "slice_index": 170,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_514080ea",
          "center_x": 248.38262939453125,
          "center_y": 204.20721435546875,
          "radius_x": 140.8208465576172,
          "radius_y": 237.09915161132812,
          "rotation": 90.42200469970703,
          "slice_index": 170,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.494788"
        }
      ],
      "brush_strokes": []
    },
    "x_171": {
      "slice_index": 171,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5b0bd765",
          "center_x": 248.89500427246094,
          "center_y": 204.3678741455078,
          "radius_x": 140.87403869628906,
          "radius_y": 237.12088012695312,
          "rotation": 90.52774810791016,
          "slice_index": 171,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.512057"
        }
      ],
      "brush_strokes": []
    },
    "x_172": {
      "slice_index": 172,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0a41ec54",
          "center_x": 248.0647430419922,
          "center_y": 204.24179077148438,
          "radius_x": 141.2633819580078,
          "radius_y": 237.3335418701172,
          "rotation": 90.49227142333984,
          "slice_index": 172,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.528217"
        }
      ],
      "brush_strokes": []
    },
    "x_173": {
      "slice_index": 173,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_78a6cded",
          "center_x": 248.61068725585938,
          "center_y": 204.06126403808594,
          "radius_x": 141.34765625,
          "radius_y": 237.19387817382812,
          "rotation": 90.67848205566406,
          "slice_index": 173,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.545149"
        }
      ],
      "brush_strokes": []
    },
    "x_174": {
      "slice_index": 174,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e4c16486",
          "center_x": 248.98800659179688,
          "center_y": 204.11715698242188,
          "radius_x": 141.5074462890625,
          "radius_y": 236.66473388671875,
          "rotation": 90.43727111816406,
          "slice_index": 174,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.562056"
        }
      ],
      "brush_strokes": []
    },
    "x_175": {
      "slice_index": 175,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_94eb8b26",
          "center_x": 248.6482391357422,
          "center_y": 203.54515075683594,
          "radius_x": 141.7725830078125,
          "radius_y": 236.4281463623047,
          "rotation": 90.75096130371094,
          "slice_index": 175,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.580764"
        }
      ],
      "brush_strokes": []
    },
    "x_176": {
      "slice_index": 176,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d3293728",
          "center_x": 248.4447479248047,
          "center_y": 203.86843872070312,
          "radius_x": 141.18417358398438,
          "radius_y": 237.29580688476562,
          "rotation": 90.49616241455078,
          "slice_index": 176,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.597386"
        }
      ],
      "brush_strokes": []
    },
    "x_177": {
      "slice_index": 177,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e5798ea5",
          "center_x": 248.80430603027344,
          "center_y": 204.27894592285156,
          "radius_x": 141.2030029296875,
          "radius_y": 237.67984008789062,
          "rotation": 90.69493865966797,
          "slice_index": 177,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.613479"
        }
      ],
      "brush_strokes": []
    },
    "x_178": {
      "slice_index": 178,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f2b1aa7c",
          "center_x": 248.72088623046875,
          "center_y": 204.0630645751953,
          "radius_x": 142.0039520263672,
          "radius_y": 238.3462371826172,
          "rotation": 90.12494659423828,
          "slice_index": 178,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.632062"
        }
      ],
      "brush_strokes": []
    },
    "x_179": {
      "slice_index": 179,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7c6bd89b",
          "center_x": 249.0652313232422,
          "center_y": 204.01345825195312,
          "radius_x": 141.93588256835938,
          "radius_y": 237.82376098632812,
          "rotation": 90.45951080322266,
          "slice_index": 179,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.648715"
        }
      ],
      "brush_strokes": []
    },
    "x_180": {
      "slice_index": 180,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6d3fef76",
          "center_x": 248.9816436767578,
          "center_y": 201.60125732421875,
          "radius_x": 145.24795532226562,
          "radius_y": 235.08689880371094,
          "rotation": 89.82975769042969,
          "slice_index": 180,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.665274"
        }
      ],
      "brush_strokes": []
    },
    "x_181": {
      "slice_index": 181,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_25ef3c24",
          "center_x": 247.69325256347656,
          "center_y": 203.38803100585938,
          "radius_x": 141.9530792236328,
          "radius_y": 236.77764892578125,
          "rotation": 90.50055694580078,
          "slice_index": 181,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.682941"
        }
      ],
      "brush_strokes": []
    },
    "x_182": {
      "slice_index": 182,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c65dab29",
          "center_x": 247.29164123535156,
          "center_y": 203.37893676757812,
          "radius_x": 142.07928466796875,
          "radius_y": 236.9741668701172,
          "rotation": 90.35198974609375,
          "slice_index": 182,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.699882"
        }
      ],
      "brush_strokes": []
    },
    "x_183": {
      "slice_index": 183,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_affe8341",
          "center_x": 247.4603271484375,
          "center_y": 203.25833129882812,
          "radius_x": 141.0188446044922,
          "radius_y": 236.36520385742188,
          "rotation": 90.76898193359375,
          "slice_index": 183,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.717127"
        }
      ],
      "brush_strokes": []
    },
    "x_184": {
      "slice_index": 184,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5b70cf04",
          "center_x": 248.8525390625,
          "center_y": 202.65447998046875,
          "radius_x": 142.20986938476562,
          "radius_y": 236.70330810546875,
          "rotation": 90.79739379882812,
          "slice_index": 184,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.734009"
        }
      ],
      "brush_strokes": []
    },
    "x_185": {
      "slice_index": 185,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dfd1fa5f",
          "center_x": 248.46133422851562,
          "center_y": 202.93150329589844,
          "radius_x": 142.94813537597656,
          "radius_y": 236.71023559570312,
          "rotation": 90.7291259765625,
          "slice_index": 185,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.751900"
        }
      ],
      "brush_strokes": []
    },
    "x_186": {
      "slice_index": 186,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6d9641c8",
          "center_x": 248.85079956054688,
          "center_y": 204.1240997314453,
          "radius_x": 141.90618896484375,
          "radius_y": 236.30722045898438,
          "rotation": 91.20195770263672,
          "slice_index": 186,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.768352"
        }
      ],
      "brush_strokes": []
    },
    "x_187": {
      "slice_index": 187,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_91ab7831",
          "center_x": 248.76052856445312,
          "center_y": 204.8173065185547,
          "radius_x": 141.79490661621094,
          "radius_y": 236.0588836669922,
          "rotation": 91.22866821289062,
          "slice_index": 187,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.785194"
        }
      ],
      "brush_strokes": []
    },
    "x_188": {
      "slice_index": 188,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0b0428e9",
          "center_x": 248.1179962158203,
          "center_y": 204.7920379638672,
          "radius_x": 141.36557006835938,
          "radius_y": 236.1148223876953,
          "rotation": 90.9810562133789,
          "slice_index": 188,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.803002"
        }
      ],
      "brush_strokes": []
    },
    "x_189": {
      "slice_index": 189,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_35ddabe8",
          "center_x": 247.32037353515625,
          "center_y": 204.7544403076172,
          "radius_x": 141.00315856933594,
          "radius_y": 236.38587951660156,
          "rotation": 90.77961730957031,
          "slice_index": 189,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.820810"
        }
      ],
      "brush_strokes": []
    },
    "x_190": {
      "slice_index": 190,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_32a316f4",
          "center_x": 247.66368103027344,
          "center_y": 204.812744140625,
          "radius_x": 141.54457092285156,
          "radius_y": 237.13877868652344,
          "rotation": 90.9049301147461,
          "slice_index": 190,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.838623"
        }
      ],
      "brush_strokes": []
    },
    "x_191": {
      "slice_index": 191,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_39158694",
          "center_x": 247.03717041015625,
          "center_y": 204.8240966796875,
          "radius_x": 141.23326110839844,
          "radius_y": 237.33938598632812,
          "rotation": 90.56768798828125,
          "slice_index": 191,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.855432"
        }
      ],
      "brush_strokes": []
    },
    "x_192": {
      "slice_index": 192,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_fed1b85e",
          "center_x": 248.68417358398438,
          "center_y": 204.6984405517578,
          "radius_x": 141.7369384765625,
          "radius_y": 236.8228302001953,
          "rotation": 90.0199966430664,
          "slice_index": 192,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.873105"
        }
      ],
      "brush_strokes": []
    },
    "x_193": {
      "slice_index": 193,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_77348155",
          "center_x": 248.37547302246094,
          "center_y": 204.3863067626953,
          "radius_x": 141.31246948242188,
          "radius_y": 236.66122436523438,
          "rotation": 90.13787841796875,
          "slice_index": 193,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.888631"
        }
      ],
      "brush_strokes": []
    },
    "x_194": {
      "slice_index": 194,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8ea7d944",
          "center_x": 248.72616577148438,
          "center_y": 204.35101318359375,
          "radius_x": 141.28097534179688,
          "radius_y": 237.126708984375,
          "rotation": 90.00044250488281,
          "slice_index": 194,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.905879"
        }
      ],
      "brush_strokes": []
    },
    "x_195": {
      "slice_index": 195,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_936159db",
          "center_x": 248.05499267578125,
          "center_y": 204.75477600097656,
          "radius_x": 140.4502716064453,
          "radius_y": 236.90147399902344,
          "rotation": 90.58716583251953,
          "slice_index": 195,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.924052"
        }
      ],
      "brush_strokes": []
    },
    "x_196": {
      "slice_index": 196,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4b30b1fb",
          "center_x": 247.6510009765625,
          "center_y": 204.6255340576172,
          "radius_x": 140.7684783935547,
          "radius_y": 236.4931182861328,
          "rotation": 90.81388092041016,
          "slice_index": 196,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.941301"
        }
      ],
      "brush_strokes": []
    },
    "x_197": {
      "slice_index": 197,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5ac27177",
          "center_x": 247.62889099121094,
          "center_y": 204.3157196044922,
          "radius_x": 140.78201293945312,
          "radius_y": 236.5948028564453,
          "rotation": 90.76306915283203,
          "slice_index": 197,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.959087"
        }
      ],
      "brush_strokes": []
    },
    "x_198": {
      "slice_index": 198,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_01621212",
          "center_x": 248.1051788330078,
          "center_y": 204.62098693847656,
          "radius_x": 141.86257934570312,
          "radius_y": 236.71487426757812,
          "rotation": 91.13209533691406,
          "slice_index": 198,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.975125"
        }
      ],
      "brush_strokes": []
    },
    "x_199": {
      "slice_index": 199,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a7f09218",
          "center_x": 247.33116149902344,
          "center_y": 203.66323852539062,
          "radius_x": 142.4306640625,
          "radius_y": 235.85125732421875,
          "rotation": 91.3233413696289,
          "slice_index": 199,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:51.993234"
        }
      ],
      "brush_strokes": []
    },
    "x_200": {
      "slice_index": 200,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_32b2a01a",
          "center_x": 246.9001007080078,
          "center_y": 203.86390686035156,
          "radius_x": 142.75067138671875,
          "radius_y": 236.1599578857422,
          "rotation": 91.31840515136719,
          "slice_index": 200,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.011346"
        }
      ],
      "brush_strokes": []
    },
    "x_201": {
      "slice_index": 201,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9d173d0d",
          "center_x": 245.639892578125,
          "center_y": 203.16183471679688,
          "radius_x": 140.78208923339844,
          "radius_y": 236.88909912109375,
          "rotation": 91.33555603027344,
          "slice_index": 201,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.028603"
        }
      ],
      "brush_strokes": []
    },
    "x_202": {
      "slice_index": 202,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ba1348bd",
          "center_x": 247.1118927001953,
          "center_y": 202.87139892578125,
          "radius_x": 141.95298767089844,
          "radius_y": 236.4517822265625,
          "rotation": 91.32278442382812,
          "slice_index": 202,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.046155"
        }
      ],
      "brush_strokes": []
    },
    "x_203": {
      "slice_index": 203,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b41d3469",
          "center_x": 247.02699279785156,
          "center_y": 202.39952087402344,
          "radius_x": 141.44493103027344,
          "radius_y": 236.48707580566406,
          "rotation": 91.24937438964844,
          "slice_index": 203,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.064024"
        }
      ],
      "brush_strokes": []
    },
    "x_204": {
      "slice_index": 204,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_95fd4095",
          "center_x": 247.25416564941406,
          "center_y": 202.83287048339844,
          "radius_x": 142.0106201171875,
          "radius_y": 236.3646697998047,
          "rotation": 90.79772186279297,
          "slice_index": 204,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.081699"
        }
      ],
      "brush_strokes": []
    },
    "x_205": {
      "slice_index": 205,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_640f0fd9",
          "center_x": 248.05137634277344,
          "center_y": 203.4431610107422,
          "radius_x": 141.99078369140625,
          "radius_y": 236.69503784179688,
          "rotation": 90.954345703125,
          "slice_index": 205,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.099854"
        }
      ],
      "brush_strokes": []
    },
    "x_206": {
      "slice_index": 206,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5cb68c61",
          "center_x": 248.02947998046875,
          "center_y": 203.31564331054688,
          "radius_x": 141.63446044921875,
          "radius_y": 236.92996215820312,
          "rotation": 90.98556518554688,
          "slice_index": 206,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.117574"
        }
      ],
      "brush_strokes": []
    },
    "x_207": {
      "slice_index": 207,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ab36aa9d",
          "center_x": 247.14256286621094,
          "center_y": 203.71937561035156,
          "radius_x": 142.39547729492188,
          "radius_y": 236.82887268066406,
          "rotation": 91.17582702636719,
          "slice_index": 207,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.133446"
        }
      ],
      "brush_strokes": []
    },
    "x_208": {
      "slice_index": 208,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_824db6f6",
          "center_x": 246.97682189941406,
          "center_y": 204.02630615234375,
          "radius_x": 142.35240173339844,
          "radius_y": 237.04254150390625,
          "rotation": 91.38341522216797,
          "slice_index": 208,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.150698"
        }
      ],
      "brush_strokes": []
    },
    "x_209": {
      "slice_index": 209,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9665b036",
          "center_x": 246.14918518066406,
          "center_y": 203.41368103027344,
          "radius_x": 141.0891571044922,
          "radius_y": 236.94882202148438,
          "rotation": 91.19574737548828,
          "slice_index": 209,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.168219"
        }
      ],
      "brush_strokes": []
    },
    "x_210": {
      "slice_index": 210,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4eb35d14",
          "center_x": 246.1350860595703,
          "center_y": 203.8148193359375,
          "radius_x": 141.95970153808594,
          "radius_y": 236.01356506347656,
          "rotation": 91.25471496582031,
          "slice_index": 210,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.186266"
        }
      ],
      "brush_strokes": []
    },
    "x_211": {
      "slice_index": 211,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_532f3cae",
          "center_x": 246.19668579101562,
          "center_y": 203.66720581054688,
          "radius_x": 141.90745544433594,
          "radius_y": 236.13287353515625,
          "rotation": 91.29206085205078,
          "slice_index": 211,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.202605"
        }
      ],
      "brush_strokes": []
    },
    "x_212": {
      "slice_index": 212,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2f2e6132",
          "center_x": 246.5342254638672,
          "center_y": 202.94827270507812,
          "radius_x": 143.9457550048828,
          "radius_y": 235.28807067871094,
          "rotation": 91.6001205444336,
          "slice_index": 212,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.219870"
        }
      ],
      "brush_strokes": []
    },
    "x_213": {
      "slice_index": 213,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ba7ed8c4",
          "center_x": 247.1521759033203,
          "center_y": 202.76365661621094,
          "radius_x": 142.36172485351562,
          "radius_y": 236.28228759765625,
          "rotation": 90.48184967041016,
          "slice_index": 213,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.237482"
        }
      ],
      "brush_strokes": []
    },
    "x_214": {
      "slice_index": 214,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d1670389",
          "center_x": 247.4884796142578,
          "center_y": 202.96055603027344,
          "radius_x": 142.42654418945312,
          "radius_y": 236.2200164794922,
          "rotation": 90.47087097167969,
          "slice_index": 214,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.253516"
        }
      ],
      "brush_strokes": []
    },
    "x_215": {
      "slice_index": 215,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_18ff9ec5",
          "center_x": 247.64491271972656,
          "center_y": 203.6139678955078,
          "radius_x": 140.6241455078125,
          "radius_y": 236.82223510742188,
          "rotation": 90.82755279541016,
          "slice_index": 215,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.272068"
        }
      ],
      "brush_strokes": []
    },
    "x_216": {
      "slice_index": 216,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_17e94f74",
          "center_x": 247.113525390625,
          "center_y": 203.50897216796875,
          "radius_x": 141.646240234375,
          "radius_y": 236.70401000976562,
          "rotation": 91.13719177246094,
          "slice_index": 216,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.290021"
        }
      ],
      "brush_strokes": []
    },
    "x_217": {
      "slice_index": 217,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_36319ae3",
          "center_x": 247.00901794433594,
          "center_y": 203.1278533935547,
          "radius_x": 142.1747283935547,
          "radius_y": 236.40432739257812,
          "rotation": 91.2008285522461,
          "slice_index": 217,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.307246"
        }
      ],
      "brush_strokes": []
    },
    "x_218": {
      "slice_index": 218,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d5590fca",
          "center_x": 247.68997192382812,
          "center_y": 202.97132873535156,
          "radius_x": 141.94302368164062,
          "radius_y": 236.84568786621094,
          "rotation": 90.58634185791016,
          "slice_index": 218,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.323887"
        }
      ],
      "brush_strokes": []
    },
    "x_219": {
      "slice_index": 219,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9f26c65a",
          "center_x": 247.30238342285156,
          "center_y": 201.34458923339844,
          "radius_x": 142.57655334472656,
          "radius_y": 235.03114318847656,
          "rotation": 90.34630584716797,
          "slice_index": 219,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.340992"
        }
      ],
      "brush_strokes": []
    },
    "x_220": {
      "slice_index": 220,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_189d5283",
          "center_x": 247.7818603515625,
          "center_y": 201.7671661376953,
          "radius_x": 142.896728515625,
          "radius_y": 235.722412109375,
          "rotation": 90.69567108154297,
          "slice_index": 220,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.358385"
        }
      ],
      "brush_strokes": []
    },
    "x_221": {
      "slice_index": 221,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1f04b658",
          "center_x": 248.575439453125,
          "center_y": 201.0438690185547,
          "radius_x": 142.72940063476562,
          "radius_y": 235.70736694335938,
          "rotation": 91.01480102539062,
          "slice_index": 221,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.375936"
        }
      ],
      "brush_strokes": []
    },
    "x_222": {
      "slice_index": 222,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_61964932",
          "center_x": 246.83108520507812,
          "center_y": 202.4498291015625,
          "radius_x": 142.57667541503906,
          "radius_y": 236.19259643554688,
          "rotation": 90.77490234375,
          "slice_index": 222,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.392615"
        }
      ],
      "brush_strokes": []
    },
    "x_223": {
      "slice_index": 223,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cc96869a",
          "center_x": 247.14108276367188,
          "center_y": 201.9761962890625,
          "radius_x": 142.9482879638672,
          "radius_y": 236.05389404296875,
          "rotation": 90.78316497802734,
          "slice_index": 223,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.411687"
        }
      ],
      "brush_strokes": []
    },
    "x_224": {
      "slice_index": 224,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a36cdb9c",
          "center_x": 247.84803771972656,
          "center_y": 202.61756896972656,
          "radius_x": 143.83651733398438,
          "radius_y": 236.50074768066406,
          "rotation": 90.24987030029297,
          "slice_index": 224,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.428731"
        }
      ],
      "brush_strokes": []
    },
    "x_225": {
      "slice_index": 225,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e0711b6b",
          "center_x": 247.37576293945312,
          "center_y": 202.301025390625,
          "radius_x": 142.57681274414062,
          "radius_y": 236.6511688232422,
          "rotation": 90.57178497314453,
          "slice_index": 225,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.447020"
        }
      ],
      "brush_strokes": []
    },
    "x_226": {
      "slice_index": 226,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1c748609",
          "center_x": 248.41436767578125,
          "center_y": 202.61875915527344,
          "radius_x": 142.3041229248047,
          "radius_y": 237.38523864746094,
          "rotation": 90.85835266113281,
          "slice_index": 226,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.464149"
        }
      ],
      "brush_strokes": []
    },
    "x_227": {
      "slice_index": 227,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b94d0835",
          "center_x": 247.8939666748047,
          "center_y": 202.63851928710938,
          "radius_x": 142.2057647705078,
          "radius_y": 235.5745849609375,
          "rotation": 91.08712005615234,
          "slice_index": 227,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.482403"
        }
      ],
      "brush_strokes": []
    },
    "x_228": {
      "slice_index": 228,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9d1c750c",
          "center_x": 247.7440948486328,
          "center_y": 202.60826110839844,
          "radius_x": 143.58676147460938,
          "radius_y": 235.60592651367188,
          "rotation": 90.92137145996094,
          "slice_index": 228,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.498456"
        }
      ],
      "brush_strokes": []
    },
    "x_229": {
      "slice_index": 229,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4208a0eb",
          "center_x": 248.14393615722656,
          "center_y": 202.6043701171875,
          "radius_x": 143.47885131835938,
          "radius_y": 235.90640258789062,
          "rotation": 91.04529571533203,
          "slice_index": 229,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.518432"
        }
      ],
      "brush_strokes": []
    },
    "x_230": {
      "slice_index": 230,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_36a78d50",
          "center_x": 248.2456512451172,
          "center_y": 202.45816040039062,
          "radius_x": 143.00604248046875,
          "radius_y": 236.2699432373047,
          "rotation": 90.89151000976562,
          "slice_index": 230,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.536260"
        }
      ],
      "brush_strokes": []
    },
    "x_231": {
      "slice_index": 231,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bef66c99",
          "center_x": 247.77130126953125,
          "center_y": 202.0831756591797,
          "radius_x": 143.10499572753906,
          "radius_y": 235.4852294921875,
          "rotation": 90.99679565429688,
          "slice_index": 231,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.553192"
        }
      ],
      "brush_strokes": []
    },
    "x_232": {
      "slice_index": 232,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_fccc69d0",
          "center_x": 248.26632690429688,
          "center_y": 201.66819763183594,
          "radius_x": 143.1831512451172,
          "radius_y": 235.66537475585938,
          "rotation": 91.0875473022461,
          "slice_index": 232,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.571242"
        }
      ],
      "brush_strokes": []
    },
    "x_233": {
      "slice_index": 233,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7c72a67a",
          "center_x": 247.95166015625,
          "center_y": 201.7622833251953,
          "radius_x": 142.7010040283203,
          "radius_y": 235.45358276367188,
          "rotation": 91.14492797851562,
          "slice_index": 233,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.589190"
        }
      ],
      "brush_strokes": []
    },
    "x_234": {
      "slice_index": 234,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8fb4c3fb",
          "center_x": 247.67100524902344,
          "center_y": 201.99168395996094,
          "radius_x": 141.74972534179688,
          "radius_y": 235.57679748535156,
          "rotation": 90.62456512451172,
          "slice_index": 234,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.606250"
        }
      ],
      "brush_strokes": []
    },
    "x_235": {
      "slice_index": 235,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7339a267",
          "center_x": 248.0714111328125,
          "center_y": 202.0682373046875,
          "radius_x": 142.8850555419922,
          "radius_y": 235.25379943847656,
          "rotation": 90.73967742919922,
          "slice_index": 235,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.624944"
        }
      ],
      "brush_strokes": []
    },
    "x_236": {
      "slice_index": 236,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a19eb3d2",
          "center_x": 248.59701538085938,
          "center_y": 201.60464477539062,
          "radius_x": 142.61410522460938,
          "radius_y": 235.76487731933594,
          "rotation": 90.81023406982422,
          "slice_index": 236,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.643542"
        }
      ],
      "brush_strokes": []
    },
    "x_237": {
      "slice_index": 237,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dca53548",
          "center_x": 247.751708984375,
          "center_y": 201.6278076171875,
          "radius_x": 142.52061462402344,
          "radius_y": 235.57522583007812,
          "rotation": 90.5196304321289,
          "slice_index": 237,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.660613"
        }
      ],
      "brush_strokes": []
    },
    "x_238": {
      "slice_index": 238,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_96d561f4",
          "center_x": 247.91209411621094,
          "center_y": 202.58763122558594,
          "radius_x": 143.79681396484375,
          "radius_y": 234.58370971679688,
          "rotation": 90.66145324707031,
          "slice_index": 238,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.678445"
        }
      ],
      "brush_strokes": []
    },
    "x_239": {
      "slice_index": 239,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1abe1ee5",
          "center_x": 248.31875610351562,
          "center_y": 202.8567352294922,
          "radius_x": 143.48338317871094,
          "radius_y": 235.14012145996094,
          "rotation": 91.33854675292969,
          "slice_index": 239,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.697014"
        }
      ],
      "brush_strokes": []
    },
    "x_240": {
      "slice_index": 240,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8ace933a",
          "center_x": 247.68701171875,
          "center_y": 202.75433349609375,
          "radius_x": 143.3523406982422,
          "radius_y": 235.52195739746094,
          "rotation": 91.19293212890625,
          "slice_index": 240,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.713881"
        }
      ],
      "brush_strokes": []
    },
    "x_241": {
      "slice_index": 241,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f0104ac9",
          "center_x": 246.4890899658203,
          "center_y": 203.98609924316406,
          "radius_x": 142.30752563476562,
          "radius_y": 236.004150390625,
          "rotation": 91.37828826904297,
          "slice_index": 241,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.731198"
        }
      ],
      "brush_strokes": []
    },
    "x_242": {
      "slice_index": 242,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_40421ceb",
          "center_x": 246.87718200683594,
          "center_y": 203.28086853027344,
          "radius_x": 142.64096069335938,
          "radius_y": 235.7587890625,
          "rotation": 91.67747497558594,
          "slice_index": 242,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.748733"
        }
      ],
      "brush_strokes": []
    },
    "x_243": {
      "slice_index": 243,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ff835319",
          "center_x": 246.37124633789062,
          "center_y": 203.63525390625,
          "radius_x": 142.88140869140625,
          "radius_y": 235.86399841308594,
          "rotation": 91.74243927001953,
          "slice_index": 243,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.766250"
        }
      ],
      "brush_strokes": []
    },
    "x_244": {
      "slice_index": 244,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f4b1f95d",
          "center_x": 245.3768768310547,
          "center_y": 202.2027587890625,
          "radius_x": 144.32583618164062,
          "radius_y": 236.03346252441406,
          "rotation": 92.37203216552734,
          "slice_index": 244,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.783578"
        }
      ],
      "brush_strokes": []
    },
    "x_245": {
      "slice_index": 245,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5fc5e649",
          "center_x": 245.40960693359375,
          "center_y": 200.95089721679688,
          "radius_x": 144.36448669433594,
          "radius_y": 236.39500427246094,
          "rotation": 92.94947052001953,
          "slice_index": 245,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.800288"
        }
      ],
      "brush_strokes": []
    },
    "x_246": {
      "slice_index": 246,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5c17054f",
          "center_x": 245.1123809814453,
          "center_y": 201.11907958984375,
          "radius_x": 144.2178955078125,
          "radius_y": 236.12913513183594,
          "rotation": 92.82110595703125,
          "slice_index": 246,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.817828"
        }
      ],
      "brush_strokes": []
    },
    "x_247": {
      "slice_index": 247,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_55993b00",
          "center_x": 246.6385955810547,
          "center_y": 201.1526641845703,
          "radius_x": 144.45632934570312,
          "radius_y": 237.40248107910156,
          "rotation": 92.4053955078125,
          "slice_index": 247,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.835374"
        }
      ],
      "brush_strokes": []
    },
    "x_248": {
      "slice_index": 248,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1026a544",
          "center_x": 246.516845703125,
          "center_y": 200.9359893798828,
          "radius_x": 144.22442626953125,
          "radius_y": 237.53611755371094,
          "rotation": 92.76123046875,
          "slice_index": 248,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.852818"
        }
      ],
      "brush_strokes": []
    },
    "x_249": {
      "slice_index": 249,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ce9954f0",
          "center_x": 245.94744873046875,
          "center_y": 200.88587951660156,
          "radius_x": 144.7848358154297,
          "radius_y": 237.5972442626953,
          "rotation": 92.62213897705078,
          "slice_index": 249,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.869904"
        }
      ],
      "brush_strokes": []
    },
    "x_250": {
      "slice_index": 250,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9cf75526",
          "center_x": 245.8136444091797,
          "center_y": 203.22991943359375,
          "radius_x": 143.66456604003906,
          "radius_y": 237.4502716064453,
          "rotation": 92.51319122314453,
          "slice_index": 250,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.889972"
        }
      ],
      "brush_strokes": []
    },
    "x_251": {
      "slice_index": 251,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_62a12af7",
          "center_x": 246.5304412841797,
          "center_y": 203.856201171875,
          "radius_x": 142.01722717285156,
          "radius_y": 237.2158660888672,
          "rotation": 91.7076187133789,
          "slice_index": 251,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.907154"
        }
      ],
      "brush_strokes": []
    },
    "x_252": {
      "slice_index": 252,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_14c3f913",
          "center_x": 245.90594482421875,
          "center_y": 204.046142578125,
          "radius_x": 142.6097869873047,
          "radius_y": 237.2864990234375,
          "rotation": 91.41068267822266,
          "slice_index": 252,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.925992"
        }
      ],
      "brush_strokes": []
    },
    "x_253": {
      "slice_index": 253,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_48531088",
          "center_x": 246.5532684326172,
          "center_y": 203.832275390625,
          "radius_x": 142.56137084960938,
          "radius_y": 237.85475158691406,
          "rotation": 91.37230682373047,
          "slice_index": 253,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.944164"
        }
      ],
      "brush_strokes": []
    },
    "x_254": {
      "slice_index": 254,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2e785732",
          "center_x": 246.55332946777344,
          "center_y": 203.09548950195312,
          "radius_x": 142.14222717285156,
          "radius_y": 237.26145935058594,
          "rotation": 91.15238189697266,
          "slice_index": 254,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.960795"
        }
      ],
      "brush_strokes": []
    },
    "x_255": {
      "slice_index": 255,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9c20d7f3",
          "center_x": 246.7493133544922,
          "center_y": 202.7776641845703,
          "radius_x": 142.11224365234375,
          "radius_y": 236.90428161621094,
          "rotation": 91.2185287475586,
          "slice_index": 255,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.977858"
        }
      ],
      "brush_strokes": []
    },
    "x_256": {
      "slice_index": 256,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_95117c7e",
          "center_x": 247.2290802001953,
          "center_y": 203.27786254882812,
          "radius_x": 142.09671020507812,
          "radius_y": 237.2769775390625,
          "rotation": 90.57762908935547,
          "slice_index": 256,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:52.995969"
        }
      ],
      "brush_strokes": []
    },
    "x_257": {
      "slice_index": 257,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dd9494fc",
          "center_x": 247.55569458007812,
          "center_y": 203.33460998535156,
          "radius_x": 141.2216796875,
          "radius_y": 237.4943084716797,
          "rotation": 91.00882720947266,
          "slice_index": 257,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.014045"
        }
      ],
      "brush_strokes": []
    },
    "x_258": {
      "slice_index": 258,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_35f2e594",
          "center_x": 246.66258239746094,
          "center_y": 202.82244873046875,
          "radius_x": 141.11424255371094,
          "radius_y": 236.8966064453125,
          "rotation": 90.7052001953125,
          "slice_index": 258,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.031015"
        }
      ],
      "brush_strokes": []
    },
    "x_259": {
      "slice_index": 259,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_39a933df",
          "center_x": 248.07516479492188,
          "center_y": 203.006591796875,
          "radius_x": 142.6582489013672,
          "radius_y": 236.7891387939453,
          "rotation": 91.13862609863281,
          "slice_index": 259,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.049361"
        }
      ],
      "brush_strokes": []
    },
    "x_260": {
      "slice_index": 260,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c90a6b94",
          "center_x": 247.03118896484375,
          "center_y": 203.76422119140625,
          "radius_x": 142.54200744628906,
          "radius_y": 236.48130798339844,
          "rotation": 91.17635345458984,
          "slice_index": 260,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.066993"
        }
      ],
      "brush_strokes": []
    },
    "x_261": {
      "slice_index": 261,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f8fe4393",
          "center_x": 247.41439819335938,
          "center_y": 203.6212615966797,
          "radius_x": 142.29312133789062,
          "radius_y": 236.4602813720703,
          "rotation": 91.58084869384766,
          "slice_index": 261,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.084035"
        }
      ],
      "brush_strokes": []
    },
    "x_262": {
      "slice_index": 262,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c5246ba3",
          "center_x": 246.48345947265625,
          "center_y": 203.8230743408203,
          "radius_x": 141.8302459716797,
          "radius_y": 236.3331298828125,
          "rotation": 90.88343811035156,
          "slice_index": 262,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.101115"
        }
      ],
      "brush_strokes": []
    },
    "x_263": {
      "slice_index": 263,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_61077a7d",
          "center_x": 247.621826171875,
          "center_y": 202.74057006835938,
          "radius_x": 142.35763549804688,
          "radius_y": 236.26171875,
          "rotation": 91.1910629272461,
          "slice_index": 263,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.118887"
        }
      ],
      "brush_strokes": []
    },
    "x_264": {
      "slice_index": 264,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bb8b85ff",
          "center_x": 247.71241760253906,
          "center_y": 203.09390258789062,
          "radius_x": 142.1420135498047,
          "radius_y": 236.09515380859375,
          "rotation": 91.27709197998047,
          "slice_index": 264,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.136571"
        }
      ],
      "brush_strokes": []
    },
    "x_265": {
      "slice_index": 265,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4831f344",
          "center_x": 248.10995483398438,
          "center_y": 202.8869171142578,
          "radius_x": 142.71072387695312,
          "radius_y": 236.05177307128906,
          "rotation": 91.11119079589844,
          "slice_index": 265,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.153898"
        }
      ],
      "brush_strokes": []
    },
    "x_266": {
      "slice_index": 266,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_021f567c",
          "center_x": 248.15252685546875,
          "center_y": 203.06570434570312,
          "radius_x": 142.4664306640625,
          "radius_y": 236.48939514160156,
          "rotation": 91.31956481933594,
          "slice_index": 266,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.170086"
        }
      ],
      "brush_strokes": []
    },
    "x_267": {
      "slice_index": 267,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a17161c8",
          "center_x": 247.43899536132812,
          "center_y": 203.38525390625,
          "radius_x": 143.5388946533203,
          "radius_y": 235.89828491210938,
          "rotation": 90.95719146728516,
          "slice_index": 267,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.189223"
        }
      ],
      "brush_strokes": []
    },
    "x_268": {
      "slice_index": 268,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5867a55c",
          "center_x": 246.56390380859375,
          "center_y": 202.77029418945312,
          "radius_x": 141.98532104492188,
          "radius_y": 235.94020080566406,
          "rotation": 91.30294036865234,
          "slice_index": 268,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.206087"
        }
      ],
      "brush_strokes": []
    },
    "x_269": {
      "slice_index": 269,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f8638758",
          "center_x": 246.37625122070312,
          "center_y": 202.9994659423828,
          "radius_x": 141.38941955566406,
          "radius_y": 236.12550354003906,
          "rotation": 91.15250396728516,
          "slice_index": 269,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.223897"
        }
      ],
      "brush_strokes": []
    },
    "x_270": {
      "slice_index": 270,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1f77efd7",
          "center_x": 244.6041717529297,
          "center_y": 201.6584014892578,
          "radius_x": 143.09182739257812,
          "radius_y": 235.9720001220703,
          "rotation": 91.59373474121094,
          "slice_index": 270,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.242306"
        }
      ],
      "brush_strokes": []
    },
    "x_271": {
      "slice_index": 271,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c17e7a07",
          "center_x": 245.2169189453125,
          "center_y": 202.04714965820312,
          "radius_x": 142.06390380859375,
          "radius_y": 235.8391571044922,
          "rotation": 90.9594497680664,
          "slice_index": 271,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.260108"
        }
      ],
      "brush_strokes": []
    },
    "x_272": {
      "slice_index": 272,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8cf151f6",
          "center_x": 245.52386474609375,
          "center_y": 202.66346740722656,
          "radius_x": 142.73277282714844,
          "radius_y": 236.29598999023438,
          "rotation": 91.21600341796875,
          "slice_index": 272,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.277149"
        }
      ],
      "brush_strokes": []
    },
    "x_273": {
      "slice_index": 273,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_30578b46",
          "center_x": 246.21218872070312,
          "center_y": 201.78382873535156,
          "radius_x": 143.44000244140625,
          "radius_y": 236.03334045410156,
          "rotation": 90.98583221435547,
          "slice_index": 273,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.294251"
        }
      ],
      "brush_strokes": []
    },
    "x_274": {
      "slice_index": 274,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ab8bcdb0",
          "center_x": 246.9743194580078,
          "center_y": 202.3026885986328,
          "radius_x": 143.56820678710938,
          "radius_y": 236.84214782714844,
          "rotation": 91.56066131591797,
          "slice_index": 274,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.311795"
        }
      ],
      "brush_strokes": []
    },
    "x_275": {
      "slice_index": 275,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5735c12a",
          "center_x": 246.72320556640625,
          "center_y": 202.25228881835938,
          "radius_x": 143.9394989013672,
          "radius_y": 236.9086151123047,
          "rotation": 91.58770751953125,
          "slice_index": 275,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.329891"
        }
      ],
      "brush_strokes": []
    },
    "x_276": {
      "slice_index": 276,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_214ca2e1",
          "center_x": 247.4843292236328,
          "center_y": 201.08396911621094,
          "radius_x": 143.5325469970703,
          "radius_y": 235.62872314453125,
          "rotation": 91.86756896972656,
          "slice_index": 276,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.347950"
        }
      ],
      "brush_strokes": []
    },
    "x_277": {
      "slice_index": 277,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ad3e1d00",
          "center_x": 247.28167724609375,
          "center_y": 202.42227172851562,
          "radius_x": 142.85964965820312,
          "radius_y": 237.0048370361328,
          "rotation": 91.41178131103516,
          "slice_index": 277,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.364900"
        }
      ],
      "brush_strokes": []
    },
    "x_278": {
      "slice_index": 278,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0cfcee1c",
          "center_x": 246.82464599609375,
          "center_y": 202.46409606933594,
          "radius_x": 142.91909790039062,
          "radius_y": 236.89207458496094,
          "rotation": 91.24131774902344,
          "slice_index": 278,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.382232"
        }
      ],
      "brush_strokes": []
    },
    "x_279": {
      "slice_index": 279,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_784fe50d",
          "center_x": 247.5928955078125,
          "center_y": 202.7165069580078,
          "radius_x": 142.68182373046875,
          "radius_y": 236.02821350097656,
          "rotation": 91.1386947631836,
          "slice_index": 279,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.400182"
        }
      ],
      "brush_strokes": []
    },
    "x_280": {
      "slice_index": 280,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_31051334",
          "center_x": 247.0236053466797,
          "center_y": 202.8192596435547,
          "radius_x": 143.3216552734375,
          "radius_y": 235.92221069335938,
          "rotation": 91.6969223022461,
          "slice_index": 280,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.417730"
        }
      ],
      "brush_strokes": []
    },
    "x_281": {
      "slice_index": 281,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5e4a423e",
          "center_x": 247.58082580566406,
          "center_y": 202.08746337890625,
          "radius_x": 142.88536071777344,
          "radius_y": 235.50607299804688,
          "rotation": 91.8746566772461,
          "slice_index": 281,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.435263"
        }
      ],
      "brush_strokes": []
    },
    "x_282": {
      "slice_index": 282,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cff864bf",
          "center_x": 247.10572814941406,
          "center_y": 202.9712677001953,
          "radius_x": 143.51303100585938,
          "radius_y": 236.2328643798828,
          "rotation": 91.55034637451172,
          "slice_index": 282,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.452987"
        }
      ],
      "brush_strokes": []
    },
    "x_283": {
      "slice_index": 283,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b044435b",
          "center_x": 248.67494201660156,
          "center_y": 202.92181396484375,
          "radius_x": 142.9944305419922,
          "radius_y": 235.95654296875,
          "rotation": 91.49864196777344,
          "slice_index": 283,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.472032"
        }
      ],
      "brush_strokes": []
    },
    "x_284": {
      "slice_index": 284,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dac9f00f",
          "center_x": 248.07968139648438,
          "center_y": 202.7279815673828,
          "radius_x": 142.79055786132812,
          "radius_y": 235.8235626220703,
          "rotation": 91.32667541503906,
          "slice_index": 284,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.488610"
        }
      ],
      "brush_strokes": []
    },
    "x_285": {
      "slice_index": 285,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a0b5d9b9",
          "center_x": 247.9876708984375,
          "center_y": 203.8976287841797,
          "radius_x": 142.57977294921875,
          "radius_y": 236.4171142578125,
          "rotation": 91.12527465820312,
          "slice_index": 285,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.507188"
        }
      ],
      "brush_strokes": []
    },
    "x_286": {
      "slice_index": 286,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_52c066b2",
          "center_x": 247.01776123046875,
          "center_y": 203.47572326660156,
          "radius_x": 142.77999877929688,
          "radius_y": 236.552490234375,
          "rotation": 91.06732940673828,
          "slice_index": 286,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.524261"
        }
      ],
      "brush_strokes": []
    },
    "x_287": {
      "slice_index": 287,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_afdc82f5",
          "center_x": 246.9447479248047,
          "center_y": 203.212646484375,
          "radius_x": 143.05174255371094,
          "radius_y": 236.12364196777344,
          "rotation": 91.07840728759766,
          "slice_index": 287,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.542397"
        }
      ],
      "brush_strokes": []
    },
    "x_288": {
      "slice_index": 288,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5118d165",
          "center_x": 247.42140197753906,
          "center_y": 202.6949462890625,
          "radius_x": 143.3241729736328,
          "radius_y": 236.34925842285156,
          "rotation": 90.83401489257812,
          "slice_index": 288,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.560222"
        }
      ],
      "brush_strokes": []
    },
    "x_289": {
      "slice_index": 289,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4906f351",
          "center_x": 246.63648986816406,
          "center_y": 203.17201232910156,
          "radius_x": 142.69967651367188,
          "radius_y": 236.24966430664062,
          "rotation": 91.259765625,
          "slice_index": 289,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.577554"
        }
      ],
      "brush_strokes": []
    },
    "x_290": {
      "slice_index": 290,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f8d1d065",
          "center_x": 246.7190399169922,
          "center_y": 202.92193603515625,
          "radius_x": 142.72158813476562,
          "radius_y": 236.53921508789062,
          "rotation": 91.2463150024414,
          "slice_index": 290,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.595156"
        }
      ],
      "brush_strokes": []
    },
    "x_291": {
      "slice_index": 291,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_db59c819",
          "center_x": 247.69268798828125,
          "center_y": 203.38687133789062,
          "radius_x": 142.35386657714844,
          "radius_y": 236.2869110107422,
          "rotation": 91.17328643798828,
          "slice_index": 291,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.612811"
        }
      ],
      "brush_strokes": []
    },
    "x_292": {
      "slice_index": 292,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bfb4e1e4",
          "center_x": 247.2500762939453,
          "center_y": 202.56919860839844,
          "radius_x": 142.27920532226562,
          "radius_y": 236.96267700195312,
          "rotation": 90.40411376953125,
          "slice_index": 292,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.629973"
        }
      ],
      "brush_strokes": []
    },
    "x_293": {
      "slice_index": 293,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_66153f81",
          "center_x": 247.81039428710938,
          "center_y": 202.52203369140625,
          "radius_x": 142.07508850097656,
          "radius_y": 236.86508178710938,
          "rotation": 90.3655014038086,
          "slice_index": 293,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.647593"
        }
      ],
      "brush_strokes": []
    },
    "x_294": {
      "slice_index": 294,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dd195f96",
          "center_x": 247.57620239257812,
          "center_y": 203.15724182128906,
          "radius_x": 142.08956909179688,
          "radius_y": 237.18946838378906,
          "rotation": 90.820556640625,
          "slice_index": 294,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.666233"
        }
      ],
      "brush_strokes": []
    },
    "x_295": {
      "slice_index": 295,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ed586dd1",
          "center_x": 247.51895141601562,
          "center_y": 203.0174102783203,
          "radius_x": 141.74966430664062,
          "radius_y": 237.09364318847656,
          "rotation": 90.70124053955078,
          "slice_index": 295,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.683760"
        }
      ],
      "brush_strokes": []
    },
    "x_296": {
      "slice_index": 296,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_860c9878",
          "center_x": 247.476806640625,
          "center_y": 201.40480041503906,
          "radius_x": 143.05923461914062,
          "radius_y": 236.3679962158203,
          "rotation": 91.39503479003906,
          "slice_index": 296,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.700640"
        }
      ],
      "brush_strokes": []
    },
    "x_297": {
      "slice_index": 297,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_18e7e1e7",
          "center_x": 248.23561096191406,
          "center_y": 202.60955810546875,
          "radius_x": 143.6764678955078,
          "radius_y": 236.20767211914062,
          "rotation": 91.02253723144531,
          "slice_index": 297,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.718253"
        }
      ],
      "brush_strokes": []
    },
    "x_298": {
      "slice_index": 298,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_991e8ba4",
          "center_x": 248.46617126464844,
          "center_y": 201.7966766357422,
          "radius_x": 143.6625518798828,
          "radius_y": 235.83876037597656,
          "rotation": 91.17548370361328,
          "slice_index": 298,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.735997"
        }
      ],
      "brush_strokes": []
    },
    "x_299": {
      "slice_index": 299,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_39ae1cd6",
          "center_x": 248.41903686523438,
          "center_y": 201.97528076171875,
          "radius_x": 143.92465209960938,
          "radius_y": 235.62948608398438,
          "rotation": 91.07759857177734,
          "slice_index": 299,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.754866"
        }
      ],
      "brush_strokes": []
    },
    "x_300": {
      "slice_index": 300,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_efdb9e30",
          "center_x": 247.48251342773438,
          "center_y": 200.35377502441406,
          "radius_x": 144.60675048828125,
          "radius_y": 234.81639099121094,
          "rotation": 90.99156188964844,
          "slice_index": 300,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.773344"
        }
      ],
      "brush_strokes": []
    },
    "x_301": {
      "slice_index": 301,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ac1156e9",
          "center_x": 247.7646484375,
          "center_y": 199.55545043945312,
          "radius_x": 144.00514221191406,
          "radius_y": 234.5320281982422,
          "rotation": 91.16964721679688,
          "slice_index": 301,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.790666"
        }
      ],
      "brush_strokes": []
    },
    "x_302": {
      "slice_index": 302,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6db5d5e5",
          "center_x": 247.04042053222656,
          "center_y": 201.16851806640625,
          "radius_x": 144.70541381835938,
          "radius_y": 236.04248046875,
          "rotation": 91.47077178955078,
          "slice_index": 302,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.808360"
        }
      ],
      "brush_strokes": []
    },
    "x_303": {
      "slice_index": 303,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_432ecb69",
          "center_x": 246.06011962890625,
          "center_y": 199.24392700195312,
          "radius_x": 145.7807159423828,
          "radius_y": 235.3489532470703,
          "rotation": 92.43607330322266,
          "slice_index": 303,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.826055"
        }
      ],
      "brush_strokes": []
    },
    "x_304": {
      "slice_index": 304,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d3f81384",
          "center_x": 245.8447723388672,
          "center_y": 199.6636505126953,
          "radius_x": 145.56304931640625,
          "radius_y": 235.53390502929688,
          "rotation": 92.25502014160156,
          "slice_index": 304,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.843825"
        }
      ],
      "brush_strokes": []
    },
    "x_305": {
      "slice_index": 305,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6f12591e",
          "center_x": 245.17193603515625,
          "center_y": 199.96754455566406,
          "radius_x": 144.71656799316406,
          "radius_y": 236.44125366210938,
          "rotation": 92.22624969482422,
          "slice_index": 305,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.862115"
        }
      ],
      "brush_strokes": []
    },
    "x_306": {
      "slice_index": 306,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6f408999",
          "center_x": 244.91452026367188,
          "center_y": 200.07559204101562,
          "radius_x": 144.82266235351562,
          "radius_y": 236.83106994628906,
          "rotation": 92.58343505859375,
          "slice_index": 306,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.878898"
        }
      ],
      "brush_strokes": []
    },
    "x_307": {
      "slice_index": 307,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_913f6852",
          "center_x": 244.9661865234375,
          "center_y": 200.35926818847656,
          "radius_x": 144.78125,
          "radius_y": 236.51405334472656,
          "rotation": 92.43903350830078,
          "slice_index": 307,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.895962"
        }
      ],
      "brush_strokes": []
    },
    "x_308": {
      "slice_index": 308,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_31844119",
          "center_x": 244.64552307128906,
          "center_y": 200.1729736328125,
          "radius_x": 144.65646362304688,
          "radius_y": 237.0465545654297,
          "rotation": 92.33309936523438,
          "slice_index": 308,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.914042"
        }
      ],
      "brush_strokes": []
    },
    "x_309": {
      "slice_index": 309,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_3e2a0097",
          "center_x": 244.8977508544922,
          "center_y": 200.89642333984375,
          "radius_x": 144.62644958496094,
          "radius_y": 236.57847595214844,
          "rotation": 92.48774719238281,
          "slice_index": 309,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.931197"
        }
      ],
      "brush_strokes": []
    },
    "x_310": {
      "slice_index": 310,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f1d28656",
          "center_x": 245.25819396972656,
          "center_y": 201.03744506835938,
          "radius_x": 144.90882873535156,
          "radius_y": 236.4295196533203,
          "rotation": 92.5384521484375,
          "slice_index": 310,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.950395"
        }
      ],
      "brush_strokes": []
    },
    "x_311": {
      "slice_index": 311,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_99835344",
          "center_x": 245.21487426757812,
          "center_y": 200.9338836669922,
          "radius_x": 146.08595275878906,
          "radius_y": 234.28109741210938,
          "rotation": 92.1711654663086,
          "slice_index": 311,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.968641"
        }
      ],
      "brush_strokes": []
    },
    "x_312": {
      "slice_index": 312,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b35991c3",
          "center_x": 245.83802795410156,
          "center_y": 201.919921875,
          "radius_x": 144.1677703857422,
          "radius_y": 235.665283203125,
          "rotation": 91.43215942382812,
          "slice_index": 312,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:53.986191"
        }
      ],
      "brush_strokes": []
    },
    "x_313": {
      "slice_index": 313,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f0a9d553",
          "center_x": 246.08432006835938,
          "center_y": 201.71279907226562,
          "radius_x": 144.64901733398438,
          "radius_y": 235.3470458984375,
          "rotation": 91.87704467773438,
          "slice_index": 313,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.004976"
        }
      ],
      "brush_strokes": []
    },
    "x_314": {
      "slice_index": 314,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bc7f446c",
          "center_x": 247.3910369873047,
          "center_y": 202.12559509277344,
          "radius_x": 143.646728515625,
          "radius_y": 236.56983947753906,
          "rotation": 91.80680084228516,
          "slice_index": 314,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.023558"
        }
      ],
      "brush_strokes": []
    },
    "x_315": {
      "slice_index": 315,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bbc250fc",
          "center_x": 246.7115478515625,
          "center_y": 201.7098846435547,
          "radius_x": 143.40525817871094,
          "radius_y": 236.0205078125,
          "rotation": 91.43054962158203,
          "slice_index": 315,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.040694"
        }
      ],
      "brush_strokes": []
    },
    "x_316": {
      "slice_index": 316,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_43bd6609",
          "center_x": 246.8406219482422,
          "center_y": 201.4823455810547,
          "radius_x": 142.8215789794922,
          "radius_y": 236.08836364746094,
          "rotation": 91.54920196533203,
          "slice_index": 316,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.057959"
        }
      ],
      "brush_strokes": []
    },
    "x_317": {
      "slice_index": 317,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_3f1b8f4a",
          "center_x": 245.90972900390625,
          "center_y": 201.3445281982422,
          "radius_x": 142.9441375732422,
          "radius_y": 236.6668701171875,
          "rotation": 91.6302490234375,
          "slice_index": 317,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.075993"
        }
      ],
      "brush_strokes": []
    },
    "x_318": {
      "slice_index": 318,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b6be15d0",
          "center_x": 245.87196350097656,
          "center_y": 200.11024475097656,
          "radius_x": 144.52468872070312,
          "radius_y": 235.17530822753906,
          "rotation": 92.17076873779297,
          "slice_index": 318,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.093482"
        }
      ],
      "brush_strokes": []
    },
    "x_319": {
      "slice_index": 319,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6170b2f3",
          "center_x": 246.03500366210938,
          "center_y": 199.61883544921875,
          "radius_x": 144.22628784179688,
          "radius_y": 235.4594268798828,
          "rotation": 92.1025619506836,
          "slice_index": 319,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.110780"
        }
      ],
      "brush_strokes": []
    },
    "x_320": {
      "slice_index": 320,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_25e24fcb",
          "center_x": 246.0585174560547,
          "center_y": 199.95028686523438,
          "radius_x": 144.82814025878906,
          "radius_y": 234.81431579589844,
          "rotation": 92.2126693725586,
          "slice_index": 320,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.128732"
        }
      ],
      "brush_strokes": []
    },
    "x_321": {
      "slice_index": 321,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_35ad8410",
          "center_x": 245.52450561523438,
          "center_y": 201.49896240234375,
          "radius_x": 143.41354370117188,
          "radius_y": 235.5016632080078,
          "rotation": 92.22860717773438,
          "slice_index": 321,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.146093"
        }
      ],
      "brush_strokes": []
    },
    "x_322": {
      "slice_index": 322,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0d85fdea",
          "center_x": 245.67657470703125,
          "center_y": 201.42007446289062,
          "radius_x": 143.30264282226562,
          "radius_y": 235.3862762451172,
          "rotation": 92.1930160522461,
          "slice_index": 322,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.163646"
        }
      ],
      "brush_strokes": []
    },
    "x_323": {
      "slice_index": 323,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_27cccab6",
          "center_x": 244.98500061035156,
          "center_y": 202.620849609375,
          "radius_x": 143.08871459960938,
          "radius_y": 236.9725799560547,
          "rotation": 91.9244384765625,
          "slice_index": 323,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.182709"
        }
      ],
      "brush_strokes": []
    },
    "x_324": {
      "slice_index": 324,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_547536a1",
          "center_x": 245.1689453125,
          "center_y": 202.2740020751953,
          "radius_x": 143.35658264160156,
          "radius_y": 236.78561401367188,
          "rotation": 91.8641586303711,
          "slice_index": 324,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.200574"
        }
      ],
      "brush_strokes": []
    },
    "x_325": {
      "slice_index": 325,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_25b86a25",
          "center_x": 245.3946990966797,
          "center_y": 200.88023376464844,
          "radius_x": 144.7833709716797,
          "radius_y": 235.98544311523438,
          "rotation": 92.40603637695312,
          "slice_index": 325,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.217616"
        }
      ],
      "brush_strokes": []
    },
    "x_326": {
      "slice_index": 326,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_21225f40",
          "center_x": 245.9955291748047,
          "center_y": 202.2152099609375,
          "radius_x": 143.4571075439453,
          "radius_y": 237.2755584716797,
          "rotation": 92.68769836425781,
          "slice_index": 326,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.234980"
        }
      ],
      "brush_strokes": []
    },
    "x_327": {
      "slice_index": 327,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e7064d61",
          "center_x": 246.2924041748047,
          "center_y": 201.8050994873047,
          "radius_x": 143.47952270507812,
          "radius_y": 236.96754455566406,
          "rotation": 92.69711303710938,
          "slice_index": 327,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.253079"
        }
      ],
      "brush_strokes": []
    },
    "x_328": {
      "slice_index": 328,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6ccf9ef6",
          "center_x": 245.09669494628906,
          "center_y": 201.1044921875,
          "radius_x": 144.1148223876953,
          "radius_y": 236.6577911376953,
          "rotation": 92.51558685302734,
          "slice_index": 328,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.271111"
        }
      ],
      "brush_strokes": []
    },
    "x_329": {
      "slice_index": 329,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e9455c22",
          "center_x": 245.1354217529297,
          "center_y": 201.21873474121094,
          "radius_x": 144.3633270263672,
          "radius_y": 236.3445281982422,
          "rotation": 92.0067138671875,
          "slice_index": 329,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.288638"
        }
      ],
      "brush_strokes": []
    },
    "x_330": {
      "slice_index": 330,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c1a32580",
          "center_x": 245.6824951171875,
          "center_y": 200.86033630371094,
          "radius_x": 143.70346069335938,
          "radius_y": 236.2585906982422,
          "rotation": 92.0038070678711,
          "slice_index": 330,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.305197"
        }
      ],
      "brush_strokes": []
    },
    "x_331": {
      "slice_index": 331,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8dc3add2",
          "center_x": 245.0181121826172,
          "center_y": 200.45135498046875,
          "radius_x": 145.37413024902344,
          "radius_y": 236.65899658203125,
          "rotation": 92.30445098876953,
          "slice_index": 331,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.322248"
        }
      ],
      "brush_strokes": []
    },
    "x_332": {
      "slice_index": 332,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7bcfccd7",
          "center_x": 244.22315979003906,
          "center_y": 199.31707763671875,
          "radius_x": 146.5330810546875,
          "radius_y": 235.86196899414062,
          "rotation": 93.40938568115234,
          "slice_index": 332,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.339883"
        }
      ],
      "brush_strokes": []
    },
    "x_333": {
      "slice_index": 333,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6312c4c1",
          "center_x": 244.13461303710938,
          "center_y": 199.88555908203125,
          "radius_x": 146.40707397460938,
          "radius_y": 236.07928466796875,
          "rotation": 93.36397552490234,
          "slice_index": 333,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.359827"
        }
      ],
      "brush_strokes": []
    },
    "x_334": {
      "slice_index": 334,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c71c753d",
          "center_x": 244.2362518310547,
          "center_y": 198.75094604492188,
          "radius_x": 146.0343475341797,
          "radius_y": 235.53179931640625,
          "rotation": 93.41659545898438,
          "slice_index": 334,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.377527"
        }
      ],
      "brush_strokes": []
    },
    "x_335": {
      "slice_index": 335,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_41d90536",
          "center_x": 243.8662109375,
          "center_y": 199.22727966308594,
          "radius_x": 146.21484375,
          "radius_y": 237.23822021484375,
          "rotation": 93.62159729003906,
          "slice_index": 335,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.395881"
        }
      ],
      "brush_strokes": []
    },
    "x_336": {
      "slice_index": 336,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_99c1e3db",
          "center_x": 244.203369140625,
          "center_y": 199.531494140625,
          "radius_x": 146.28627014160156,
          "radius_y": 237.1837615966797,
          "rotation": 93.70500183105469,
          "slice_index": 336,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.413362"
        }
      ],
      "brush_strokes": []
    },
    "x_337": {
      "slice_index": 337,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dd32775c",
          "center_x": 243.91859436035156,
          "center_y": 199.8118438720703,
          "radius_x": 145.28285217285156,
          "radius_y": 237.52024841308594,
          "rotation": 93.48541259765625,
          "slice_index": 337,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.431493"
        }
      ],
      "brush_strokes": []
    },
    "x_338": {
      "slice_index": 338,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cbaef99a",
          "center_x": 244.12942504882812,
          "center_y": 199.61241149902344,
          "radius_x": 146.0915069580078,
          "radius_y": 236.98866271972656,
          "rotation": 93.78180694580078,
          "slice_index": 338,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.448541"
        }
      ],
      "brush_strokes": []
    },
    "x_339": {
      "slice_index": 339,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_350393dd",
          "center_x": 243.36924743652344,
          "center_y": 199.19659423828125,
          "radius_x": 146.04786682128906,
          "radius_y": 237.20359802246094,
          "rotation": 93.79558563232422,
          "slice_index": 339,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.466067"
        }
      ],
      "brush_strokes": []
    },
    "x_340": {
      "slice_index": 340,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1bdb107d",
          "center_x": 243.5443115234375,
          "center_y": 198.73321533203125,
          "radius_x": 146.12355041503906,
          "radius_y": 237.03343200683594,
          "rotation": 94.25863647460938,
          "slice_index": 340,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.483614"
        }
      ],
      "brush_strokes": []
    },
    "x_341": {
      "slice_index": 341,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c9caefe0",
          "center_x": 244.63345336914062,
          "center_y": 199.3762664794922,
          "radius_x": 144.98941040039062,
          "radius_y": 236.4483642578125,
          "rotation": 93.29661560058594,
          "slice_index": 341,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.501677"
        }
      ],
      "brush_strokes": []
    },
    "x_342": {
      "slice_index": 342,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_61f530a8",
          "center_x": 244.47079467773438,
          "center_y": 199.1829833984375,
          "radius_x": 144.3240203857422,
          "radius_y": 236.46095275878906,
          "rotation": 93.19266510009766,
          "slice_index": 342,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.518533"
        }
      ],
      "brush_strokes": []
    },
    "x_343": {
      "slice_index": 343,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_3d27a698",
          "center_x": 242.94752502441406,
          "center_y": 199.32949829101562,
          "radius_x": 144.7711944580078,
          "radius_y": 236.7980194091797,
          "rotation": 92.67668151855469,
          "slice_index": 343,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.537178"
        }
      ],
      "brush_strokes": []
    },
    "x_344": {
      "slice_index": 344,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4bcac714",
          "center_x": 243.7142333984375,
          "center_y": 198.77186584472656,
          "radius_x": 146.2418975830078,
          "radius_y": 236.44468688964844,
          "rotation": 92.44261169433594,
          "slice_index": 344,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.555228"
        }
      ],
      "brush_strokes": []
    },
    "x_345": {
      "slice_index": 345,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4cba95af",
          "center_x": 243.43202209472656,
          "center_y": 198.41287231445312,
          "radius_x": 146.55126953125,
          "radius_y": 235.7108154296875,
          "rotation": 92.28438568115234,
          "slice_index": 345,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.573455"
        }
      ],
      "brush_strokes": []
    },
    "x_346": {
      "slice_index": 346,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_12459075",
          "center_x": 243.8167266845703,
          "center_y": 198.9792022705078,
          "radius_x": 147.04989624023438,
          "radius_y": 236.37196350097656,
          "rotation": 93.02044677734375,
          "slice_index": 346,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.592133"
        }
      ],
      "brush_strokes": []
    },
    "x_347": {
      "slice_index": 347,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_056795da",
          "center_x": 244.2228240966797,
          "center_y": 198.09396362304688,
          "radius_x": 146.83248901367188,
          "radius_y": 236.38784790039062,
          "rotation": 94.20396423339844,
          "slice_index": 347,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.611057"
        }
      ],
      "brush_strokes": []
    },
    "x_348": {
      "slice_index": 348,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9d93a206",
          "center_x": 244.270751953125,
          "center_y": 198.17115783691406,
          "radius_x": 146.52813720703125,
          "radius_y": 236.0667724609375,
          "rotation": 93.8917007446289,
          "slice_index": 348,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.627840"
        }
      ],
      "brush_strokes": []
    },
    "x_349": {
      "slice_index": 349,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_db722114",
          "center_x": 243.9590301513672,
          "center_y": 198.4752197265625,
          "radius_x": 146.71788024902344,
          "radius_y": 237.12924194335938,
          "rotation": 94.15113067626953,
          "slice_index": 349,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.646128"
        }
      ],
      "brush_strokes": []
    },
    "x_350": {
      "slice_index": 350,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_30972106",
          "center_x": 242.7103729248047,
          "center_y": 197.01686096191406,
          "radius_x": 146.19932556152344,
          "radius_y": 236.5714111328125,
          "rotation": 93.46635437011719,
          "slice_index": 350,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.663719"
        }
      ],
      "brush_strokes": []
    },
    "x_351": {
      "slice_index": 351,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b72b61a6",
          "center_x": 243.0452117919922,
          "center_y": 196.73109436035156,
          "radius_x": 146.18801879882812,
          "radius_y": 236.200927734375,
          "rotation": 93.60125732421875,
          "slice_index": 351,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.680289"
        }
      ],
      "brush_strokes": []
    },
    "x_352": {
      "slice_index": 352,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0f1fd954",
          "center_x": 242.45018005371094,
          "center_y": 195.94985961914062,
          "radius_x": 146.5038299560547,
          "radius_y": 236.3658447265625,
          "rotation": 93.89138793945312,
          "slice_index": 352,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.697879"
        }
      ],
      "brush_strokes": []
    },
    "x_353": {
      "slice_index": 353,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_35df9fd7",
          "center_x": 242.35768127441406,
          "center_y": 196.8279266357422,
          "radius_x": 146.56407165527344,
          "radius_y": 236.06283569335938,
          "rotation": 93.98379516601562,
          "slice_index": 353,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.715876"
        }
      ],
      "brush_strokes": []
    },
    "x_354": {
      "slice_index": 354,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1b1968a1",
          "center_x": 242.5994873046875,
          "center_y": 197.05645751953125,
          "radius_x": 146.43606567382812,
          "radius_y": 236.65342712402344,
          "rotation": 93.99234008789062,
          "slice_index": 354,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.734105"
        }
      ],
      "brush_strokes": []
    },
    "x_355": {
      "slice_index": 355,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1ef87976",
          "center_x": 243.66671752929688,
          "center_y": 197.31752014160156,
          "radius_x": 146.47630310058594,
          "radius_y": 235.41395568847656,
          "rotation": 94.0290298461914,
          "slice_index": 355,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.750654"
        }
      ],
      "brush_strokes": []
    },
    "x_356": {
      "slice_index": 356,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_189239f1",
          "center_x": 244.02151489257812,
          "center_y": 197.56057739257812,
          "radius_x": 146.84898376464844,
          "radius_y": 235.52178955078125,
          "rotation": 94.15531921386719,
          "slice_index": 356,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.768959"
        }
      ],
      "brush_strokes": []
    },
    "x_357": {
      "slice_index": 357,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b0c79e03",
          "center_x": 242.45111083984375,
          "center_y": 195.72036743164062,
          "radius_x": 147.77999877929688,
          "radius_y": 234.36892700195312,
          "rotation": 93.71499633789062,
          "slice_index": 357,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.786256"
        }
      ],
      "brush_strokes": []
    },
    "x_358": {
      "slice_index": 358,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_77cb1956",
          "center_x": 242.71868896484375,
          "center_y": 196.7108154296875,
          "radius_x": 147.232177734375,
          "radius_y": 236.26943969726562,
          "rotation": 93.87403106689453,
          "slice_index": 358,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.804226"
        }
      ],
      "brush_strokes": []
    },
    "x_359": {
      "slice_index": 359,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9bff5aa3",
          "center_x": 242.99234008789062,
          "center_y": 196.73228454589844,
          "radius_x": 147.41629028320312,
          "radius_y": 236.36256408691406,
          "rotation": 93.82679748535156,
          "slice_index": 359,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.822343"
        }
      ],
      "brush_strokes": []
    },
    "x_360": {
      "slice_index": 360,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2b825c27",
          "center_x": 243.4748992919922,
          "center_y": 196.2908935546875,
          "radius_x": 145.74176025390625,
          "radius_y": 235.978759765625,
          "rotation": 94.07061767578125,
          "slice_index": 360,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.839883"
        }
      ],
      "brush_strokes": []
    },
    "x_361": {
      "slice_index": 361,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_862903ae",
          "center_x": 243.21340942382812,
          "center_y": 197.4439697265625,
          "radius_x": 147.1693572998047,
          "radius_y": 236.42926025390625,
          "rotation": 94.20925903320312,
          "slice_index": 361,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.857441"
        }
      ],
      "brush_strokes": []
    },
    "x_362": {
      "slice_index": 362,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d586d6ce",
          "center_x": 242.96922302246094,
          "center_y": 197.50648498535156,
          "radius_x": 147.28648376464844,
          "radius_y": 236.64991760253906,
          "rotation": 94.11434936523438,
          "slice_index": 362,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.874817"
        }
      ],
      "brush_strokes": []
    },
    "x_363": {
      "slice_index": 363,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bffb8944",
          "center_x": 242.26730346679688,
          "center_y": 196.78330993652344,
          "radius_x": 147.82174682617188,
          "radius_y": 236.4495391845703,
          "rotation": 94.1538314819336,
          "slice_index": 363,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.892771"
        }
      ],
      "brush_strokes": []
    },
    "x_364": {
      "slice_index": 364,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a9d6668e",
          "center_x": 242.2721710205078,
          "center_y": 195.39959716796875,
          "radius_x": 148.08233642578125,
          "radius_y": 236.55548095703125,
          "rotation": 95.27137756347656,
          "slice_index": 364,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.910922"
        }
      ],
      "brush_strokes": []
    },
    "x_365": {
      "slice_index": 365,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7529d08c",
          "center_x": 241.4421844482422,
          "center_y": 195.41543579101562,
          "radius_x": 149.01966857910156,
          "radius_y": 236.99343872070312,
          "rotation": 95.24386596679688,
          "slice_index": 365,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.928845"
        }
      ],
      "brush_strokes": []
    },
    "x_366": {
      "slice_index": 366,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_77a2178d",
          "center_x": 243.55587768554688,
          "center_y": 194.22293090820312,
          "radius_x": 146.92495727539062,
          "radius_y": 235.8916778564453,
          "rotation": 95.4776840209961,
          "slice_index": 366,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.947198"
        }
      ],
      "brush_strokes": []
    },
    "x_367": {
      "slice_index": 367,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_389dff6d",
          "center_x": 239.93260192871094,
          "center_y": 193.3061065673828,
          "radius_x": 148.82777404785156,
          "radius_y": 236.22793579101562,
          "rotation": 95.28401184082031,
          "slice_index": 367,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.965290"
        }
      ],
      "brush_strokes": []
    },
    "x_368": {
      "slice_index": 368,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_3d06a6d1",
          "center_x": 241.2561798095703,
          "center_y": 192.59970092773438,
          "radius_x": 147.78646850585938,
          "radius_y": 235.9859161376953,
          "rotation": 96.07682037353516,
          "slice_index": 368,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:54.983977"
        }
      ],
      "brush_strokes": []
    },
    "x_369": {
      "slice_index": 369,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ad5bc86c",
          "center_x": 239.85595703125,
          "center_y": 191.15321350097656,
          "radius_x": 148.60995483398438,
          "radius_y": 236.50050354003906,
          "rotation": 96.21044921875,
          "slice_index": 369,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.002138"
        }
      ],
      "brush_strokes": []
    },
    "x_370": {
      "slice_index": 370,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_903f8a1c",
          "center_x": 237.41102600097656,
          "center_y": 190.5361328125,
          "radius_x": 151.4530792236328,
          "radius_y": 236.3765869140625,
          "rotation": 96.5198745727539,
          "slice_index": 370,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.020197"
        }
      ],
      "brush_strokes": []
    },
    "x_371": {
      "slice_index": 371,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_570ba705",
          "center_x": 238.31246948242188,
          "center_y": 191.00885009765625,
          "radius_x": 150.9807891845703,
          "radius_y": 235.95204162597656,
          "rotation": 96.54379272460938,
          "slice_index": 371,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.038684"
        }
      ],
      "brush_strokes": []
    },
    "x_372": {
      "slice_index": 372,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_09465d64",
          "center_x": 238.04302978515625,
          "center_y": 192.58876037597656,
          "radius_x": 151.00576782226562,
          "radius_y": 237.1538848876953,
          "rotation": 95.98607635498047,
          "slice_index": 372,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.056115"
        }
      ],
      "brush_strokes": []
    },
    "x_373": {
      "slice_index": 373,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1bf04a6f",
          "center_x": 238.31275939941406,
          "center_y": 191.9443359375,
          "radius_x": 150.20901489257812,
          "radius_y": 236.58401489257812,
          "rotation": 95.7780990600586,
          "slice_index": 373,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.075156"
        }
      ],
      "brush_strokes": []
    },
    "x_374": {
      "slice_index": 374,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_108f8dd9",
          "center_x": 238.11090087890625,
          "center_y": 192.3328857421875,
          "radius_x": 151.0000762939453,
          "radius_y": 237.12359619140625,
          "rotation": 96.42695617675781,
          "slice_index": 374,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.092683"
        }
      ],
      "brush_strokes": []
    },
    "x_375": {
      "slice_index": 375,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f16898d0",
          "center_x": 236.81167602539062,
          "center_y": 191.00552368164062,
          "radius_x": 151.96739196777344,
          "radius_y": 236.45045471191406,
          "rotation": 96.46986389160156,
          "slice_index": 375,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.110855"
        }
      ],
      "brush_strokes": []
    },
    "x_376": {
      "slice_index": 376,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f12667fd",
          "center_x": 236.50592041015625,
          "center_y": 191.62789916992188,
          "radius_x": 151.88914489746094,
          "radius_y": 236.97962951660156,
          "rotation": 96.73766326904297,
          "slice_index": 376,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.128417"
        }
      ],
      "brush_strokes": []
    },
    "x_377": {
      "slice_index": 377,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_7b0fac0d",
          "center_x": 236.74948120117188,
          "center_y": 191.9374542236328,
          "radius_x": 152.33001708984375,
          "radius_y": 236.78533935546875,
          "rotation": 96.88033294677734,
          "slice_index": 377,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.147999"
        }
      ],
      "brush_strokes": []
    },
    "x_378": {
      "slice_index": 378,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c200fb82",
          "center_x": 235.84124755859375,
          "center_y": 189.8966064453125,
          "radius_x": 151.4725799560547,
          "radius_y": 236.85926818847656,
          "rotation": 96.94213104248047,
          "slice_index": 378,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.166085"
        }
      ],
      "brush_strokes": []
    },
    "x_379": {
      "slice_index": 379,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0687fae2",
          "center_x": 236.69911193847656,
          "center_y": 190.45260620117188,
          "radius_x": 151.42245483398438,
          "radius_y": 237.8914794921875,
          "rotation": 97.15830993652344,
          "slice_index": 379,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.184093"
        }
      ],
      "brush_strokes": []
    },
    "x_380": {
      "slice_index": 380,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_14f7590b",
          "center_x": 237.28001403808594,
          "center_y": 191.20346069335938,
          "radius_x": 151.02432250976562,
          "radius_y": 238.2129364013672,
          "rotation": 97.2010269165039,
          "slice_index": 380,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.202214"
        }
      ],
      "brush_strokes": []
    },
    "x_381": {
      "slice_index": 381,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8ff91cdd",
          "center_x": 237.74099731445312,
          "center_y": 190.27511596679688,
          "radius_x": 151.41783142089844,
          "radius_y": 238.09970092773438,
          "rotation": 97.3299331665039,
          "slice_index": 381,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.221230"
        }
      ],
      "brush_strokes": []
    },
    "x_382": {
      "slice_index": 382,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_521b35e8",
          "center_x": 236.2213592529297,
          "center_y": 189.09048461914062,
          "radius_x": 152.20001220703125,
          "radius_y": 237.3294677734375,
          "rotation": 97.11739349365234,
          "slice_index": 382,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.238423"
        }
      ],
      "brush_strokes": []
    },
    "x_383": {
      "slice_index": 383,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_948d9048",
          "center_x": 236.35012817382812,
          "center_y": 189.2081298828125,
          "radius_x": 152.3507843017578,
          "radius_y": 237.38526916503906,
          "rotation": 97.44451141357422,
          "slice_index": 383,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.256935"
        }
      ],
      "brush_strokes": []
    },
    "x_384": {
      "slice_index": 384,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5f40d2d6",
          "center_x": 234.3133544921875,
          "center_y": 189.21237182617188,
          "radius_x": 153.5285186767578,
          "radius_y": 235.36827087402344,
          "rotation": 96.71481323242188,
          "slice_index": 384,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.274991"
        }
      ],
      "brush_strokes": []
    },
    "x_385": {
      "slice_index": 385,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6322a093",
          "center_x": 234.7230682373047,
          "center_y": 189.9375,
          "radius_x": 153.53485107421875,
          "radius_y": 236.36114501953125,
          "rotation": 96.7901382446289,
          "slice_index": 385,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.292585"
        }
      ],
      "brush_strokes": []
    },
    "x_386": {
      "slice_index": 386,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d0ea138d",
          "center_x": 235.65908813476562,
          "center_y": 189.0706329345703,
          "radius_x": 152.8927764892578,
          "radius_y": 236.5791473388672,
          "rotation": 97.80779266357422,
          "slice_index": 386,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.311047"
        }
      ],
      "brush_strokes": []
    },
    "x_387": {
      "slice_index": 387,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0dd1328e",
          "center_x": 235.80775451660156,
          "center_y": 189.60638427734375,
          "radius_x": 153.23675537109375,
          "radius_y": 237.86741638183594,
          "rotation": 98.25598907470703,
          "slice_index": 387,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.328397"
        }
      ],
      "brush_strokes": []
    },
    "x_388": {
      "slice_index": 388,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c9f6b670",
          "center_x": 235.91909790039062,
          "center_y": 190.22000122070312,
          "radius_x": 152.84019470214844,
          "radius_y": 238.0089111328125,
          "rotation": 98.05497741699219,
          "slice_index": 388,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.347509"
        }
      ],
      "brush_strokes": []
    },
    "x_389": {
      "slice_index": 389,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_09a36d7e",
          "center_x": 235.25108337402344,
          "center_y": 188.5848388671875,
          "radius_x": 152.99269104003906,
          "radius_y": 237.62777709960938,
          "rotation": 97.86467742919922,
          "slice_index": 389,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.364900"
        }
      ],
      "brush_strokes": []
    },
    "x_390": {
      "slice_index": 390,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a50ab68f",
          "center_x": 234.3241424560547,
          "center_y": 187.06971740722656,
          "radius_x": 152.8885955810547,
          "radius_y": 236.46759033203125,
          "rotation": 97.7497329711914,
          "slice_index": 390,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.384956"
        }
      ],
      "brush_strokes": []
    },
    "x_391": {
      "slice_index": 391,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_76741925",
          "center_x": 234.34054565429688,
          "center_y": 187.08729553222656,
          "radius_x": 153.3945770263672,
          "radius_y": 236.16619873046875,
          "rotation": 97.68953704833984,
          "slice_index": 391,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.402673"
        }
      ],
      "brush_strokes": []
    },
    "x_392": {
      "slice_index": 392,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9536b930",
          "center_x": 234.8456268310547,
          "center_y": 188.09249877929688,
          "radius_x": 153.70016479492188,
          "radius_y": 236.57901000976562,
          "rotation": 97.94425964355469,
          "slice_index": 392,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.420396"
        }
      ],
      "brush_strokes": []
    },
    "x_393": {
      "slice_index": 393,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_381da4a7",
          "center_x": 234.39187622070312,
          "center_y": 188.4918670654297,
          "radius_x": 152.78855895996094,
          "radius_y": 236.48486328125,
          "rotation": 97.75613403320312,
          "slice_index": 393,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.438944"
        }
      ],
      "brush_strokes": []
    },
    "x_394": {
      "slice_index": 394,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2408c06d",
          "center_x": 234.21743774414062,
          "center_y": 187.9063262939453,
          "radius_x": 152.9204864501953,
          "radius_y": 236.67904663085938,
          "rotation": 97.75125122070312,
          "slice_index": 394,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.456979"
        }
      ],
      "brush_strokes": []
    },
    "x_395": {
      "slice_index": 395,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_201f219f",
          "center_x": 234.0674285888672,
          "center_y": 187.2718505859375,
          "radius_x": 153.3460235595703,
          "radius_y": 236.8400115966797,
          "rotation": 98.19760131835938,
          "slice_index": 395,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.475519"
        }
      ],
      "brush_strokes": []
    },
    "x_396": {
      "slice_index": 396,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a3f3149a",
          "center_x": 235.08157348632812,
          "center_y": 187.6369171142578,
          "radius_x": 154.82046508789062,
          "radius_y": 236.86683654785156,
          "rotation": 98.34535217285156,
          "slice_index": 396,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.493070"
        }
      ],
      "brush_strokes": []
    },
    "x_397": {
      "slice_index": 397,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_98791458",
          "center_x": 234.6690216064453,
          "center_y": 187.03042602539062,
          "radius_x": 153.70913696289062,
          "radius_y": 236.9099884033203,
          "rotation": 98.39293670654297,
          "slice_index": 397,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.511614"
        }
      ],
      "brush_strokes": []
    },
    "x_398": {
      "slice_index": 398,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_63801e63",
          "center_x": 234.26785278320312,
          "center_y": 187.34161376953125,
          "radius_x": 154.568603515625,
          "radius_y": 236.78872680664062,
          "rotation": 98.36973571777344,
          "slice_index": 398,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.530157"
        }
      ],
      "brush_strokes": []
    },
    "x_399": {
      "slice_index": 399,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6af72c45",
          "center_x": 233.98023986816406,
          "center_y": 185.43722534179688,
          "radius_x": 153.91891479492188,
          "radius_y": 236.01318359375,
          "rotation": 98.28731536865234,
          "slice_index": 399,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.548453"
        }
      ],
      "brush_strokes": []
    },
    "x_400": {
      "slice_index": 400,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1f692fae",
          "center_x": 233.82090759277344,
          "center_y": 184.66116333007812,
          "radius_x": 153.01283264160156,
          "radius_y": 235.8313751220703,
          "rotation": 97.91952514648438,
          "slice_index": 400,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.568100"
        }
      ],
      "brush_strokes": []
    },
    "x_401": {
      "slice_index": 401,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8d32547c",
          "center_x": 235.0420684814453,
          "center_y": 185.68165588378906,
          "radius_x": 153.86167907714844,
          "radius_y": 236.13763427734375,
          "rotation": 98.40972900390625,
          "slice_index": 401,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.585069"
        }
      ],
      "brush_strokes": []
    },
    "x_402": {
      "slice_index": 402,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_fb2c4372",
          "center_x": 233.88641357421875,
          "center_y": 186.27960205078125,
          "radius_x": 156.71409606933594,
          "radius_y": 235.1830596923828,
          "rotation": 97.80438232421875,
          "slice_index": 402,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.602606"
        }
      ],
      "brush_strokes": []
    },
    "x_403": {
      "slice_index": 403,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f942dcfa",
          "center_x": 234.52139282226562,
          "center_y": 186.47976684570312,
          "radius_x": 156.7642822265625,
          "radius_y": 235.9767303466797,
          "rotation": 98.25617218017578,
          "slice_index": 403,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.621048"
        }
      ],
      "brush_strokes": []
    },
    "x_404": {
      "slice_index": 404,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c235c3dd",
          "center_x": 232.80397033691406,
          "center_y": 185.34536743164062,
          "radius_x": 155.64427185058594,
          "radius_y": 235.12855529785156,
          "rotation": 98.10382080078125,
          "slice_index": 404,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.638880"
        }
      ],
      "brush_strokes": []
    },
    "x_405": {
      "slice_index": 405,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1b9a1a00",
          "center_x": 232.0039520263672,
          "center_y": 184.99583435058594,
          "radius_x": 154.36863708496094,
          "radius_y": 235.4585418701172,
          "rotation": 97.63727569580078,
          "slice_index": 405,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.656265"
        }
      ],
      "brush_strokes": []
    },
    "x_406": {
      "slice_index": 406,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1e14a962",
          "center_x": 231.23233032226562,
          "center_y": 184.7452850341797,
          "radius_x": 154.94801330566406,
          "radius_y": 234.9254608154297,
          "rotation": 97.1839599609375,
          "slice_index": 406,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.675311"
        }
      ],
      "brush_strokes": []
    },
    "x_407": {
      "slice_index": 407,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_418506b5",
          "center_x": 233.13168334960938,
          "center_y": 185.52223205566406,
          "radius_x": 155.2211456298828,
          "radius_y": 235.31707763671875,
          "rotation": 98.3503189086914,
          "slice_index": 407,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.692871"
        }
      ],
      "brush_strokes": []
    },
    "x_408": {
      "slice_index": 408,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bb164213",
          "center_x": 233.6837615966797,
          "center_y": 185.86231994628906,
          "radius_x": 156.35940551757812,
          "radius_y": 236.16136169433594,
          "rotation": 98.44378662109375,
          "slice_index": 408,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.711140"
        }
      ],
      "brush_strokes": []
    },
    "x_409": {
      "slice_index": 409,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cbf1ec27",
          "center_x": 234.09011840820312,
          "center_y": 186.01173400878906,
          "radius_x": 156.3759765625,
          "radius_y": 236.00193786621094,
          "rotation": 98.68408203125,
          "slice_index": 409,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.728675"
        }
      ],
      "brush_strokes": []
    },
    "x_410": {
      "slice_index": 410,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5562bc0d",
          "center_x": 234.5024871826172,
          "center_y": 186.31553649902344,
          "radius_x": 156.66896057128906,
          "radius_y": 235.99415588378906,
          "rotation": 99.0929946899414,
          "slice_index": 410,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.747716"
        }
      ],
      "brush_strokes": []
    },
    "x_411": {
      "slice_index": 411,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_11b7f883",
          "center_x": 233.44357299804688,
          "center_y": 185.68563842773438,
          "radius_x": 154.84182739257812,
          "radius_y": 235.9897003173828,
          "rotation": 98.34689331054688,
          "slice_index": 411,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.765245"
        }
      ],
      "brush_strokes": []
    },
    "x_412": {
      "slice_index": 412,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e27784a1",
          "center_x": 233.58892822265625,
          "center_y": 185.40052795410156,
          "radius_x": 155.08450317382812,
          "radius_y": 236.40733337402344,
          "rotation": 98.65552520751953,
          "slice_index": 412,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.781808"
        }
      ],
      "brush_strokes": []
    },
    "x_413": {
      "slice_index": 413,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_338ed805",
          "center_x": 232.7028350830078,
          "center_y": 184.9974822998047,
          "radius_x": 157.1748046875,
          "radius_y": 235.12368774414062,
          "rotation": 97.65999603271484,
          "slice_index": 413,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.799884"
        }
      ],
      "brush_strokes": []
    },
    "x_414": {
      "slice_index": 414,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6a7669f4",
          "center_x": 232.10755920410156,
          "center_y": 183.96200561523438,
          "radius_x": 156.4086151123047,
          "radius_y": 234.62161254882812,
          "rotation": 97.11907196044922,
          "slice_index": 414,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.816910"
        }
      ],
      "brush_strokes": []
    },
    "x_415": {
      "slice_index": 415,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c6c167a7",
          "center_x": 232.00135803222656,
          "center_y": 185.3743896484375,
          "radius_x": 157.52366638183594,
          "radius_y": 234.76206970214844,
          "rotation": 97.34783172607422,
          "slice_index": 415,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.834802"
        }
      ],
      "brush_strokes": []
    },
    "x_416": {
      "slice_index": 416,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8a20815f",
          "center_x": 233.61270141601562,
          "center_y": 183.2276611328125,
          "radius_x": 154.62342834472656,
          "radius_y": 234.69361877441406,
          "rotation": 97.96159362792969,
          "slice_index": 416,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.852976"
        }
      ],
      "brush_strokes": []
    },
    "x_417": {
      "slice_index": 417,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bbef973a",
          "center_x": 233.50489807128906,
          "center_y": 184.23814392089844,
          "radius_x": 155.58358764648438,
          "radius_y": 235.0209197998047,
          "rotation": 98.13729095458984,
          "slice_index": 417,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.871366"
        }
      ],
      "brush_strokes": []
    },
    "x_418": {
      "slice_index": 418,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_43ae8dee",
          "center_x": 233.22442626953125,
          "center_y": 184.788330078125,
          "radius_x": 156.2854461669922,
          "radius_y": 235.09568786621094,
          "rotation": 98.17204284667969,
          "slice_index": 418,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.887960"
        }
      ],
      "brush_strokes": []
    },
    "x_419": {
      "slice_index": 419,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ba89d2ca",
          "center_x": 233.6058349609375,
          "center_y": 184.98477172851562,
          "radius_x": 156.3480987548828,
          "radius_y": 235.40139770507812,
          "rotation": 98.16576385498047,
          "slice_index": 419,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.907900"
        }
      ],
      "brush_strokes": []
    },
    "x_420": {
      "slice_index": 420,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0e6cc6d0",
          "center_x": 233.1530303955078,
          "center_y": 184.2965850830078,
          "radius_x": 156.2108917236328,
          "radius_y": 235.05145263671875,
          "rotation": 97.84660339355469,
          "slice_index": 420,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.924988"
        }
      ],
      "brush_strokes": []
    },
    "x_421": {
      "slice_index": 421,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f78f9270",
          "center_x": 233.5813751220703,
          "center_y": 184.73536682128906,
          "radius_x": 156.95205688476562,
          "radius_y": 235.0899200439453,
          "rotation": 98.26361846923828,
          "slice_index": 421,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.942032"
        }
      ],
      "brush_strokes": []
    },
    "x_422": {
      "slice_index": 422,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0caa1334",
          "center_x": 232.7925262451172,
          "center_y": 184.38140869140625,
          "radius_x": 156.26394653320312,
          "radius_y": 235.4971160888672,
          "rotation": 97.82906341552734,
          "slice_index": 422,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.961769"
        }
      ],
      "brush_strokes": []
    },
    "x_423": {
      "slice_index": 423,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dd6e45c7",
          "center_x": 233.2880859375,
          "center_y": 184.63006591796875,
          "radius_x": 156.08700561523438,
          "radius_y": 235.6308135986328,
          "rotation": 98.1588363647461,
          "slice_index": 423,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.979145"
        }
      ],
      "brush_strokes": []
    },
    "x_424": {
      "slice_index": 424,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_99467726",
          "center_x": 231.70155334472656,
          "center_y": 184.003662109375,
          "radius_x": 156.0746612548828,
          "radius_y": 234.54156494140625,
          "rotation": 97.03495025634766,
          "slice_index": 424,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:55.996979"
        }
      ],
      "brush_strokes": []
    },
    "x_425": {
      "slice_index": 425,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c6bf2be3",
          "center_x": 232.4448699951172,
          "center_y": 183.06813049316406,
          "radius_x": 155.70938110351562,
          "radius_y": 235.53726196289062,
          "rotation": 97.20376586914062,
          "slice_index": 425,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.013985"
        }
      ],
      "brush_strokes": []
    },
    "x_426": {
      "slice_index": 426,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_03d10509",
          "center_x": 233.0596923828125,
          "center_y": 183.90744018554688,
          "radius_x": 157.5103302001953,
          "radius_y": 235.12265014648438,
          "rotation": 97.4522705078125,
          "slice_index": 426,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.032205"
        }
      ],
      "brush_strokes": []
    },
    "x_427": {
      "slice_index": 427,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_19460154",
          "center_x": 230.89205932617188,
          "center_y": 183.56527709960938,
          "radius_x": 156.50643920898438,
          "radius_y": 234.44625854492188,
          "rotation": 96.33495330810547,
          "slice_index": 427,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.050737"
        }
      ],
      "brush_strokes": []
    },
    "x_428": {
      "slice_index": 428,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b3fcae80",
          "center_x": 230.6402587890625,
          "center_y": 183.01002502441406,
          "radius_x": 156.91725158691406,
          "radius_y": 234.87432861328125,
          "rotation": 96.70309448242188,
          "slice_index": 428,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.067534"
        }
      ],
      "brush_strokes": []
    },
    "x_429": {
      "slice_index": 429,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9f3775a9",
          "center_x": 231.30352783203125,
          "center_y": 183.62158203125,
          "radius_x": 156.90924072265625,
          "radius_y": 235.01504516601562,
          "rotation": 96.84322357177734,
          "slice_index": 429,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.086211"
        }
      ],
      "brush_strokes": []
    },
    "x_430": {
      "slice_index": 430,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c20704f8",
          "center_x": 230.9477081298828,
          "center_y": 181.48605346679688,
          "radius_x": 155.5908203125,
          "radius_y": 235.15151977539062,
          "rotation": 96.56892395019531,
          "slice_index": 430,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.103207"
        }
      ],
      "brush_strokes": []
    },
    "x_431": {
      "slice_index": 431,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b2225d76",
          "center_x": 228.2538299560547,
          "center_y": 179.60804748535156,
          "radius_x": 155.78712463378906,
          "radius_y": 232.98583984375,
          "rotation": 94.89530181884766,
          "slice_index": 431,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.120929"
        }
      ],
      "brush_strokes": []
    },
    "x_432": {
      "slice_index": 432,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e8c88b4d",
          "center_x": 228.919677734375,
          "center_y": 180.7533721923828,
          "radius_x": 155.93138122558594,
          "radius_y": 233.722412109375,
          "rotation": 95.46102905273438,
          "slice_index": 432,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.137973"
        }
      ],
      "brush_strokes": []
    },
    "x_433": {
      "slice_index": 433,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_27fe4d21",
          "center_x": 230.6041259765625,
          "center_y": 182.7235870361328,
          "radius_x": 157.69924926757812,
          "radius_y": 234.50936889648438,
          "rotation": 96.68688201904297,
          "slice_index": 433,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.155513"
        }
      ],
      "brush_strokes": []
    },
    "x_434": {
      "slice_index": 434,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_3e82c6bf",
          "center_x": 229.36517333984375,
          "center_y": 182.15049743652344,
          "radius_x": 158.52879333496094,
          "radius_y": 233.16973876953125,
          "rotation": 96.0367431640625,
          "slice_index": 434,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.173130"
        }
      ],
      "brush_strokes": []
    },
    "x_435": {
      "slice_index": 435,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9f9239d3",
          "center_x": 228.978271484375,
          "center_y": 181.8299102783203,
          "radius_x": 157.99124145507812,
          "radius_y": 233.1952362060547,
          "rotation": 95.59892272949219,
          "slice_index": 435,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.190185"
        }
      ],
      "brush_strokes": []
    },
    "x_436": {
      "slice_index": 436,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cb6e32d7",
          "center_x": 227.72894287109375,
          "center_y": 180.632568359375,
          "radius_x": 158.4389190673828,
          "radius_y": 232.33949279785156,
          "rotation": 94.52438354492188,
          "slice_index": 436,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.207207"
        }
      ],
      "brush_strokes": []
    },
    "x_437": {
      "slice_index": 437,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_155322c1",
          "center_x": 229.23239135742188,
          "center_y": 181.05381774902344,
          "radius_x": 158.6256866455078,
          "radius_y": 232.6785888671875,
          "rotation": 95.26678466796875,
          "slice_index": 437,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.225273"
        }
      ],
      "brush_strokes": []
    },
    "x_438": {
      "slice_index": 438,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a7f320c0",
          "center_x": 229.1581573486328,
          "center_y": 181.0127410888672,
          "radius_x": 158.59075927734375,
          "radius_y": 232.83633422851562,
          "rotation": 95.2137680053711,
          "slice_index": 438,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.241274"
        }
      ],
      "brush_strokes": []
    },
    "x_439": {
      "slice_index": 439,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a897fe12",
          "center_x": 227.95556640625,
          "center_y": 180.55809020996094,
          "radius_x": 158.1140899658203,
          "radius_y": 232.95925903320312,
          "rotation": 94.7042007446289,
          "slice_index": 439,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.259799"
        }
      ],
      "brush_strokes": []
    },
    "x_440": {
      "slice_index": 440,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9059acde",
          "center_x": 230.48570251464844,
          "center_y": 183.99212646484375,
          "radius_x": 160.86407470703125,
          "radius_y": 234.01620483398438,
          "rotation": 97.1173324584961,
          "slice_index": 440,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.275848"
        }
      ],
      "brush_strokes": []
    },
    "x_441": {
      "slice_index": 441,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_13b72802",
          "center_x": 229.7188262939453,
          "center_y": 182.71498107910156,
          "radius_x": 160.19290161132812,
          "radius_y": 233.607666015625,
          "rotation": 96.45286560058594,
          "slice_index": 441,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.293975"
        }
      ],
      "brush_strokes": []
    },
    "x_442": {
      "slice_index": 442,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cce95407",
          "center_x": 229.4888916015625,
          "center_y": 181.81903076171875,
          "radius_x": 158.3936767578125,
          "radius_y": 233.50392150878906,
          "rotation": 96.29033660888672,
          "slice_index": 442,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.312046"
        }
      ],
      "brush_strokes": []
    },
    "x_443": {
      "slice_index": 443,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_fb3635d5",
          "center_x": 229.43348693847656,
          "center_y": 182.40536499023438,
          "radius_x": 159.17282104492188,
          "radius_y": 233.32269287109375,
          "rotation": 96.15645599365234,
          "slice_index": 443,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.330853"
        }
      ],
      "brush_strokes": []
    },
    "x_444": {
      "slice_index": 444,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1ac26de0",
          "center_x": 229.04910278320312,
          "center_y": 180.6927947998047,
          "radius_x": 157.35154724121094,
          "radius_y": 233.4484100341797,
          "rotation": 96.19450378417969,
          "slice_index": 444,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.347884"
        }
      ],
      "brush_strokes": []
    },
    "x_445": {
      "slice_index": 445,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e2692222",
          "center_x": 227.52554321289062,
          "center_y": 182.1874237060547,
          "radius_x": 158.90199279785156,
          "radius_y": 233.72752380371094,
          "rotation": 95.72261810302734,
          "slice_index": 445,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.364924"
        }
      ],
      "brush_strokes": []
    },
    "x_446": {
      "slice_index": 446,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f6b27454",
          "center_x": 224.65733337402344,
          "center_y": 177.98028564453125,
          "radius_x": 155.7932891845703,
          "radius_y": 233.16297912597656,
          "rotation": 93.59341430664062,
          "slice_index": 446,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.380746"
        }
      ],
      "brush_strokes": []
    },
    "x_447": {
      "slice_index": 447,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_627206c3",
          "center_x": 225.49850463867188,
          "center_y": 178.96115112304688,
          "radius_x": 156.4341583251953,
          "radius_y": 232.3349151611328,
          "rotation": 94.1900405883789,
          "slice_index": 447,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.398302"
        }
      ],
      "brush_strokes": []
    },
    "x_448": {
      "slice_index": 448,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_907de5fe",
          "center_x": 227.56185913085938,
          "center_y": 181.46705627441406,
          "radius_x": 158.67005920410156,
          "radius_y": 232.3060302734375,
          "rotation": 95.20040893554688,
          "slice_index": 448,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.416370"
        }
      ],
      "brush_strokes": []
    },
    "x_449": {
      "slice_index": 449,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1f16d67b",
          "center_x": 226.63189697265625,
          "center_y": 180.55865478515625,
          "radius_x": 157.79148864746094,
          "radius_y": 232.52297973632812,
          "rotation": 94.51581573486328,
          "slice_index": 449,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.434269"
        }
      ],
      "brush_strokes": []
    },
    "x_450": {
      "slice_index": 450,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0f4e2e75",
          "center_x": 227.29136657714844,
          "center_y": 181.70970153808594,
          "radius_x": 158.66842651367188,
          "radius_y": 232.5031280517578,
          "rotation": 94.6533203125,
          "slice_index": 450,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.452174"
        }
      ],
      "brush_strokes": []
    },
    "x_451": {
      "slice_index": 451,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9c6bd1e6",
          "center_x": 225.4158935546875,
          "center_y": 180.89268493652344,
          "radius_x": 156.65252685546875,
          "radius_y": 232.59349060058594,
          "rotation": 94.00782775878906,
          "slice_index": 451,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.468438"
        }
      ],
      "brush_strokes": []
    },
    "x_452": {
      "slice_index": 452,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_495eac2e",
          "center_x": 226.1643829345703,
          "center_y": 181.74815368652344,
          "radius_x": 157.11090087890625,
          "radius_y": 232.80548095703125,
          "rotation": 94.58943939208984,
          "slice_index": 452,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.486007"
        }
      ],
      "brush_strokes": []
    },
    "x_453": {
      "slice_index": 453,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a89a8c97",
          "center_x": 226.37034606933594,
          "center_y": 180.5247039794922,
          "radius_x": 157.17202758789062,
          "radius_y": 233.39761352539062,
          "rotation": 94.53207397460938,
          "slice_index": 453,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.502766"
        }
      ],
      "brush_strokes": []
    },
    "x_454": {
      "slice_index": 454,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ee47058f",
          "center_x": 226.65322875976562,
          "center_y": 180.3594970703125,
          "radius_x": 156.92137145996094,
          "radius_y": 232.98597717285156,
          "rotation": 95.33724975585938,
          "slice_index": 454,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.519949"
        }
      ],
      "brush_strokes": []
    },
    "x_455": {
      "slice_index": 455,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_152a941c",
          "center_x": 224.99771118164062,
          "center_y": 178.65390014648438,
          "radius_x": 156.27267456054688,
          "radius_y": 232.5628662109375,
          "rotation": 94.17578125,
          "slice_index": 455,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.536913"
        }
      ],
      "brush_strokes": []
    },
    "x_456": {
      "slice_index": 456,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f90492ff",
          "center_x": 224.53700256347656,
          "center_y": 178.8472900390625,
          "radius_x": 155.51234436035156,
          "radius_y": 232.90960693359375,
          "rotation": 94.01553344726562,
          "slice_index": 456,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.554134"
        }
      ],
      "brush_strokes": []
    },
    "x_457": {
      "slice_index": 457,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dbc730b8",
          "center_x": 225.79611206054688,
          "center_y": 179.44705200195312,
          "radius_x": 156.15673828125,
          "radius_y": 232.87269592285156,
          "rotation": 94.55347442626953,
          "slice_index": 457,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.572190"
        }
      ],
      "brush_strokes": []
    },
    "x_458": {
      "slice_index": 458,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5bc5f077",
          "center_x": 226.77870178222656,
          "center_y": 180.6137237548828,
          "radius_x": 156.46742248535156,
          "radius_y": 233.29910278320312,
          "rotation": 95.36421966552734,
          "slice_index": 458,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.588837"
        }
      ],
      "brush_strokes": []
    },
    "x_459": {
      "slice_index": 459,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_69a36dc6",
          "center_x": 226.63011169433594,
          "center_y": 181.69131469726562,
          "radius_x": 157.79852294921875,
          "radius_y": 232.87786865234375,
          "rotation": 95.15106201171875,
          "slice_index": 459,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.606180"
        }
      ],
      "brush_strokes": []
    },
    "x_460": {
      "slice_index": 460,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0819b794",
          "center_x": 227.041748046875,
          "center_y": 181.306884765625,
          "radius_x": 157.62579345703125,
          "radius_y": 233.83746337890625,
          "rotation": 95.50880432128906,
          "slice_index": 460,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.623242"
        }
      ],
      "brush_strokes": []
    },
    "x_461": {
      "slice_index": 461,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_556761de",
          "center_x": 226.7704315185547,
          "center_y": 180.62213134765625,
          "radius_x": 157.48629760742188,
          "radius_y": 234.03594970703125,
          "rotation": 95.46399688720703,
          "slice_index": 461,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.639754"
        }
      ],
      "brush_strokes": []
    },
    "x_462": {
      "slice_index": 462,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d857e547",
          "center_x": 226.70445251464844,
          "center_y": 180.70053100585938,
          "radius_x": 157.88380432128906,
          "radius_y": 233.73150634765625,
          "rotation": 95.51837921142578,
          "slice_index": 462,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.657666"
        }
      ],
      "brush_strokes": []
    },
    "x_463": {
      "slice_index": 463,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_74ece664",
          "center_x": 226.9990692138672,
          "center_y": 180.67726135253906,
          "radius_x": 159.12179565429688,
          "radius_y": 232.36802673339844,
          "rotation": 95.38265228271484,
          "slice_index": 463,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.675193"
        }
      ],
      "brush_strokes": []
    },
    "x_464": {
      "slice_index": 464,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_292cb887",
          "center_x": 226.48765563964844,
          "center_y": 179.94239807128906,
          "radius_x": 157.5989532470703,
          "radius_y": 232.8148193359375,
          "rotation": 95.10411071777344,
          "slice_index": 464,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.692234"
        }
      ],
      "brush_strokes": []
    },
    "x_465": {
      "slice_index": 465,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0116d9e2",
          "center_x": 226.37648010253906,
          "center_y": 179.27598571777344,
          "radius_x": 159.04486083984375,
          "radius_y": 231.52976989746094,
          "rotation": 94.2607192993164,
          "slice_index": 465,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.708761"
        }
      ],
      "brush_strokes": []
    },
    "x_466": {
      "slice_index": 466,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f332ba08",
          "center_x": 226.26028442382812,
          "center_y": 178.0640106201172,
          "radius_x": 159.2432403564453,
          "radius_y": 231.0775604248047,
          "rotation": 93.63726806640625,
          "slice_index": 466,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.726075"
        }
      ],
      "brush_strokes": []
    },
    "x_467": {
      "slice_index": 467,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c43f94b1",
          "center_x": 225.509033203125,
          "center_y": 177.52383422851562,
          "radius_x": 158.73468017578125,
          "radius_y": 230.92105102539062,
          "rotation": 93.18270874023438,
          "slice_index": 467,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.743623"
        }
      ],
      "brush_strokes": []
    },
    "x_468": {
      "slice_index": 468,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c1a0eca8",
          "center_x": 226.17129516601562,
          "center_y": 179.22482299804688,
          "radius_x": 158.10665893554688,
          "radius_y": 232.80970764160156,
          "rotation": 94.67918395996094,
          "slice_index": 468,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.759984"
        }
      ],
      "brush_strokes": []
    },
    "x_469": {
      "slice_index": 469,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_5cc710ec",
          "center_x": 227.42242431640625,
          "center_y": 180.90335083007812,
          "radius_x": 159.87745666503906,
          "radius_y": 233.15371704101562,
          "rotation": 95.6791000366211,
          "slice_index": 469,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.776566"
        }
      ],
      "brush_strokes": []
    },
    "x_470": {
      "slice_index": 470,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_60108a7c",
          "center_x": 226.8137664794922,
          "center_y": 180.33619689941406,
          "radius_x": 158.96141052246094,
          "radius_y": 232.82962036132812,
          "rotation": 95.22775268554688,
          "slice_index": 470,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.792959"
        }
      ],
      "brush_strokes": []
    },
    "x_471": {
      "slice_index": 471,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_233484ca",
          "center_x": 225.92605590820312,
          "center_y": 179.83106994628906,
          "radius_x": 159.72137451171875,
          "radius_y": 231.8723907470703,
          "rotation": 94.60838317871094,
          "slice_index": 471,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.810001"
        }
      ],
      "brush_strokes": []
    },
    "x_472": {
      "slice_index": 472,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_e95d7acc",
          "center_x": 226.7430877685547,
          "center_y": 180.89447021484375,
          "radius_x": 160.2558135986328,
          "radius_y": 232.0044403076172,
          "rotation": 95.12877655029297,
          "slice_index": 472,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.828571"
        }
      ],
      "brush_strokes": []
    },
    "x_473": {
      "slice_index": 473,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_30b483df",
          "center_x": 224.3380126953125,
          "center_y": 177.18328857421875,
          "radius_x": 157.4643096923828,
          "radius_y": 231.50254821777344,
          "rotation": 93.21231079101562,
          "slice_index": 473,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.845002"
        }
      ],
      "brush_strokes": []
    },
    "x_474": {
      "slice_index": 474,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_30c9320a",
          "center_x": 225.09039306640625,
          "center_y": 178.5567626953125,
          "radius_x": 158.3296356201172,
          "radius_y": 230.68692016601562,
          "rotation": 93.69189453125,
          "slice_index": 474,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.861998"
        }
      ],
      "brush_strokes": []
    },
    "x_475": {
      "slice_index": 475,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8195ea00",
          "center_x": 223.4702606201172,
          "center_y": 175.42822265625,
          "radius_x": 156.45489501953125,
          "radius_y": 230.81800842285156,
          "rotation": 92.32156372070312,
          "slice_index": 475,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.880263"
        }
      ],
      "brush_strokes": []
    },
    "x_476": {
      "slice_index": 476,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_edc1ea1e",
          "center_x": 224.15672302246094,
          "center_y": 178.72373962402344,
          "radius_x": 158.25816345214844,
          "radius_y": 231.147705078125,
          "rotation": 93.38192749023438,
          "slice_index": 476,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.896083"
        }
      ],
      "brush_strokes": []
    },
    "x_477": {
      "slice_index": 477,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_56b46c8f",
          "center_x": 225.39651489257812,
          "center_y": 178.33953857421875,
          "radius_x": 158.31704711914062,
          "radius_y": 230.93115234375,
          "rotation": 93.33486938476562,
          "slice_index": 477,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.913946"
        }
      ],
      "brush_strokes": []
    },
    "x_478": {
      "slice_index": 478,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_119a3629",
          "center_x": 224.61512756347656,
          "center_y": 178.03466796875,
          "radius_x": 157.9864501953125,
          "radius_y": 230.49107360839844,
          "rotation": 93.03337097167969,
          "slice_index": 478,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.931039"
        }
      ],
      "brush_strokes": []
    },
    "x_479": {
      "slice_index": 479,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6185d41f",
          "center_x": 223.28326416015625,
          "center_y": 176.55166625976562,
          "radius_x": 157.54354858398438,
          "radius_y": 230.0771484375,
          "rotation": 92.37113189697266,
          "slice_index": 479,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.949331"
        }
      ],
      "brush_strokes": []
    },
    "x_480": {
      "slice_index": 480,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1e9625a0",
          "center_x": 224.85340881347656,
          "center_y": 178.79197692871094,
          "radius_x": 157.33900451660156,
          "radius_y": 232.0801239013672,
          "rotation": 93.95508575439453,
          "slice_index": 480,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.966340"
        }
      ],
      "brush_strokes": []
    },
    "x_481": {
      "slice_index": 481,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cf8269db",
          "center_x": 225.15802001953125,
          "center_y": 178.76844787597656,
          "radius_x": 157.86932373046875,
          "radius_y": 231.61378479003906,
          "rotation": 94.05679321289062,
          "slice_index": 481,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.982419"
        }
      ],
      "brush_strokes": []
    },
    "x_482": {
      "slice_index": 482,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_53740dca",
          "center_x": 226.21214294433594,
          "center_y": 179.55596923828125,
          "radius_x": 158.4765167236328,
          "radius_y": 232.39093017578125,
          "rotation": 94.50215148925781,
          "slice_index": 482,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:56.998855"
        }
      ],
      "brush_strokes": []
    },
    "x_483": {
      "slice_index": 483,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cb9b1c0a",
          "center_x": 225.2413330078125,
          "center_y": 178.64935302734375,
          "radius_x": 158.2917938232422,
          "radius_y": 232.5627899169922,
          "rotation": 93.77156066894531,
          "slice_index": 483,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.016428"
        }
      ],
      "brush_strokes": []
    },
    "x_484": {
      "slice_index": 484,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b641af17",
          "center_x": 225.3814239501953,
          "center_y": 179.0236358642578,
          "radius_x": 158.15830993652344,
          "radius_y": 232.8218994140625,
          "rotation": 93.81131744384766,
          "slice_index": 484,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.032970"
        }
      ],
      "brush_strokes": []
    },
    "x_485": {
      "slice_index": 485,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8febbdd3",
          "center_x": 222.67242431640625,
          "center_y": 176.12380981445312,
          "radius_x": 157.18849182128906,
          "radius_y": 230.6971435546875,
          "rotation": 92.17779541015625,
          "slice_index": 485,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.050808"
        }
      ],
      "brush_strokes": []
    },
    "x_486": {
      "slice_index": 486,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ddff9402",
          "center_x": 226.94656372070312,
          "center_y": 178.7487030029297,
          "radius_x": 159.92074584960938,
          "radius_y": 233.06570434570312,
          "rotation": 94.42717742919922,
          "slice_index": 486,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.067301"
        }
      ],
      "brush_strokes": []
    },
    "x_487": {
      "slice_index": 487,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6f265526",
          "center_x": 228.30455017089844,
          "center_y": 180.245361328125,
          "radius_x": 160.78335571289062,
          "radius_y": 233.0166473388672,
          "rotation": 95.000244140625,
          "slice_index": 487,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.083022"
        }
      ],
      "brush_strokes": []
    },
    "x_488": {
      "slice_index": 488,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ff8aa0b5",
          "center_x": 226.41513061523438,
          "center_y": 179.38304138183594,
          "radius_x": 158.76023864746094,
          "radius_y": 232.56785583496094,
          "rotation": 94.43689727783203,
          "slice_index": 488,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.100810"
        }
      ],
      "brush_strokes": []
    },
    "x_489": {
      "slice_index": 489,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0a2c8781",
          "center_x": 227.1688690185547,
          "center_y": 179.82200622558594,
          "radius_x": 158.4541015625,
          "radius_y": 233.25096130371094,
          "rotation": 95.02310943603516,
          "slice_index": 489,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.118344"
        }
      ],
      "brush_strokes": []
    },
    "x_490": {
      "slice_index": 490,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_17b77403",
          "center_x": 226.2222900390625,
          "center_y": 179.1844024658203,
          "radius_x": 158.7646484375,
          "radius_y": 232.18276977539062,
          "rotation": 94.24803924560547,
          "slice_index": 490,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.135887"
        }
      ],
      "brush_strokes": []
    },
    "x_491": {
      "slice_index": 491,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_18002f28",
          "center_x": 226.38706970214844,
          "center_y": 180.49525451660156,
          "radius_x": 160.88645935058594,
          "radius_y": 231.57359313964844,
          "rotation": 94.28885650634766,
          "slice_index": 491,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.152387"
        }
      ],
      "brush_strokes": []
    },
    "x_492": {
      "slice_index": 492,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_dff7103e",
          "center_x": 226.4786376953125,
          "center_y": 179.57615661621094,
          "radius_x": 160.5923614501953,
          "radius_y": 231.54881286621094,
          "rotation": 94.55160522460938,
          "slice_index": 492,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.168473"
        }
      ],
      "brush_strokes": []
    },
    "x_493": {
      "slice_index": 493,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_72dce284",
          "center_x": 226.1766815185547,
          "center_y": 179.41946411132812,
          "radius_x": 160.90061950683594,
          "radius_y": 231.48760986328125,
          "rotation": 94.470703125,
          "slice_index": 493,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.185511"
        }
      ],
      "brush_strokes": []
    },
    "x_494": {
      "slice_index": 494,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1a287d6b",
          "center_x": 225.7244873046875,
          "center_y": 178.878173828125,
          "radius_x": 158.98590087890625,
          "radius_y": 231.61573791503906,
          "rotation": 94.0324478149414,
          "slice_index": 494,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.203606"
        }
      ],
      "brush_strokes": []
    },
    "x_495": {
      "slice_index": 495,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4f17087a",
          "center_x": 225.7086944580078,
          "center_y": 179.740966796875,
          "radius_x": 159.44854736328125,
          "radius_y": 232.22137451171875,
          "rotation": 94.69348907470703,
          "slice_index": 495,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.220902"
        }
      ],
      "brush_strokes": []
    },
    "x_496": {
      "slice_index": 496,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a8d6c9c5",
          "center_x": 225.89016723632812,
          "center_y": 179.94143676757812,
          "radius_x": 159.673828125,
          "radius_y": 232.04551696777344,
          "rotation": 94.90913391113281,
          "slice_index": 496,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.238057"
        }
      ],
      "brush_strokes": []
    },
    "x_497": {
      "slice_index": 497,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2f0130b8",
          "center_x": 225.709228515625,
          "center_y": 180.07955932617188,
          "radius_x": 160.89007568359375,
          "radius_y": 231.01229858398438,
          "rotation": 94.23099517822266,
          "slice_index": 497,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.254902"
        }
      ],
      "brush_strokes": []
    },
    "x_498": {
      "slice_index": 498,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_536f57c0",
          "center_x": 226.08599853515625,
          "center_y": 180.5504608154297,
          "radius_x": 161.17050170898438,
          "radius_y": 231.45004272460938,
          "rotation": 94.46088409423828,
          "slice_index": 498,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.270847"
        }
      ],
      "brush_strokes": []
    },
    "x_499": {
      "slice_index": 499,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6f2a96b1",
          "center_x": 226.9503173828125,
          "center_y": 180.48965454101562,
          "radius_x": 161.2057647705078,
          "radius_y": 231.51486206054688,
          "rotation": 94.69795227050781,
          "slice_index": 499,
          "axis": "x",
          "vessel_id": null,
          "created_at": "2025-12-10T14:34:57.286994"
        }
      ],
      "brush_strokes": []
    }
  },
  "undo_stack": [
    {
      "action": "update_layer",
      "layer_key": "x_249",
      "old_data": {
        "slice_index": 249,
        "axis": "x",
        "ellipses": [
          {
            "id": "auto_f3e92bc3",
            "center_x": 248.15158081054688,
            "center_y": 188.08570861816406,
            "radius_x": 128.65516662597656,
            "radius_y": 233.68893432617188,
            "rotation": 92.46410369873047,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.116622"
          },
          {
            "id": "auto_1f4bd010",
            "center_x": 247.1956787109375,
            "center_y": 199.76414489746094,
            "radius_x": 3.091808795928955,
            "radius_y": 4.971115589141846,
            "rotation": 1.0547198057174683,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.118646"
          },
          {
            "id": "auto_4333c1f0",
            "center_x": 235.50289916992188,
            "center_y": 217.47122192382812,
            "radius_x": 2.9110100269317627,
            "radius_y": 4.333542823791504,
            "rotation": 130.29055786132812,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.119620"
          },
          {
            "id": "auto_99462e36",
            "center_x": 248.89688110351562,
            "center_y": 220.9669189453125,
            "radius_x": 1.9997483491897583,
            "radius_y": 3.2073891162872314,
            "rotation": 171.09918212890625,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.120626"
          },
          {
            "id": "auto_af8d3aed",
            "center_x": 230.93722534179688,
            "center_y": 241.1560516357422,
            "radius_x": 2.0481460094451904,
            "radius_y": 2.722074508666992,
            "rotation": 141.80186462402344,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.122655"
          },
          {
            "id": "auto_57811b10",
            "center_x": 3.0058345794677734,
            "center_y": 279.4148254394531,
            "radius_x": 2.437013626098633,
            "radius_y": 6.339483737945557,
            "rotation": 4.531608581542969,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.124652"
          },
          {
            "id": "auto_5b594124",
            "center_x": 217.4421844482422,
            "center_y": 292.67791748046875,
            "radius_x": 6.9130754470825195,
            "radius_y": 8.461715698242188,
            "rotation": 145.4633331298828,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.125716"
          },
          {
            "id": "auto_e8412fed",
            "center_x": 255.5,
            "center_y": 294.0,
            "radius_x": 1.5185229778289795,
            "radius_y": 2.6711513996124268,
            "rotation": 13.709689140319824,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.127760"
          },
          {
            "id": "auto_e7fea7d4",
            "center_x": 300.1543273925781,
            "center_y": 295.7666015625,
            "radius_x": 3.309530019760132,
            "radius_y": 5.8830084800720215,
            "rotation": 126.35856628417969,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.128770"
          },
          {
            "id": "auto_6cdc1403",
            "center_x": 383.3621520996094,
            "center_y": 296.5433654785156,
            "radius_x": 2.479849338531494,
            "radius_y": 4.51409912109375,
            "rotation": 58.809242248535156,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.132732"
          },
          {
            "id": "auto_e107bebe",
            "center_x": 397.9291076660156,
            "center_y": 324.893310546875,
            "radius_x": 10.259565353393555,
            "radius_y": 19.990774154663086,
            "rotation": 166.41409301757812,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.140306"
          },
          {
            "id": "auto_948145e9",
            "center_x": 223.54812622070312,
            "center_y": 307.23284912109375,
            "radius_x": 1.5209828615188599,
            "radius_y": 3.917186737060547,
            "rotation": 45.30094528198242,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.143409"
          },
          {
            "id": "auto_88905e60",
            "center_x": 376.6560363769531,
            "center_y": 312.6483459472656,
            "radius_x": 2.805417537689209,
            "radius_y": 7.438404083251953,
            "rotation": 134.98768615722656,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.152393"
          },
          {
            "id": "auto_6168ae1a",
            "center_x": 292.3922119140625,
            "center_y": 315.453125,
            "radius_x": 3.1567134857177734,
            "radius_y": 4.766417026519775,
            "rotation": 31.456113815307617,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.157076"
          },
          {
            "id": "auto_e10d1f76",
            "center_x": 357.823486328125,
            "center_y": 330.1923828125,
            "radius_x": 13.61129379272461,
            "radius_y": 16.63905143737793,
            "rotation": 42.34423065185547,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.160079"
          },
          {
            "id": "auto_7473b46e",
            "center_x": 171.6698455810547,
            "center_y": 321.17828369140625,
            "radius_x": 2.6026058197021484,
            "radius_y": 6.267845630645752,
            "rotation": 156.85757446289062,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.165052"
          },
          {
            "id": "auto_33a379ae",
            "center_x": 419.7711486816406,
            "center_y": 319.861328125,
            "radius_x": 4.083816051483154,
            "radius_y": 7.263009071350098,
            "rotation": 78.48270416259766,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.168096"
          },
          {
            "id": "auto_c5afe2dc",
            "center_x": 22.859127044677734,
            "center_y": 326.0493469238281,
            "radius_x": 3.523721933364868,
            "radius_y": 6.1828508377075195,
            "rotation": 38.192657470703125,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.173055"
          },
          {
            "id": "auto_d6e857a1",
            "center_x": 118.9794921875,
            "center_y": 329.739990234375,
            "radius_x": 3.2316386699676514,
            "radius_y": 6.405859470367432,
            "rotation": 7.694828987121582,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.176075"
          },
          {
            "id": "auto_3787722b",
            "center_x": 88.02000427246094,
            "center_y": 329.0783386230469,
            "radius_x": 4.541500568389893,
            "radius_y": 6.6939849853515625,
            "rotation": 89.74368286132812,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.179080"
          },
          {
            "id": "auto_514cff77",
            "center_x": 104.00808715820312,
            "center_y": 326.70147705078125,
            "radius_x": 1.8517178297042847,
            "radius_y": 3.10231351852417,
            "rotation": 39.73229217529297,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.180072"
          },
          {
            "id": "auto_67e82ffd",
            "center_x": 278.53887939453125,
            "center_y": 333.4655456542969,
            "radius_x": 3.4034011363983154,
            "radius_y": 7.286600112915039,
            "rotation": 1.4387013912200928,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.182043"
          },
          {
            "id": "auto_4899900a",
            "center_x": 431.40338134765625,
            "center_y": 331.12493896484375,
            "radius_x": 2.750357151031494,
            "radius_y": 6.252671718597412,
            "rotation": 24.618574142456055,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.184071"
          },
          {
            "id": "auto_bc13b173",
            "center_x": 417.8872375488281,
            "center_y": 335.0592346191406,
            "radius_x": 4.526283264160156,
            "radius_y": 7.121091842651367,
            "rotation": 17.852581024169922,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.185111"
          },
          {
            "id": "auto_f2d8018a",
            "center_x": 177.25743103027344,
            "center_y": 334.876708984375,
            "radius_x": 5.030592441558838,
            "radius_y": 5.78075647354126,
            "rotation": 113.15230560302734,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.188057"
          },
          {
            "id": "auto_d7cecd58",
            "center_x": 302.3977355957031,
            "center_y": 339.08026123046875,
            "radius_x": 7.066741943359375,
            "radius_y": 8.711181640625,
            "rotation": 42.757266998291016,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.194121"
          },
          {
            "id": "auto_82c25142",
            "center_x": 150.99412536621094,
            "center_y": 336.2051086425781,
            "radius_x": 2.0379860401153564,
            "radius_y": 3.339007616043091,
            "rotation": 178.48976135253906,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.195125"
          },
          {
            "id": "auto_4383143d",
            "center_x": 198.8387451171875,
            "center_y": 338.8925476074219,
            "radius_x": 3.1086442470550537,
            "radius_y": 8.474030494689941,
            "rotation": 127.13192749023438,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.196124"
          },
          {
            "id": "auto_865eab81",
            "center_x": 12.136853218078613,
            "center_y": 339.1907043457031,
            "radius_x": 3.578331232070923,
            "radius_y": 6.466348648071289,
            "rotation": 42.056453704833984,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.198289"
          },
          {
            "id": "auto_f701f22b",
            "center_x": 470.89166259765625,
            "center_y": 337.2559814453125,
            "radius_x": 2.5053110122680664,
            "radius_y": 3.8298637866973877,
            "rotation": 100.47621154785156,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.199160"
          },
          {
            "id": "auto_333bcc1d",
            "center_x": 50.33221435546875,
            "center_y": 343.9289855957031,
            "radius_x": 5.034102916717529,
            "radius_y": 7.377481937408447,
            "rotation": 54.799591064453125,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.200121"
          },
          {
            "id": "auto_d4019dcc",
            "center_x": 101.21269226074219,
            "center_y": 339.5042724609375,
            "radius_x": 2.216134548187256,
            "radius_y": 3.847200393676758,
            "rotation": 112.5547103881836,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.202123"
          },
          {
            "id": "auto_2e606a23",
            "center_x": 110.98773956298828,
            "center_y": 343.6748962402344,
            "radius_x": 2.7209486961364746,
            "radius_y": 4.029385089874268,
            "rotation": 7.6881513595581055,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.204132"
          },
          {
            "id": "auto_359c729b",
            "center_x": 20.211814880371094,
            "center_y": 345.37530517578125,
            "radius_x": 2.190140962600708,
            "radius_y": 3.9539060592651367,
            "rotation": 31.594993591308594,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.205714"
          },
          {
            "id": "auto_3013f4a6",
            "center_x": 90.31208801269531,
            "center_y": 343.0888366699219,
            "radius_x": 2.8229868412017822,
            "radius_y": 4.090603828430176,
            "rotation": 88.50515747070312,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.206802"
          },
          {
            "id": "auto_7bcf2461",
            "center_x": 143.8983154296875,
            "center_y": 344.06732177734375,
            "radius_x": 2.2857937812805176,
            "radius_y": 4.035345077514648,
            "rotation": 123.04951477050781,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.208801"
          },
          {
            "id": "auto_228d7d01",
            "center_x": 436.30438232421875,
            "center_y": 344.1734924316406,
            "radius_x": 3.693016529083252,
            "radius_y": 4.717811584472656,
            "rotation": 136.58834838867188,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.210803"
          },
          {
            "id": "auto_680f3b5c",
            "center_x": 492.6902160644531,
            "center_y": 344.767822265625,
            "radius_x": 2.8047983646392822,
            "radius_y": 5.769140243530273,
            "rotation": 61.747032165527344,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.211777"
          },
          {
            "id": "auto_76671214",
            "center_x": 158.627197265625,
            "center_y": 346.4515075683594,
            "radius_x": 2.78825306892395,
            "radius_y": 5.045507907867432,
            "rotation": 93.25540924072266,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.214732"
          },
          {
            "id": "auto_44e438fd",
            "center_x": 173.9480743408203,
            "center_y": 345.09039306640625,
            "radius_x": 2.5755677223205566,
            "radius_y": 5.937477111816406,
            "rotation": 74.35358428955078,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.215802"
          },
          {
            "id": "auto_13bfd882",
            "center_x": 211.10934448242188,
            "center_y": 345.367431640625,
            "radius_x": 1.7025245428085327,
            "radius_y": 2.5213592052459717,
            "rotation": 117.89124298095703,
            "slice_index": 249,
            "axis": "x",
            "vessel_id": null,
            "created_at": "2025-12-10T01:05:35.216809"
          }
        ],
        "brush_strokes": []
      }
    }
  ],
  "redo_stack": []
}
</file>

<file path="backend/data/annotations/ann_20251210_143954_0057e27c/project.json">
{
  "id": "ann_20251210_143954_0057e27c",
  "volume_id": "vol_20251205_184159_1c530d6d",
  "name": "项目_7.oct-Stru.dcm_1765348794864",
  "created_at": "2025-12-10T14:39:54.867585",
  "modified_at": "2025-12-11T04:05:52.185178",
  "layers": {
    "y_0": {
      "slice_index": 0,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7e690f67",
          "center_x": 249.12432861328125,
          "center_y": 249.2230224609375,
          "radius_x": 240.8388214111328,
          "radius_y": 243.0471954345703,
          "rotation": 88.73217010498047,
          "slice_index": 0,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:35.713650"
        }
      ],
      "brush_strokes": []
    },
    "y_1": {
      "slice_index": 1,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ffafd642",
          "center_x": 248.58778381347656,
          "center_y": 248.89544677734375,
          "radius_x": 240.39718627929688,
          "radius_y": 243.53651428222656,
          "rotation": 84.91290283203125,
          "slice_index": 1,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:35.745650"
        }
      ],
      "brush_strokes": []
    },
    "y_2": {
      "slice_index": 2,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_fd69a563",
          "center_x": 249.02476501464844,
          "center_y": 249.01832580566406,
          "radius_x": 240.33230590820312,
          "radius_y": 243.62014770507812,
          "rotation": 85.52474212646484,
          "slice_index": 2,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:35.782660"
        }
      ],
      "brush_strokes": []
    },
    "y_3": {
      "slice_index": 3,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_136b007b",
          "center_x": 249.0237579345703,
          "center_y": 249.270263671875,
          "radius_x": 240.45803833007812,
          "radius_y": 243.87977600097656,
          "rotation": 89.77685546875,
          "slice_index": 3,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:35.812095"
        }
      ],
      "brush_strokes": []
    },
    "y_4": {
      "slice_index": 4,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e3892357",
          "center_x": 249.3285675048828,
          "center_y": 249.25848388671875,
          "radius_x": 240.84095764160156,
          "radius_y": 243.06637573242188,
          "rotation": 88.95533752441406,
          "slice_index": 4,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:35.844096"
        }
      ],
      "brush_strokes": []
    },
    "y_5": {
      "slice_index": 5,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2bf9bf03",
          "center_x": 249.07147216796875,
          "center_y": 249.17884826660156,
          "radius_x": 240.82688903808594,
          "radius_y": 243.3793182373047,
          "rotation": 90.4315185546875,
          "slice_index": 5,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:35.876095"
        }
      ],
      "brush_strokes": []
    },
    "y_6": {
      "slice_index": 6,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7eddff4c",
          "center_x": 249.2333526611328,
          "center_y": 249.40899658203125,
          "radius_x": 241.12840270996094,
          "radius_y": 242.6837921142578,
          "rotation": 91.08885955810547,
          "slice_index": 6,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:35.911632"
        }
      ],
      "brush_strokes": []
    },
    "y_7": {
      "slice_index": 7,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_85f7d01b",
          "center_x": 249.17933654785156,
          "center_y": 249.23141479492188,
          "radius_x": 241.24244689941406,
          "radius_y": 242.5738525390625,
          "rotation": 92.19493103027344,
          "slice_index": 7,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:35.940700"
        }
      ],
      "brush_strokes": []
    },
    "y_8": {
      "slice_index": 8,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_06e5484e",
          "center_x": 249.25181579589844,
          "center_y": 249.37384033203125,
          "radius_x": 241.1570587158203,
          "radius_y": 242.47848510742188,
          "rotation": 89.9654312133789,
          "slice_index": 8,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:35.969701"
        }
      ],
      "brush_strokes": []
    },
    "y_9": {
      "slice_index": 9,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1f6b3d54",
          "center_x": 249.25332641601562,
          "center_y": 249.39857482910156,
          "radius_x": 241.26406860351562,
          "radius_y": 242.1147918701172,
          "rotation": 86.38756561279297,
          "slice_index": 9,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.001729"
        }
      ],
      "brush_strokes": []
    },
    "y_10": {
      "slice_index": 10,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e2287f22",
          "center_x": 249.27931213378906,
          "center_y": 249.37051391601562,
          "radius_x": 241.3713836669922,
          "radius_y": 242.2527313232422,
          "rotation": 90.06329345703125,
          "slice_index": 10,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.037248"
        }
      ],
      "brush_strokes": []
    },
    "y_11": {
      "slice_index": 11,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7db3ad0b",
          "center_x": 249.28140258789062,
          "center_y": 249.2830810546875,
          "radius_x": 241.3124237060547,
          "radius_y": 242.26419067382812,
          "rotation": 84.59878540039062,
          "slice_index": 11,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.072147"
        }
      ],
      "brush_strokes": []
    },
    "y_12": {
      "slice_index": 12,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_182bc72e",
          "center_x": 249.18800354003906,
          "center_y": 249.33914184570312,
          "radius_x": 241.28244018554688,
          "radius_y": 242.07179260253906,
          "rotation": 83.15420532226562,
          "slice_index": 12,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.107887"
        }
      ],
      "brush_strokes": []
    },
    "y_13": {
      "slice_index": 13,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_91b5c247",
          "center_x": 248.91896057128906,
          "center_y": 249.20050048828125,
          "radius_x": 241.1924285888672,
          "radius_y": 242.0235137939453,
          "rotation": 76.62062072753906,
          "slice_index": 13,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.138655"
        }
      ],
      "brush_strokes": []
    },
    "y_14": {
      "slice_index": 14,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1a7e4a5d",
          "center_x": 249.01959228515625,
          "center_y": 249.4886932373047,
          "radius_x": 241.10755920410156,
          "radius_y": 242.41360473632812,
          "rotation": 89.64215850830078,
          "slice_index": 14,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.169654"
        }
      ],
      "brush_strokes": []
    },
    "y_15": {
      "slice_index": 15,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_32ede82c",
          "center_x": 248.9761199951172,
          "center_y": 249.2222900390625,
          "radius_x": 241.31297302246094,
          "radius_y": 242.11566162109375,
          "rotation": 83.50382232666016,
          "slice_index": 15,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.199658"
        }
      ],
      "brush_strokes": []
    },
    "y_16": {
      "slice_index": 16,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5af423dc",
          "center_x": 248.94631958007812,
          "center_y": 249.35745239257812,
          "radius_x": 241.22789001464844,
          "radius_y": 242.126220703125,
          "rotation": 80.42572021484375,
          "slice_index": 16,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.230165"
        }
      ],
      "brush_strokes": []
    },
    "y_17": {
      "slice_index": 17,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_63af27ee",
          "center_x": 249.221435546875,
          "center_y": 249.43118286132812,
          "radius_x": 241.39747619628906,
          "radius_y": 241.97044372558594,
          "rotation": 86.59811401367188,
          "slice_index": 17,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.260165"
        }
      ],
      "brush_strokes": []
    },
    "y_18": {
      "slice_index": 18,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_bc1a54a6",
          "center_x": 249.12088012695312,
          "center_y": 249.34213256835938,
          "radius_x": 241.03053283691406,
          "radius_y": 242.4469757080078,
          "rotation": 87.29998779296875,
          "slice_index": 18,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.288342"
        }
      ],
      "brush_strokes": []
    },
    "y_19": {
      "slice_index": 19,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_fe8fdc01",
          "center_x": 249.1704864501953,
          "center_y": 249.33399963378906,
          "radius_x": 241.2666015625,
          "radius_y": 241.92115783691406,
          "rotation": 73.12326049804688,
          "slice_index": 19,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.318894"
        }
      ],
      "brush_strokes": []
    },
    "y_20": {
      "slice_index": 20,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_403daa75",
          "center_x": 249.21334838867188,
          "center_y": 249.4764862060547,
          "radius_x": 241.23204040527344,
          "radius_y": 242.10568237304688,
          "rotation": 85.89019775390625,
          "slice_index": 20,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.356897"
        }
      ],
      "brush_strokes": []
    },
    "y_21": {
      "slice_index": 21,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e4341eab",
          "center_x": 249.08778381347656,
          "center_y": 249.20199584960938,
          "radius_x": 241.1790771484375,
          "radius_y": 242.35745239257812,
          "rotation": 77.29801177978516,
          "slice_index": 21,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.387900"
        }
      ],
      "brush_strokes": []
    },
    "y_22": {
      "slice_index": 22,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9f626e4c",
          "center_x": 249.08119201660156,
          "center_y": 249.3101348876953,
          "radius_x": 241.32591247558594,
          "radius_y": 242.25425720214844,
          "rotation": 88.23200225830078,
          "slice_index": 22,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.419495"
        }
      ],
      "brush_strokes": []
    },
    "y_23": {
      "slice_index": 23,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e02dc606",
          "center_x": 249.2286376953125,
          "center_y": 249.31341552734375,
          "radius_x": 241.2193145751953,
          "radius_y": 242.33169555664062,
          "rotation": 84.32149505615234,
          "slice_index": 23,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.456580"
        }
      ],
      "brush_strokes": []
    },
    "y_24": {
      "slice_index": 24,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c5fccc84",
          "center_x": 249.32882690429688,
          "center_y": 249.38641357421875,
          "radius_x": 241.1821746826172,
          "radius_y": 242.58282470703125,
          "rotation": 85.34799194335938,
          "slice_index": 24,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.489580"
        }
      ],
      "brush_strokes": []
    },
    "y_25": {
      "slice_index": 25,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_8f100d55",
          "center_x": 249.13511657714844,
          "center_y": 249.15542602539062,
          "radius_x": 240.84901428222656,
          "radius_y": 243.15179443359375,
          "rotation": 88.6397705078125,
          "slice_index": 25,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.520688"
        }
      ],
      "brush_strokes": []
    },
    "y_26": {
      "slice_index": 26,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_494487b0",
          "center_x": 248.79306030273438,
          "center_y": 249.00747680664062,
          "radius_x": 240.510986328125,
          "radius_y": 244.19345092773438,
          "rotation": 90.48505401611328,
          "slice_index": 26,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.555890"
        }
      ],
      "brush_strokes": []
    },
    "y_27": {
      "slice_index": 27,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_0f0ff868",
          "center_x": 249.24313354492188,
          "center_y": 249.11941528320312,
          "radius_x": 240.7880096435547,
          "radius_y": 243.69558715820312,
          "rotation": 89.06965637207031,
          "slice_index": 27,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.584882"
        }
      ],
      "brush_strokes": []
    },
    "y_28": {
      "slice_index": 28,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7923be1d",
          "center_x": 249.43214416503906,
          "center_y": 249.2850341796875,
          "radius_x": 240.67674255371094,
          "radius_y": 243.84234619140625,
          "rotation": 90.75240325927734,
          "slice_index": 28,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.620429"
        }
      ],
      "brush_strokes": []
    },
    "y_29": {
      "slice_index": 29,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_8cef11f3",
          "center_x": 249.30918884277344,
          "center_y": 249.3590850830078,
          "radius_x": 240.71514892578125,
          "radius_y": 243.4590606689453,
          "rotation": 89.68128967285156,
          "slice_index": 29,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.657866"
        }
      ],
      "brush_strokes": []
    },
    "y_30": {
      "slice_index": 30,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_a85169c5",
          "center_x": 249.2899169921875,
          "center_y": 249.4215087890625,
          "radius_x": 241.0046844482422,
          "radius_y": 243.29258728027344,
          "rotation": 90.4020767211914,
          "slice_index": 30,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.685860"
        }
      ],
      "brush_strokes": []
    },
    "y_31": {
      "slice_index": 31,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9a4d5ae0",
          "center_x": 248.93881225585938,
          "center_y": 249.37869262695312,
          "radius_x": 241.07333374023438,
          "radius_y": 243.2107391357422,
          "rotation": 87.2457275390625,
          "slice_index": 31,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.717842"
        }
      ],
      "brush_strokes": []
    },
    "y_32": {
      "slice_index": 32,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f30e3156",
          "center_x": 248.75100708007812,
          "center_y": 249.5263214111328,
          "radius_x": 240.9398651123047,
          "radius_y": 243.11361694335938,
          "rotation": 90.0400161743164,
          "slice_index": 32,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.748238"
        }
      ],
      "brush_strokes": []
    },
    "y_33": {
      "slice_index": 33,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b4d7fd0d",
          "center_x": 248.93661499023438,
          "center_y": 249.57510375976562,
          "radius_x": 241.0949249267578,
          "radius_y": 242.56036376953125,
          "rotation": 88.13533020019531,
          "slice_index": 33,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.779746"
        }
      ],
      "brush_strokes": []
    },
    "y_34": {
      "slice_index": 34,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1f4d2d50",
          "center_x": 248.8509979248047,
          "center_y": 249.5960235595703,
          "radius_x": 241.09799194335938,
          "radius_y": 242.52493286132812,
          "rotation": 92.40894317626953,
          "slice_index": 34,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.809749"
        }
      ],
      "brush_strokes": []
    },
    "y_35": {
      "slice_index": 35,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9376d97e",
          "center_x": 248.1997833251953,
          "center_y": 249.845947265625,
          "radius_x": 240.8255157470703,
          "radius_y": 242.3692626953125,
          "rotation": 89.3753662109375,
          "slice_index": 35,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.838579"
        }
      ],
      "brush_strokes": []
    },
    "y_36": {
      "slice_index": 36,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2f296a99",
          "center_x": 247.948486328125,
          "center_y": 249.79286193847656,
          "radius_x": 240.99786376953125,
          "radius_y": 242.49374389648438,
          "rotation": 89.78144073486328,
          "slice_index": 36,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.869101"
        }
      ],
      "brush_strokes": []
    },
    "y_37": {
      "slice_index": 37,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2bc9218b",
          "center_x": 248.09750366210938,
          "center_y": 249.7593536376953,
          "radius_x": 240.8339080810547,
          "radius_y": 242.03384399414062,
          "rotation": 78.64772033691406,
          "slice_index": 37,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.906121"
        }
      ],
      "brush_strokes": []
    },
    "y_38": {
      "slice_index": 38,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d839a60e",
          "center_x": 247.9906005859375,
          "center_y": 249.9678955078125,
          "radius_x": 240.5199432373047,
          "radius_y": 242.1998291015625,
          "rotation": 84.2784652709961,
          "slice_index": 38,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.941445"
        }
      ],
      "brush_strokes": []
    },
    "y_39": {
      "slice_index": 39,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_93df0d59",
          "center_x": 248.17213439941406,
          "center_y": 250.56015014648438,
          "radius_x": 240.70016479492188,
          "radius_y": 242.0616455078125,
          "rotation": 94.73787689208984,
          "slice_index": 39,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.970446"
        }
      ],
      "brush_strokes": []
    },
    "y_40": {
      "slice_index": 40,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_58271ec4",
          "center_x": 248.23646545410156,
          "center_y": 250.3082733154297,
          "radius_x": 240.68283081054688,
          "radius_y": 242.3454132080078,
          "rotation": 92.39916229248047,
          "slice_index": 40,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:36.999609"
        }
      ],
      "brush_strokes": []
    },
    "y_41": {
      "slice_index": 41,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c0b28211",
          "center_x": 248.22817993164062,
          "center_y": 251.1524658203125,
          "radius_x": 240.51068115234375,
          "radius_y": 241.8808135986328,
          "rotation": 87.3519058227539,
          "slice_index": 41,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.031137"
        }
      ],
      "brush_strokes": []
    },
    "y_42": {
      "slice_index": 42,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_df4a29dd",
          "center_x": 247.6771697998047,
          "center_y": 251.12979125976562,
          "radius_x": 240.4502716064453,
          "radius_y": 241.21446228027344,
          "rotation": 86.15866088867188,
          "slice_index": 42,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.073131"
        }
      ],
      "brush_strokes": []
    },
    "y_43": {
      "slice_index": 43,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_027f28ef",
          "center_x": 247.41104125976562,
          "center_y": 252.12588500976562,
          "radius_x": 239.30645751953125,
          "radius_y": 241.48773193359375,
          "rotation": 75.71123504638672,
          "slice_index": 43,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.102119"
        }
      ],
      "brush_strokes": []
    },
    "y_44": {
      "slice_index": 44,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e3655704",
          "center_x": 247.1612091064453,
          "center_y": 251.95738220214844,
          "radius_x": 240.02059936523438,
          "radius_y": 241.54904174804688,
          "rotation": 94.66012573242188,
          "slice_index": 44,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.130326"
        }
      ],
      "brush_strokes": []
    },
    "y_45": {
      "slice_index": 45,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6873805b",
          "center_x": 247.0315704345703,
          "center_y": 251.82264709472656,
          "radius_x": 239.37335205078125,
          "radius_y": 241.1988067626953,
          "rotation": 88.72908020019531,
          "slice_index": 45,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.161319"
        }
      ],
      "brush_strokes": []
    },
    "y_46": {
      "slice_index": 46,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c3dd5a04",
          "center_x": 246.45425415039062,
          "center_y": 252.65130615234375,
          "radius_x": 239.5296630859375,
          "radius_y": 240.9727325439453,
          "rotation": 101.17465209960938,
          "slice_index": 46,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.188319"
        }
      ],
      "brush_strokes": []
    },
    "y_47": {
      "slice_index": 47,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_279a7461",
          "center_x": 246.93646240234375,
          "center_y": 251.9864501953125,
          "radius_x": 239.70997619628906,
          "radius_y": 241.3876190185547,
          "rotation": 95.72884368896484,
          "slice_index": 47,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.216861"
        }
      ],
      "brush_strokes": []
    },
    "y_48": {
      "slice_index": 48,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_00e04a5c",
          "center_x": 246.020263671875,
          "center_y": 252.71902465820312,
          "radius_x": 239.3489990234375,
          "radius_y": 241.11959838867188,
          "rotation": 108.82634735107422,
          "slice_index": 48,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.245854"
        }
      ],
      "brush_strokes": []
    },
    "y_49": {
      "slice_index": 49,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d395c49f",
          "center_x": 245.4207763671875,
          "center_y": 253.6766815185547,
          "radius_x": 238.69790649414062,
          "radius_y": 240.85508728027344,
          "rotation": 114.18402099609375,
          "slice_index": 49,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.271854"
        }
      ],
      "brush_strokes": []
    },
    "y_50": {
      "slice_index": 50,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c61247df",
          "center_x": 246.15200805664062,
          "center_y": 252.30038452148438,
          "radius_x": 239.77651977539062,
          "radius_y": 241.4737548828125,
          "rotation": 90.4874267578125,
          "slice_index": 50,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.299858"
        }
      ],
      "brush_strokes": []
    },
    "y_51": {
      "slice_index": 51,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_8d0ff086",
          "center_x": 245.50491333007812,
          "center_y": 251.41372680664062,
          "radius_x": 239.51348876953125,
          "radius_y": 241.91383361816406,
          "rotation": 89.61546325683594,
          "slice_index": 51,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.328373"
        }
      ],
      "brush_strokes": []
    },
    "y_52": {
      "slice_index": 52,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1ebf2334",
          "center_x": 246.64987182617188,
          "center_y": 252.45286560058594,
          "radius_x": 240.07012939453125,
          "radius_y": 241.40301513671875,
          "rotation": 92.86988830566406,
          "slice_index": 52,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.354372"
        }
      ],
      "brush_strokes": []
    },
    "y_53": {
      "slice_index": 53,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c729f927",
          "center_x": 244.59320068359375,
          "center_y": 253.9983367919922,
          "radius_x": 238.84947204589844,
          "radius_y": 240.12704467773438,
          "rotation": 111.23933410644531,
          "slice_index": 53,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.382370"
        }
      ],
      "brush_strokes": []
    },
    "y_54": {
      "slice_index": 54,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_a49d893f",
          "center_x": 244.23008728027344,
          "center_y": 255.31173706054688,
          "radius_x": 237.81878662109375,
          "radius_y": 240.21104431152344,
          "rotation": 126.23023986816406,
          "slice_index": 54,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.409386"
        }
      ],
      "brush_strokes": []
    },
    "y_55": {
      "slice_index": 55,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c9e728d2",
          "center_x": 241.98562622070312,
          "center_y": 260.5628662109375,
          "radius_x": 233.9377899169922,
          "radius_y": 238.53753662109375,
          "rotation": 125.87433624267578,
          "slice_index": 55,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.435014"
        }
      ],
      "brush_strokes": []
    },
    "y_56": {
      "slice_index": 56,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_25961d34",
          "center_x": 239.1665802001953,
          "center_y": 269.0665283203125,
          "radius_x": 225.9678192138672,
          "radius_y": 234.47222900390625,
          "rotation": 114.03802490234375,
          "slice_index": 56,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.464703"
        }
      ],
      "brush_strokes": []
    },
    "y_57": {
      "slice_index": 57,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_38cdca1b",
          "center_x": 237.88253784179688,
          "center_y": 272.47906494140625,
          "radius_x": 223.7682647705078,
          "radius_y": 230.4380645751953,
          "rotation": 105.3370590209961,
          "slice_index": 57,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.494706"
        }
      ],
      "brush_strokes": []
    },
    "y_58": {
      "slice_index": 58,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_a3f56ba2",
          "center_x": 236.6070098876953,
          "center_y": 275.1557922363281,
          "radius_x": 221.02525329589844,
          "radius_y": 230.10507202148438,
          "rotation": 105.63887786865234,
          "slice_index": 58,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.527194"
        }
      ],
      "brush_strokes": []
    },
    "y_59": {
      "slice_index": 59,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_743e8eb8",
          "center_x": 236.60302734375,
          "center_y": 275.1351318359375,
          "radius_x": 220.16575622558594,
          "radius_y": 230.66358947753906,
          "rotation": 99.04761505126953,
          "slice_index": 59,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.616836"
        }
      ],
      "brush_strokes": []
    },
    "y_60": {
      "slice_index": 60,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_91264929",
          "center_x": 235.16148376464844,
          "center_y": 277.35845947265625,
          "radius_x": 217.92730712890625,
          "radius_y": 229.20834350585938,
          "rotation": 93.624755859375,
          "slice_index": 60,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.671753"
        }
      ],
      "brush_strokes": []
    },
    "y_61": {
      "slice_index": 61,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5106a309",
          "center_x": 232.89712524414062,
          "center_y": 278.25347900390625,
          "radius_x": 217.9595489501953,
          "radius_y": 226.9552459716797,
          "rotation": 93.08125305175781,
          "slice_index": 61,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.701029"
        }
      ],
      "brush_strokes": []
    },
    "y_62": {
      "slice_index": 62,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5ea99163",
          "center_x": 229.57867431640625,
          "center_y": 281.3371887207031,
          "radius_x": 215.6943359375,
          "radius_y": 225.1454620361328,
          "rotation": 104.33019256591797,
          "slice_index": 62,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.725066"
        }
      ],
      "brush_strokes": []
    },
    "y_63": {
      "slice_index": 63,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3699331e",
          "center_x": 225.96571350097656,
          "center_y": 288.0291748046875,
          "radius_x": 211.4156951904297,
          "radius_y": 218.6329803466797,
          "rotation": 109.7380599975586,
          "slice_index": 63,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.749298"
        }
      ],
      "brush_strokes": []
    },
    "y_64": {
      "slice_index": 64,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6cc759b4",
          "center_x": 222.68341064453125,
          "center_y": 296.1142883300781,
          "radius_x": 204.60293579101562,
          "radius_y": 210.086181640625,
          "rotation": 65.3843002319336,
          "slice_index": 64,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.774298"
        }
      ],
      "brush_strokes": []
    },
    "y_65": {
      "slice_index": 65,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e3c5c63b",
          "center_x": 219.0898895263672,
          "center_y": 298.47430419921875,
          "radius_x": 201.2925567626953,
          "radius_y": 208.5901336669922,
          "rotation": 71.69558715820312,
          "slice_index": 65,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.794299"
        }
      ],
      "brush_strokes": []
    },
    "y_66": {
      "slice_index": 66,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ed209587",
          "center_x": 212.09580993652344,
          "center_y": 300.4062805175781,
          "radius_x": 197.77467346191406,
          "radius_y": 202.72816467285156,
          "rotation": 66.09818267822266,
          "slice_index": 66,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.814810"
        }
      ],
      "brush_strokes": []
    },
    "y_67": {
      "slice_index": 67,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_70aad683",
          "center_x": 206.86732482910156,
          "center_y": 303.6145324707031,
          "radius_x": 195.22988891601562,
          "radius_y": 200.588134765625,
          "rotation": 104.1407699584961,
          "slice_index": 67,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.835812"
        }
      ],
      "brush_strokes": []
    },
    "y_68": {
      "slice_index": 68,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3c73e4da",
          "center_x": 203.0011749267578,
          "center_y": 302.9942932128906,
          "radius_x": 194.03213500976562,
          "radius_y": 197.3525390625,
          "rotation": 106.67920684814453,
          "slice_index": 68,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.855813"
        }
      ],
      "brush_strokes": []
    },
    "y_69": {
      "slice_index": 69,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_dfcf32f4",
          "center_x": 197.0897674560547,
          "center_y": 297.2292785644531,
          "radius_x": 191.9929962158203,
          "radius_y": 202.6314239501953,
          "rotation": 141.0188446044922,
          "slice_index": 69,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.874813"
        }
      ],
      "brush_strokes": []
    },
    "y_70": {
      "slice_index": 70,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c91e4cd4",
          "center_x": 198.66065979003906,
          "center_y": 295.4366760253906,
          "radius_x": 192.9676513671875,
          "radius_y": 202.96478271484375,
          "rotation": 140.353271484375,
          "slice_index": 70,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.896814"
        }
      ],
      "brush_strokes": []
    },
    "y_71": {
      "slice_index": 71,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_24811d63",
          "center_x": 205.18365478515625,
          "center_y": 294.1237487792969,
          "radius_x": 196.09228515625,
          "radius_y": 208.61952209472656,
          "rotation": 128.80203247070312,
          "slice_index": 71,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.919327"
        }
      ],
      "brush_strokes": []
    },
    "y_72": {
      "slice_index": 72,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e0ad95a8",
          "center_x": 207.26219177246094,
          "center_y": 290.00616455078125,
          "radius_x": 198.27694702148438,
          "radius_y": 214.6725616455078,
          "rotation": 129.29519653320312,
          "slice_index": 72,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.943326"
        }
      ],
      "brush_strokes": []
    },
    "y_73": {
      "slice_index": 73,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7a2b012b",
          "center_x": 213.23223876953125,
          "center_y": 287.4154968261719,
          "radius_x": 201.41111755371094,
          "radius_y": 220.86105346679688,
          "rotation": 127.70804595947266,
          "slice_index": 73,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.971326"
        }
      ],
      "brush_strokes": []
    },
    "y_74": {
      "slice_index": 74,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6c624bb6",
          "center_x": 220.00173950195312,
          "center_y": 283.4728698730469,
          "radius_x": 206.39381408691406,
          "radius_y": 225.1483612060547,
          "rotation": 124.95914459228516,
          "slice_index": 74,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:37.999345"
        }
      ],
      "brush_strokes": []
    },
    "y_75": {
      "slice_index": 75,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_98aa4ca8",
          "center_x": 226.323974609375,
          "center_y": 279.8595886230469,
          "radius_x": 210.24264526367188,
          "radius_y": 231.8086700439453,
          "rotation": 121.73652648925781,
          "slice_index": 75,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.024874"
        }
      ],
      "brush_strokes": []
    },
    "y_76": {
      "slice_index": 76,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_baeceeab",
          "center_x": 231.53897094726562,
          "center_y": 276.8695983886719,
          "radius_x": 213.5013885498047,
          "radius_y": 238.47122192382812,
          "rotation": 122.70701599121094,
          "slice_index": 76,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.050872"
        }
      ],
      "brush_strokes": []
    },
    "y_77": {
      "slice_index": 77,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_590dacf1",
          "center_x": 233.56027221679688,
          "center_y": 270.8721008300781,
          "radius_x": 217.73619079589844,
          "radius_y": 245.0317840576172,
          "rotation": 122.48580169677734,
          "slice_index": 77,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.076870"
        }
      ],
      "brush_strokes": []
    },
    "y_78": {
      "slice_index": 78,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_54bbc853",
          "center_x": 235.6618194580078,
          "center_y": 266.8551940917969,
          "radius_x": 221.20755004882812,
          "radius_y": 247.0386962890625,
          "rotation": 124.29151916503906,
          "slice_index": 78,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.106146"
        }
      ],
      "brush_strokes": []
    },
    "y_79": {
      "slice_index": 79,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e0ca495c",
          "center_x": 237.29713439941406,
          "center_y": 264.46209716796875,
          "radius_x": 223.40048217773438,
          "radius_y": 246.6222381591797,
          "rotation": 123.98536682128906,
          "slice_index": 79,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.149660"
        }
      ],
      "brush_strokes": []
    },
    "y_80": {
      "slice_index": 80,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1c3c6c47",
          "center_x": 238.37808227539062,
          "center_y": 263.24920654296875,
          "radius_x": 225.0835418701172,
          "radius_y": 246.37936401367188,
          "rotation": 122.34906768798828,
          "slice_index": 80,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.183667"
        }
      ],
      "brush_strokes": []
    },
    "y_81": {
      "slice_index": 81,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_035bf668",
          "center_x": 239.47474670410156,
          "center_y": 261.4362487792969,
          "radius_x": 226.83737182617188,
          "radius_y": 245.69491577148438,
          "rotation": 123.34498596191406,
          "slice_index": 81,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.216874"
        }
      ],
      "brush_strokes": []
    },
    "y_82": {
      "slice_index": 82,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_18a38579",
          "center_x": 240.36805725097656,
          "center_y": 259.7158508300781,
          "radius_x": 229.3574676513672,
          "radius_y": 244.58126831054688,
          "rotation": 123.97785949707031,
          "slice_index": 82,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.244877"
        }
      ],
      "brush_strokes": []
    },
    "y_83": {
      "slice_index": 83,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7b6df43b",
          "center_x": 242.21531677246094,
          "center_y": 258.2369384765625,
          "radius_x": 231.49566650390625,
          "radius_y": 244.14236450195312,
          "rotation": 127.63725280761719,
          "slice_index": 83,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.270873"
        }
      ],
      "brush_strokes": []
    },
    "y_84": {
      "slice_index": 84,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5ddaf1b4",
          "center_x": 243.7659149169922,
          "center_y": 256.2247009277344,
          "radius_x": 234.14410400390625,
          "radius_y": 243.1587677001953,
          "rotation": 126.89201354980469,
          "slice_index": 84,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.298878"
        }
      ],
      "brush_strokes": []
    },
    "y_85": {
      "slice_index": 85,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_27739266",
          "center_x": 245.10614013671875,
          "center_y": 254.5655517578125,
          "radius_x": 236.31484985351562,
          "radius_y": 242.76947021484375,
          "rotation": 123.32666778564453,
          "slice_index": 85,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.326394"
        }
      ],
      "brush_strokes": []
    },
    "y_86": {
      "slice_index": 86,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_80218d8c",
          "center_x": 246.7740478515625,
          "center_y": 252.57301330566406,
          "radius_x": 238.94595336914062,
          "radius_y": 241.94187927246094,
          "rotation": 102.97381591796875,
          "slice_index": 86,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.357393"
        }
      ],
      "brush_strokes": []
    },
    "y_87": {
      "slice_index": 87,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5ff792dc",
          "center_x": 247.91444396972656,
          "center_y": 252.029296875,
          "radius_x": 240.1671600341797,
          "radius_y": 243.04249572753906,
          "rotation": 99.2767105102539,
          "slice_index": 87,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.384394"
        }
      ],
      "brush_strokes": []
    },
    "y_88": {
      "slice_index": 88,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1afb7c84",
          "center_x": 248.17401123046875,
          "center_y": 251.39976501464844,
          "radius_x": 240.65011596679688,
          "radius_y": 243.53982543945312,
          "rotation": 87.73937225341797,
          "slice_index": 88,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.415908"
        }
      ],
      "brush_strokes": []
    },
    "y_89": {
      "slice_index": 89,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_640e1360",
          "center_x": 248.3279266357422,
          "center_y": 251.17601013183594,
          "radius_x": 240.4077911376953,
          "radius_y": 243.38661193847656,
          "rotation": 77.9848403930664,
          "slice_index": 89,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.445913"
        }
      ],
      "brush_strokes": []
    },
    "y_90": {
      "slice_index": 90,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_787517cb",
          "center_x": 248.18716430664062,
          "center_y": 251.29483032226562,
          "radius_x": 240.61293029785156,
          "radius_y": 243.5007781982422,
          "rotation": 88.19569396972656,
          "slice_index": 90,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.472906"
        }
      ],
      "brush_strokes": []
    },
    "y_91": {
      "slice_index": 91,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_04a2acf7",
          "center_x": 248.27586364746094,
          "center_y": 251.1021270751953,
          "radius_x": 240.66226196289062,
          "radius_y": 242.96932983398438,
          "rotation": 81.97762298583984,
          "slice_index": 91,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.500915"
        }
      ],
      "brush_strokes": []
    },
    "y_92": {
      "slice_index": 92,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ce1e3d23",
          "center_x": 247.65074157714844,
          "center_y": 250.85086059570312,
          "radius_x": 240.18051147460938,
          "radius_y": 243.15316772460938,
          "rotation": 75.44104766845703,
          "slice_index": 92,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.529836"
        }
      ],
      "brush_strokes": []
    },
    "y_93": {
      "slice_index": 93,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b2ee7f78",
          "center_x": 247.7264404296875,
          "center_y": 250.45999145507812,
          "radius_x": 240.4283447265625,
          "radius_y": 243.324951171875,
          "rotation": 78.9457778930664,
          "slice_index": 93,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.557838"
        }
      ],
      "brush_strokes": []
    },
    "y_94": {
      "slice_index": 94,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_19036b92",
          "center_x": 247.5146484375,
          "center_y": 250.709716796875,
          "radius_x": 240.6631317138672,
          "radius_y": 243.21304321289062,
          "rotation": 76.0948715209961,
          "slice_index": 94,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.584838"
        }
      ],
      "brush_strokes": []
    },
    "y_95": {
      "slice_index": 95,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3716c79f",
          "center_x": 248.0189666748047,
          "center_y": 250.27195739746094,
          "radius_x": 240.19076538085938,
          "radius_y": 243.8466033935547,
          "rotation": 70.48432922363281,
          "slice_index": 95,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.614365"
        }
      ],
      "brush_strokes": []
    },
    "y_96": {
      "slice_index": 96,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c06dd0e7",
          "center_x": 248.21853637695312,
          "center_y": 250.58094787597656,
          "radius_x": 239.91311645507812,
          "radius_y": 244.19778442382812,
          "rotation": 75.2689437866211,
          "slice_index": 96,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.645366"
        }
      ],
      "brush_strokes": []
    },
    "y_97": {
      "slice_index": 97,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_331a7853",
          "center_x": 247.91246032714844,
          "center_y": 250.10328674316406,
          "radius_x": 240.43978881835938,
          "radius_y": 244.07797241210938,
          "rotation": 72.90764617919922,
          "slice_index": 97,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.674365"
        }
      ],
      "brush_strokes": []
    },
    "y_98": {
      "slice_index": 98,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_282d8879",
          "center_x": 248.32318115234375,
          "center_y": 250.6869354248047,
          "radius_x": 240.7423095703125,
          "radius_y": 243.63088989257812,
          "rotation": 75.72061920166016,
          "slice_index": 98,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.701376"
        }
      ],
      "brush_strokes": []
    },
    "y_99": {
      "slice_index": 99,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_0e416a39",
          "center_x": 247.78407287597656,
          "center_y": 250.68612670898438,
          "radius_x": 240.3514862060547,
          "radius_y": 243.6160430908203,
          "rotation": 74.73267364501953,
          "slice_index": 99,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.729002"
        }
      ],
      "brush_strokes": []
    },
    "y_100": {
      "slice_index": 100,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_a3fa9b6f",
          "center_x": 247.79660034179688,
          "center_y": 251.02685546875,
          "radius_x": 240.1172332763672,
          "radius_y": 243.9219512939453,
          "rotation": 80.92726135253906,
          "slice_index": 100,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.759432"
        }
      ],
      "brush_strokes": []
    },
    "y_101": {
      "slice_index": 101,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e59ef5c2",
          "center_x": 247.92074584960938,
          "center_y": 250.49026489257812,
          "radius_x": 239.58163452148438,
          "radius_y": 244.30482482910156,
          "rotation": 79.33588409423828,
          "slice_index": 101,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.789431"
        }
      ],
      "brush_strokes": []
    },
    "y_102": {
      "slice_index": 102,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_dec3dece",
          "center_x": 247.8392333984375,
          "center_y": 250.85939025878906,
          "radius_x": 239.8893585205078,
          "radius_y": 244.04335021972656,
          "rotation": 78.38191986083984,
          "slice_index": 102,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.819941"
        }
      ],
      "brush_strokes": []
    },
    "y_103": {
      "slice_index": 103,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ce16b409",
          "center_x": 248.16412353515625,
          "center_y": 250.4105224609375,
          "radius_x": 240.5276641845703,
          "radius_y": 244.19940185546875,
          "rotation": 77.68016815185547,
          "slice_index": 103,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.847941"
        }
      ],
      "brush_strokes": []
    },
    "y_104": {
      "slice_index": 104,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2cf9ee15",
          "center_x": 248.1053009033203,
          "center_y": 251.24432373046875,
          "radius_x": 240.2928466796875,
          "radius_y": 244.08450317382812,
          "rotation": 80.41030883789062,
          "slice_index": 104,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.874942"
        }
      ],
      "brush_strokes": []
    },
    "y_105": {
      "slice_index": 105,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f3175a1e",
          "center_x": 248.18455505371094,
          "center_y": 250.07911682128906,
          "radius_x": 240.62535095214844,
          "radius_y": 243.98544311523438,
          "rotation": 80.61743927001953,
          "slice_index": 105,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.901947"
        }
      ],
      "brush_strokes": []
    },
    "y_106": {
      "slice_index": 106,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9c1efffa",
          "center_x": 248.42823791503906,
          "center_y": 250.4337615966797,
          "radius_x": 239.74929809570312,
          "radius_y": 244.71665954589844,
          "rotation": 72.02257537841797,
          "slice_index": 106,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.930465"
        }
      ],
      "brush_strokes": []
    },
    "y_107": {
      "slice_index": 107,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_47a02702",
          "center_x": 248.55517578125,
          "center_y": 251.28683471679688,
          "radius_x": 239.78147888183594,
          "radius_y": 244.3435821533203,
          "rotation": 72.7524185180664,
          "slice_index": 107,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.956463"
        }
      ],
      "brush_strokes": []
    },
    "y_108": {
      "slice_index": 108,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_920163ad",
          "center_x": 248.5789794921875,
          "center_y": 250.46543884277344,
          "radius_x": 240.4495086669922,
          "radius_y": 244.08226013183594,
          "rotation": 73.3671875,
          "slice_index": 108,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:38.985078"
        }
      ],
      "brush_strokes": []
    },
    "y_109": {
      "slice_index": 109,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_876f2234",
          "center_x": 248.722412109375,
          "center_y": 250.31045532226562,
          "radius_x": 240.5568084716797,
          "radius_y": 243.6158905029297,
          "rotation": 66.08390045166016,
          "slice_index": 109,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.013807"
        }
      ],
      "brush_strokes": []
    },
    "y_110": {
      "slice_index": 110,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_de8507c5",
          "center_x": 248.20135498046875,
          "center_y": 250.22634887695312,
          "radius_x": 240.40719604492188,
          "radius_y": 243.8187713623047,
          "rotation": 74.77520751953125,
          "slice_index": 110,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.043442"
        }
      ],
      "brush_strokes": []
    },
    "y_111": {
      "slice_index": 111,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6a684adb",
          "center_x": 247.82017517089844,
          "center_y": 250.15513610839844,
          "radius_x": 240.7102508544922,
          "radius_y": 244.10208129882812,
          "rotation": 75.80217742919922,
          "slice_index": 111,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.071686"
        }
      ],
      "brush_strokes": []
    },
    "y_112": {
      "slice_index": 112,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_562fbe92",
          "center_x": 247.62686157226562,
          "center_y": 249.951904296875,
          "radius_x": 240.3249969482422,
          "radius_y": 243.83416748046875,
          "rotation": 69.78924560546875,
          "slice_index": 112,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.098333"
        }
      ],
      "brush_strokes": []
    },
    "y_113": {
      "slice_index": 113,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_8b08bf52",
          "center_x": 247.9806671142578,
          "center_y": 250.83302307128906,
          "radius_x": 240.39324951171875,
          "radius_y": 243.93858337402344,
          "rotation": 78.6426010131836,
          "slice_index": 113,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.126134"
        }
      ],
      "brush_strokes": []
    },
    "y_114": {
      "slice_index": 114,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d66a3a29",
          "center_x": 248.24566650390625,
          "center_y": 250.45187377929688,
          "radius_x": 240.28990173339844,
          "radius_y": 244.0976104736328,
          "rotation": 71.14484405517578,
          "slice_index": 114,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.157256"
        }
      ],
      "brush_strokes": []
    },
    "y_115": {
      "slice_index": 115,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_8a2c2588",
          "center_x": 248.06565856933594,
          "center_y": 250.62034606933594,
          "radius_x": 240.9739532470703,
          "radius_y": 243.48789978027344,
          "rotation": 74.89559173583984,
          "slice_index": 115,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.183694"
        }
      ],
      "brush_strokes": []
    },
    "y_116": {
      "slice_index": 116,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ec5ae6e4",
          "center_x": 247.9139404296875,
          "center_y": 250.7556610107422,
          "radius_x": 240.76739501953125,
          "radius_y": 243.6055908203125,
          "rotation": 75.90196990966797,
          "slice_index": 116,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.210772"
        }
      ],
      "brush_strokes": []
    },
    "y_117": {
      "slice_index": 117,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_41d2ee1a",
          "center_x": 247.90261840820312,
          "center_y": 250.69273376464844,
          "radius_x": 240.87940979003906,
          "radius_y": 243.80833435058594,
          "rotation": 80.46614837646484,
          "slice_index": 117,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.238286"
        }
      ],
      "brush_strokes": []
    },
    "y_118": {
      "slice_index": 118,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e6d0ea82",
          "center_x": 248.5898895263672,
          "center_y": 251.03155517578125,
          "radius_x": 240.8661346435547,
          "radius_y": 243.58470153808594,
          "rotation": 74.57554626464844,
          "slice_index": 118,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.270003"
        }
      ],
      "brush_strokes": []
    },
    "y_119": {
      "slice_index": 119,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_406c2a85",
          "center_x": 248.9038543701172,
          "center_y": 250.74339294433594,
          "radius_x": 240.21958923339844,
          "radius_y": 244.13059997558594,
          "rotation": 69.01719665527344,
          "slice_index": 119,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.299366"
        }
      ],
      "brush_strokes": []
    },
    "y_120": {
      "slice_index": 120,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_548dba78",
          "center_x": 248.2047576904297,
          "center_y": 250.93807983398438,
          "radius_x": 240.0224151611328,
          "radius_y": 243.93150329589844,
          "rotation": 74.42123413085938,
          "slice_index": 120,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.328052"
        }
      ],
      "brush_strokes": []
    },
    "y_121": {
      "slice_index": 121,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_596c28db",
          "center_x": 248.47242736816406,
          "center_y": 250.29815673828125,
          "radius_x": 240.54005432128906,
          "radius_y": 243.71649169921875,
          "rotation": 69.52753448486328,
          "slice_index": 121,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.356386"
        }
      ],
      "brush_strokes": []
    },
    "y_122": {
      "slice_index": 122,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2c17b2ab",
          "center_x": 248.6614227294922,
          "center_y": 250.08993530273438,
          "radius_x": 240.87571716308594,
          "radius_y": 244.03311157226562,
          "rotation": 66.2228775024414,
          "slice_index": 122,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.382764"
        }
      ],
      "brush_strokes": []
    },
    "y_123": {
      "slice_index": 123,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_006dc177",
          "center_x": 248.6796112060547,
          "center_y": 250.5204620361328,
          "radius_x": 240.0150604248047,
          "radius_y": 244.2504119873047,
          "rotation": 71.50267791748047,
          "slice_index": 123,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.416516"
        }
      ],
      "brush_strokes": []
    },
    "y_124": {
      "slice_index": 124,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e6b7e4cd",
          "center_x": 248.79345703125,
          "center_y": 250.6735382080078,
          "radius_x": 240.62486267089844,
          "radius_y": 243.85093688964844,
          "rotation": 72.13329315185547,
          "slice_index": 124,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.450509"
        }
      ],
      "brush_strokes": []
    },
    "y_125": {
      "slice_index": 125,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_069b643f",
          "center_x": 248.44338989257812,
          "center_y": 250.66285705566406,
          "radius_x": 240.7675323486328,
          "radius_y": 243.55966186523438,
          "rotation": 70.0185546875,
          "slice_index": 125,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.493729"
        }
      ],
      "brush_strokes": []
    },
    "y_126": {
      "slice_index": 126,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_54864051",
          "center_x": 248.86378479003906,
          "center_y": 250.6770477294922,
          "radius_x": 240.69395446777344,
          "radius_y": 243.59596252441406,
          "rotation": 67.06182861328125,
          "slice_index": 126,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.523389"
        }
      ],
      "brush_strokes": []
    },
    "y_127": {
      "slice_index": 127,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_99c6f5fd",
          "center_x": 248.24057006835938,
          "center_y": 250.09600830078125,
          "radius_x": 240.40447998046875,
          "radius_y": 243.85055541992188,
          "rotation": 68.25865936279297,
          "slice_index": 127,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.557211"
        }
      ],
      "brush_strokes": []
    },
    "y_128": {
      "slice_index": 128,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_4fdc026f",
          "center_x": 248.56431579589844,
          "center_y": 250.44772338867188,
          "radius_x": 240.03915405273438,
          "radius_y": 244.1189422607422,
          "rotation": 71.53313446044922,
          "slice_index": 128,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.586210"
        }
      ],
      "brush_strokes": []
    },
    "y_129": {
      "slice_index": 129,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5e301366",
          "center_x": 248.43734741210938,
          "center_y": 250.0853271484375,
          "radius_x": 240.11375427246094,
          "radius_y": 243.65771484375,
          "rotation": 69.92057037353516,
          "slice_index": 129,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.613739"
        }
      ],
      "brush_strokes": []
    },
    "y_130": {
      "slice_index": 130,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_544b6cc3",
          "center_x": 248.65310668945312,
          "center_y": 250.10105895996094,
          "radius_x": 240.72280883789062,
          "radius_y": 244.17100524902344,
          "rotation": 70.60708618164062,
          "slice_index": 130,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.641076"
        }
      ],
      "brush_strokes": []
    },
    "y_131": {
      "slice_index": 131,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1da10e2d",
          "center_x": 248.6778564453125,
          "center_y": 250.7783660888672,
          "radius_x": 241.17332458496094,
          "radius_y": 243.3843536376953,
          "rotation": 74.96067810058594,
          "slice_index": 131,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.670095"
        }
      ],
      "brush_strokes": []
    },
    "y_132": {
      "slice_index": 132,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_53a8cbc5",
          "center_x": 248.0144500732422,
          "center_y": 250.2938995361328,
          "radius_x": 240.69834899902344,
          "radius_y": 243.2931671142578,
          "rotation": 63.63988494873047,
          "slice_index": 132,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.701994"
        }
      ],
      "brush_strokes": []
    },
    "y_133": {
      "slice_index": 133,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e6fb093c",
          "center_x": 248.58148193359375,
          "center_y": 250.66497802734375,
          "radius_x": 241.19161987304688,
          "radius_y": 243.05191040039062,
          "rotation": 67.42991638183594,
          "slice_index": 133,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.730795"
        }
      ],
      "brush_strokes": []
    },
    "y_134": {
      "slice_index": 134,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_392926f7",
          "center_x": 248.6153106689453,
          "center_y": 250.3216552734375,
          "radius_x": 240.54380798339844,
          "radius_y": 243.533935546875,
          "rotation": 66.9284896850586,
          "slice_index": 134,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.761119"
        }
      ],
      "brush_strokes": []
    },
    "y_135": {
      "slice_index": 135,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_969674da",
          "center_x": 248.40228271484375,
          "center_y": 250.46401977539062,
          "radius_x": 240.7923126220703,
          "radius_y": 243.25494384765625,
          "rotation": 66.58255767822266,
          "slice_index": 135,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.789233"
        }
      ],
      "brush_strokes": []
    },
    "y_136": {
      "slice_index": 136,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5e16c637",
          "center_x": 248.84295654296875,
          "center_y": 250.10800170898438,
          "radius_x": 241.09938049316406,
          "radius_y": 243.0806884765625,
          "rotation": 59.56221389770508,
          "slice_index": 136,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.818809"
        }
      ],
      "brush_strokes": []
    },
    "y_137": {
      "slice_index": 137,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c00066d6",
          "center_x": 249.0131378173828,
          "center_y": 250.69461059570312,
          "radius_x": 241.45704650878906,
          "radius_y": 242.75978088378906,
          "rotation": 62.48094940185547,
          "slice_index": 137,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.853918"
        }
      ],
      "brush_strokes": []
    },
    "y_138": {
      "slice_index": 138,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ba73260d",
          "center_x": 249.5392303466797,
          "center_y": 250.9544219970703,
          "radius_x": 240.98443603515625,
          "radius_y": 242.96792602539062,
          "rotation": 56.2099609375,
          "slice_index": 138,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.896074"
        }
      ],
      "brush_strokes": []
    },
    "y_139": {
      "slice_index": 139,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_59e633fe",
          "center_x": 248.541259765625,
          "center_y": 249.9642791748047,
          "radius_x": 241.04266357421875,
          "radius_y": 243.01449584960938,
          "rotation": 58.66645812988281,
          "slice_index": 139,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.923739"
        }
      ],
      "brush_strokes": []
    },
    "y_140": {
      "slice_index": 140,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d5865534",
          "center_x": 248.93771362304688,
          "center_y": 250.8445281982422,
          "radius_x": 241.06222534179688,
          "radius_y": 242.9369354248047,
          "rotation": 50.490501403808594,
          "slice_index": 140,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.950837"
        }
      ],
      "brush_strokes": []
    },
    "y_141": {
      "slice_index": 141,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e4ffd17b",
          "center_x": 248.64173889160156,
          "center_y": 250.65206909179688,
          "radius_x": 241.18798828125,
          "radius_y": 242.9037322998047,
          "rotation": 55.13138198852539,
          "slice_index": 141,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:39.979476"
        }
      ],
      "brush_strokes": []
    },
    "y_142": {
      "slice_index": 142,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_43b576b9",
          "center_x": 249.3739013671875,
          "center_y": 251.0364227294922,
          "radius_x": 241.1692352294922,
          "radius_y": 242.5516815185547,
          "rotation": 36.70809555053711,
          "slice_index": 142,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.011488"
        }
      ],
      "brush_strokes": []
    },
    "y_143": {
      "slice_index": 143,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_82466ef3",
          "center_x": 249.04519653320312,
          "center_y": 250.37936401367188,
          "radius_x": 241.8119659423828,
          "radius_y": 242.7879180908203,
          "rotation": 41.368167877197266,
          "slice_index": 143,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.041089"
        }
      ],
      "brush_strokes": []
    },
    "y_144": {
      "slice_index": 144,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_00bbd2c4",
          "center_x": 249.08251953125,
          "center_y": 250.76904296875,
          "radius_x": 241.3132781982422,
          "radius_y": 242.61260986328125,
          "rotation": 40.95656204223633,
          "slice_index": 144,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.068632"
        }
      ],
      "brush_strokes": []
    },
    "y_145": {
      "slice_index": 145,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2ace1415",
          "center_x": 249.02377319335938,
          "center_y": 250.3415069580078,
          "radius_x": 241.54234313964844,
          "radius_y": 242.9517822265625,
          "rotation": 49.74470138549805,
          "slice_index": 145,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.097632"
        }
      ],
      "brush_strokes": []
    },
    "y_146": {
      "slice_index": 146,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_8a645ce2",
          "center_x": 248.7368621826172,
          "center_y": 250.40797424316406,
          "radius_x": 241.43565368652344,
          "radius_y": 242.56552124023438,
          "rotation": 25.832477569580078,
          "slice_index": 146,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.125118"
        }
      ],
      "brush_strokes": []
    },
    "y_147": {
      "slice_index": 147,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_81e280f7",
          "center_x": 249.27532958984375,
          "center_y": 250.41867065429688,
          "radius_x": 241.1732177734375,
          "radius_y": 242.66690063476562,
          "rotation": 28.437259674072266,
          "slice_index": 147,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.157111"
        }
      ],
      "brush_strokes": []
    },
    "y_148": {
      "slice_index": 148,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_af0898d7",
          "center_x": 249.1905975341797,
          "center_y": 250.41278076171875,
          "radius_x": 241.35508728027344,
          "radius_y": 242.97866821289062,
          "rotation": 12.854046821594238,
          "slice_index": 148,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.186111"
        }
      ],
      "brush_strokes": []
    },
    "y_149": {
      "slice_index": 149,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_706e626b",
          "center_x": 249.47366333007812,
          "center_y": 250.5887908935547,
          "radius_x": 241.38897705078125,
          "radius_y": 242.9446563720703,
          "rotation": 10.95101261138916,
          "slice_index": 149,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.216935"
        }
      ],
      "brush_strokes": []
    },
    "y_150": {
      "slice_index": 150,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f8e0a81b",
          "center_x": 249.1134796142578,
          "center_y": 250.48294067382812,
          "radius_x": 240.88307189941406,
          "radius_y": 242.8697052001953,
          "rotation": 20.664939880371094,
          "slice_index": 150,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.246124"
        }
      ],
      "brush_strokes": []
    },
    "y_151": {
      "slice_index": 151,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_fb7a1b56",
          "center_x": 249.2942352294922,
          "center_y": 250.4614715576172,
          "radius_x": 240.8555145263672,
          "radius_y": 243.586669921875,
          "rotation": 6.715648174285889,
          "slice_index": 151,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.274117"
        }
      ],
      "brush_strokes": []
    },
    "y_152": {
      "slice_index": 152,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_67a2aa2f",
          "center_x": 249.376220703125,
          "center_y": 250.56382751464844,
          "radius_x": 240.65499877929688,
          "radius_y": 243.7913055419922,
          "rotation": 9.768253326416016,
          "slice_index": 152,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.303139"
        }
      ],
      "brush_strokes": []
    },
    "y_153": {
      "slice_index": 153,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_aea94ba8",
          "center_x": 249.1023712158203,
          "center_y": 250.57569885253906,
          "radius_x": 240.575439453125,
          "radius_y": 243.96621704101562,
          "rotation": 4.741910457611084,
          "slice_index": 153,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.334429"
        }
      ],
      "brush_strokes": []
    },
    "y_154": {
      "slice_index": 154,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_127af291",
          "center_x": 249.2945556640625,
          "center_y": 250.37904357910156,
          "radius_x": 241.02125549316406,
          "radius_y": 243.82574462890625,
          "rotation": 2.4802589416503906,
          "slice_index": 154,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.363510"
        }
      ],
      "brush_strokes": []
    },
    "y_155": {
      "slice_index": 155,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7b68770e",
          "center_x": 249.18719482421875,
          "center_y": 250.43138122558594,
          "radius_x": 240.6538848876953,
          "radius_y": 244.43617248535156,
          "rotation": 2.351889133453369,
          "slice_index": 155,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.392427"
        }
      ],
      "brush_strokes": []
    },
    "y_156": {
      "slice_index": 156,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_071d806e",
          "center_x": 249.4773406982422,
          "center_y": 250.58941650390625,
          "radius_x": 240.68673706054688,
          "radius_y": 244.80081176757812,
          "rotation": 0.747776210308075,
          "slice_index": 156,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.420939"
        }
      ],
      "brush_strokes": []
    },
    "y_157": {
      "slice_index": 157,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_de05e8e8",
          "center_x": 249.41481018066406,
          "center_y": 250.1259307861328,
          "radius_x": 240.74908447265625,
          "radius_y": 244.5824432373047,
          "rotation": 3.848939895629883,
          "slice_index": 157,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.449947"
        }
      ],
      "brush_strokes": []
    },
    "y_158": {
      "slice_index": 158,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3da9c52d",
          "center_x": 249.22669982910156,
          "center_y": 250.0929412841797,
          "radius_x": 240.40931701660156,
          "radius_y": 244.6419677734375,
          "rotation": 4.894920349121094,
          "slice_index": 158,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.478946"
        }
      ],
      "brush_strokes": []
    },
    "y_159": {
      "slice_index": 159,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6b93cf2a",
          "center_x": 248.91993713378906,
          "center_y": 250.3547821044922,
          "radius_x": 240.29489135742188,
          "radius_y": 245.318603515625,
          "rotation": 179.5742645263672,
          "slice_index": 159,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.506955"
        }
      ],
      "brush_strokes": []
    },
    "y_160": {
      "slice_index": 160,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9b9fd6e9",
          "center_x": 249.1737518310547,
          "center_y": 250.14675903320312,
          "radius_x": 239.84225463867188,
          "radius_y": 245.14085388183594,
          "rotation": 6.909371376037598,
          "slice_index": 160,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.536195"
        }
      ],
      "brush_strokes": []
    },
    "y_161": {
      "slice_index": 161,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_98c25db6",
          "center_x": 249.26914978027344,
          "center_y": 249.92210388183594,
          "radius_x": 240.0094451904297,
          "radius_y": 245.39276123046875,
          "rotation": 4.3103179931640625,
          "slice_index": 161,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.566198"
        }
      ],
      "brush_strokes": []
    },
    "y_162": {
      "slice_index": 162,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_cf510084",
          "center_x": 249.00021362304688,
          "center_y": 250.12799072265625,
          "radius_x": 239.7569122314453,
          "radius_y": 245.54615783691406,
          "rotation": 2.4451897144317627,
          "slice_index": 162,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.594199"
        }
      ],
      "brush_strokes": []
    },
    "y_163": {
      "slice_index": 163,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_caba1a17",
          "center_x": 248.93994140625,
          "center_y": 249.94189453125,
          "radius_x": 240.0616455078125,
          "radius_y": 245.34461975097656,
          "rotation": 2.971857786178589,
          "slice_index": 163,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.624361"
        }
      ],
      "brush_strokes": []
    },
    "y_164": {
      "slice_index": 164,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1edc73e7",
          "center_x": 249.32568359375,
          "center_y": 250.0023193359375,
          "radius_x": 239.41383361816406,
          "radius_y": 246.05703735351562,
          "rotation": 4.001466751098633,
          "slice_index": 164,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.654353"
        }
      ],
      "brush_strokes": []
    },
    "y_165": {
      "slice_index": 165,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_11d5b209",
          "center_x": 249.2620086669922,
          "center_y": 249.97174072265625,
          "radius_x": 239.59532165527344,
          "radius_y": 246.13720703125,
          "rotation": 3.4812958240509033,
          "slice_index": 165,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.686353"
        }
      ],
      "brush_strokes": []
    },
    "y_166": {
      "slice_index": 166,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f41189c6",
          "center_x": 248.9339141845703,
          "center_y": 250.08230590820312,
          "radius_x": 239.4746551513672,
          "radius_y": 245.92294311523438,
          "rotation": 1.6965030431747437,
          "slice_index": 166,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.715364"
        }
      ],
      "brush_strokes": []
    },
    "y_167": {
      "slice_index": 167,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b6ff2806",
          "center_x": 248.90499877929688,
          "center_y": 250.08203125,
          "radius_x": 239.08384704589844,
          "radius_y": 246.60821533203125,
          "rotation": 1.1808176040649414,
          "slice_index": 167,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.743049"
        }
      ],
      "brush_strokes": []
    },
    "y_168": {
      "slice_index": 168,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7fa9f130",
          "center_x": 249.0814666748047,
          "center_y": 250.28895568847656,
          "radius_x": 238.9628143310547,
          "radius_y": 246.7346954345703,
          "rotation": 1.8817490339279175,
          "slice_index": 168,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.771190"
        }
      ],
      "brush_strokes": []
    },
    "y_169": {
      "slice_index": 169,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_764516d9",
          "center_x": 249.02001953125,
          "center_y": 249.74563598632812,
          "radius_x": 238.66107177734375,
          "radius_y": 247.66510009765625,
          "rotation": 2.206859827041626,
          "slice_index": 169,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.799188"
        }
      ],
      "brush_strokes": []
    },
    "y_170": {
      "slice_index": 170,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_fe0593a3",
          "center_x": 249.22901916503906,
          "center_y": 250.03485107421875,
          "radius_x": 239.26632690429688,
          "radius_y": 246.9795379638672,
          "rotation": 1.7258021831512451,
          "slice_index": 170,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.829834"
        }
      ],
      "brush_strokes": []
    },
    "y_171": {
      "slice_index": 171,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_fad3c020",
          "center_x": 249.1328887939453,
          "center_y": 249.90940856933594,
          "radius_x": 238.8455810546875,
          "radius_y": 247.94398498535156,
          "rotation": 1.1082570552825928,
          "slice_index": 171,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.858073"
        }
      ],
      "brush_strokes": []
    },
    "y_172": {
      "slice_index": 172,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_a886c540",
          "center_x": 249.2610321044922,
          "center_y": 250.04153442382812,
          "radius_x": 238.60308837890625,
          "radius_y": 247.41183471679688,
          "rotation": 2.375200033187866,
          "slice_index": 172,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.895993"
        }
      ],
      "brush_strokes": []
    },
    "y_173": {
      "slice_index": 173,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3d716a6a",
          "center_x": 249.06155395507812,
          "center_y": 249.88507080078125,
          "radius_x": 239.1659698486328,
          "radius_y": 246.92897033691406,
          "rotation": 1.5849372148513794,
          "slice_index": 173,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.927617"
        }
      ],
      "brush_strokes": []
    },
    "y_174": {
      "slice_index": 174,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1196fc99",
          "center_x": 249.2124786376953,
          "center_y": 250.17984008789062,
          "radius_x": 239.43141174316406,
          "radius_y": 246.5579376220703,
          "rotation": 0.8767237067222595,
          "slice_index": 174,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.959604"
        }
      ],
      "brush_strokes": []
    },
    "y_175": {
      "slice_index": 175,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5852c2f2",
          "center_x": 248.97952270507812,
          "center_y": 249.91517639160156,
          "radius_x": 239.0846405029297,
          "radius_y": 246.6931610107422,
          "rotation": 1.159324049949646,
          "slice_index": 175,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:40.986517"
        }
      ],
      "brush_strokes": []
    },
    "y_176": {
      "slice_index": 176,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_99482181",
          "center_x": 249.32752990722656,
          "center_y": 249.87196350097656,
          "radius_x": 238.91893005371094,
          "radius_y": 247.2784881591797,
          "rotation": 2.0464327335357666,
          "slice_index": 176,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.013530"
        }
      ],
      "brush_strokes": []
    },
    "y_177": {
      "slice_index": 177,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c57b6c3a",
          "center_x": 248.96368408203125,
          "center_y": 249.82615661621094,
          "radius_x": 239.34141540527344,
          "radius_y": 246.18577575683594,
          "rotation": 2.715573310852051,
          "slice_index": 177,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.041069"
        }
      ],
      "brush_strokes": []
    },
    "y_178": {
      "slice_index": 178,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_cbca074a",
          "center_x": 249.07022094726562,
          "center_y": 250.4384765625,
          "radius_x": 239.07302856445312,
          "radius_y": 247.063720703125,
          "rotation": 1.8815886974334717,
          "slice_index": 178,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.069145"
        }
      ],
      "brush_strokes": []
    },
    "y_179": {
      "slice_index": 179,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_51649939",
          "center_x": 249.1892852783203,
          "center_y": 249.95074462890625,
          "radius_x": 239.3023223876953,
          "radius_y": 246.78445434570312,
          "rotation": 0.3320762813091278,
          "slice_index": 179,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.096437"
        }
      ],
      "brush_strokes": []
    },
    "y_180": {
      "slice_index": 180,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_79639d7a",
          "center_x": 249.1046905517578,
          "center_y": 249.8706512451172,
          "radius_x": 239.51495361328125,
          "radius_y": 246.63949584960938,
          "rotation": 179.3841094970703,
          "slice_index": 180,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.125771"
        }
      ],
      "brush_strokes": []
    },
    "y_181": {
      "slice_index": 181,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_0a92c485",
          "center_x": 248.90966796875,
          "center_y": 250.00006103515625,
          "radius_x": 239.44444274902344,
          "radius_y": 246.10791015625,
          "rotation": 2.0516016483306885,
          "slice_index": 181,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.153660"
        }
      ],
      "brush_strokes": []
    },
    "y_182": {
      "slice_index": 182,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d26e6667",
          "center_x": 248.8008270263672,
          "center_y": 249.65213012695312,
          "radius_x": 238.95838928222656,
          "radius_y": 247.1686553955078,
          "rotation": 0.5715113878250122,
          "slice_index": 182,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.181109"
        }
      ],
      "brush_strokes": []
    },
    "y_183": {
      "slice_index": 183,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_12d3e97f",
          "center_x": 248.73715209960938,
          "center_y": 249.7581024169922,
          "radius_x": 238.72898864746094,
          "radius_y": 247.7962646484375,
          "rotation": 1.0750585794448853,
          "slice_index": 183,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.209111"
        }
      ],
      "brush_strokes": []
    },
    "y_184": {
      "slice_index": 184,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d023e2b4",
          "center_x": 249.09849548339844,
          "center_y": 250.0569610595703,
          "radius_x": 239.25442504882812,
          "radius_y": 247.2630157470703,
          "rotation": 2.66620135307312,
          "slice_index": 184,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.237984"
        }
      ],
      "brush_strokes": []
    },
    "y_185": {
      "slice_index": 185,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ba6272a4",
          "center_x": 249.15655517578125,
          "center_y": 249.90916442871094,
          "radius_x": 239.31410217285156,
          "radius_y": 247.3820343017578,
          "rotation": 2.458235740661621,
          "slice_index": 185,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.267097"
        }
      ],
      "brush_strokes": []
    },
    "y_186": {
      "slice_index": 186,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_aa9b2111",
          "center_x": 249.2047119140625,
          "center_y": 249.98646545410156,
          "radius_x": 238.88839721679688,
          "radius_y": 247.29925537109375,
          "rotation": 3.0683748722076416,
          "slice_index": 186,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.297076"
        }
      ],
      "brush_strokes": []
    },
    "y_187": {
      "slice_index": 187,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_699f7e32",
          "center_x": 249.10086059570312,
          "center_y": 249.8427276611328,
          "radius_x": 239.1802978515625,
          "radius_y": 246.94607543945312,
          "rotation": 1.8713312149047852,
          "slice_index": 187,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.324277"
        }
      ],
      "brush_strokes": []
    },
    "y_188": {
      "slice_index": 188,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_4f8cc02a",
          "center_x": 249.2825469970703,
          "center_y": 250.24417114257812,
          "radius_x": 238.83016967773438,
          "radius_y": 247.58799743652344,
          "rotation": 0.7898680567741394,
          "slice_index": 188,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.353278"
        }
      ],
      "brush_strokes": []
    },
    "y_189": {
      "slice_index": 189,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_8c08c2be",
          "center_x": 248.99378967285156,
          "center_y": 250.25633239746094,
          "radius_x": 239.14486694335938,
          "radius_y": 247.2704315185547,
          "rotation": 0.6635844707489014,
          "slice_index": 189,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.380279"
        }
      ],
      "brush_strokes": []
    },
    "y_190": {
      "slice_index": 190,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_dd647b9c",
          "center_x": 249.04627990722656,
          "center_y": 249.89620971679688,
          "radius_x": 238.96546936035156,
          "radius_y": 247.34634399414062,
          "rotation": 0.4256493151187897,
          "slice_index": 190,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.432104"
        }
      ],
      "brush_strokes": []
    },
    "y_191": {
      "slice_index": 191,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_0864dba5",
          "center_x": 249.38885498046875,
          "center_y": 249.7330780029297,
          "radius_x": 238.9058380126953,
          "radius_y": 247.63343811035156,
          "rotation": 0.27661603689193726,
          "slice_index": 191,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.526356"
        }
      ],
      "brush_strokes": []
    },
    "y_192": {
      "slice_index": 192,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b127c0db",
          "center_x": 249.42919921875,
          "center_y": 249.90859985351562,
          "radius_x": 238.69149780273438,
          "radius_y": 247.61605834960938,
          "rotation": 1.2452645301818848,
          "slice_index": 192,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.596450"
        }
      ],
      "brush_strokes": []
    },
    "y_193": {
      "slice_index": 193,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_42dcc413",
          "center_x": 249.19374084472656,
          "center_y": 249.94764709472656,
          "radius_x": 238.87660217285156,
          "radius_y": 248.02821350097656,
          "rotation": 179.94554138183594,
          "slice_index": 193,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.623677"
        }
      ],
      "brush_strokes": []
    },
    "y_194": {
      "slice_index": 194,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_62244dcd",
          "center_x": 249.15452575683594,
          "center_y": 249.854736328125,
          "radius_x": 239.2694854736328,
          "radius_y": 247.25521850585938,
          "rotation": 0.20522944629192352,
          "slice_index": 194,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.650682"
        }
      ],
      "brush_strokes": []
    },
    "y_195": {
      "slice_index": 195,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_252211eb",
          "center_x": 249.2003173828125,
          "center_y": 250.15408325195312,
          "radius_x": 239.02005004882812,
          "radius_y": 247.23593139648438,
          "rotation": 1.393183708190918,
          "slice_index": 195,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.679763"
        }
      ],
      "brush_strokes": []
    },
    "y_196": {
      "slice_index": 196,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_85fe8126",
          "center_x": 249.20726013183594,
          "center_y": 250.12930297851562,
          "radius_x": 238.88673400878906,
          "radius_y": 247.30137634277344,
          "rotation": 1.7185457944869995,
          "slice_index": 196,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.707679"
        }
      ],
      "brush_strokes": []
    },
    "y_197": {
      "slice_index": 197,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_88d2eea2",
          "center_x": 249.39483642578125,
          "center_y": 249.8632354736328,
          "radius_x": 238.80674743652344,
          "radius_y": 247.8702850341797,
          "rotation": 0.8819423913955688,
          "slice_index": 197,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.734995"
        }
      ],
      "brush_strokes": []
    },
    "y_198": {
      "slice_index": 198,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3b233061",
          "center_x": 249.0116424560547,
          "center_y": 250.05545043945312,
          "radius_x": 239.3455810546875,
          "radius_y": 246.9450225830078,
          "rotation": 0.39014139771461487,
          "slice_index": 198,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.763600"
        }
      ],
      "brush_strokes": []
    },
    "y_199": {
      "slice_index": 199,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_abea2436",
          "center_x": 249.21817016601562,
          "center_y": 250.2523956298828,
          "radius_x": 238.79119873046875,
          "radius_y": 247.44337463378906,
          "rotation": 179.67758178710938,
          "slice_index": 199,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.792540"
        }
      ],
      "brush_strokes": []
    },
    "y_200": {
      "slice_index": 200,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_0790764f",
          "center_x": 249.429443359375,
          "center_y": 249.94728088378906,
          "radius_x": 239.123291015625,
          "radius_y": 246.6180419921875,
          "rotation": 3.1890485286712646,
          "slice_index": 200,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.823095"
        }
      ],
      "brush_strokes": []
    },
    "y_201": {
      "slice_index": 201,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_4ceddbf2",
          "center_x": 249.3294677734375,
          "center_y": 249.77584838867188,
          "radius_x": 239.0688934326172,
          "radius_y": 247.55337524414062,
          "rotation": 0.2911967933177948,
          "slice_index": 201,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.851094"
        }
      ],
      "brush_strokes": []
    },
    "y_202": {
      "slice_index": 202,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e9925613",
          "center_x": 249.25555419921875,
          "center_y": 249.64208984375,
          "radius_x": 239.0818328857422,
          "radius_y": 247.59405517578125,
          "rotation": 0.6787887215614319,
          "slice_index": 202,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.879094"
        }
      ],
      "brush_strokes": []
    },
    "y_203": {
      "slice_index": 203,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_89b50b68",
          "center_x": 249.40269470214844,
          "center_y": 250.05621337890625,
          "radius_x": 238.94796752929688,
          "radius_y": 247.47706604003906,
          "rotation": 0.7727063894271851,
          "slice_index": 203,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.908576"
        }
      ],
      "brush_strokes": []
    },
    "y_204": {
      "slice_index": 204,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d2cd1bd6",
          "center_x": 249.14340209960938,
          "center_y": 250.1671142578125,
          "radius_x": 238.92910766601562,
          "radius_y": 247.59877014160156,
          "rotation": 0.30728286504745483,
          "slice_index": 204,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.934461"
        }
      ],
      "brush_strokes": []
    },
    "y_205": {
      "slice_index": 205,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f9389983",
          "center_x": 249.1405487060547,
          "center_y": 250.1198272705078,
          "radius_x": 238.8024444580078,
          "radius_y": 247.25120544433594,
          "rotation": 179.94308471679688,
          "slice_index": 205,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.966461"
        }
      ],
      "brush_strokes": []
    },
    "y_206": {
      "slice_index": 206,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b217ef0c",
          "center_x": 249.2108612060547,
          "center_y": 250.1840362548828,
          "radius_x": 238.84344482421875,
          "radius_y": 247.06788635253906,
          "rotation": 179.3197479248047,
          "slice_index": 206,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:41.996454"
        }
      ],
      "brush_strokes": []
    },
    "y_207": {
      "slice_index": 207,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2e740183",
          "center_x": 249.0888214111328,
          "center_y": 250.1460723876953,
          "radius_x": 239.14764404296875,
          "radius_y": 247.1686553955078,
          "rotation": 178.81417846679688,
          "slice_index": 207,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.025998"
        }
      ],
      "brush_strokes": []
    },
    "y_208": {
      "slice_index": 208,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_dd5a87e1",
          "center_x": 249.21807861328125,
          "center_y": 249.8766632080078,
          "radius_x": 238.68026733398438,
          "radius_y": 247.74073791503906,
          "rotation": 179.44873046875,
          "slice_index": 208,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.066991"
        }
      ],
      "brush_strokes": []
    },
    "y_209": {
      "slice_index": 209,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_544a0739",
          "center_x": 249.4208221435547,
          "center_y": 249.94895935058594,
          "radius_x": 238.58668518066406,
          "radius_y": 247.94017028808594,
          "rotation": 1.6686949729919434,
          "slice_index": 209,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.099610"
        }
      ],
      "brush_strokes": []
    },
    "y_210": {
      "slice_index": 210,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_95d1befa",
          "center_x": 249.16009521484375,
          "center_y": 249.7066192626953,
          "radius_x": 238.64002990722656,
          "radius_y": 247.48672485351562,
          "rotation": 2.1133573055267334,
          "slice_index": 210,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.127478"
        }
      ],
      "brush_strokes": []
    },
    "y_211": {
      "slice_index": 211,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b9a2c6ce",
          "center_x": 249.2401885986328,
          "center_y": 249.66029357910156,
          "radius_x": 238.60549926757812,
          "radius_y": 247.86398315429688,
          "rotation": 179.65057373046875,
          "slice_index": 211,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.156394"
        }
      ],
      "brush_strokes": []
    },
    "y_212": {
      "slice_index": 212,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9dfc52b0",
          "center_x": 248.97390747070312,
          "center_y": 249.8843536376953,
          "radius_x": 239.0142822265625,
          "radius_y": 247.66802978515625,
          "rotation": 179.3218994140625,
          "slice_index": 212,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.184907"
        }
      ],
      "brush_strokes": []
    },
    "y_213": {
      "slice_index": 213,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9b4cdac5",
          "center_x": 249.10598754882812,
          "center_y": 249.86985778808594,
          "radius_x": 238.4032745361328,
          "radius_y": 247.88108825683594,
          "rotation": 1.1868152618408203,
          "slice_index": 213,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.221442"
        }
      ],
      "brush_strokes": []
    },
    "y_214": {
      "slice_index": 214,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_fb215169",
          "center_x": 249.11651611328125,
          "center_y": 250.148681640625,
          "radius_x": 238.57138061523438,
          "radius_y": 247.253662109375,
          "rotation": 179.89024353027344,
          "slice_index": 214,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.265448"
        }
      ],
      "brush_strokes": []
    },
    "y_215": {
      "slice_index": 215,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_800ed428",
          "center_x": 249.03028869628906,
          "center_y": 249.99928283691406,
          "radius_x": 238.4802703857422,
          "radius_y": 247.75457763671875,
          "rotation": 0.6525914072990417,
          "slice_index": 215,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.297629"
        }
      ],
      "brush_strokes": []
    },
    "y_216": {
      "slice_index": 216,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c168a55c",
          "center_x": 249.19815063476562,
          "center_y": 250.20616149902344,
          "radius_x": 238.75624084472656,
          "radius_y": 247.25296020507812,
          "rotation": 179.0750732421875,
          "slice_index": 216,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.326140"
        }
      ],
      "brush_strokes": []
    },
    "y_217": {
      "slice_index": 217,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ced137a9",
          "center_x": 249.1263885498047,
          "center_y": 250.0045928955078,
          "radius_x": 238.87469482421875,
          "radius_y": 247.026123046875,
          "rotation": 179.59356689453125,
          "slice_index": 217,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.357140"
        }
      ],
      "brush_strokes": []
    },
    "y_218": {
      "slice_index": 218,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5b9bd9cf",
          "center_x": 249.2864532470703,
          "center_y": 249.665771484375,
          "radius_x": 239.00482177734375,
          "radius_y": 247.6057891845703,
          "rotation": 179.50115966796875,
          "slice_index": 218,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.385140"
        }
      ],
      "brush_strokes": []
    },
    "y_219": {
      "slice_index": 219,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1359c72b",
          "center_x": 249.28282165527344,
          "center_y": 249.98770141601562,
          "radius_x": 239.1979217529297,
          "radius_y": 247.0186767578125,
          "rotation": 179.46630859375,
          "slice_index": 219,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.414142"
        }
      ],
      "brush_strokes": []
    },
    "y_220": {
      "slice_index": 220,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d3d129e0",
          "center_x": 249.1998291015625,
          "center_y": 250.13563537597656,
          "radius_x": 238.98255920410156,
          "radius_y": 247.01319885253906,
          "rotation": 0.7793565988540649,
          "slice_index": 220,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.441908"
        }
      ],
      "brush_strokes": []
    },
    "y_221": {
      "slice_index": 221,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f2a9cca0",
          "center_x": 248.87149047851562,
          "center_y": 249.96170043945312,
          "radius_x": 239.40499877929688,
          "radius_y": 247.03054809570312,
          "rotation": 179.4110107421875,
          "slice_index": 221,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.475252"
        }
      ],
      "brush_strokes": []
    },
    "y_222": {
      "slice_index": 222,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5b2830ba",
          "center_x": 248.83139038085938,
          "center_y": 250.02662658691406,
          "radius_x": 238.83326721191406,
          "radius_y": 247.4689178466797,
          "rotation": 179.5850372314453,
          "slice_index": 222,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.524769"
        }
      ],
      "brush_strokes": []
    },
    "y_223": {
      "slice_index": 223,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ff890104",
          "center_x": 248.9335479736328,
          "center_y": 250.0397491455078,
          "radius_x": 238.62928771972656,
          "radius_y": 247.20448303222656,
          "rotation": 0.2424883097410202,
          "slice_index": 223,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.557844"
        }
      ],
      "brush_strokes": []
    },
    "y_224": {
      "slice_index": 224,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ecd00a95",
          "center_x": 249.30184936523438,
          "center_y": 249.7986297607422,
          "radius_x": 238.49258422851562,
          "radius_y": 247.9073486328125,
          "rotation": 1.947147250175476,
          "slice_index": 224,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.585843"
        }
      ],
      "brush_strokes": []
    },
    "y_225": {
      "slice_index": 225,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_43f0df3e",
          "center_x": 249.27938842773438,
          "center_y": 250.09364318847656,
          "radius_x": 238.84222412109375,
          "radius_y": 247.70884704589844,
          "rotation": 1.1662707328796387,
          "slice_index": 225,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.613847"
        }
      ],
      "brush_strokes": []
    },
    "y_226": {
      "slice_index": 226,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2fc49153",
          "center_x": 249.2320098876953,
          "center_y": 250.08544921875,
          "radius_x": 238.78887939453125,
          "radius_y": 247.49832153320312,
          "rotation": 0.5348255634307861,
          "slice_index": 226,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.640353"
        }
      ],
      "brush_strokes": []
    },
    "y_227": {
      "slice_index": 227,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_861b7399",
          "center_x": 249.14906311035156,
          "center_y": 250.21697998046875,
          "radius_x": 238.932861328125,
          "radius_y": 247.3688201904297,
          "rotation": 1.4687694311141968,
          "slice_index": 227,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.667352"
        }
      ],
      "brush_strokes": []
    },
    "y_228": {
      "slice_index": 228,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_76176093",
          "center_x": 249.2025146484375,
          "center_y": 249.8873748779297,
          "radius_x": 238.65914916992188,
          "radius_y": 247.6115264892578,
          "rotation": 2.491875648498535,
          "slice_index": 228,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.695936"
        }
      ],
      "brush_strokes": []
    },
    "y_229": {
      "slice_index": 229,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_97567844",
          "center_x": 249.10499572753906,
          "center_y": 249.95188903808594,
          "radius_x": 238.52249145507812,
          "radius_y": 247.92990112304688,
          "rotation": 0.5919896364212036,
          "slice_index": 229,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.725270"
        }
      ],
      "brush_strokes": []
    },
    "y_230": {
      "slice_index": 230,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_121065a5",
          "center_x": 249.251220703125,
          "center_y": 249.9085235595703,
          "radius_x": 238.6200714111328,
          "radius_y": 247.533935546875,
          "rotation": 1.2558305263519287,
          "slice_index": 230,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.752395"
        }
      ],
      "brush_strokes": []
    },
    "y_231": {
      "slice_index": 231,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f328271a",
          "center_x": 248.93576049804688,
          "center_y": 249.52645874023438,
          "radius_x": 238.3637237548828,
          "radius_y": 248.42591857910156,
          "rotation": 0.2506399154663086,
          "slice_index": 231,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.781401"
        }
      ],
      "brush_strokes": []
    },
    "y_232": {
      "slice_index": 232,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ae97e297",
          "center_x": 249.14479064941406,
          "center_y": 250.17213439941406,
          "radius_x": 238.07398986816406,
          "radius_y": 248.4613800048828,
          "rotation": 179.4916229248047,
          "slice_index": 232,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.808398"
        }
      ],
      "brush_strokes": []
    },
    "y_233": {
      "slice_index": 233,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2dbdee4f",
          "center_x": 249.22079467773438,
          "center_y": 249.84129333496094,
          "radius_x": 238.3776092529297,
          "radius_y": 248.3354949951172,
          "rotation": 0.3177081346511841,
          "slice_index": 233,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.835905"
        }
      ],
      "brush_strokes": []
    },
    "y_234": {
      "slice_index": 234,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c3f42f07",
          "center_x": 249.0180206298828,
          "center_y": 249.81520080566406,
          "radius_x": 238.34774780273438,
          "radius_y": 248.34544372558594,
          "rotation": 0.40520554780960083,
          "slice_index": 234,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.862906"
        }
      ],
      "brush_strokes": []
    },
    "y_235": {
      "slice_index": 235,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_452ca2d8",
          "center_x": 249.05123901367188,
          "center_y": 249.89088439941406,
          "radius_x": 238.46644592285156,
          "radius_y": 247.95082092285156,
          "rotation": 1.3121665716171265,
          "slice_index": 235,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.892156"
        }
      ],
      "brush_strokes": []
    },
    "y_236": {
      "slice_index": 236,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_71129a51",
          "center_x": 249.1045379638672,
          "center_y": 249.9370574951172,
          "radius_x": 238.79994201660156,
          "radius_y": 247.38609313964844,
          "rotation": 0.4054241478443146,
          "slice_index": 236,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.918915"
        }
      ],
      "brush_strokes": []
    },
    "y_237": {
      "slice_index": 237,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3fe05b8a",
          "center_x": 249.19419860839844,
          "center_y": 250.23858642578125,
          "radius_x": 238.26568603515625,
          "radius_y": 248.18478393554688,
          "rotation": 179.9601593017578,
          "slice_index": 237,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.946956"
        }
      ],
      "brush_strokes": []
    },
    "y_238": {
      "slice_index": 238,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f8b20197",
          "center_x": 249.4260711669922,
          "center_y": 250.2884979248047,
          "radius_x": 238.1109619140625,
          "radius_y": 248.50408935546875,
          "rotation": 0.3802564740180969,
          "slice_index": 238,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:42.974964"
        }
      ],
      "brush_strokes": []
    },
    "y_239": {
      "slice_index": 239,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_87ae8ed3",
          "center_x": 249.3466796875,
          "center_y": 249.8838348388672,
          "radius_x": 237.9947509765625,
          "radius_y": 248.79100036621094,
          "rotation": 1.1501084566116333,
          "slice_index": 239,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.003899"
        }
      ],
      "brush_strokes": []
    },
    "y_240": {
      "slice_index": 240,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_40d0e19d",
          "center_x": 249.2215118408203,
          "center_y": 249.88644409179688,
          "radius_x": 238.4713897705078,
          "radius_y": 248.60169982910156,
          "rotation": 0.5868030190467834,
          "slice_index": 240,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.031719"
        }
      ],
      "brush_strokes": []
    },
    "y_241": {
      "slice_index": 241,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_cc13f475",
          "center_x": 248.9664764404297,
          "center_y": 249.64974975585938,
          "radius_x": 238.52098083496094,
          "radius_y": 248.3036346435547,
          "rotation": 1.9032559394836426,
          "slice_index": 241,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.061194"
        }
      ],
      "brush_strokes": []
    },
    "y_242": {
      "slice_index": 242,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b11ece23",
          "center_x": 249.16848754882812,
          "center_y": 249.8391571044922,
          "radius_x": 238.55352783203125,
          "radius_y": 247.92276000976562,
          "rotation": 0.06454797834157944,
          "slice_index": 242,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.088225"
        }
      ],
      "brush_strokes": []
    },
    "y_243": {
      "slice_index": 243,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d2370c4c",
          "center_x": 249.30819702148438,
          "center_y": 250.185302734375,
          "radius_x": 238.73696899414062,
          "radius_y": 247.8020477294922,
          "rotation": 1.5265264511108398,
          "slice_index": 243,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.116164"
        }
      ],
      "brush_strokes": []
    },
    "y_244": {
      "slice_index": 244,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_aede654c",
          "center_x": 248.9169158935547,
          "center_y": 249.98974609375,
          "radius_x": 238.71730041503906,
          "radius_y": 247.88853454589844,
          "rotation": 179.40924072265625,
          "slice_index": 244,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.145288"
        }
      ],
      "brush_strokes": []
    },
    "y_245": {
      "slice_index": 245,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_371320b4",
          "center_x": 249.2520751953125,
          "center_y": 249.88169860839844,
          "radius_x": 238.97340393066406,
          "radius_y": 247.7294158935547,
          "rotation": 178.91575622558594,
          "slice_index": 245,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.172077"
        }
      ],
      "brush_strokes": []
    },
    "y_246": {
      "slice_index": 246,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e06881b5",
          "center_x": 249.38623046875,
          "center_y": 249.8719024658203,
          "radius_x": 238.9401092529297,
          "radius_y": 247.6587677001953,
          "rotation": 0.3462942838668823,
          "slice_index": 246,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.199402"
        }
      ],
      "brush_strokes": []
    },
    "y_247": {
      "slice_index": 247,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1414583d",
          "center_x": 249.46200561523438,
          "center_y": 249.67025756835938,
          "radius_x": 238.74295043945312,
          "radius_y": 247.66404724121094,
          "rotation": 0.515450119972229,
          "slice_index": 247,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.226112"
        }
      ],
      "brush_strokes": []
    },
    "y_248": {
      "slice_index": 248,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d3374b9f",
          "center_x": 248.97518920898438,
          "center_y": 249.77066040039062,
          "radius_x": 238.93682861328125,
          "radius_y": 247.33563232421875,
          "rotation": 0.5898920893669128,
          "slice_index": 248,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.252919"
        }
      ],
      "brush_strokes": []
    },
    "y_249": {
      "slice_index": 249,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_42e1a058",
          "center_x": 249.2272491455078,
          "center_y": 249.7610626220703,
          "radius_x": 239.02023315429688,
          "radius_y": 247.6302947998047,
          "rotation": 0.4377678334712982,
          "slice_index": 249,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.283088"
        }
      ],
      "brush_strokes": []
    },
    "y_250": {
      "slice_index": 250,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3a434427",
          "center_x": 249.51568603515625,
          "center_y": 250.2235870361328,
          "radius_x": 238.89627075195312,
          "radius_y": 247.823486328125,
          "rotation": 1.1883972883224487,
          "slice_index": 250,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.312183"
        }
      ],
      "brush_strokes": []
    },
    "y_251": {
      "slice_index": 251,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7b543450",
          "center_x": 249.2963409423828,
          "center_y": 250.28123474121094,
          "radius_x": 238.54312133789062,
          "radius_y": 247.53115844726562,
          "rotation": 0.7589843273162842,
          "slice_index": 251,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.340668"
        }
      ],
      "brush_strokes": []
    },
    "y_252": {
      "slice_index": 252,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_df97a877",
          "center_x": 249.3944091796875,
          "center_y": 250.03131103515625,
          "radius_x": 238.881103515625,
          "radius_y": 247.6112518310547,
          "rotation": 0.6664935946464539,
          "slice_index": 252,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.371868"
        }
      ],
      "brush_strokes": []
    },
    "y_253": {
      "slice_index": 253,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_4fba1b05",
          "center_x": 248.97471618652344,
          "center_y": 249.6829071044922,
          "radius_x": 238.6917266845703,
          "radius_y": 247.86575317382812,
          "rotation": 1.049527883529663,
          "slice_index": 253,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.399977"
        }
      ],
      "brush_strokes": []
    },
    "y_254": {
      "slice_index": 254,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1754207c",
          "center_x": 249.1410369873047,
          "center_y": 249.7147216796875,
          "radius_x": 238.44454956054688,
          "radius_y": 247.96109008789062,
          "rotation": 0.7691882252693176,
          "slice_index": 254,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.429483"
        }
      ],
      "brush_strokes": []
    },
    "y_255": {
      "slice_index": 255,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_dc8e2ee5",
          "center_x": 249.10792541503906,
          "center_y": 249.7786407470703,
          "radius_x": 238.6654815673828,
          "radius_y": 247.53704833984375,
          "rotation": 0.7455953359603882,
          "slice_index": 255,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.458269"
        }
      ],
      "brush_strokes": []
    },
    "y_256": {
      "slice_index": 256,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e4e5b10a",
          "center_x": 249.33575439453125,
          "center_y": 249.88497924804688,
          "radius_x": 238.48928833007812,
          "radius_y": 247.8975372314453,
          "rotation": 1.971386432647705,
          "slice_index": 256,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.485835"
        }
      ],
      "brush_strokes": []
    },
    "y_257": {
      "slice_index": 257,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_88345c00",
          "center_x": 249.27511596679688,
          "center_y": 250.0441436767578,
          "radius_x": 238.49951171875,
          "radius_y": 248.01280212402344,
          "rotation": 0.8534005284309387,
          "slice_index": 257,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.513509"
        }
      ],
      "brush_strokes": []
    },
    "y_258": {
      "slice_index": 258,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_4ea5f99b",
          "center_x": 248.9747772216797,
          "center_y": 249.7145538330078,
          "radius_x": 238.70172119140625,
          "radius_y": 247.8192901611328,
          "rotation": 1.051908254623413,
          "slice_index": 258,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.541724"
        }
      ],
      "brush_strokes": []
    },
    "y_259": {
      "slice_index": 259,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d777cd06",
          "center_x": 249.34573364257812,
          "center_y": 250.12875366210938,
          "radius_x": 238.67604064941406,
          "radius_y": 247.4505157470703,
          "rotation": 1.6377098560333252,
          "slice_index": 259,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.569715"
        }
      ],
      "brush_strokes": []
    },
    "y_260": {
      "slice_index": 260,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_60585af0",
          "center_x": 249.10975646972656,
          "center_y": 249.92498779296875,
          "radius_x": 238.63438415527344,
          "radius_y": 247.698974609375,
          "rotation": 179.50668334960938,
          "slice_index": 260,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.596591"
        }
      ],
      "brush_strokes": []
    },
    "y_261": {
      "slice_index": 261,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7bc0b42a",
          "center_x": 249.2401885986328,
          "center_y": 249.65675354003906,
          "radius_x": 238.9251708984375,
          "radius_y": 247.3509063720703,
          "rotation": 179.36976623535156,
          "slice_index": 261,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.625671"
        }
      ],
      "brush_strokes": []
    },
    "y_262": {
      "slice_index": 262,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2be0a9f3",
          "center_x": 249.27566528320312,
          "center_y": 249.72999572753906,
          "radius_x": 238.59288024902344,
          "radius_y": 247.5291748046875,
          "rotation": 179.98451232910156,
          "slice_index": 262,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.655091"
        }
      ],
      "brush_strokes": []
    },
    "y_263": {
      "slice_index": 263,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_a7271242",
          "center_x": 249.01531982421875,
          "center_y": 250.00929260253906,
          "radius_x": 238.5221710205078,
          "radius_y": 247.76315307617188,
          "rotation": 179.8465576171875,
          "slice_index": 263,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.713177"
        }
      ],
      "brush_strokes": []
    },
    "y_264": {
      "slice_index": 264,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1fafbf51",
          "center_x": 249.2114715576172,
          "center_y": 250.15139770507812,
          "radius_x": 238.71987915039062,
          "radius_y": 247.5534210205078,
          "rotation": 0.8093016147613525,
          "slice_index": 264,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.788371"
        }
      ],
      "brush_strokes": []
    },
    "y_265": {
      "slice_index": 265,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9fb6edd9",
          "center_x": 249.3825225830078,
          "center_y": 250.02996826171875,
          "radius_x": 239.09768676757812,
          "radius_y": 247.14743041992188,
          "rotation": 0.9039949774742126,
          "slice_index": 265,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.832351"
        }
      ],
      "brush_strokes": []
    },
    "y_266": {
      "slice_index": 266,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3734d15c",
          "center_x": 249.11502075195312,
          "center_y": 249.88134765625,
          "radius_x": 238.77517700195312,
          "radius_y": 247.28396606445312,
          "rotation": 1.3073574304580688,
          "slice_index": 266,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.866253"
        }
      ],
      "brush_strokes": []
    },
    "y_267": {
      "slice_index": 267,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6a7c4628",
          "center_x": 249.1100616455078,
          "center_y": 249.8002166748047,
          "radius_x": 238.8304443359375,
          "radius_y": 247.65533447265625,
          "rotation": 2.8914971351623535,
          "slice_index": 267,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.894217"
        }
      ],
      "brush_strokes": []
    },
    "y_268": {
      "slice_index": 268,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1c0782f0",
          "center_x": 249.15872192382812,
          "center_y": 249.9381103515625,
          "radius_x": 238.51907348632812,
          "radius_y": 247.45118713378906,
          "rotation": 1.3790780305862427,
          "slice_index": 268,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.921681"
        }
      ],
      "brush_strokes": []
    },
    "y_269": {
      "slice_index": 269,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9cb6bd9f",
          "center_x": 248.78131103515625,
          "center_y": 250.06829833984375,
          "radius_x": 238.7124786376953,
          "radius_y": 247.3806610107422,
          "rotation": 2.0634968280792236,
          "slice_index": 269,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.951566"
        }
      ],
      "brush_strokes": []
    },
    "y_270": {
      "slice_index": 270,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c6ccceb3",
          "center_x": 249.2611846923828,
          "center_y": 249.7013702392578,
          "radius_x": 238.9552459716797,
          "radius_y": 247.09286499023438,
          "rotation": 0.8601349592208862,
          "slice_index": 270,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:43.978649"
        }
      ],
      "brush_strokes": []
    },
    "y_271": {
      "slice_index": 271,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b0ec07b0",
          "center_x": 249.53591918945312,
          "center_y": 249.95614624023438,
          "radius_x": 239.10043334960938,
          "radius_y": 247.09925842285156,
          "rotation": 2.09321928024292,
          "slice_index": 271,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.009920"
        }
      ],
      "brush_strokes": []
    },
    "y_272": {
      "slice_index": 272,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_94ff2409",
          "center_x": 249.4173583984375,
          "center_y": 249.7306671142578,
          "radius_x": 238.8828125,
          "radius_y": 247.6555633544922,
          "rotation": 1.1793287992477417,
          "slice_index": 272,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.039667"
        }
      ],
      "brush_strokes": []
    },
    "y_273": {
      "slice_index": 273,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b7376dce",
          "center_x": 249.1417999267578,
          "center_y": 249.85926818847656,
          "radius_x": 239.03741455078125,
          "radius_y": 247.3323516845703,
          "rotation": 0.13105466961860657,
          "slice_index": 273,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.068659"
        }
      ],
      "brush_strokes": []
    },
    "y_274": {
      "slice_index": 274,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_068a05db",
          "center_x": 249.23809814453125,
          "center_y": 249.7050323486328,
          "radius_x": 238.88331604003906,
          "radius_y": 247.41722106933594,
          "rotation": 0.45111045241355896,
          "slice_index": 274,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.097931"
        }
      ],
      "brush_strokes": []
    },
    "y_275": {
      "slice_index": 275,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ee263456",
          "center_x": 248.94235229492188,
          "center_y": 250.0243377685547,
          "radius_x": 238.90057373046875,
          "radius_y": 247.39068603515625,
          "rotation": 0.2940283715724945,
          "slice_index": 275,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.139573"
        }
      ],
      "brush_strokes": []
    },
    "y_276": {
      "slice_index": 276,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d447af97",
          "center_x": 249.1228790283203,
          "center_y": 250.0746612548828,
          "radius_x": 238.81683349609375,
          "radius_y": 247.52012634277344,
          "rotation": 179.4923095703125,
          "slice_index": 276,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.168895"
        }
      ],
      "brush_strokes": []
    },
    "y_277": {
      "slice_index": 277,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f446a54f",
          "center_x": 249.06698608398438,
          "center_y": 250.13754272460938,
          "radius_x": 238.7101593017578,
          "radius_y": 247.30628967285156,
          "rotation": 0.49446988105773926,
          "slice_index": 277,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.206444"
        }
      ],
      "brush_strokes": []
    },
    "y_278": {
      "slice_index": 278,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_2f7dfe6e",
          "center_x": 249.41307067871094,
          "center_y": 250.11151123046875,
          "radius_x": 239.0001220703125,
          "radius_y": 247.4883270263672,
          "rotation": 1.1688982248306274,
          "slice_index": 278,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.233254"
        }
      ],
      "brush_strokes": []
    },
    "y_279": {
      "slice_index": 279,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d1615756",
          "center_x": 248.9648895263672,
          "center_y": 249.91529846191406,
          "radius_x": 238.76107788085938,
          "radius_y": 247.1456756591797,
          "rotation": 0.5184534788131714,
          "slice_index": 279,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.261291"
        }
      ],
      "brush_strokes": []
    },
    "y_280": {
      "slice_index": 280,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6cc7d5c0",
          "center_x": 249.1279296875,
          "center_y": 249.6809539794922,
          "radius_x": 238.54273986816406,
          "radius_y": 247.29530334472656,
          "rotation": 1.698183536529541,
          "slice_index": 280,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.291723"
        }
      ],
      "brush_strokes": []
    },
    "y_281": {
      "slice_index": 281,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ce07cdb2",
          "center_x": 249.08953857421875,
          "center_y": 249.60414123535156,
          "radius_x": 238.9750213623047,
          "radius_y": 247.24986267089844,
          "rotation": 0.525770902633667,
          "slice_index": 281,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.319707"
        }
      ],
      "brush_strokes": []
    },
    "y_282": {
      "slice_index": 282,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5cd505d5",
          "center_x": 249.08824157714844,
          "center_y": 249.8580780029297,
          "radius_x": 239.21737670898438,
          "radius_y": 246.3241424560547,
          "rotation": 0.5766518712043762,
          "slice_index": 282,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.349290"
        }
      ],
      "brush_strokes": []
    },
    "y_283": {
      "slice_index": 283,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_07157e16",
          "center_x": 248.93353271484375,
          "center_y": 249.62550354003906,
          "radius_x": 239.05931091308594,
          "radius_y": 246.616943359375,
          "rotation": 179.84657287597656,
          "slice_index": 283,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.377351"
        }
      ],
      "brush_strokes": []
    },
    "y_284": {
      "slice_index": 284,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_cc7c03d8",
          "center_x": 249.17562866210938,
          "center_y": 249.95407104492188,
          "radius_x": 238.7954559326172,
          "radius_y": 246.67701721191406,
          "rotation": 1.8266595602035522,
          "slice_index": 284,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.407427"
        }
      ],
      "brush_strokes": []
    },
    "y_285": {
      "slice_index": 285,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ac80293d",
          "center_x": 249.08953857421875,
          "center_y": 249.7919464111328,
          "radius_x": 238.49484252929688,
          "radius_y": 247.38339233398438,
          "rotation": 1.3238474130630493,
          "slice_index": 285,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.442397"
        }
      ],
      "brush_strokes": []
    },
    "y_286": {
      "slice_index": 286,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d366559e",
          "center_x": 248.87193298339844,
          "center_y": 249.7245330810547,
          "radius_x": 238.75132751464844,
          "radius_y": 246.8125762939453,
          "rotation": 0.9279584884643555,
          "slice_index": 286,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.481942"
        }
      ],
      "brush_strokes": []
    },
    "y_287": {
      "slice_index": 287,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e470c8af",
          "center_x": 249.12135314941406,
          "center_y": 249.87271118164062,
          "radius_x": 238.7458953857422,
          "radius_y": 246.89437866210938,
          "rotation": 0.7041690945625305,
          "slice_index": 287,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.520128"
        }
      ],
      "brush_strokes": []
    },
    "y_288": {
      "slice_index": 288,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_8b436c2a",
          "center_x": 249.2381591796875,
          "center_y": 250.15542602539062,
          "radius_x": 239.0069122314453,
          "radius_y": 246.69036865234375,
          "rotation": 0.468447744846344,
          "slice_index": 288,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.552179"
        }
      ],
      "brush_strokes": []
    },
    "y_289": {
      "slice_index": 289,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d79b48b4",
          "center_x": 249.18763732910156,
          "center_y": 250.1346435546875,
          "radius_x": 239.432373046875,
          "radius_y": 246.34304809570312,
          "rotation": 1.2660282850265503,
          "slice_index": 289,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.582942"
        }
      ],
      "brush_strokes": []
    },
    "y_290": {
      "slice_index": 290,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3ef9e34e",
          "center_x": 249.28135681152344,
          "center_y": 249.89846801757812,
          "radius_x": 239.78387451171875,
          "radius_y": 245.67062377929688,
          "rotation": 179.1988067626953,
          "slice_index": 290,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.618727"
        }
      ],
      "brush_strokes": []
    },
    "y_291": {
      "slice_index": 291,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1cc21772",
          "center_x": 249.1615753173828,
          "center_y": 249.9007568359375,
          "radius_x": 239.46063232421875,
          "radius_y": 245.74208068847656,
          "rotation": 179.48048400878906,
          "slice_index": 291,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.649467"
        }
      ],
      "brush_strokes": []
    },
    "y_292": {
      "slice_index": 292,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e24868f3",
          "center_x": 249.23362731933594,
          "center_y": 249.7941436767578,
          "radius_x": 239.45037841796875,
          "radius_y": 245.8513946533203,
          "rotation": 0.7728787660598755,
          "slice_index": 292,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.678702"
        }
      ],
      "brush_strokes": []
    },
    "y_293": {
      "slice_index": 293,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_4e719aa8",
          "center_x": 249.16357421875,
          "center_y": 250.05064392089844,
          "radius_x": 239.53138732910156,
          "radius_y": 245.44650268554688,
          "rotation": 2.0371570587158203,
          "slice_index": 293,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.711723"
        }
      ],
      "brush_strokes": []
    },
    "y_294": {
      "slice_index": 294,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1d7ac5bd",
          "center_x": 249.23814392089844,
          "center_y": 249.93368530273438,
          "radius_x": 239.52517700195312,
          "radius_y": 245.72113037109375,
          "rotation": 1.9785466194152832,
          "slice_index": 294,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.738957"
        }
      ],
      "brush_strokes": []
    },
    "y_295": {
      "slice_index": 295,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_fc75a866",
          "center_x": 249.02957153320312,
          "center_y": 249.62533569335938,
          "radius_x": 239.60757446289062,
          "radius_y": 246.16567993164062,
          "rotation": 0.4572409689426422,
          "slice_index": 295,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.770849"
        }
      ],
      "brush_strokes": []
    },
    "y_296": {
      "slice_index": 296,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_67230476",
          "center_x": 248.8079376220703,
          "center_y": 249.907958984375,
          "radius_x": 239.44581604003906,
          "radius_y": 245.9530487060547,
          "rotation": 2.190446376800537,
          "slice_index": 296,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.798314"
        }
      ],
      "brush_strokes": []
    },
    "y_297": {
      "slice_index": 297,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_b9334b23",
          "center_x": 249.095458984375,
          "center_y": 250.3036651611328,
          "radius_x": 239.21939086914062,
          "radius_y": 246.00653076171875,
          "rotation": 1.9538801908493042,
          "slice_index": 297,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.827050"
        }
      ],
      "brush_strokes": []
    },
    "y_298": {
      "slice_index": 298,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_12a975ba",
          "center_x": 249.21995544433594,
          "center_y": 249.7957305908203,
          "radius_x": 239.31936645507812,
          "radius_y": 246.10792541503906,
          "rotation": 1.7716078758239746,
          "slice_index": 298,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.857070"
        }
      ],
      "brush_strokes": []
    },
    "y_299": {
      "slice_index": 299,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6eb8e97d",
          "center_x": 249.21261596679688,
          "center_y": 249.8548583984375,
          "radius_x": 239.55479431152344,
          "radius_y": 245.64414978027344,
          "rotation": 2.263927698135376,
          "slice_index": 299,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.885049"
        }
      ],
      "brush_strokes": []
    },
    "y_300": {
      "slice_index": 300,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_47732961",
          "center_x": 249.15347290039062,
          "center_y": 250.08590698242188,
          "radius_x": 239.32212829589844,
          "radius_y": 245.88954162597656,
          "rotation": 179.83355712890625,
          "slice_index": 300,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.918135"
        }
      ],
      "brush_strokes": []
    },
    "y_301": {
      "slice_index": 301,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_420ecfd2",
          "center_x": 249.4163818359375,
          "center_y": 249.70265197753906,
          "radius_x": 239.43685913085938,
          "radius_y": 245.802490234375,
          "rotation": 2.5308103561401367,
          "slice_index": 301,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.949026"
        }
      ],
      "brush_strokes": []
    },
    "y_302": {
      "slice_index": 302,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_31b7b9dc",
          "center_x": 249.1811065673828,
          "center_y": 249.78204345703125,
          "radius_x": 239.33836364746094,
          "radius_y": 245.8788604736328,
          "rotation": 0.6889615058898926,
          "slice_index": 302,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:44.979014"
        }
      ],
      "brush_strokes": []
    },
    "y_303": {
      "slice_index": 303,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_a223e54a",
          "center_x": 249.27012634277344,
          "center_y": 249.92874145507812,
          "radius_x": 239.61611938476562,
          "radius_y": 245.74301147460938,
          "rotation": 1.0703473091125488,
          "slice_index": 303,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.009547"
        }
      ],
      "brush_strokes": []
    },
    "y_304": {
      "slice_index": 304,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_08645013",
          "center_x": 249.1338653564453,
          "center_y": 249.73377990722656,
          "radius_x": 239.182373046875,
          "radius_y": 246.20123291015625,
          "rotation": 0.7241255044937134,
          "slice_index": 304,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.037330"
        }
      ],
      "brush_strokes": []
    },
    "y_305": {
      "slice_index": 305,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_dad5b09e",
          "center_x": 249.39849853515625,
          "center_y": 249.83108520507812,
          "radius_x": 239.2510223388672,
          "radius_y": 245.50314331054688,
          "rotation": 1.7561041116714478,
          "slice_index": 305,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.067222"
        }
      ],
      "brush_strokes": []
    },
    "y_306": {
      "slice_index": 306,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_10b7ecae",
          "center_x": 249.18380737304688,
          "center_y": 249.714111328125,
          "radius_x": 239.49639892578125,
          "radius_y": 245.25233459472656,
          "rotation": 0.7826825976371765,
          "slice_index": 306,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.099251"
        }
      ],
      "brush_strokes": []
    },
    "y_307": {
      "slice_index": 307,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f30af02a",
          "center_x": 249.23211669921875,
          "center_y": 249.64657592773438,
          "radius_x": 239.49131774902344,
          "radius_y": 245.57369995117188,
          "rotation": 0.40091684460639954,
          "slice_index": 307,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.131225"
        }
      ],
      "brush_strokes": []
    },
    "y_308": {
      "slice_index": 308,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_79497dd6",
          "center_x": 249.283203125,
          "center_y": 249.84078979492188,
          "radius_x": 239.6376953125,
          "radius_y": 245.0697784423828,
          "rotation": 1.0266320705413818,
          "slice_index": 308,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.161152"
        }
      ],
      "brush_strokes": []
    },
    "y_309": {
      "slice_index": 309,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_bccc7d14",
          "center_x": 249.30517578125,
          "center_y": 249.9285430908203,
          "radius_x": 239.69317626953125,
          "radius_y": 245.06192016601562,
          "rotation": 1.9552990198135376,
          "slice_index": 309,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.189620"
        }
      ],
      "brush_strokes": []
    },
    "y_310": {
      "slice_index": 310,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_c4d50bce",
          "center_x": 249.24513244628906,
          "center_y": 250.0330810546875,
          "radius_x": 239.80616760253906,
          "radius_y": 244.78732299804688,
          "rotation": 0.691145122051239,
          "slice_index": 310,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.217734"
        }
      ],
      "brush_strokes": []
    },
    "y_311": {
      "slice_index": 311,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5b9a3b63",
          "center_x": 249.39683532714844,
          "center_y": 249.9122314453125,
          "radius_x": 239.8184356689453,
          "radius_y": 244.8525390625,
          "rotation": 2.3972723484039307,
          "slice_index": 311,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.246014"
        }
      ],
      "brush_strokes": []
    },
    "y_312": {
      "slice_index": 312,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7cdc9886",
          "center_x": 249.23056030273438,
          "center_y": 249.5982208251953,
          "radius_x": 239.836669921875,
          "radius_y": 245.2242889404297,
          "rotation": 2.9691057205200195,
          "slice_index": 312,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.274001"
        }
      ],
      "brush_strokes": []
    },
    "y_313": {
      "slice_index": 313,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_489f7f2d",
          "center_x": 249.1256103515625,
          "center_y": 249.80657958984375,
          "radius_x": 239.71826171875,
          "radius_y": 244.6852264404297,
          "rotation": 1.1874138116836548,
          "slice_index": 313,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.303004"
        }
      ],
      "brush_strokes": []
    },
    "y_314": {
      "slice_index": 314,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ee6fff05",
          "center_x": 249.3123321533203,
          "center_y": 249.83367919921875,
          "radius_x": 239.88400268554688,
          "radius_y": 244.81454467773438,
          "rotation": 1.8834190368652344,
          "slice_index": 314,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.334829"
        }
      ],
      "brush_strokes": []
    },
    "y_315": {
      "slice_index": 315,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6bab5606",
          "center_x": 249.14547729492188,
          "center_y": 249.6470947265625,
          "radius_x": 239.74124145507812,
          "radius_y": 245.16055297851562,
          "rotation": 0.5003133416175842,
          "slice_index": 315,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.362688"
        }
      ],
      "brush_strokes": []
    },
    "y_316": {
      "slice_index": 316,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_730c3096",
          "center_x": 249.447509765625,
          "center_y": 249.8029327392578,
          "radius_x": 240.15013122558594,
          "radius_y": 244.23838806152344,
          "rotation": 1.7233452796936035,
          "slice_index": 316,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.393231"
        }
      ],
      "brush_strokes": []
    },
    "y_317": {
      "slice_index": 317,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_7d47d668",
          "center_x": 249.29542541503906,
          "center_y": 249.69418334960938,
          "radius_x": 240.251708984375,
          "radius_y": 244.35626220703125,
          "rotation": 1.3101199865341187,
          "slice_index": 317,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.422263"
        }
      ],
      "brush_strokes": []
    },
    "y_318": {
      "slice_index": 318,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_4395ad80",
          "center_x": 249.4823455810547,
          "center_y": 249.5724334716797,
          "radius_x": 240.22227478027344,
          "radius_y": 244.09681701660156,
          "rotation": 2.428377151489258,
          "slice_index": 318,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.451104"
        }
      ],
      "brush_strokes": []
    },
    "y_319": {
      "slice_index": 319,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ce9c33a4",
          "center_x": 249.4597625732422,
          "center_y": 250.01670837402344,
          "radius_x": 240.14968872070312,
          "radius_y": 244.1549835205078,
          "rotation": 2.821471691131592,
          "slice_index": 319,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.479309"
        }
      ],
      "brush_strokes": []
    },
    "y_320": {
      "slice_index": 320,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_e01bd4b9",
          "center_x": 249.20619201660156,
          "center_y": 249.70326232910156,
          "radius_x": 240.29905700683594,
          "radius_y": 244.0390167236328,
          "rotation": 179.60044860839844,
          "slice_index": 320,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.508004"
        }
      ],
      "brush_strokes": []
    },
    "y_321": {
      "slice_index": 321,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_013db531",
          "center_x": 249.34762573242188,
          "center_y": 249.59413146972656,
          "radius_x": 240.24684143066406,
          "radius_y": 243.93856811523438,
          "rotation": 4.118053913116455,
          "slice_index": 321,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.537982"
        }
      ],
      "brush_strokes": []
    },
    "y_322": {
      "slice_index": 322,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_d08ba1d7",
          "center_x": 249.2720947265625,
          "center_y": 249.7385711669922,
          "radius_x": 240.2638397216797,
          "radius_y": 244.04345703125,
          "rotation": 0.29461801052093506,
          "slice_index": 322,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.565799"
        }
      ],
      "brush_strokes": []
    },
    "y_323": {
      "slice_index": 323,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_98c2c846",
          "center_x": 249.17999267578125,
          "center_y": 249.40130615234375,
          "radius_x": 240.1797637939453,
          "radius_y": 244.2701873779297,
          "rotation": 2.216179132461548,
          "slice_index": 323,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.596313"
        }
      ],
      "brush_strokes": []
    },
    "y_324": {
      "slice_index": 324,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_399deb14",
          "center_x": 249.07992553710938,
          "center_y": 249.52577209472656,
          "radius_x": 240.0867462158203,
          "radius_y": 243.90103149414062,
          "rotation": 2.847614288330078,
          "slice_index": 324,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.628239"
        }
      ],
      "brush_strokes": []
    },
    "y_325": {
      "slice_index": 325,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_cd717a0b",
          "center_x": 249.17153930664062,
          "center_y": 249.8119354248047,
          "radius_x": 240.43467712402344,
          "radius_y": 243.5302734375,
          "rotation": 0.9534997344017029,
          "slice_index": 325,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.657217"
        }
      ],
      "brush_strokes": []
    },
    "y_326": {
      "slice_index": 326,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_75061ecc",
          "center_x": 249.5045928955078,
          "center_y": 249.7288055419922,
          "radius_x": 240.22064208984375,
          "radius_y": 244.03152465820312,
          "rotation": 3.187958002090454,
          "slice_index": 326,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.687310"
        }
      ],
      "brush_strokes": []
    },
    "y_327": {
      "slice_index": 327,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_14236fe7",
          "center_x": 249.23143005371094,
          "center_y": 249.8379364013672,
          "radius_x": 240.23519897460938,
          "radius_y": 244.1202392578125,
          "rotation": 179.63807678222656,
          "slice_index": 327,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.718399"
        }
      ],
      "brush_strokes": []
    },
    "y_328": {
      "slice_index": 328,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_9318918e",
          "center_x": 249.29019165039062,
          "center_y": 249.73306274414062,
          "radius_x": 240.22560119628906,
          "radius_y": 243.87452697753906,
          "rotation": 6.087173938751221,
          "slice_index": 328,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.747903"
        }
      ],
      "brush_strokes": []
    },
    "y_329": {
      "slice_index": 329,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_834b7d3c",
          "center_x": 249.34841918945312,
          "center_y": 249.74090576171875,
          "radius_x": 240.6002960205078,
          "radius_y": 243.24989318847656,
          "rotation": 2.286801338195801,
          "slice_index": 329,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.779104"
        }
      ],
      "brush_strokes": []
    },
    "y_330": {
      "slice_index": 330,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_51c57b72",
          "center_x": 249.21548461914062,
          "center_y": 250.00479125976562,
          "radius_x": 240.408203125,
          "radius_y": 243.98451232910156,
          "rotation": 1.0156275033950806,
          "slice_index": 330,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.811256"
        }
      ],
      "brush_strokes": []
    },
    "y_331": {
      "slice_index": 331,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f6432cdb",
          "center_x": 249.4458770751953,
          "center_y": 249.86422729492188,
          "radius_x": 240.6427764892578,
          "radius_y": 243.1917266845703,
          "rotation": 1.8729735612869263,
          "slice_index": 331,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.843922"
        }
      ],
      "brush_strokes": []
    },
    "y_332": {
      "slice_index": 332,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5a042347",
          "center_x": 249.2366180419922,
          "center_y": 249.72633361816406,
          "radius_x": 240.56578063964844,
          "radius_y": 243.09161376953125,
          "rotation": 0.5204329490661621,
          "slice_index": 332,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.874112"
        }
      ],
      "brush_strokes": []
    },
    "y_333": {
      "slice_index": 333,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5af05f00",
          "center_x": 249.26092529296875,
          "center_y": 249.73760986328125,
          "radius_x": 240.6197052001953,
          "radius_y": 242.94093322753906,
          "rotation": 2.5347001552581787,
          "slice_index": 333,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.903213"
        }
      ],
      "brush_strokes": []
    },
    "y_334": {
      "slice_index": 334,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5e1a0d1d",
          "center_x": 249.3688201904297,
          "center_y": 249.65203857421875,
          "radius_x": 240.72909545898438,
          "radius_y": 242.99925231933594,
          "rotation": 2.9726924896240234,
          "slice_index": 334,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.933353"
        }
      ],
      "brush_strokes": []
    },
    "y_335": {
      "slice_index": 335,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_5f88e4e1",
          "center_x": 249.4487762451172,
          "center_y": 249.8342742919922,
          "radius_x": 240.62977600097656,
          "radius_y": 243.23619079589844,
          "rotation": 1.9600882530212402,
          "slice_index": 335,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.964310"
        }
      ],
      "brush_strokes": []
    },
    "y_336": {
      "slice_index": 336,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_6cffdac0",
          "center_x": 249.36485290527344,
          "center_y": 249.9082489013672,
          "radius_x": 240.95848083496094,
          "radius_y": 242.81436157226562,
          "rotation": 0.7931077480316162,
          "slice_index": 336,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:45.995378"
        }
      ],
      "brush_strokes": []
    },
    "y_337": {
      "slice_index": 337,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_abf954f9",
          "center_x": 249.3128662109375,
          "center_y": 249.72096252441406,
          "radius_x": 240.7554168701172,
          "radius_y": 243.1293182373047,
          "rotation": 2.2676308155059814,
          "slice_index": 337,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.024477"
        }
      ],
      "brush_strokes": []
    },
    "y_338": {
      "slice_index": 338,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_604e1e05",
          "center_x": 249.47535705566406,
          "center_y": 249.78192138671875,
          "radius_x": 240.72967529296875,
          "radius_y": 242.93411254882812,
          "rotation": 4.470407009124756,
          "slice_index": 338,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.055088"
        }
      ],
      "brush_strokes": []
    },
    "y_339": {
      "slice_index": 339,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_1ed9af47",
          "center_x": 249.25538635253906,
          "center_y": 249.68304443359375,
          "radius_x": 240.91778564453125,
          "radius_y": 242.5834197998047,
          "rotation": 7.548340320587158,
          "slice_index": 339,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.084433"
        }
      ],
      "brush_strokes": []
    },
    "y_340": {
      "slice_index": 340,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_61fce796",
          "center_x": 249.2305450439453,
          "center_y": 249.5983428955078,
          "radius_x": 240.74905395507812,
          "radius_y": 242.85330200195312,
          "rotation": 0.7471088767051697,
          "slice_index": 340,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.117023"
        }
      ],
      "brush_strokes": []
    },
    "y_341": {
      "slice_index": 341,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_4218c999",
          "center_x": 249.26739501953125,
          "center_y": 249.71006774902344,
          "radius_x": 240.673095703125,
          "radius_y": 242.85501098632812,
          "rotation": 3.387366533279419,
          "slice_index": 341,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.146535"
        }
      ],
      "brush_strokes": []
    },
    "y_342": {
      "slice_index": 342,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_f58c33ba",
          "center_x": 249.22967529296875,
          "center_y": 249.60231018066406,
          "radius_x": 240.5851593017578,
          "radius_y": 243.0486602783203,
          "rotation": 7.617340087890625,
          "slice_index": 342,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.175535"
        }
      ],
      "brush_strokes": []
    },
    "y_343": {
      "slice_index": 343,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_ae42edec",
          "center_x": 249.30345153808594,
          "center_y": 249.78726196289062,
          "radius_x": 240.60411071777344,
          "radius_y": 243.0398712158203,
          "rotation": 0.17345118522644043,
          "slice_index": 343,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.206536"
        }
      ],
      "brush_strokes": []
    },
    "y_344": {
      "slice_index": 344,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3486ef95",
          "center_x": 249.26072692871094,
          "center_y": 249.6282501220703,
          "radius_x": 240.95252990722656,
          "radius_y": 242.69151306152344,
          "rotation": 179.74205017089844,
          "slice_index": 344,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.243670"
        }
      ],
      "brush_strokes": []
    },
    "y_345": {
      "slice_index": 345,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_3a1243ff",
          "center_x": 249.26693725585938,
          "center_y": 249.65188598632812,
          "radius_x": 240.94570922851562,
          "radius_y": 242.83444213867188,
          "rotation": 177.03517150878906,
          "slice_index": 345,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.286640"
        }
      ],
      "brush_strokes": []
    },
    "y_346": {
      "slice_index": 346,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_104007bf",
          "center_x": 249.3179931640625,
          "center_y": 249.64195251464844,
          "radius_x": 240.92669677734375,
          "radius_y": 242.7554473876953,
          "rotation": 0.4941047430038452,
          "slice_index": 346,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.317879"
        }
      ],
      "brush_strokes": []
    },
    "y_347": {
      "slice_index": 347,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_898f2636",
          "center_x": 249.317626953125,
          "center_y": 249.5904541015625,
          "radius_x": 240.76890563964844,
          "radius_y": 243.05857849121094,
          "rotation": 1.8558403253555298,
          "slice_index": 347,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.349393"
        }
      ],
      "brush_strokes": []
    },
    "y_348": {
      "slice_index": 348,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_477956ab",
          "center_x": 249.3501739501953,
          "center_y": 249.66256713867188,
          "radius_x": 240.90943908691406,
          "radius_y": 242.82589721679688,
          "rotation": 1.6822935342788696,
          "slice_index": 348,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.379015"
        }
      ],
      "brush_strokes": []
    },
    "y_349": {
      "slice_index": 349,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_91311db3",
          "center_x": 249.31655883789062,
          "center_y": 249.68197631835938,
          "radius_x": 240.92332458496094,
          "radius_y": 242.93585205078125,
          "rotation": 2.5925307273864746,
          "slice_index": 349,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.416653"
        }
      ],
      "brush_strokes": []
    },
    "y_350": {
      "slice_index": 350,
      "axis": "y",
      "ellipses": [
        {
          "id": "auto_add5cec3",
          "center_x": 249.42138671875,
          "center_y": 250.05882263183594,
          "radius_x": 241.02020263671875,
          "radius_y": 242.52764892578125,
          "rotation": 0.1574946939945221,
          "slice_index": 350,
          "axis": "y",
          "vessel_id": null,
          "confidence": 1.0,
          "is_manual": false,
          "created_at": "2025-12-10T17:07:46.473878"
        }
      ],
      "brush_strokes": []
    },
    "x_177": {
      "slice_index": 177,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_040c184a",
          "center_x": 120.27996826171875,
          "center_y": 76.10491180419922,
          "radius_x": 19.90298080444336,
          "radius_y": 17.91670036315918,
          "rotation": 54.87432861328125,
          "slice_index": 177,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_386": {
      "slice_index": 386,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_a0ceaa03",
          "center_x": 54.696495056152344,
          "center_y": 24.16728973388672,
          "radius_x": 6.420267581939697,
          "radius_y": 1.938090205192566,
          "rotation": 86.22335815429688,
          "slice_index": 386,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_393": {
      "slice_index": 393,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6de10ee0",
          "center_x": 22.33537483215332,
          "center_y": 22.33364486694336,
          "radius_x": 7.1785173416137695,
          "radius_y": 1.9346370697021484,
          "rotation": 86.46171569824219,
          "slice_index": 393,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_394": {
      "slice_index": 394,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_8f274fcf",
          "center_x": 62.48822784423828,
          "center_y": 22.970294952392578,
          "radius_x": 7.568246364593506,
          "radius_y": 4.111969947814941,
          "rotation": 95.07061624526978,
          "slice_index": 394,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_391": {
      "slice_index": 391,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d79ce722",
          "center_x": 44.0694465637207,
          "center_y": 20.068653106689453,
          "radius_x": 3.924744129180908,
          "radius_y": 1.8537960052490234,
          "rotation": 86.58125305175781,
          "slice_index": 391,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_396": {
      "slice_index": 396,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_48e4d0aa",
          "center_x": 327.4093933105469,
          "center_y": 77.68218994140625,
          "radius_x": 17.994482040405273,
          "radius_y": 17.877620697021484,
          "rotation": 47.58677673339844,
          "slice_index": 396,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_401": {
      "slice_index": 401,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_aaac2809",
          "center_x": 87.02371978759766,
          "center_y": 24.47673988342285,
          "radius_x": 5.001314163208008,
          "radius_y": 2.051954507827759,
          "rotation": 93.7973279953003,
          "slice_index": 401,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_404": {
      "slice_index": 404,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c461a2cc",
          "center_x": 43.750572204589844,
          "center_y": 23.888439178466797,
          "radius_x": 6.7720184326171875,
          "radius_y": 1.8758234977722168,
          "rotation": 88.09568786621094,
          "slice_index": 404,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_399": {
      "slice_index": 399,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_d619daf5",
          "center_x": 59.141883850097656,
          "center_y": 29.613323211669922,
          "radius_x": 5.811155319213867,
          "radius_y": 1.863064169883728,
          "rotation": 84.03030395507812,
          "slice_index": 399,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_407": {
      "slice_index": 407,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_41639a80",
          "center_x": 102.12601470947266,
          "center_y": 23.143108367919922,
          "radius_x": 7.391296863555908,
          "radius_y": 2.439387559890747,
          "rotation": 96.60449123382568,
          "slice_index": 407,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_402": {
      "slice_index": 402,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_484ab306",
          "center_x": 58.38008117675781,
          "center_y": 24.51856803894043,
          "radius_x": 5.264286041259766,
          "radius_y": 2.986017942428589,
          "rotation": 68.58769226074219,
          "slice_index": 402,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_a53501cd",
          "center_x": 33.693843841552734,
          "center_y": 26.07209014892578,
          "radius_x": 6.0377373695373535,
          "radius_y": 2.0085458755493164,
          "rotation": 95.29316139221191,
          "slice_index": 402,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_8adc35c2",
          "center_x": 86.09127807617188,
          "center_y": 25.395893096923828,
          "radius_x": 2.7188570499420166,
          "radius_y": 1.8144044876098633,
          "rotation": 127.49866104125977,
          "slice_index": 402,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_27fe565e",
          "center_x": 44.11174774169922,
          "center_y": 29.8692684173584,
          "radius_x": 6.596912384033203,
          "radius_y": 2.1628947257995605,
          "rotation": 86.21728515625,
          "slice_index": 402,
          "axis": "x",
          "vessel_id": "v3",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_411": {
      "slice_index": 411,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_2258fdb0",
          "center_x": 91.2483901977539,
          "center_y": 18.61274528503418,
          "radius_x": 4.186464309692383,
          "radius_y": 3.2580671310424805,
          "rotation": 67.86093139648438,
          "slice_index": 411,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_eee034a7",
          "center_x": 199.77439880371094,
          "center_y": 23.799386978149414,
          "radius_x": 2.3597824573516846,
          "radius_y": 1.8087421655654907,
          "rotation": 150.48991775512695,
          "slice_index": 411,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_414": {
      "slice_index": 414,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1a8fcfca",
          "center_x": 23.005149841308594,
          "center_y": 24.72926139831543,
          "radius_x": 9.757194519042969,
          "radius_y": 3.29282283782959,
          "rotation": 85.20675659179688,
          "slice_index": 414,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_421": {
      "slice_index": 421,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_11534fed",
          "center_x": 206.77857971191406,
          "center_y": 27.062278747558594,
          "radius_x": 5.395559787750244,
          "radius_y": 2.214024543762207,
          "rotation": 83.52149963378906,
          "slice_index": 421,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_419": {
      "slice_index": 419,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_11ed59a8",
          "center_x": 20.935213088989258,
          "center_y": 24.0,
          "radius_x": 4.647806167602539,
          "radius_y": 2.149595022201538,
          "rotation": 90.0,
          "slice_index": 419,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_426": {
      "slice_index": 426,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4b04af48",
          "center_x": 206.6999969482422,
          "center_y": 19.5,
          "radius_x": 4.54972505569458,
          "radius_y": 2.034698963165283,
          "rotation": 90.0,
          "slice_index": 426,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_431": {
      "slice_index": 431,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_0e15953b",
          "center_x": 50.7039680480957,
          "center_y": 23.570667266845703,
          "radius_x": 4.286088466644287,
          "radius_y": 2.3162176609039307,
          "rotation": 112.66927146911621,
          "slice_index": 431,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_9eed1efe",
          "center_x": 60.66905212402344,
          "center_y": 24.111589431762695,
          "radius_x": 5.6713361740112305,
          "radius_y": 2.8717355728149414,
          "rotation": 110.78445053100586,
          "slice_index": 431,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_427": {
      "slice_index": 427,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f54af1df",
          "center_x": 91.56671142578125,
          "center_y": 20.424457550048828,
          "radius_x": 4.018698215484619,
          "radius_y": 2.0463428497314453,
          "rotation": 71.69097900390625,
          "slice_index": 427,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_438": {
      "slice_index": 438,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_82cc35fa",
          "center_x": 26.871824264526367,
          "center_y": 24.382360458374023,
          "radius_x": 8.741777420043945,
          "radius_y": 2.6631064414978027,
          "rotation": 87.57792663574219,
          "slice_index": 438,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_433": {
      "slice_index": 433,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_c18a6afe",
          "center_x": 94.78130340576172,
          "center_y": 20.035144805908203,
          "radius_x": 3.9101083278656006,
          "radius_y": 3.198455810546875,
          "rotation": 86.17724609375,
          "slice_index": 433,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_127a82eb",
          "center_x": 48.35402297973633,
          "center_y": 26.764495849609375,
          "radius_x": 6.520827770233154,
          "radius_y": 2.2255938053131104,
          "rotation": 91.07982397079468,
          "slice_index": 433,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_084988cc",
          "center_x": 79.33258819580078,
          "center_y": 23.519533157348633,
          "radius_x": 5.12656831741333,
          "radius_y": 3.5677623748779297,
          "rotation": 16.14897918701172,
          "slice_index": 433,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_439": {
      "slice_index": 439,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_922cde43",
          "center_x": 46.0,
          "center_y": 22.0,
          "radius_x": 2.31685471534729,
          "radius_y": 2.08913516998291,
          "rotation": 0.0,
          "slice_index": 439,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_445": {
      "slice_index": 445,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cd3faa2a",
          "center_x": 58.92905807495117,
          "center_y": 27.052818298339844,
          "radius_x": 4.77463436126709,
          "radius_y": 1.9951603412628174,
          "rotation": 89.15669250488281,
          "slice_index": 445,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_447": {
      "slice_index": 447,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_da6e002f",
          "center_x": 29.927017211914062,
          "center_y": 23.793777465820312,
          "radius_x": 3.407013177871704,
          "radius_y": 2.00500226020813,
          "rotation": 97.64013957977295,
          "slice_index": 447,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_448": {
      "slice_index": 448,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b7169f77",
          "center_x": 22.246496200561523,
          "center_y": 20.657331466674805,
          "radius_x": 3.83721661567688,
          "radius_y": 2.1656653881073,
          "rotation": 66.70260620117188,
          "slice_index": 448,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_450": {
      "slice_index": 450,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6605f22a",
          "center_x": 63.87971115112305,
          "center_y": 25.510053634643555,
          "radius_x": 6.287899017333984,
          "radius_y": 2.603762626647949,
          "rotation": 79.84300231933594,
          "slice_index": 450,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_452": {
      "slice_index": 452,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cee7bc64",
          "center_x": 193.10499572753906,
          "center_y": 22.67904281616211,
          "radius_x": 4.356764316558838,
          "radius_y": 2.3365705013275146,
          "rotation": 102.25497913360596,
          "slice_index": 452,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_454": {
      "slice_index": 454,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_6118c6ce",
          "center_x": 46.57529830932617,
          "center_y": 22.158397674560547,
          "radius_x": 4.03989315032959,
          "radius_y": 1.8072795867919922,
          "rotation": 86.65048217773438,
          "slice_index": 454,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_457": {
      "slice_index": 457,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_cc715931",
          "center_x": 43.179256439208984,
          "center_y": 20.538984298706055,
          "radius_x": 5.4185791015625,
          "radius_y": 1.8987452983856201,
          "rotation": 83.67979431152344,
          "slice_index": 457,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_fe73e2cf",
          "center_x": 59.0,
          "center_y": 22.5,
          "radius_x": 3.6815803050994873,
          "radius_y": 2.202012300491333,
          "rotation": 90.0,
          "slice_index": 457,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_456": {
      "slice_index": 456,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_3251dcf5",
          "center_x": 34.89177703857422,
          "center_y": 18.175437927246094,
          "radius_x": 2.883650779724121,
          "radius_y": 2.2509043216705322,
          "rotation": 41.73040771484375,
          "slice_index": 456,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_455": {
      "slice_index": 455,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_77c4bbdb",
          "center_x": 178.71925354003906,
          "center_y": 20.323945999145508,
          "radius_x": 3.2069473266601562,
          "radius_y": 1.9911010265350342,
          "rotation": 122.74365997314453,
          "slice_index": 455,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_edff2e37",
          "center_x": 66.7525634765625,
          "center_y": 20.840097427368164,
          "radius_x": 2.7944769859313965,
          "radius_y": 1.983463168144226,
          "rotation": 16.668983459472656,
          "slice_index": 455,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_460": {
      "slice_index": 460,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_1d91fb81",
          "center_x": 109.68270874023438,
          "center_y": 23.009933471679688,
          "radius_x": 4.117848873138428,
          "radius_y": 2.389652729034424,
          "rotation": 57.429931640625,
          "slice_index": 460,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_73833935",
          "center_x": 45.12626266479492,
          "center_y": 25.876882553100586,
          "radius_x": 5.110642910003662,
          "radius_y": 2.3234992027282715,
          "rotation": 70.06475830078125,
          "slice_index": 460,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_c4ab0a16",
          "center_x": 52.70008087158203,
          "center_y": 27.988418579101562,
          "radius_x": 7.194908618927002,
          "radius_y": 3.200063705444336,
          "rotation": 90.5544182062149,
          "slice_index": 460,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_462": {
      "slice_index": 462,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b1e2f14f",
          "center_x": 18.445674896240234,
          "center_y": 21.0,
          "radius_x": 2.1294052600860596,
          "radius_y": 1.8271193504333496,
          "rotation": 0.0,
          "slice_index": 462,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_463": {
      "slice_index": 463,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9df91c71",
          "center_x": 206.7351837158203,
          "center_y": 20.663097381591797,
          "radius_x": 4.541428089141846,
          "radius_y": 3.38108229637146,
          "rotation": 91.30970656871796,
          "slice_index": 463,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_75fe9c0d",
          "center_x": 110.03177642822266,
          "center_y": 24.735261917114258,
          "radius_x": 7.19828987121582,
          "radius_y": 3.4478213787078857,
          "rotation": 75.40109252929688,
          "slice_index": 463,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_466": {
      "slice_index": 466,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_28c2444e",
          "center_x": 83.29412078857422,
          "center_y": 20.0,
          "radius_x": 5.048781871795654,
          "radius_y": 2.120912551879883,
          "rotation": 90.0,
          "slice_index": 466,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_eca8a451",
          "center_x": 49.13816833496094,
          "center_y": 21.24106788635254,
          "radius_x": 3.3997726440429688,
          "radius_y": 2.0075736045837402,
          "rotation": 30.29210662841797,
          "slice_index": 466,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_779e5ac7",
          "center_x": 69.3858871459961,
          "center_y": 22.10871696472168,
          "radius_x": 3.0642473697662354,
          "radius_y": 1.837597370147705,
          "rotation": 85.07698059082031,
          "slice_index": 466,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_89f7cbbb",
          "center_x": 91.500732421875,
          "center_y": 23.69818115234375,
          "radius_x": 5.67304801940918,
          "radius_y": 3.4037439823150635,
          "rotation": 79.26441955566406,
          "slice_index": 466,
          "axis": "x",
          "vessel_id": "v3",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_465": {
      "slice_index": 465,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_79fb01ff",
          "center_x": 88.73571014404297,
          "center_y": 21.939289093017578,
          "radius_x": 5.533890247344971,
          "radius_y": 1.9659972190856934,
          "rotation": 96.2401475906372,
          "slice_index": 465,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_f1a283f7",
          "center_x": 183.6399688720703,
          "center_y": 20.770492553710938,
          "radius_x": 3.9526400566101074,
          "radius_y": 2.839674234390259,
          "rotation": 33.403602600097656,
          "slice_index": 465,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_3aa26d1f",
          "center_x": 207.7891387939453,
          "center_y": 21.25688934326172,
          "radius_x": 3.8125076293945312,
          "radius_y": 2.768190860748291,
          "rotation": 64.98968505859375,
          "slice_index": 465,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_472": {
      "slice_index": 472,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bc6a14af",
          "center_x": 49.761558532714844,
          "center_y": 21.955224990844727,
          "radius_x": 4.421054363250732,
          "radius_y": 3.458005905151367,
          "rotation": 57.18133544921875,
          "slice_index": 472,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_471": {
      "slice_index": 471,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_9f987193",
          "center_x": 133.30934143066406,
          "center_y": 20.793920516967773,
          "radius_x": 4.853489875793457,
          "radius_y": 2.282215118408203,
          "rotation": 97.85929107666016,
          "slice_index": 471,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_467": {
      "slice_index": 467,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bc6d446d",
          "center_x": 56.16246795654297,
          "center_y": 19.820459365844727,
          "radius_x": 3.5646588802337646,
          "radius_y": 2.7362635135650635,
          "rotation": 109.07242393493652,
          "slice_index": 467,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_cc5df72a",
          "center_x": 93.7187728881836,
          "center_y": 21.797990798950195,
          "radius_x": 3.313483476638794,
          "radius_y": 2.776021957397461,
          "rotation": 37.540321350097656,
          "slice_index": 467,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_4487c593",
          "center_x": 213.9337921142578,
          "center_y": 23.38287925720215,
          "radius_x": 4.496387958526611,
          "radius_y": 2.374924898147583,
          "rotation": 94.10931205749512,
          "slice_index": 467,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_77a0fda0",
          "center_x": 63.41098403930664,
          "center_y": 26.380155563354492,
          "radius_x": 7.103692054748535,
          "radius_y": 1.9283883571624756,
          "rotation": 89.25741577148438,
          "slice_index": 467,
          "axis": "x",
          "vessel_id": "v3",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_469": {
      "slice_index": 469,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_43c68f24",
          "center_x": 56.8428840637207,
          "center_y": 22.861488342285156,
          "radius_x": 7.12052059173584,
          "radius_y": 2.045673131942749,
          "rotation": 88.94058227539062,
          "slice_index": 469,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_88609e1e",
          "center_x": 67.6141128540039,
          "center_y": 21.89128303527832,
          "radius_x": 3.0642473697662354,
          "radius_y": 1.837597370147705,
          "rotation": 85.07698059082031,
          "slice_index": 469,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_8b61f11a",
          "center_x": 48.63096618652344,
          "center_y": 30.810365676879883,
          "radius_x": 9.858582496643066,
          "radius_y": 2.387238025665283,
          "rotation": 86.69169616699219,
          "slice_index": 469,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_470": {
      "slice_index": 470,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_f8172032",
          "center_x": 37.910888671875,
          "center_y": 21.923908233642578,
          "radius_x": 4.021730899810791,
          "radius_y": 2.57473087310791,
          "rotation": 121.26021957397461,
          "slice_index": 470,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_b879431f",
          "center_x": 49.4046745300293,
          "center_y": 29.99373435974121,
          "radius_x": 10.765172958374023,
          "radius_y": 2.355072259902954,
          "rotation": 88.39952087402344,
          "slice_index": 470,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_473": {
      "slice_index": 473,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_44d3ca89",
          "center_x": 22.0,
          "center_y": 19.40964126586914,
          "radius_x": 2.63875150680542,
          "radius_y": 2.4622721672058105,
          "rotation": 90.0,
          "slice_index": 473,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_479": {
      "slice_index": 479,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_db96eb79",
          "center_x": 35.90917205810547,
          "center_y": 24.03584861755371,
          "radius_x": 5.826198101043701,
          "radius_y": 2.019287586212158,
          "rotation": 89.62423706054688,
          "slice_index": 479,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_478": {
      "slice_index": 478,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_4b4655f1",
          "center_x": 67.25514221191406,
          "center_y": 21.867795944213867,
          "radius_x": 6.3492608070373535,
          "radius_y": 2.2400107383728027,
          "rotation": 93.48819661140442,
          "slice_index": 478,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_b74d20ab",
          "center_x": 199.69732666015625,
          "center_y": 21.949909210205078,
          "radius_x": 3.8804094791412354,
          "radius_y": 2.157031297683716,
          "rotation": 122.21148300170898,
          "slice_index": 478,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_482": {
      "slice_index": 482,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_bb9918bf",
          "center_x": 19.815576553344727,
          "center_y": 23.237693786621094,
          "radius_x": 3.5818569660186768,
          "radius_y": 2.2481372356414795,
          "rotation": 94.37235641479492,
          "slice_index": 482,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_256decb9",
          "center_x": 185.0619659423828,
          "center_y": 22.244794845581055,
          "radius_x": 2.623671531677246,
          "radius_y": 2.327407121658325,
          "rotation": 129.20726776123047,
          "slice_index": 482,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_484": {
      "slice_index": 484,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_ff358167",
          "center_x": 59.028785705566406,
          "center_y": 20.30000877380371,
          "radius_x": 5.548195838928223,
          "radius_y": 2.009958028793335,
          "rotation": 92.52653241157532,
          "slice_index": 484,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_be9f63ae",
          "center_x": 29.5924072265625,
          "center_y": 22.206775665283203,
          "radius_x": 3.9743309020996094,
          "radius_y": 2.4928133487701416,
          "rotation": 103.41373538970947,
          "slice_index": 484,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_483": {
      "slice_index": 483,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_02ec7f37",
          "center_x": 72.01766204833984,
          "center_y": 24.052478790283203,
          "radius_x": 5.7237348556518555,
          "radius_y": 2.414564371109009,
          "rotation": 89.73831176757812,
          "slice_index": 483,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_488": {
      "slice_index": 488,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_660aa15d",
          "center_x": 51.8952751159668,
          "center_y": 20.53032684326172,
          "radius_x": 3.844942569732666,
          "radius_y": 2.0212690830230713,
          "rotation": 99.37569236755371,
          "slice_index": 488,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_0cff2eff",
          "center_x": 92.89024353027344,
          "center_y": 21.418025970458984,
          "radius_x": 3.6192800998687744,
          "radius_y": 2.222769021987915,
          "rotation": 104.90611362457275,
          "slice_index": 488,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_485": {
      "slice_index": 485,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_28bba9b2",
          "center_x": 86.87333679199219,
          "center_y": 26.23354148864746,
          "radius_x": 7.31181001663208,
          "radius_y": 3.353032112121582,
          "rotation": 89.38357543945312,
          "slice_index": 485,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_e306e059",
          "center_x": 44.98355484008789,
          "center_y": 22.615629196166992,
          "radius_x": 5.220280170440674,
          "radius_y": 2.983708381652832,
          "rotation": 159.8971710205078,
          "slice_index": 485,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_4c49cbb1",
          "center_x": 65.0997314453125,
          "center_y": 27.43853759765625,
          "radius_x": 6.1772780418396,
          "radius_y": 2.15895676612854,
          "rotation": 92.22377705574036,
          "slice_index": 485,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_486": {
      "slice_index": 486,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_98bb6e30",
          "center_x": 52.891300201416016,
          "center_y": 20.984874725341797,
          "radius_x": 2.2378320693969727,
          "radius_y": 2.059522867202759,
          "rotation": 154.07666015625,
          "slice_index": 486,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_2d147a98",
          "center_x": 68.69999694824219,
          "center_y": 23.5,
          "radius_x": 4.54972505569458,
          "radius_y": 2.034698963165283,
          "rotation": 90.0,
          "slice_index": 486,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_268315be",
          "center_x": 26.010208129882812,
          "center_y": 22.495389938354492,
          "radius_x": 3.330660820007324,
          "radius_y": 2.1719436645507812,
          "rotation": 24.2384033203125,
          "slice_index": 486,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_491": {
      "slice_index": 491,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_562b4e28",
          "center_x": 95.64913177490234,
          "center_y": 20.04106330871582,
          "radius_x": 3.539172887802124,
          "radius_y": 2.629488706588745,
          "rotation": 101.70301246643066,
          "slice_index": 491,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_493": {
      "slice_index": 493,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_00b4f5ab",
          "center_x": 17.03661346435547,
          "center_y": 19.522260665893555,
          "radius_x": 3.291332721710205,
          "radius_y": 2.1773056983947754,
          "rotation": 77.30056762695312,
          "slice_index": 493,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_489": {
      "slice_index": 489,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_96c4ae09",
          "center_x": 57.493858337402344,
          "center_y": 21.09318733215332,
          "radius_x": 4.609652996063232,
          "radius_y": 2.07065486907959,
          "rotation": 80.66987609863281,
          "slice_index": 489,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_594bf823",
          "center_x": 95.12968444824219,
          "center_y": 21.797712326049805,
          "radius_x": 6.168403625488281,
          "radius_y": 3.538423538208008,
          "rotation": 50.29888916015625,
          "slice_index": 489,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_2ba1d0f6",
          "center_x": 49.17637252807617,
          "center_y": 22.4492244720459,
          "radius_x": 4.638706207275391,
          "radius_y": 2.4353442192077637,
          "rotation": 95.2937159538269,
          "slice_index": 489,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_492": {
      "slice_index": 492,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_b1828ec3",
          "center_x": 199.79196166992188,
          "center_y": 21.581449508666992,
          "radius_x": 3.936845302581787,
          "radius_y": 2.168210983276367,
          "rotation": 86.71919250488281,
          "slice_index": 492,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_494": {
      "slice_index": 494,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_34e9badf",
          "center_x": 106.94029235839844,
          "center_y": 24.547229766845703,
          "radius_x": 7.318623065948486,
          "radius_y": 1.9692071676254272,
          "rotation": 89.32905578613281,
          "slice_index": 494,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_9e3d13cc",
          "center_x": 48.65726852416992,
          "center_y": 22.24332618713379,
          "radius_x": 4.138975620269775,
          "radius_y": 2.4124977588653564,
          "rotation": 95.70122909545898,
          "slice_index": 494,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_70cd05b0",
          "center_x": 141.91586303710938,
          "center_y": 24.876245498657227,
          "radius_x": 3.912999391555786,
          "radius_y": 1.8834195137023926,
          "rotation": 85.72869873046875,
          "slice_index": 494,
          "axis": "x",
          "vessel_id": "v2",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_495": {
      "slice_index": 495,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_724da5df",
          "center_x": 169.19532775878906,
          "center_y": 19.101545333862305,
          "radius_x": 3.509253978729248,
          "radius_y": 2.053950548171997,
          "rotation": 98.37747859954834,
          "slice_index": 495,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_f10a7967",
          "center_x": 26.56560516357422,
          "center_y": 22.255062103271484,
          "radius_x": 2.656855821609497,
          "radius_y": 2.0437440872192383,
          "rotation": 55.06608581542969,
          "slice_index": 495,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_497": {
      "slice_index": 497,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_00af6c46",
          "center_x": 80.23519134521484,
          "center_y": 22.691438674926758,
          "radius_x": 4.842768669128418,
          "radius_y": 2.6470487117767334,
          "rotation": 104.0759334564209,
          "slice_index": 497,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        },
        {
          "id": "auto_54feb7a1",
          "center_x": 65.08733367919922,
          "center_y": 26.929563522338867,
          "radius_x": 8.052759170532227,
          "radius_y": 2.369459867477417,
          "rotation": 82.01211547851562,
          "slice_index": 497,
          "axis": "x",
          "vessel_id": "v1",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    },
    "x_499": {
      "slice_index": 499,
      "axis": "x",
      "ellipses": [
        {
          "id": "auto_35935086",
          "center_x": 30.73438262939453,
          "center_y": 19.033876419067383,
          "radius_x": 3.1334638595581055,
          "radius_y": 1.960895299911499,
          "rotation": 104.44923305511475,
          "slice_index": 499,
          "axis": "x",
          "vessel_id": "v0",
          "confidence": 0.7,
          "is_manual": false,
          "created_at": "2025-12-11T04:05:52.185178"
        }
      ],
      "brush_strokes": []
    }
  },
  "undo_stack": [],
  "redo_stack": []
}
</file>

<file path="backend/data/processed/vol_20251205_145234_40bbedec/metadata.json">
{
  "id": "vol_20251205_145234_40bbedec",
  "filename": "2023.08.16_14.44.06_3DprintSample.oct-Flow_edNM.dcm",
  "shape": [
    500,
    301,
    500
  ],
  "spacing": [
    1.0,
    1.0,
    1.0
  ],
  "origin": [
    0.0,
    0.0,
    0.0
  ],
  "axis_labels": [
    "X",
    "Y",
    "Z"
  ],
  "value_range": [
    0.0,
    1.0
  ],
  "vessel_fraction": 0.10466506312292359,
  "created_at": "2025-12-05T14:52:36.072305"
}
</file>

<file path="backend/data/processed/vol_20251205_184159_1c530d6d/metadata.json">
{
  "id": "vol_20251205_184159_1c530d6d",
  "filename": "7.oct-Stru.dcm",
  "shape": [
    500,
    351,
    500
  ],
  "spacing": [
    1.0,
    1.0,
    1.0
  ],
  "origin": [
    0.0,
    0.0,
    0.0
  ],
  "axis_labels": [
    "X",
    "Y",
    "Z"
  ],
  "value_range": [
    0.0,
    1.0
  ],
  "vessel_fraction": 0.025463897435897435,
  "created_at": "2025-12-05T18:42:00.995537"
}
</file>

<file path="backend/models/__init__.py">
# 深度学习模型模块
</file>

<file path="backend/models/combined.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 联合模型

将 3D U-Net 分割网络与 Diffusion 模型结合，实现：
1. 粗分割：U-Net 快速生成初步血管 mask
2. 精修：Diffusion 模型根据条件优化细节

工作流程：
    输入(带拖尾 OCTA) 
        → U-Net 分割 
        → 初步 mask 
        → Diffusion 精修 
        → 高质量输出
"""

import torch
import torch.nn as nn
from typing import Optional, Dict, Any, Tuple

from .unet3d import UNet3D, VesselSegmentationNet
from .diffusion import OCTADiffusionModel, ConditionalUNet3D


class CombinedOCTAModel(nn.Module):
    """
    联合 OCTA 处理模型
    
    结合分割网络和扩散模型，实现两阶段处理：
    1. 分割阶段：快速生成粗分割结果
    2. 扩散阶段：利用扩散模型精修细节
    
    参数：
        seg_base_features: 分割网络基础特征数
        diff_base_features: 扩散网络基础特征数
        diff_timesteps: 扩散步数
        diff_beta_schedule: 噪声调度类型
        use_attention: 是否使用注意力机制
        device: 计算设备
    """
    
    def __init__(
        self,
        seg_base_features: int = 32,
        diff_base_features: int = 64,
        diff_timesteps: int = 1000,
        diff_beta_schedule: str = 'cosine',
        use_attention: bool = True,
        device: str = 'cuda'
    ):
        super().__init__()
        
        self.device = device
        
        # ====================================================================
        # 阶段1: 3D U-Net 分割网络
        # 输入: 带拖尾的 OCTA (B, 1, D, H, W)
        # 输出: 粗分割血管概率图 (B, 1, D, H, W)
        # ====================================================================
        self.segmentation_net = VesselSegmentationNet(
            in_channels=1,
            base_features=seg_base_features,
            use_attention=use_attention
        )
        
        # ====================================================================
        # 阶段2: 条件 Diffusion 模型
        # 输入: 
        #   - x_t: 噪声扰动的目标 (B, 1, D, H, W)
        #   - condition: 原始 OCTA + 粗分割结果 (B, 2, D, H, W)
        #   - t: 时间步
        # 输出: 预测噪声或干净目标
        # ====================================================================
        self.diffusion_model = OCTADiffusionModel(
            timesteps=diff_timesteps,
            beta_schedule=diff_beta_schedule,
            base_features=diff_base_features,
            in_channels=1,
            condition_channels=2,  # 原始 + 粗分割
            device=device
        )
        
        # 训练模式标志
        self.train_segmentation = True
        self.train_diffusion = True
    
    def forward(
        self,
        x: torch.Tensor,
        target: Optional[torch.Tensor] = None,
        return_intermediate: bool = False
    ) -> Dict[str, torch.Tensor]:
        """
        前向传播
        
        参数：
            x: 输入的带拖尾 OCTA (B, 1, D, H, W)
            target: 训练时的金标准 (B, 1, D, H, W)，推理时为 None
            return_intermediate: 是否返回中间结果
        
        返回：
            包含各阶段输出的字典
        """
        outputs = {}
        
        # ====================================================================
        # 阶段1: 分割
        # ====================================================================
        seg_logits = self.segmentation_net.unet(x)
        seg_prob = torch.sigmoid(seg_logits)
        
        outputs['seg_logits'] = seg_logits
        outputs['seg_prob'] = seg_prob
        
        # ====================================================================
        # 阶段2: 扩散精修
        # ====================================================================
        # 构建条件输入：拼接原始 OCTA 和粗分割结果
        # condition shape: (B, 2, D, H, W)
        condition = torch.cat([x, seg_prob.detach()], dim=1)
        
        if target is not None and self.training:
            # 训练模式：计算扩散损失
            diff_loss = self.diffusion_model.compute_loss(target, condition)
            outputs['diff_loss'] = diff_loss
        else:
            # 推理模式：通过扩散采样生成结果
            # 使用 DDIM 加速采样
            refined = self.diffusion_model.sample(
                condition,
                use_ddim=True,
                ddim_steps=50,
                progress=False
            )
            outputs['refined'] = refined
        
        if return_intermediate:
            outputs['condition'] = condition
        
        return outputs
    
    def compute_loss(
        self,
        x: torch.Tensor,
        target: torch.Tensor,
        seg_weight: float = 1.0,
        diff_weight: float = 1.0
    ) -> Dict[str, torch.Tensor]:
        """
        计算联合训练损失
        
        参数：
            x: 输入的带拖尾 OCTA
            target: 金标准
            seg_weight: 分割损失权重
            diff_weight: 扩散损失权重
        
        返回：
            包含各项损失的字典
        """
        from training.losses import DiceLoss
        
        # 前向传播
        outputs = self.forward(x, target)
        
        # 分割损失
        seg_logits = outputs['seg_logits']
        dice_loss = DiceLoss()(torch.sigmoid(seg_logits), target)
        bce_loss = nn.BCEWithLogitsLoss()(seg_logits, target)
        seg_loss = dice_loss + bce_loss
        
        # 扩散损失
        diff_loss = outputs.get('diff_loss', torch.tensor(0.0, device=self.device))
        
        # 总损失
        total_loss = seg_weight * seg_loss + diff_weight * diff_loss
        
        return {
            'total_loss': total_loss,
            'seg_loss': seg_loss,
            'dice_loss': dice_loss,
            'bce_loss': bce_loss,
            'diff_loss': diff_loss
        }
    
    @torch.no_grad()
    def predict(
        self,
        x: torch.Tensor,
        use_diffusion: bool = True,
        use_ddim: bool = True,
        ddim_steps: int = 50,
        seg_threshold: float = 0.5
    ) -> Dict[str, torch.Tensor]:
        """
        推理预测
        
        参数：
            x: 输入的带拖尾 OCTA
            use_diffusion: 是否使用扩散模型精修
            use_ddim: 是否使用 DDIM 加速
            ddim_steps: DDIM 采样步数
            seg_threshold: 分割阈值
        
        返回：
            包含预测结果的字典
        """
        self.eval()
        
        # 分割
        seg_logits = self.segmentation_net.unet(x)
        seg_prob = torch.sigmoid(seg_logits)
        seg_mask = (seg_prob > seg_threshold).float()
        
        results = {
            'seg_prob': seg_prob,
            'seg_mask': seg_mask
        }
        
        if use_diffusion:
            # 构建条件
            condition = torch.cat([x, seg_prob], dim=1)
            
            # 扩散采样
            refined = self.diffusion_model.sample(
                condition,
                use_ddim=use_ddim,
                ddim_steps=ddim_steps,
                progress=False
            )
            
            results['refined'] = refined
            results['refined_mask'] = (refined > seg_threshold).float()
        
        return results
    
    def get_segmentation_params(self):
        """获取分割网络参数"""
        return self.segmentation_net.parameters()
    
    def get_diffusion_params(self):
        """获取扩散模型参数"""
        return self.diffusion_model.parameters()
    
    def freeze_segmentation(self):
        """冻结分割网络"""
        for param in self.segmentation_net.parameters():
            param.requires_grad = False
        self.train_segmentation = False
    
    def unfreeze_segmentation(self):
        """解冻分割网络"""
        for param in self.segmentation_net.parameters():
            param.requires_grad = True
        self.train_segmentation = True
    
    def freeze_diffusion(self):
        """冻结扩散模型"""
        for param in self.diffusion_model.parameters():
            param.requires_grad = False
        self.train_diffusion = False
    
    def unfreeze_diffusion(self):
        """解冻扩散模型"""
        for param in self.diffusion_model.parameters():
            param.requires_grad = True
        self.train_diffusion = True


class CascadeTrainer:
    """
    级联训练器
    
    实现两阶段训练策略：
    1. 先训练分割网络直到收敛
    2. 冻结分割网络，训练扩散模型
    """
    
    def __init__(
        self,
        model: CombinedOCTAModel,
        seg_epochs: int = 50,
        diff_epochs: int = 50,
        learning_rate: float = 1e-4,
        device: str = 'cuda'
    ):
        self.model = model
        self.seg_epochs = seg_epochs
        self.diff_epochs = diff_epochs
        self.learning_rate = learning_rate
        self.device = device
        
        # 优化器（将在训练时创建）
        self.seg_optimizer = None
        self.diff_optimizer = None
    
    def train_stage1(
        self,
        train_loader,
        val_loader=None,
        callbacks=None
    ):
        """
        阶段1: 训练分割网络
        """
        print("=" * 60)
        print("阶段 1: 训练分割网络")
        print("=" * 60)
        
        self.model.freeze_diffusion()
        self.model.unfreeze_segmentation()
        
        self.seg_optimizer = torch.optim.AdamW(
            self.model.get_segmentation_params(),
            lr=self.learning_rate,
            weight_decay=1e-5
        )
        
        scheduler = torch.optim.lr_scheduler.CosineAnnealingLR(
            self.seg_optimizer,
            T_max=self.seg_epochs
        )
        
        best_loss = float('inf')
        
        for epoch in range(self.seg_epochs):
            self.model.train()
            epoch_loss = 0.0
            
            for batch_idx, (inputs, targets) in enumerate(train_loader):
                inputs = inputs.to(self.device)
                targets = targets.to(self.device)
                
                self.seg_optimizer.zero_grad()
                
                losses = self.model.compute_loss(inputs, targets, seg_weight=1.0, diff_weight=0.0)
                loss = losses['seg_loss']
                
                loss.backward()
                self.seg_optimizer.step()
                
                epoch_loss += loss.item()
            
            epoch_loss /= len(train_loader)
            scheduler.step()
            
            print(f"Epoch {epoch+1}/{self.seg_epochs} - 分割 Loss: {epoch_loss:.4f}")
            
            if callbacks:
                for cb in callbacks:
                    cb(epoch, epoch_loss, 'segmentation')
        
        print("阶段 1 完成")
    
    def train_stage2(
        self,
        train_loader,
        val_loader=None,
        callbacks=None
    ):
        """
        阶段2: 训练扩散模型
        """
        print("=" * 60)
        print("阶段 2: 训练扩散模型")
        print("=" * 60)
        
        self.model.freeze_segmentation()
        self.model.unfreeze_diffusion()
        
        self.diff_optimizer = torch.optim.AdamW(
            self.model.get_diffusion_params(),
            lr=self.learning_rate,
            weight_decay=1e-5
        )
        
        scheduler = torch.optim.lr_scheduler.CosineAnnealingLR(
            self.diff_optimizer,
            T_max=self.diff_epochs
        )
        
        for epoch in range(self.diff_epochs):
            self.model.train()
            epoch_loss = 0.0
            
            for batch_idx, (inputs, targets) in enumerate(train_loader):
                inputs = inputs.to(self.device)
                targets = targets.to(self.device)
                
                self.diff_optimizer.zero_grad()
                
                losses = self.model.compute_loss(inputs, targets, seg_weight=0.0, diff_weight=1.0)
                loss = losses['diff_loss']
                
                loss.backward()
                torch.nn.utils.clip_grad_norm_(self.model.get_diffusion_params(), 1.0)
                self.diff_optimizer.step()
                
                epoch_loss += loss.item()
            
            epoch_loss /= len(train_loader)
            scheduler.step()
            
            print(f"Epoch {epoch+1}/{self.diff_epochs} - 扩散 Loss: {epoch_loss:.4f}")
            
            if callbacks:
                for cb in callbacks:
                    cb(epoch, epoch_loss, 'diffusion')
        
        print("阶段 2 完成")
    
    def train(
        self,
        train_loader,
        val_loader=None,
        callbacks=None
    ):
        """
        完整的级联训练
        """
        # 阶段1
        self.train_stage1(train_loader, val_loader, callbacks)
        
        # 阶段2
        self.train_stage2(train_loader, val_loader, callbacks)
        
        # 解冻所有参数
        self.model.unfreeze_segmentation()
        self.model.unfreeze_diffusion()
        
        print("=" * 60)
        print("级联训练完成!")
        print("=" * 60)
</file>

<file path="backend/models/diffusion.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 3D Diffusion 模型

================================================================================
扩散模型数学原理
================================================================================

扩散模型（Diffusion Models）是一类基于随机过程的生成模型，包含两个过程：

【1. 前向扩散过程（Forward Diffusion Process）】

逐步向数据添加高斯噪声，直到数据变成纯噪声：

\[
q(x_t | x_{t-1}) = \mathcal{N}(x_t; \sqrt{1-\beta_t} x_{t-1}, \beta_t \mathbf{I})
\]

其中 β_t 是噪声调度参数，t ∈ {1, 2, ..., T}。

可以直接从 x_0 采样任意时刻 x_t：

\[
q(x_t | x_0) = \mathcal{N}(x_t; \sqrt{\bar{\alpha}_t} x_0, (1-\bar{\alpha}_t) \mathbf{I})
\]

其中：
- α_t = 1 - β_t
- ᾱ_t = ∏_{s=1}^t α_s

【2. 反向去噪过程（Reverse Denoising Process）】

学习从噪声恢复数据的过程：

\[
p_\theta(x_{t-1} | x_t) = \mathcal{N}(x_{t-1}; \mu_\theta(x_t, t), \Sigma_\theta(x_t, t))
\]

网络预测噪声 ε_θ(x_t, t)，均值计算为：

\[
\mu_\theta(x_t, t) = \frac{1}{\sqrt{\alpha_t}} \left( x_t - \frac{\beta_t}{\sqrt{1-\bar{\alpha}_t}} \epsilon_\theta(x_t, t) \right)
\]

【3. 训练目标】

简化的损失函数（预测噪声）：

\[
\mathcal{L}_{simple} = \mathbb{E}_{t, x_0, \epsilon} \left[ \| \epsilon - \epsilon_\theta(x_t, t) \|^2 \right]
\]

【4. 条件扩散（Conditional Diffusion）】

本系统使用条件扩散模型，条件是带拖尾的 OCTA 数据：

\[
p_\theta(x_{t-1} | x_t, c) = \mathcal{N}(x_{t-1}; \mu_\theta(x_t, t, c), \Sigma_\theta(x_t, t, c))
\]

其中 c 是条件信息（带拖尾的 OCTA 体数据）。

================================================================================
"""

import math
import torch
import torch.nn as nn
import torch.nn.functional as F
from typing import Optional, Tuple, Dict, Any, List
from functools import partial
from tqdm import tqdm


# ============================================================================
# 噪声调度器
# ============================================================================

def linear_beta_schedule(timesteps: int, beta_start: float = 0.0001, beta_end: float = 0.02):
    """
    线性噪声调度
    
    β_t 从 beta_start 线性增加到 beta_end
    """
    return torch.linspace(beta_start, beta_end, timesteps)


def cosine_beta_schedule(timesteps: int, s: float = 0.008):
    """
    余弦噪声调度（推荐）
    
    相比线性调度，余弦调度在训练初期更平滑，生成质量更好
    
    公式：
    ᾱ_t = cos²((t/T + s) / (1 + s) × π/2)
    β_t = 1 - ᾱ_t / ᾱ_{t-1}
    """
    steps = timesteps + 1
    x = torch.linspace(0, timesteps, steps)
    
    alphas_cumprod = torch.cos(((x / timesteps) + s) / (1 + s) * math.pi * 0.5) ** 2
    alphas_cumprod = alphas_cumprod / alphas_cumprod[0]
    
    betas = 1 - (alphas_cumprod[1:] / alphas_cumprod[:-1])
    return torch.clip(betas, 0.0001, 0.9999)


def quadratic_beta_schedule(timesteps: int, beta_start: float = 0.0001, beta_end: float = 0.02):
    """
    二次噪声调度
    """
    return torch.linspace(beta_start ** 0.5, beta_end ** 0.5, timesteps) ** 2


# ============================================================================
# 时间嵌入
# ============================================================================

class SinusoidalPositionEmbeddings(nn.Module):
    """
    正弦位置嵌入
    
    将时间步 t 编码为高维向量，使网络能够区分不同的噪声级别
    
    使用 Transformer 中的位置编码方法：
    PE(pos, 2i) = sin(pos / 10000^(2i/d))
    PE(pos, 2i+1) = cos(pos / 10000^(2i/d))
    """
    
    def __init__(self, dim: int):
        super().__init__()
        self.dim = dim
    
    def forward(self, time: torch.Tensor) -> torch.Tensor:
        device = time.device
        half_dim = self.dim // 2
        
        embeddings = math.log(10000) / (half_dim - 1)
        embeddings = torch.exp(torch.arange(half_dim, device=device) * -embeddings)
        embeddings = time[:, None] * embeddings[None, :]
        embeddings = torch.cat((embeddings.sin(), embeddings.cos()), dim=-1)
        
        return embeddings


# ============================================================================
# 3D Diffusion U-Net 组件
# ============================================================================

class ResBlock3D(nn.Module):
    """
    残差块，带时间嵌入
    
    结构：
    x → Conv → Norm → Act → Conv → Norm → + → Act → out
    ↓                                       ↑
    └─────────── residual ──────────────────┘
    
    时间嵌入通过 MLP 映射后与特征相加
    """
    
    def __init__(
        self,
        in_channels: int,
        out_channels: int,
        time_emb_dim: int,
        dropout: float = 0.1
    ):
        super().__init__()
        
        self.time_mlp = nn.Sequential(
            nn.SiLU(),
            nn.Linear(time_emb_dim, out_channels)
        )
        
        self.block1 = nn.Sequential(
            nn.GroupNorm(8, in_channels),
            nn.SiLU(),
            nn.Conv3d(in_channels, out_channels, kernel_size=3, padding=1)
        )
        
        self.block2 = nn.Sequential(
            nn.GroupNorm(8, out_channels),
            nn.SiLU(),
            nn.Dropout(dropout),
            nn.Conv3d(out_channels, out_channels, kernel_size=3, padding=1)
        )
        
        if in_channels != out_channels:
            self.shortcut = nn.Conv3d(in_channels, out_channels, kernel_size=1)
        else:
            self.shortcut = nn.Identity()
    
    def forward(self, x: torch.Tensor, t: torch.Tensor) -> torch.Tensor:
        """
        参数：
            x: 特征 (B, C, D, H, W)
            t: 时间嵌入 (B, time_emb_dim)
        """
        h = self.block1(x)
        
        # 添加时间嵌入
        time_emb = self.time_mlp(t)
        h = h + time_emb[:, :, None, None, None]
        
        h = self.block2(h)
        
        return h + self.shortcut(x)


class SelfAttention3D(nn.Module):
    """
    3D 自注意力层
    
    在特征图上计算全局注意力，捕获长程依赖
    """
    
    def __init__(self, channels: int, num_heads: int = 4):
        super().__init__()
        
        self.channels = channels
        self.num_heads = num_heads
        
        self.norm = nn.GroupNorm(8, channels)
        self.qkv = nn.Conv3d(channels, channels * 3, kernel_size=1)
        self.proj = nn.Conv3d(channels, channels, kernel_size=1)
    
    def forward(self, x: torch.Tensor) -> torch.Tensor:
        B, C, D, H, W = x.shape
        
        # 归一化
        h = self.norm(x)
        
        # QKV 投影
        qkv = self.qkv(h)
        q, k, v = qkv.chunk(3, dim=1)
        
        # 重塑为序列形式
        q = q.view(B, self.num_heads, C // self.num_heads, -1)
        k = k.view(B, self.num_heads, C // self.num_heads, -1)
        v = v.view(B, self.num_heads, C // self.num_heads, -1)
        
        # 注意力计算
        scale = (C // self.num_heads) ** -0.5
        attn = torch.softmax(torch.einsum('bhcd,bhce->bhde', q, k) * scale, dim=-1)
        out = torch.einsum('bhde,bhce->bhcd', attn, v)
        
        # 恢复形状
        out = out.view(B, C, D, H, W)
        out = self.proj(out)
        
        return x + out


class DownBlock3D(nn.Module):
    """下采样块"""
    
    def __init__(
        self,
        in_channels: int,
        out_channels: int,
        time_emb_dim: int,
        use_attention: bool = False,
        num_heads: int = 4
    ):
        super().__init__()
        
        self.res_block = ResBlock3D(in_channels, out_channels, time_emb_dim)
        
        if use_attention:
            self.attention = SelfAttention3D(out_channels, num_heads)
        else:
            self.attention = None
        
        self.downsample = nn.Conv3d(out_channels, out_channels, kernel_size=2, stride=2)
    
    def forward(self, x: torch.Tensor, t: torch.Tensor) -> Tuple[torch.Tensor, torch.Tensor]:
        h = self.res_block(x, t)
        
        if self.attention is not None:
            h = self.attention(h)
        
        skip = h
        h = self.downsample(h)
        
        return h, skip


class UpBlock3D(nn.Module):
    """上采样块"""
    
    def __init__(
        self,
        in_channels: int,
        out_channels: int,
        time_emb_dim: int,
        use_attention: bool = False,
        num_heads: int = 4
    ):
        super().__init__()
        
        self.upsample = nn.ConvTranspose3d(in_channels, in_channels, kernel_size=2, stride=2)
        self.res_block = ResBlock3D(in_channels + out_channels, out_channels, time_emb_dim)
        
        if use_attention:
            self.attention = SelfAttention3D(out_channels, num_heads)
        else:
            self.attention = None
    
    def forward(
        self, 
        x: torch.Tensor, 
        skip: torch.Tensor, 
        t: torch.Tensor
    ) -> torch.Tensor:
        x = self.upsample(x)
        
        # 处理尺寸不匹配
        if x.shape[2:] != skip.shape[2:]:
            x = F.interpolate(x, size=skip.shape[2:], mode='trilinear', align_corners=False)
        
        x = torch.cat([x, skip], dim=1)
        x = self.res_block(x, t)
        
        if self.attention is not None:
            x = self.attention(x)
        
        return x


# ============================================================================
# 条件 3D Diffusion U-Net
# ============================================================================

class ConditionalUNet3D(nn.Module):
    """
    条件 3D Diffusion U-Net
    
    用于从噪声预测目标数据，条件是带拖尾的 OCTA 体数据
    
    输入：
        x_t: 噪声图像 (B, 1, D, H, W)
        t: 时间步 (B,)
        condition: 条件（带拖尾的 OCTA）(B, 1, D, H, W)
    
    输出：
        预测的噪声 ε (B, 1, D, H, W)
    """
    
    def __init__(
        self,
        in_channels: int = 1,
        out_channels: int = 1,
        condition_channels: int = 1,
        base_features: int = 64,
        time_emb_dim: int = 256,
        num_layers: int = 4,
        attention_layers: List[int] = [2, 3],  # 在哪些层使用注意力
        num_heads: int = 4
    ):
        super().__init__()
        
        self.time_emb_dim = time_emb_dim
        
        # 时间嵌入
        self.time_mlp = nn.Sequential(
            SinusoidalPositionEmbeddings(time_emb_dim),
            nn.Linear(time_emb_dim, time_emb_dim * 4),
            nn.GELU(),
            nn.Linear(time_emb_dim * 4, time_emb_dim)
        )
        
        # 输入卷积（合并噪声图像和条件）
        self.input_conv = nn.Conv3d(
            in_channels + condition_channels, 
            base_features, 
            kernel_size=3, 
            padding=1
        )
        
        # 特征通道数
        features = [base_features * (2 ** i) for i in range(num_layers)]
        
        # 下采样块
        self.down_blocks = nn.ModuleList()
        in_ch = base_features
        for i, out_ch in enumerate(features):
            use_attn = i in attention_layers
            self.down_blocks.append(
                DownBlock3D(in_ch, out_ch, time_emb_dim, use_attn, num_heads)
            )
            in_ch = out_ch
        
        # 中间块
        self.mid_block1 = ResBlock3D(features[-1], features[-1], time_emb_dim)
        self.mid_attn = SelfAttention3D(features[-1], num_heads)
        self.mid_block2 = ResBlock3D(features[-1], features[-1], time_emb_dim)
        
        # 上采样块
        self.up_blocks = nn.ModuleList()
        reversed_features = list(reversed(features))
        for i in range(len(reversed_features) - 1):
            in_ch = reversed_features[i]
            out_ch = reversed_features[i + 1]
            use_attn = (len(features) - 1 - i) in attention_layers
            self.up_blocks.append(
                UpBlock3D(in_ch, out_ch, time_emb_dim, use_attn, num_heads)
            )
        
        # 最后一个上采样块
        self.up_blocks.append(
            UpBlock3D(reversed_features[-1], base_features, time_emb_dim, False)
        )
        
        # 输出卷积
        self.output_conv = nn.Sequential(
            nn.GroupNorm(8, base_features),
            nn.SiLU(),
            nn.Conv3d(base_features, out_channels, kernel_size=3, padding=1)
        )
    
    def forward(
        self,
        x: torch.Tensor,
        t: torch.Tensor,
        condition: torch.Tensor
    ) -> torch.Tensor:
        """
        前向传播
        
        参数：
            x: 噪声图像 (B, C, D, H, W)
            t: 时间步 (B,)
            condition: 条件 (B, C, D, H, W)
        
        返回：
            预测的噪声 (B, C, D, H, W)
        """
        # 时间嵌入
        t_emb = self.time_mlp(t)
        
        # 合并输入和条件
        x = torch.cat([x, condition], dim=1)
        x = self.input_conv(x)
        
        # 下采样
        skips = []
        for down_block in self.down_blocks:
            x, skip = down_block(x, t_emb)
            skips.append(skip)
        
        # 中间处理
        x = self.mid_block1(x, t_emb)
        x = self.mid_attn(x)
        x = self.mid_block2(x, t_emb)
        
        # 上采样
        for up_block, skip in zip(self.up_blocks, reversed(skips)):
            x = up_block(x, skip, t_emb)
        
        # 输出
        return self.output_conv(x)


# ============================================================================
# 扩散过程管理器
# ============================================================================

class DiffusionProcess:
    """
    扩散过程管理器
    
    管理前向扩散和反向去噪过程
    """
    
    def __init__(
        self,
        timesteps: int = 1000,
        beta_schedule: str = 'cosine',
        device: str = 'cuda'
    ):
        """
        参数：
            timesteps: 扩散步数 T
            beta_schedule: 噪声调度类型 ('linear', 'cosine', 'quadratic')
            device: 计算设备
        """
        self.timesteps = timesteps
        self.device = device
        
        # 计算噪声调度参数
        if beta_schedule == 'linear':
            betas = linear_beta_schedule(timesteps)
        elif beta_schedule == 'cosine':
            betas = cosine_beta_schedule(timesteps)
        elif beta_schedule == 'quadratic':
            betas = quadratic_beta_schedule(timesteps)
        else:
            raise ValueError(f"未知的噪声调度: {beta_schedule}")
        
        self.betas = betas.to(device)
        
        # 预计算常用参数
        self.alphas = 1.0 - self.betas
        self.alphas_cumprod = torch.cumprod(self.alphas, dim=0)
        self.alphas_cumprod_prev = F.pad(self.alphas_cumprod[:-1], (1, 0), value=1.0)
        
        # 用于前向采样的参数
        self.sqrt_alphas_cumprod = torch.sqrt(self.alphas_cumprod)
        self.sqrt_one_minus_alphas_cumprod = torch.sqrt(1.0 - self.alphas_cumprod)
        
        # 用于反向采样的参数
        self.sqrt_recip_alphas = torch.sqrt(1.0 / self.alphas)
        self.posterior_variance = (
            self.betas * (1.0 - self.alphas_cumprod_prev) / (1.0 - self.alphas_cumprod)
        )
    
    def _extract(
        self, 
        a: torch.Tensor, 
        t: torch.Tensor, 
        x_shape: Tuple[int, ...]
    ) -> torch.Tensor:
        """从参数序列中提取对应时间步的值"""
        batch_size = t.shape[0]
        out = a.gather(-1, t)
        return out.reshape(batch_size, *((1,) * (len(x_shape) - 1)))
    
    def q_sample(
        self,
        x_start: torch.Tensor,
        t: torch.Tensor,
        noise: Optional[torch.Tensor] = None
    ) -> torch.Tensor:
        """
        前向扩散采样：q(x_t | x_0)
        
        \[
        x_t = \sqrt{\bar{\alpha}_t} x_0 + \sqrt{1 - \bar{\alpha}_t} \epsilon
        \]
        
        参数：
            x_start: 原始数据 x_0
            t: 时间步
            noise: 可选的噪声，默认随机生成
        
        返回：
            加噪后的数据 x_t
        """
        if noise is None:
            noise = torch.randn_like(x_start)
        
        sqrt_alphas_cumprod_t = self._extract(
            self.sqrt_alphas_cumprod, t, x_start.shape
        )
        sqrt_one_minus_alphas_cumprod_t = self._extract(
            self.sqrt_one_minus_alphas_cumprod, t, x_start.shape
        )
        
        return sqrt_alphas_cumprod_t * x_start + sqrt_one_minus_alphas_cumprod_t * noise
    
    @torch.no_grad()
    def p_sample(
        self,
        model: nn.Module,
        x_t: torch.Tensor,
        t: torch.Tensor,
        condition: torch.Tensor
    ) -> torch.Tensor:
        """
        反向去噪一步：p(x_{t-1} | x_t)
        
        \[
        x_{t-1} = \frac{1}{\sqrt{\alpha_t}} \left( x_t - \frac{\beta_t}{\sqrt{1-\bar{\alpha}_t}} \epsilon_\theta \right) + \sigma_t z
        \]
        
        参数：
            model: 噪声预测模型
            x_t: 当前噪声数据
            t: 时间步
            condition: 条件信息
        
        返回：
            去噪后的数据 x_{t-1}
        """
        # 预测噪声
        predicted_noise = model(x_t, t, condition)
        
        # 提取参数
        betas_t = self._extract(self.betas, t, x_t.shape)
        sqrt_one_minus_alphas_cumprod_t = self._extract(
            self.sqrt_one_minus_alphas_cumprod, t, x_t.shape
        )
        sqrt_recip_alphas_t = self._extract(self.sqrt_recip_alphas, t, x_t.shape)
        
        # 计算均值
        model_mean = sqrt_recip_alphas_t * (
            x_t - betas_t * predicted_noise / sqrt_one_minus_alphas_cumprod_t
        )
        
        # 添加噪声（除了 t=0）
        if t[0] == 0:
            return model_mean
        else:
            posterior_variance_t = self._extract(self.posterior_variance, t, x_t.shape)
            noise = torch.randn_like(x_t)
            return model_mean + torch.sqrt(posterior_variance_t) * noise
    
    @torch.no_grad()
    def p_sample_loop(
        self,
        model: nn.Module,
        shape: Tuple[int, ...],
        condition: torch.Tensor,
        progress: bool = True
    ) -> torch.Tensor:
        """
        完整的反向去噪过程
        
        从纯噪声开始，逐步去噪得到生成结果
        
        参数：
            model: 噪声预测模型
            shape: 输出形状 (B, C, D, H, W)
            condition: 条件信息
            progress: 是否显示进度条
        
        返回：
            生成的数据
        """
        device = self.device
        batch_size = shape[0]
        
        # 从纯噪声开始
        x = torch.randn(shape, device=device)
        
        # 逐步去噪
        timesteps = reversed(range(self.timesteps))
        if progress:
            timesteps = tqdm(timesteps, desc='采样中', total=self.timesteps)
        
        for t in timesteps:
            t_batch = torch.full((batch_size,), t, device=device, dtype=torch.long)
            x = self.p_sample(model, x, t_batch, condition)
        
        return x
    
    @torch.no_grad()
    def ddim_sample(
        self,
        model: nn.Module,
        shape: Tuple[int, ...],
        condition: torch.Tensor,
        ddim_steps: int = 50,
        eta: float = 0.0,
        progress: bool = True
    ) -> torch.Tensor:
        """
        DDIM 采样（Denoising Diffusion Implicit Models）
        
        加速采样，使用更少的步数生成高质量结果
        
        参数：
            model: 噪声预测模型
            shape: 输出形状
            condition: 条件信息
            ddim_steps: DDIM 采样步数（远小于训练时的 timesteps）
            eta: 随机性参数（0 = 确定性，1 = DDPM）
            progress: 是否显示进度条
        
        返回：
            生成的数据
        """
        device = self.device
        batch_size = shape[0]
        
        # 选择采样时间步
        c = self.timesteps // ddim_steps
        timesteps = list(range(0, self.timesteps, c))
        timesteps = list(reversed(timesteps))
        
        # 从纯噪声开始
        x = torch.randn(shape, device=device)
        
        if progress:
            timesteps_iter = tqdm(range(len(timesteps) - 1), desc='DDIM采样')
        else:
            timesteps_iter = range(len(timesteps) - 1)
        
        for i in timesteps_iter:
            t = timesteps[i]
            t_next = timesteps[i + 1]
            
            t_batch = torch.full((batch_size,), t, device=device, dtype=torch.long)
            
            # 预测噪声
            predicted_noise = model(x, t_batch, condition)
            
            # DDIM 更新
            alpha_t = self.alphas_cumprod[t]
            alpha_t_next = self.alphas_cumprod[t_next]
            
            # 预测 x_0
            x0_pred = (x - torch.sqrt(1 - alpha_t) * predicted_noise) / torch.sqrt(alpha_t)
            x0_pred = torch.clamp(x0_pred, -1, 1)
            
            # 计算 sigma
            sigma = eta * torch.sqrt((1 - alpha_t_next) / (1 - alpha_t)) * torch.sqrt(1 - alpha_t / alpha_t_next)
            
            # 计算方向
            dir_xt = torch.sqrt(1 - alpha_t_next - sigma ** 2) * predicted_noise
            
            # 更新
            noise = torch.randn_like(x) if eta > 0 else 0
            x = torch.sqrt(alpha_t_next) * x0_pred + dir_xt + sigma * noise
        
        return x


# ============================================================================
# 完整的条件 Diffusion 模型
# ============================================================================

class OCTADiffusionModel(nn.Module):
    """
    OCTA 条件扩散模型
    
    用于从带拖尾的 OCTA 数据生成干净的血管网络
    
    使用方法：
    ```python
    model = OCTADiffusionModel()
    
    # 训练
    loss = model.compute_loss(clean_octa, tailed_octa)
    
    # 推理
    clean_pred = model.sample(tailed_octa)
    ```
    """
    
    def __init__(
        self,
        timesteps: int = 1000,
        beta_schedule: str = 'cosine',
        base_features: int = 64,
        time_emb_dim: int = 256,
        device: str = 'cuda'
    ):
        super().__init__()
        
        self.device = device
        
        # 扩散过程
        self.diffusion = DiffusionProcess(
            timesteps=timesteps,
            beta_schedule=beta_schedule,
            device=device
        )
        
        # 噪声预测网络
        self.noise_net = ConditionalUNet3D(
            in_channels=1,
            out_channels=1,
            condition_channels=1,
            base_features=base_features,
            time_emb_dim=time_emb_dim
        )
    
    def compute_loss(
        self,
        x_start: torch.Tensor,
        condition: torch.Tensor,
        noise: Optional[torch.Tensor] = None
    ) -> torch.Tensor:
        """
        计算训练损失
        
        \[
        \mathcal{L} = \mathbb{E}_{t, x_0, \epsilon} \| \epsilon - \epsilon_\theta(x_t, t, c) \|^2
        \]
        
        参数：
            x_start: 干净的 OCTA 数据（目标）
            condition: 带拖尾的 OCTA 数据（条件）
            noise: 可选的噪声
        
        返回：
            MSE 损失
        """
        batch_size = x_start.shape[0]
        
        # 随机采样时间步
        t = torch.randint(
            0, self.diffusion.timesteps, 
            (batch_size,), 
            device=x_start.device
        ).long()
        
        # 生成噪声
        if noise is None:
            noise = torch.randn_like(x_start)
        
        # 前向扩散
        x_t = self.diffusion.q_sample(x_start, t, noise)
        
        # 预测噪声
        predicted_noise = self.noise_net(x_t, t, condition)
        
        # MSE 损失
        loss = F.mse_loss(predicted_noise, noise)
        
        return loss
    
    @torch.no_grad()
    def sample(
        self,
        condition: torch.Tensor,
        use_ddim: bool = True,
        ddim_steps: int = 50,
        progress: bool = True
    ) -> torch.Tensor:
        """
        从条件生成干净的 OCTA 数据
        
        参数：
            condition: 带拖尾的 OCTA 数据
            use_ddim: 是否使用 DDIM 加速采样
            ddim_steps: DDIM 步数
            progress: 是否显示进度条
        
        返回：
            生成的干净 OCTA 数据
        """
        self.noise_net.eval()
        
        shape = condition.shape
        
        if use_ddim:
            output = self.diffusion.ddim_sample(
                self.noise_net,
                shape,
                condition,
                ddim_steps=ddim_steps,
                progress=progress
            )
        else:
            output = self.diffusion.p_sample_loop(
                self.noise_net,
                shape,
                condition,
                progress=progress
            )
        
        # 限制输出范围
        output = torch.clamp(output, 0, 1)
        
        return output
    
    def forward(
        self,
        x_start: torch.Tensor,
        condition: torch.Tensor
    ) -> torch.Tensor:
        """训练时的前向传播，返回损失"""
        return self.compute_loss(x_start, condition)


# 测试代码
if __name__ == "__main__":
    device = 'cuda' if torch.cuda.is_available() else 'cpu'
    print(f"使用设备: {device}")
    
    # 创建模型
    model = OCTADiffusionModel(
        timesteps=1000,
        beta_schedule='cosine',
        base_features=32,  # 减小以便测试
        device=device
    ).to(device)
    
    # 统计参数量
    total_params = sum(p.numel() for p in model.parameters())
    print(f"总参数量: {total_params:,}")
    
    # 测试前向传播
    batch_size = 2
    x_start = torch.randn(batch_size, 1, 32, 32, 32).to(device)
    condition = torch.randn(batch_size, 1, 32, 32, 32).to(device)
    
    # 计算损失
    loss = model.compute_loss(x_start, condition)
    print(f"损失: {loss.item():.4f}")
    
    # 测试采样（使用较少步数）
    print("测试 DDIM 采样...")
    output = model.sample(condition, use_ddim=True, ddim_steps=5, progress=False)
    print(f"输出形状: {output.shape}")
    
    print("\n模型测试通过！")
</file>

<file path="backend/models/unet3d.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 3D U-Net 分割网络

================================================================================
网络架构说明
================================================================================

3D U-Net 是用于三维医学图像分割的经典架构，由以下部分组成：

1. 编码器（Encoder）：
   - 逐层下采样，提取多尺度特征
   - 每层：卷积 → BN → ReLU → 卷积 → BN → ReLU → MaxPool

2. 瓶颈层（Bottleneck）：
   - 最深层特征提取

3. 解码器（Decoder）：
   - 逐层上采样，恢复空间分辨率
   - 跳跃连接（Skip Connection）融合编码器特征
   - 每层：上采样 → Concat → 卷积 → BN → ReLU → 卷积 → BN → ReLU

4. 输出层：
   - 1×1×1 卷积生成分割概率图

本实现针对 OCTA 血管分割进行了优化：
- 支持 patch-based 训练（处理大体积数据）
- 使用残差连接增强梯度流动
- 引入注意力机制提升血管边界分割精度

================================================================================
"""

import torch
import torch.nn as nn
import torch.nn.functional as F
from typing import Optional, List, Tuple


class ConvBlock3D(nn.Module):
    """
    3D 卷积块：Conv3d → BatchNorm → ReLU → Conv3d → BatchNorm → ReLU
    
    可选：残差连接
    """
    
    def __init__(
        self,
        in_channels: int,
        out_channels: int,
        kernel_size: int = 3,
        padding: int = 1,
        use_residual: bool = True
    ):
        super().__init__()
        
        self.use_residual = use_residual
        
        self.conv1 = nn.Conv3d(
            in_channels, out_channels, 
            kernel_size=kernel_size, 
            padding=padding
        )
        self.bn1 = nn.BatchNorm3d(out_channels)
        
        self.conv2 = nn.Conv3d(
            out_channels, out_channels, 
            kernel_size=kernel_size, 
            padding=padding
        )
        self.bn2 = nn.BatchNorm3d(out_channels)
        
        self.relu = nn.ReLU(inplace=True)
        
        # 残差连接的通道匹配
        if use_residual and in_channels != out_channels:
            self.residual_conv = nn.Conv3d(
                in_channels, out_channels, 
                kernel_size=1
            )
        else:
            self.residual_conv = None
    
    def forward(self, x: torch.Tensor) -> torch.Tensor:
        residual = x
        
        out = self.conv1(x)
        out = self.bn1(out)
        out = self.relu(out)
        
        out = self.conv2(out)
        out = self.bn2(out)
        
        if self.use_residual:
            if self.residual_conv is not None:
                residual = self.residual_conv(residual)
            out = out + residual
        
        out = self.relu(out)
        return out


class AttentionGate3D(nn.Module):
    """
    3D 注意力门控
    
    用于在跳跃连接中增强重要特征，抑制无关特征
    特别适合血管分割，可以聚焦于血管边界
    
    公式：
    α = σ(W_ψ × ψ + W_g × g + b)
    out = α × g
    
    其中：
    - g: 编码器特征（高分辨率）
    - ψ: 解码器特征（语义丰富）
    - α: 注意力权重
    """
    
    def __init__(
        self, 
        F_g: int,  # 解码器特征通道数
        F_l: int,  # 编码器特征通道数
        F_int: int  # 中间特征通道数
    ):
        super().__init__()
        
        self.W_g = nn.Sequential(
            nn.Conv3d(F_g, F_int, kernel_size=1, stride=1, padding=0, bias=True),
            nn.BatchNorm3d(F_int)
        )
        
        self.W_x = nn.Sequential(
            nn.Conv3d(F_l, F_int, kernel_size=1, stride=1, padding=0, bias=True),
            nn.BatchNorm3d(F_int)
        )
        
        self.psi = nn.Sequential(
            nn.Conv3d(F_int, 1, kernel_size=1, stride=1, padding=0, bias=True),
            nn.BatchNorm3d(1),
            nn.Sigmoid()
        )
        
        self.relu = nn.ReLU(inplace=True)
    
    def forward(self, g: torch.Tensor, x: torch.Tensor) -> torch.Tensor:
        """
        参数：
            g: 解码器特征 (B, F_g, D, H, W)
            x: 编码器特征 (B, F_l, D, H, W)
        
        返回：
            注意力加权后的编码器特征
        """
        # 确保 g 和 x 的空间尺寸匹配
        if g.shape[2:] != x.shape[2:]:
            g = F.interpolate(g, size=x.shape[2:], mode='trilinear', align_corners=False)
        
        g1 = self.W_g(g)
        x1 = self.W_x(x)
        
        psi = self.relu(g1 + x1)
        psi = self.psi(psi)
        
        return x * psi


class UNet3D(nn.Module):
    """
    3D U-Net 分割网络
    
    用于 OCTA 血管分割：
    - 输入：带拖尾的 OCTA 体数据 (B, 1, D, H, W)
    - 输出：血管概率图 (B, 1, D, H, W) 或二值掩模
    
    特点：
    - 4 层编码器-解码器结构
    - 注意力门控跳跃连接
    - 残差连接
    - 支持深度监督
    """
    
    def __init__(
        self,
        in_channels: int = 1,
        out_channels: int = 1,
        base_features: int = 32,
        use_attention: bool = True,
        use_residual: bool = True,
        deep_supervision: bool = False
    ):
        """
        参数：
            in_channels: 输入通道数（默认 1，灰度 OCTA）
            out_channels: 输出通道数（默认 1，血管概率）
            base_features: 基础特征通道数（逐层翻倍）
            use_attention: 是否使用注意力门控
            use_residual: 是否使用残差连接
            deep_supervision: 是否使用深度监督
        """
        super().__init__()
        
        self.use_attention = use_attention
        self.deep_supervision = deep_supervision
        
        # 特征通道数：32 → 64 → 128 → 256 → 512
        features = [base_features * (2 ** i) for i in range(5)]
        
        # ============================================================
        # 编码器
        # ============================================================
        self.encoder1 = ConvBlock3D(in_channels, features[0], use_residual=use_residual)
        self.pool1 = nn.MaxPool3d(kernel_size=2, stride=2)
        
        self.encoder2 = ConvBlock3D(features[0], features[1], use_residual=use_residual)
        self.pool2 = nn.MaxPool3d(kernel_size=2, stride=2)
        
        self.encoder3 = ConvBlock3D(features[1], features[2], use_residual=use_residual)
        self.pool3 = nn.MaxPool3d(kernel_size=2, stride=2)
        
        self.encoder4 = ConvBlock3D(features[2], features[3], use_residual=use_residual)
        self.pool4 = nn.MaxPool3d(kernel_size=2, stride=2)
        
        # ============================================================
        # 瓶颈层
        # ============================================================
        self.bottleneck = ConvBlock3D(features[3], features[4], use_residual=use_residual)
        
        # ============================================================
        # 解码器
        # ============================================================
        self.upconv4 = nn.ConvTranspose3d(
            features[4], features[3], 
            kernel_size=2, stride=2
        )
        if use_attention:
            self.att4 = AttentionGate3D(features[3], features[3], features[3] // 2)
        self.decoder4 = ConvBlock3D(features[4], features[3], use_residual=use_residual)
        
        self.upconv3 = nn.ConvTranspose3d(
            features[3], features[2], 
            kernel_size=2, stride=2
        )
        if use_attention:
            self.att3 = AttentionGate3D(features[2], features[2], features[2] // 2)
        self.decoder3 = ConvBlock3D(features[3], features[2], use_residual=use_residual)
        
        self.upconv2 = nn.ConvTranspose3d(
            features[2], features[1], 
            kernel_size=2, stride=2
        )
        if use_attention:
            self.att2 = AttentionGate3D(features[1], features[1], features[1] // 2)
        self.decoder2 = ConvBlock3D(features[2], features[1], use_residual=use_residual)
        
        self.upconv1 = nn.ConvTranspose3d(
            features[1], features[0], 
            kernel_size=2, stride=2
        )
        if use_attention:
            self.att1 = AttentionGate3D(features[0], features[0], features[0] // 2)
        self.decoder1 = ConvBlock3D(features[1], features[0], use_residual=use_residual)
        
        # ============================================================
        # 输出层
        # ============================================================
        self.final_conv = nn.Conv3d(features[0], out_channels, kernel_size=1)
        
        # 深度监督输出头
        if deep_supervision:
            self.ds_out4 = nn.Conv3d(features[3], out_channels, kernel_size=1)
            self.ds_out3 = nn.Conv3d(features[2], out_channels, kernel_size=1)
            self.ds_out2 = nn.Conv3d(features[1], out_channels, kernel_size=1)
        
        # 初始化权重
        self._init_weights()
    
    def _init_weights(self):
        """权重初始化"""
        for m in self.modules():
            if isinstance(m, nn.Conv3d) or isinstance(m, nn.ConvTranspose3d):
                nn.init.kaiming_normal_(m.weight, mode='fan_out', nonlinearity='relu')
                if m.bias is not None:
                    nn.init.constant_(m.bias, 0)
            elif isinstance(m, nn.BatchNorm3d):
                nn.init.constant_(m.weight, 1)
                nn.init.constant_(m.bias, 0)
    
    def forward(
        self, 
        x: torch.Tensor
    ) -> torch.Tensor | Tuple[torch.Tensor, List[torch.Tensor]]:
        """
        前向传播
        
        参数：
            x: 输入张量 (B, C, D, H, W)
        
        返回：
            如果 deep_supervision=False：
                输出张量 (B, out_channels, D, H, W)
            如果 deep_supervision=True：
                (主输出, [中间输出列表])
        """
        # 编码器
        enc1 = self.encoder1(x)
        enc2 = self.encoder2(self.pool1(enc1))
        enc3 = self.encoder3(self.pool2(enc2))
        enc4 = self.encoder4(self.pool3(enc3))
        
        # 瓶颈
        bottleneck = self.bottleneck(self.pool4(enc4))
        
        # 解码器 4
        up4 = self.upconv4(bottleneck)
        if up4.shape[2:] != enc4.shape[2:]:
            up4 = F.interpolate(up4, size=enc4.shape[2:], mode='trilinear', align_corners=False)
        if self.use_attention:
            enc4 = self.att4(up4, enc4)
        dec4 = self.decoder4(torch.cat([up4, enc4], dim=1))
        
        # 解码器 3
        up3 = self.upconv3(dec4)
        if up3.shape[2:] != enc3.shape[2:]:
            up3 = F.interpolate(up3, size=enc3.shape[2:], mode='trilinear', align_corners=False)
        if self.use_attention:
            enc3 = self.att3(up3, enc3)
        dec3 = self.decoder3(torch.cat([up3, enc3], dim=1))
        
        # 解码器 2
        up2 = self.upconv2(dec3)
        if up2.shape[2:] != enc2.shape[2:]:
            up2 = F.interpolate(up2, size=enc2.shape[2:], mode='trilinear', align_corners=False)
        if self.use_attention:
            enc2 = self.att2(up2, enc2)
        dec2 = self.decoder2(torch.cat([up2, enc2], dim=1))
        
        # 解码器 1
        up1 = self.upconv1(dec2)
        if up1.shape[2:] != enc1.shape[2:]:
            up1 = F.interpolate(up1, size=enc1.shape[2:], mode='trilinear', align_corners=False)
        if self.use_attention:
            enc1 = self.att1(up1, enc1)
        dec1 = self.decoder1(torch.cat([up1, enc1], dim=1))
        
        # 输出
        output = self.final_conv(dec1)
        
        if self.deep_supervision and self.training:
            # 深度监督输出
            ds4 = self.ds_out4(dec4)
            ds4 = F.interpolate(ds4, size=output.shape[2:], mode='trilinear', align_corners=False)
            
            ds3 = self.ds_out3(dec3)
            ds3 = F.interpolate(ds3, size=output.shape[2:], mode='trilinear', align_corners=False)
            
            ds2 = self.ds_out2(dec2)
            ds2 = F.interpolate(ds2, size=output.shape[2:], mode='trilinear', align_corners=False)
            
            return output, [ds4, ds3, ds2]
        
        return output


class VesselSegmentationNet(nn.Module):
    """
    血管分割网络（带后处理）
    
    在 3D U-Net 基础上添加：
    - Sigmoid 激活输出概率
    - 可选的后处理层（形态学操作等）
    """
    
    def __init__(
        self,
        **unet_kwargs
    ):
        super().__init__()
        
        self.unet = UNet3D(**unet_kwargs)
    
    def forward(self, x: torch.Tensor) -> torch.Tensor:
        """
        前向传播
        
        返回：
            血管概率图 (B, 1, D, H, W)，值域 [0, 1]
        """
        output = self.unet(x)
        
        if isinstance(output, tuple):
            main_out = output[0]
            return torch.sigmoid(main_out), [torch.sigmoid(o) for o in output[1]]
        
        return torch.sigmoid(output)
    
    def predict(
        self, 
        x: torch.Tensor, 
        threshold: float = 0.5
    ) -> torch.Tensor:
        """
        预测二值掩模
        
        参数：
            x: 输入张量
            threshold: 二值化阈值
        
        返回：
            二值掩模 (B, 1, D, H, W)
        """
        with torch.no_grad():
            prob = self.forward(x)
            if isinstance(prob, tuple):
                prob = prob[0]
            return (prob > threshold).float()


# 测试代码
if __name__ == "__main__":
    # 创建模型
    model = UNet3D(
        in_channels=1,
        out_channels=1,
        base_features=32,
        use_attention=True,
        use_residual=True,
        deep_supervision=True
    )
    
    # 打印模型结构
    print("=" * 60)
    print("3D U-Net 模型结构")
    print("=" * 60)
    
    # 统计参数量
    total_params = sum(p.numel() for p in model.parameters())
    trainable_params = sum(p.numel() for p in model.parameters() if p.requires_grad)
    
    print(f"总参数量: {total_params:,}")
    print(f"可训练参数量: {trainable_params:,}")
    
    # 测试前向传播
    x = torch.randn(1, 1, 32, 32, 32)
    model.train()
    output = model(x)
    
    if isinstance(output, tuple):
        print(f"\n主输出形状: {output[0].shape}")
        print(f"深度监督输出数: {len(output[1])}")
        for i, ds in enumerate(output[1]):
            print(f"  DS{4-i} 输出形状: {ds.shape}")
    else:
        print(f"\n输出形状: {output.shape}")
    
    print("\n模型测试通过！")
</file>

<file path="backend/requirements.txt">
# OCTA Vessel Analyzer - Backend Dependencies

# Web Framework
fastapi>=0.100.0
uvicorn[standard]>=0.23.0
python-multipart>=0.0.6

# Medical Image Processing
pydicom>=2.4.0
SimpleITK>=2.3.0
nibabel>=5.0.0
h5py>=3.9.0

# Numerical Computing
numpy>=1.24.0
scipy>=1.11.0
scikit-image>=0.21.0

# Deep Learning (install separately for CUDA support)
torch>=2.0.0
torchvision>=0.15.0

# 3D Visualization and Mesh Processing
trimesh>=4.0.0

# Image Processing
opencv-python>=4.8.0
Pillow>=10.0.0
matplotlib>=3.7.0

# Utilities
tqdm>=4.66.0
pydantic>=2.0.0

# Parallel Processing
joblib>=1.3.0
</file>

<file path="backend/training/__init__.py">
# 训练管理模块
</file>

<file path="backend/training/dataset.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 数据集定义

提供用于训练的数据集类：
1. OCTAPatchDataset: 从大型 3D 体数据提取 patch
2. OCTASliceDataset: 2D 切片数据集
3. 数据增强变换
"""

import numpy as np
import torch
from torch.utils.data import Dataset
from typing import Tuple, Optional, List, Callable
from scipy.ndimage import rotate, zoom, affine_transform
import random


class OCTAPatchDataset(Dataset):
    """
    OCTA 3D Patch 数据集
    
    从大型 3D 体数据中提取固定大小的 patch 用于训练
    支持数据增强和在线采样
    
    参数：
        octa_volume: 原始 OCTA 体数据 (X, Y, Z)
        label_volume: 标签体数据 (X, Y, Z)
        patch_size: patch 大小
        stride: 滑动步长（默认为 patch_size 的一半）
        augment: 是否启用数据增强
        min_vessel_ratio: 最小血管占比（过滤全背景 patch）
        transform: 额外的变换函数
    """
    
    def __init__(
        self,
        octa_volume: np.ndarray,
        label_volume: np.ndarray,
        patch_size: int = 32,
        stride: Optional[int] = None,
        augment: bool = True,
        min_vessel_ratio: float = 0.001,
        transform: Optional[Callable] = None
    ):
        self.octa_volume = octa_volume.astype(np.float32)
        self.label_volume = label_volume.astype(np.float32)
        self.patch_size = patch_size
        self.stride = stride if stride is not None else patch_size // 2
        self.augment = augment
        self.min_vessel_ratio = min_vessel_ratio
        self.transform = transform
        
        # 预计算所有有效 patch 的位置
        self.patch_positions = self._compute_patch_positions()
        
        print(f"数据集初始化完成:")
        print(f"  - 体数据大小: {octa_volume.shape}")
        print(f"  - Patch 大小: {patch_size}³")
        print(f"  - 步长: {self.stride}")
        print(f"  - 有效 Patch 数量: {len(self.patch_positions)}")
    
    def _compute_patch_positions(self) -> List[Tuple[int, int, int]]:
        """计算所有有效 patch 的起始位置"""
        positions = []
        
        X, Y, Z = self.octa_volume.shape
        ps = self.patch_size
        
        for x in range(0, X - ps + 1, self.stride):
            for y in range(0, Y - ps + 1, self.stride):
                for z in range(0, Z - ps + 1, self.stride):
                    # 提取标签 patch
                    label_patch = self.label_volume[x:x+ps, y:y+ps, z:z+ps]
                    
                    # 检查血管占比
                    vessel_ratio = label_patch.sum() / label_patch.size
                    
                    if vessel_ratio >= self.min_vessel_ratio:
                        positions.append((x, y, z))
        
        return positions
    
    def __len__(self) -> int:
        return len(self.patch_positions)
    
    def __getitem__(self, idx: int) -> Tuple[torch.Tensor, torch.Tensor]:
        x, y, z = self.patch_positions[idx]
        ps = self.patch_size
        
        # 提取 patch
        octa_patch = self.octa_volume[x:x+ps, y:y+ps, z:z+ps].copy()
        label_patch = self.label_volume[x:x+ps, y:y+ps, z:z+ps].copy()
        
        # 数据增强
        if self.augment:
            octa_patch, label_patch = self._augment(octa_patch, label_patch)
        
        # 额外变换
        if self.transform:
            octa_patch, label_patch = self.transform(octa_patch, label_patch)
        
        # 转换为 tensor
        # 添加通道维度: (D, H, W) -> (1, D, H, W)
        octa_tensor = torch.from_numpy(octa_patch).unsqueeze(0)
        label_tensor = torch.from_numpy(label_patch).unsqueeze(0)
        
        return octa_tensor, label_tensor
    
    def _augment(
        self, 
        octa: np.ndarray, 
        label: np.ndarray
    ) -> Tuple[np.ndarray, np.ndarray]:
        """
        数据增强
        
        包括：
        1. 随机翻转（3 个轴）
        2. 随机旋转（90° 倍数）
        3. 强度扰动
        """
        # 随机翻转
        for axis in range(3):
            if random.random() > 0.5:
                octa = np.flip(octa, axis=axis).copy()
                label = np.flip(label, axis=axis).copy()
        
        # 随机旋转 90° 倍数
        k = random.choice([0, 1, 2, 3])
        if k > 0:
            # 沿 XY 平面旋转
            octa = np.rot90(octa, k=k, axes=(0, 1)).copy()
            label = np.rot90(label, k=k, axes=(0, 1)).copy()
        
        # 强度扰动（只对 OCTA 数据）
        if random.random() > 0.5:
            # 添加高斯噪声
            noise = np.random.normal(0, 0.02, octa.shape).astype(np.float32)
            octa = np.clip(octa + noise, 0, 1)
        
        if random.random() > 0.5:
            # 亮度调整
            factor = random.uniform(0.9, 1.1)
            octa = np.clip(octa * factor, 0, 1)
        
        return octa, label


class OCTASliceDataset(Dataset):
    """
    OCTA 2D 切片数据集
    
    用于 2D 模型训练或快速原型验证
    
    参数：
        octa_volume: 原始 OCTA 体数据
        label_volume: 标签体数据
        axis: 切片轴向 (0, 1, 2)
        augment: 是否启用数据增强
    """
    
    def __init__(
        self,
        octa_volume: np.ndarray,
        label_volume: np.ndarray,
        axis: int = 1,
        augment: bool = True
    ):
        self.octa_volume = octa_volume.astype(np.float32)
        self.label_volume = label_volume.astype(np.float32)
        self.axis = axis
        self.augment = augment
        
        self.num_slices = octa_volume.shape[axis]
    
    def __len__(self) -> int:
        return self.num_slices
    
    def __getitem__(self, idx: int) -> Tuple[torch.Tensor, torch.Tensor]:
        # 提取切片
        if self.axis == 0:
            octa_slice = self.octa_volume[idx, :, :].copy()
            label_slice = self.label_volume[idx, :, :].copy()
        elif self.axis == 1:
            octa_slice = self.octa_volume[:, idx, :].copy()
            label_slice = self.label_volume[:, idx, :].copy()
        else:
            octa_slice = self.octa_volume[:, :, idx].copy()
            label_slice = self.label_volume[:, :, idx].copy()
        
        # 数据增强
        if self.augment:
            octa_slice, label_slice = self._augment_2d(octa_slice, label_slice)
        
        # 转换为 tensor
        octa_tensor = torch.from_numpy(octa_slice).unsqueeze(0)
        label_tensor = torch.from_numpy(label_slice).unsqueeze(0)
        
        return octa_tensor, label_tensor
    
    def _augment_2d(
        self, 
        octa: np.ndarray, 
        label: np.ndarray
    ) -> Tuple[np.ndarray, np.ndarray]:
        """2D 数据增强"""
        # 随机翻转
        if random.random() > 0.5:
            octa = np.flip(octa, axis=0).copy()
            label = np.flip(label, axis=0).copy()
        
        if random.random() > 0.5:
            octa = np.flip(octa, axis=1).copy()
            label = np.flip(label, axis=1).copy()
        
        # 随机旋转
        k = random.choice([0, 1, 2, 3])
        if k > 0:
            octa = np.rot90(octa, k=k).copy()
            label = np.rot90(label, k=k).copy()
        
        return octa, label


class OnlinePatchSampler:
    """
    在线 Patch 采样器
    
    在训练过程中动态采样 patch，支持：
    1. 难例挖掘
    2. 类别平衡采样
    """
    
    def __init__(
        self,
        octa_volume: np.ndarray,
        label_volume: np.ndarray,
        patch_size: int = 32,
        samples_per_epoch: int = 1000,
        hard_mining: bool = True
    ):
        self.octa_volume = octa_volume
        self.label_volume = label_volume
        self.patch_size = patch_size
        self.samples_per_epoch = samples_per_epoch
        self.hard_mining = hard_mining
        
        self.X, self.Y, self.Z = octa_volume.shape
        
        # 预计算血管位置（用于平衡采样）
        self.vessel_coords = np.argwhere(label_volume > 0.5)
        self.background_coords = np.argwhere(label_volume < 0.5)
    
    def sample_batch(self, batch_size: int) -> Tuple[np.ndarray, np.ndarray]:
        """采样一个 batch"""
        ps = self.patch_size
        
        octa_batch = []
        label_batch = []
        
        for _ in range(batch_size):
            # 50% 概率从血管区域采样，50% 从背景采样
            if random.random() > 0.5 and len(self.vessel_coords) > 0:
                # 从血管区域采样
                idx = random.randint(0, len(self.vessel_coords) - 1)
                center = self.vessel_coords[idx]
            else:
                # 随机采样
                center = [
                    random.randint(ps//2, self.X - ps//2 - 1),
                    random.randint(ps//2, self.Y - ps//2 - 1),
                    random.randint(ps//2, self.Z - ps//2 - 1)
                ]
            
            # 计算 patch 边界
            x = max(0, min(center[0] - ps//2, self.X - ps))
            y = max(0, min(center[1] - ps//2, self.Y - ps))
            z = max(0, min(center[2] - ps//2, self.Z - ps))
            
            # 提取 patch
            octa_patch = self.octa_volume[x:x+ps, y:y+ps, z:z+ps]
            label_patch = self.label_volume[x:x+ps, y:y+ps, z:z+ps]
            
            octa_batch.append(octa_patch)
            label_batch.append(label_patch)
        
        return np.stack(octa_batch), np.stack(label_batch)


def create_dataloader(
    octa_volume: np.ndarray,
    label_volume: np.ndarray,
    batch_size: int = 4,
    patch_size: int = 32,
    num_workers: int = 4,
    **kwargs
) -> torch.utils.data.DataLoader:
    """
    创建数据加载器的便捷函数
    
    参数：
        octa_volume: OCTA 体数据
        label_volume: 标签体数据
        batch_size: 批次大小
        patch_size: patch 大小
        num_workers: 工作进程数
        **kwargs: 传递给 OCTAPatchDataset 的其他参数
    
    返回：
        DataLoader 实例
    """
    dataset = OCTAPatchDataset(
        octa_volume=octa_volume,
        label_volume=label_volume,
        patch_size=patch_size,
        **kwargs
    )
    
    dataloader = torch.utils.data.DataLoader(
        dataset,
        batch_size=batch_size,
        shuffle=True,
        num_workers=num_workers,
        pin_memory=True,
        drop_last=True
    )
    
    return dataloader
</file>

<file path="backend/training/losses.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 损失函数

提供各种用于血管分割和生成的损失函数：
1. Dice Loss：处理类别不平衡
2. Focal Loss：关注困难样本
3. Boundary Loss：关注边界区域
4. Combined Loss：多损失组合
"""

import torch
import torch.nn as nn
import torch.nn.functional as F
from typing import Optional


class DiceLoss(nn.Module):
    """
    Dice 损失函数
    
    Dice 系数衡量两个集合的相似度：
        Dice = 2 * |X ∩ Y| / (|X| + |Y|)
        DiceLoss = 1 - Dice
    
    对于类别不平衡问题（血管占比小）特别有效
    
    参数：
        smooth: 平滑因子，防止除零
        reduction: 归约方式 ('mean', 'sum', 'none')
    """
    
    def __init__(self, smooth: float = 1e-6, reduction: str = 'mean'):
        super().__init__()
        self.smooth = smooth
        self.reduction = reduction
    
    def forward(
        self, 
        pred: torch.Tensor, 
        target: torch.Tensor
    ) -> torch.Tensor:
        """
        计算 Dice Loss
        
        参数：
            pred: 预测概率 (B, C, D, H, W) 或 (B, C, H, W)
            target: 目标标签，与 pred 形状相同
        
        返回：
            Dice Loss 值
        """
        # 确保输入在 [0, 1] 范围
        pred = torch.clamp(pred, 0, 1)
        target = torch.clamp(target, 0, 1)
        
        # 展平空间维度
        pred_flat = pred.view(pred.size(0), -1)
        target_flat = target.view(target.size(0), -1)
        
        # 计算交集
        intersection = (pred_flat * target_flat).sum(dim=1)
        
        # 计算 Dice
        dice = (2. * intersection + self.smooth) / (
            pred_flat.sum(dim=1) + target_flat.sum(dim=1) + self.smooth
        )
        
        # 损失 = 1 - Dice
        loss = 1 - dice
        
        if self.reduction == 'mean':
            return loss.mean()
        elif self.reduction == 'sum':
            return loss.sum()
        else:
            return loss


class FocalLoss(nn.Module):
    """
    Focal Loss
    
    通过调制因子 (1 - p_t)^γ 降低易分类样本的权重，
    使模型更关注困难样本
    
    公式：FL(p_t) = -α_t * (1 - p_t)^γ * log(p_t)
    
    参数：
        alpha: 类别权重（正样本权重）
        gamma: 调制因子指数
        reduction: 归约方式
    """
    
    def __init__(
        self, 
        alpha: float = 0.25, 
        gamma: float = 2.0, 
        reduction: str = 'mean'
    ):
        super().__init__()
        self.alpha = alpha
        self.gamma = gamma
        self.reduction = reduction
    
    def forward(
        self, 
        pred: torch.Tensor, 
        target: torch.Tensor
    ) -> torch.Tensor:
        """
        计算 Focal Loss
        
        参数：
            pred: 预测概率或 logits
            target: 目标标签 (0 或 1)
        """
        # 如果输入是 logits，先转换为概率
        if pred.min() < 0 or pred.max() > 1:
            pred = torch.sigmoid(pred)
        
        # 计算 p_t
        p_t = target * pred + (1 - target) * (1 - pred)
        
        # 计算 α_t
        alpha_t = target * self.alpha + (1 - target) * (1 - self.alpha)
        
        # 计算 focal weight
        focal_weight = alpha_t * (1 - p_t) ** self.gamma
        
        # 计算 BCE
        bce = F.binary_cross_entropy(pred, target, reduction='none')
        
        # 加权 BCE
        loss = focal_weight * bce
        
        if self.reduction == 'mean':
            return loss.mean()
        elif self.reduction == 'sum':
            return loss.sum()
        else:
            return loss


class BoundaryLoss(nn.Module):
    """
    边界损失函数
    
    关注血管边界区域，提高分割精度
    使用距离变换计算边界权重
    
    参数：
        reduction: 归约方式
    """
    
    def __init__(self, reduction: str = 'mean'):
        super().__init__()
        self.reduction = reduction
    
    def forward(
        self, 
        pred: torch.Tensor, 
        target: torch.Tensor,
        dist_map: Optional[torch.Tensor] = None
    ) -> torch.Tensor:
        """
        计算边界损失
        
        参数：
            pred: 预测概率
            target: 目标标签
            dist_map: 距离图（可选），如果不提供则自动计算
        """
        if dist_map is None:
            # 简化的边界检测：使用梯度
            # 真实应用中应该使用距离变换
            dist_map = self._compute_boundary_weight(target)
        
        # 加权 BCE
        bce = F.binary_cross_entropy(pred, target, reduction='none')
        weighted_bce = bce * dist_map
        
        if self.reduction == 'mean':
            return weighted_bce.mean()
        elif self.reduction == 'sum':
            return weighted_bce.sum()
        else:
            return weighted_bce
    
    def _compute_boundary_weight(self, target: torch.Tensor) -> torch.Tensor:
        """
        计算边界权重图
        
        使用 Sobel 算子检测边界
        """
        # 对于 3D 数据
        if target.dim() == 5:
            # 简化处理：沿最后一个维度计算梯度
            grad = torch.abs(target[:, :, :, :, 1:] - target[:, :, :, :, :-1])
            grad = F.pad(grad, (0, 1), mode='constant', value=0)
        else:
            # 2D 数据
            grad = torch.abs(target[:, :, :, 1:] - target[:, :, :, :-1])
            grad = F.pad(grad, (0, 1), mode='constant', value=0)
        
        # 边界区域权重更高
        weight = 1.0 + grad * 4.0
        
        return weight


class TverskyLoss(nn.Module):
    """
    Tversky 损失函数
    
    Dice 的广义形式，可以调整假阳和假阴的权重
    
    公式：Tversky = TP / (TP + α*FP + β*FN)
    
    当 α = β = 0.5 时等价于 Dice
    α < β 时更关注假阴（漏检）
    α > β 时更关注假阳（误检）
    
    参数：
        alpha: 假阳权重
        beta: 假阴权重
        smooth: 平滑因子
    """
    
    def __init__(
        self, 
        alpha: float = 0.3, 
        beta: float = 0.7, 
        smooth: float = 1e-6
    ):
        super().__init__()
        self.alpha = alpha
        self.beta = beta
        self.smooth = smooth
    
    def forward(
        self, 
        pred: torch.Tensor, 
        target: torch.Tensor
    ) -> torch.Tensor:
        """计算 Tversky Loss"""
        pred = torch.clamp(pred, 0, 1)
        target = torch.clamp(target, 0, 1)
        
        pred_flat = pred.view(pred.size(0), -1)
        target_flat = target.view(target.size(0), -1)
        
        # True Positives
        tp = (pred_flat * target_flat).sum(dim=1)
        
        # False Positives
        fp = (pred_flat * (1 - target_flat)).sum(dim=1)
        
        # False Negatives
        fn = ((1 - pred_flat) * target_flat).sum(dim=1)
        
        # Tversky 指数
        tversky = (tp + self.smooth) / (
            tp + self.alpha * fp + self.beta * fn + self.smooth
        )
        
        return (1 - tversky).mean()


class CombinedLoss(nn.Module):
    """
    组合损失函数
    
    结合多种损失函数的优点
    
    参数：
        dice_weight: Dice Loss 权重
        bce_weight: BCE Loss 权重
        focal_weight: Focal Loss 权重
        boundary_weight: Boundary Loss 权重
    """
    
    def __init__(
        self,
        dice_weight: float = 0.5,
        bce_weight: float = 0.5,
        focal_weight: float = 0.0,
        boundary_weight: float = 0.0
    ):
        super().__init__()
        
        self.dice_weight = dice_weight
        self.bce_weight = bce_weight
        self.focal_weight = focal_weight
        self.boundary_weight = boundary_weight
        
        self.dice_loss = DiceLoss()
        self.bce_loss = nn.BCELoss()
        self.focal_loss = FocalLoss()
        self.boundary_loss = BoundaryLoss()
    
    def forward(
        self, 
        pred: torch.Tensor, 
        target: torch.Tensor
    ) -> torch.Tensor:
        """
        计算组合损失
        """
        # 确保预测在 [0, 1] 范围
        if pred.min() < 0 or pred.max() > 1:
            pred_prob = torch.sigmoid(pred)
        else:
            pred_prob = pred
        
        total_loss = 0.0
        
        if self.dice_weight > 0:
            total_loss += self.dice_weight * self.dice_loss(pred_prob, target)
        
        if self.bce_weight > 0:
            total_loss += self.bce_weight * self.bce_loss(pred_prob, target)
        
        if self.focal_weight > 0:
            total_loss += self.focal_weight * self.focal_loss(pred_prob, target)
        
        if self.boundary_weight > 0:
            total_loss += self.boundary_weight * self.boundary_loss(pred_prob, target)
        
        return total_loss


class VesselLoss(nn.Module):
    """
    专门针对血管分割的损失函数
    
    特点：
    1. 结合 Dice + BCE 处理类别不平衡
    2. 添加连续性惩罚，鼓励平滑的血管结构
    3. 可选的拓扑损失
    """
    
    def __init__(
        self,
        dice_weight: float = 0.5,
        bce_weight: float = 0.5,
        continuity_weight: float = 0.1
    ):
        super().__init__()
        
        self.dice_weight = dice_weight
        self.bce_weight = bce_weight
        self.continuity_weight = continuity_weight
        
        self.dice_loss = DiceLoss()
        self.bce_loss = nn.BCEWithLogitsLoss()
    
    def forward(
        self, 
        pred_logits: torch.Tensor, 
        target: torch.Tensor
    ) -> torch.Tensor:
        """
        计算血管分割损失
        
        参数：
            pred_logits: 预测 logits（未经 sigmoid）
            target: 目标标签
        """
        pred_prob = torch.sigmoid(pred_logits)
        
        # Dice Loss
        dice = self.dice_loss(pred_prob, target)
        
        # BCE Loss
        bce = self.bce_loss(pred_logits, target)
        
        # 连续性损失：惩罚预测中的不连续
        continuity = self._continuity_loss(pred_prob)
        
        total = (
            self.dice_weight * dice + 
            self.bce_weight * bce + 
            self.continuity_weight * continuity
        )
        
        return total
    
    def _continuity_loss(self, pred: torch.Tensor) -> torch.Tensor:
        """
        计算连续性损失
        
        使用总变分（Total Variation）鼓励平滑
        """
        if pred.dim() == 5:
            # 3D: (B, C, D, H, W)
            diff_d = torch.abs(pred[:, :, 1:, :, :] - pred[:, :, :-1, :, :])
            diff_h = torch.abs(pred[:, :, :, 1:, :] - pred[:, :, :, :-1, :])
            diff_w = torch.abs(pred[:, :, :, :, 1:] - pred[:, :, :, :, :-1])
            tv = diff_d.mean() + diff_h.mean() + diff_w.mean()
        else:
            # 2D: (B, C, H, W)
            diff_h = torch.abs(pred[:, :, 1:, :] - pred[:, :, :-1, :])
            diff_w = torch.abs(pred[:, :, :, 1:] - pred[:, :, :, :-1])
            tv = diff_h.mean() + diff_w.mean()
        
        return tv
</file>

<file path="backend/training/trainer.py">
# -*- coding: utf-8 -*-
"""
OCTA 血管网络分析系统 - 训练管理模块

功能：
1. 数据集定义和加载
2. 训练循环管理
3. 损失函数定义
4. 检查点保存和恢复
5. 训练进度跟踪
"""

import os
import json
import time
import threading
from pathlib import Path
from datetime import datetime
from typing import Dict, Any, Optional, List, Tuple, Callable
from dataclasses import dataclass, asdict
from queue import Queue

import numpy as np
import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import Dataset, DataLoader
from torch.cuda.amp import autocast, GradScaler

# 导入模型
from models.unet3d import UNet3D, VesselSegmentationNet
from models.diffusion import OCTADiffusionModel


# ============================================================================
# 数据集定义
# ============================================================================

class OCTAPatchDataset(Dataset):
    """
    OCTA 3D Patch 数据集
    
    从大型 3D 体数据中提取小块进行训练
    
    参数：
        octa_volume: 带拖尾的 OCTA 体数据 (X, Y, Z)
        label_volume: 金标准标签 (X, Y, Z)
        patch_size: 3D patch 尺寸
        stride: 采样步长
        augment: 是否进行数据增强
    """
    
    def __init__(
        self,
        octa_volume: np.ndarray,
        label_volume: np.ndarray,
        patch_size: int = 32,
        stride: int = 16,
        augment: bool = True
    ):
        self.octa = octa_volume.astype(np.float32)
        self.label = label_volume.astype(np.float32)
        self.patch_size = patch_size
        self.stride = stride
        self.augment = augment
        
        # 计算有效的 patch 位置
        self.positions = self._compute_positions()
    
    def _compute_positions(self) -> List[Tuple[int, int, int]]:
        """计算所有有效的 patch 起始位置"""
        X, Y, Z = self.octa.shape
        ps = self.patch_size
        stride = self.stride
        
        positions = []
        for x in range(0, X - ps + 1, stride):
            for y in range(0, Y - ps + 1, stride):
                for z in range(0, Z - ps + 1, stride):
                    # 可选：跳过全背景区域
                    label_patch = self.label[x:x+ps, y:y+ps, z:z+ps]
                    if label_patch.sum() > 10:  # 至少有一些血管
                        positions.append((x, y, z))
        
        return positions
    
    def __len__(self) -> int:
        return len(self.positions)
    
    def __getitem__(self, idx: int) -> Tuple[torch.Tensor, torch.Tensor]:
        x, y, z = self.positions[idx]
        ps = self.patch_size
        
        # 提取 patch
        octa_patch = self.octa[x:x+ps, y:y+ps, z:z+ps].copy()
        label_patch = self.label[x:x+ps, y:y+ps, z:z+ps].copy()
        
        # 数据增强
        if self.augment:
            octa_patch, label_patch = self._augment(octa_patch, label_patch)
        
        # 转换为 tensor
        octa_tensor = torch.from_numpy(octa_patch).unsqueeze(0)  # (1, D, H, W)
        label_tensor = torch.from_numpy(label_patch).unsqueeze(0)
        
        return octa_tensor, label_tensor
    
    def _augment(
        self, 
        octa: np.ndarray, 
        label: np.ndarray
    ) -> Tuple[np.ndarray, np.ndarray]:
        """数据增强"""
        # 随机翻转
        for axis in range(3):
            if np.random.rand() > 0.5:
                octa = np.flip(octa, axis=axis).copy()
                label = np.flip(label, axis=axis).copy()
        
        # 随机旋转（90度的倍数）
        k = np.random.randint(0, 4)
        if k > 0:
            octa = np.rot90(octa, k, axes=(0, 1)).copy()
            label = np.rot90(label, k, axes=(0, 1)).copy()
        
        # 强度扰动
        if np.random.rand() > 0.5:
            noise = np.random.normal(0, 0.02, octa.shape)
            octa = np.clip(octa + noise, 0, 1)
        
        return octa, label


# ============================================================================
# 损失函数
# ============================================================================

class DiceLoss(nn.Module):
    """
    Dice Loss
    
    \[
    \text{Dice} = \frac{2|X \cap Y|}{|X| + |Y|} = \frac{2 \sum p \cdot g}{\sum p + \sum g}
    \]
    
    Dice Loss = 1 - Dice
    """
    
    def __init__(self, smooth: float = 1.0):
        super().__init__()
        self.smooth = smooth
    
    def forward(self, pred: torch.Tensor, target: torch.Tensor) -> torch.Tensor:
        pred = torch.sigmoid(pred)
        
        # 展平
        pred_flat = pred.view(-1)
        target_flat = target.view(-1)
        
        intersection = (pred_flat * target_flat).sum()
        dice = (2.0 * intersection + self.smooth) / (
            pred_flat.sum() + target_flat.sum() + self.smooth
        )
        
        return 1 - dice


class CombinedLoss(nn.Module):
    """
    组合损失：Dice + BCE
    
    L = α × Dice + (1-α) × BCE
    """
    
    def __init__(self, dice_weight: float = 0.5):
        super().__init__()
        self.dice_weight = dice_weight
        self.dice = DiceLoss()
        self.bce = nn.BCEWithLogitsLoss()
    
    def forward(self, pred: torch.Tensor, target: torch.Tensor) -> torch.Tensor:
        dice_loss = self.dice(pred, target)
        bce_loss = self.bce(pred, target)
        
        return self.dice_weight * dice_loss + (1 - self.dice_weight) * bce_loss


# ============================================================================
# 训练状态跟踪
# ============================================================================

@dataclass
class TrainingState:
    """训练状态数据类"""
    status: str = "idle"  # idle, running, paused, completed, error
    current_epoch: int = 0
    total_epochs: int = 0
    current_step: int = 0
    total_steps: int = 0
    train_loss: float = 0.0
    val_loss: float = 0.0
    best_loss: float = float('inf')
    train_losses: List[float] = None
    val_losses: List[float] = None
    dice_scores: List[float] = None
    elapsed_time: float = 0.0
    eta: float = 0.0
    message: str = ""
    
    def __post_init__(self):
        if self.train_losses is None:
            self.train_losses = []
        if self.val_losses is None:
            self.val_losses = []
        if self.dice_scores is None:
            self.dice_scores = []
    
    def to_dict(self) -> Dict[str, Any]:
        return asdict(self)


# ============================================================================
# 训练管理器
# ============================================================================

class TrainingManager:
    """
    训练管理器
    
    管理模型训练的完整生命周期：
    - 创建训练任务
    - 启动/暂停/停止训练
    - 保存/加载检查点
    - 跟踪训练进度
    """
    
    def __init__(
        self,
        data_dir: Path,
        models_dir: Path,
        device: str = 'cuda'
    ):
        self.data_dir = Path(data_dir)
        self.models_dir = Path(models_dir)
        self.device = device if torch.cuda.is_available() else 'cpu'
        
        # 创建目录
        self.models_dir.mkdir(parents=True, exist_ok=True)
        
        # 训练状态
        self.state = TrainingState()
        self.training_thread: Optional[threading.Thread] = None
        self.stop_flag = threading.Event()
        self.pause_flag = threading.Event()
        
        # 当前模型和优化器
        self.model: Optional[nn.Module] = None
        self.optimizer: Optional[optim.Optimizer] = None
        self.scheduler: Optional[optim.lr_scheduler._LRScheduler] = None
        self.scaler: Optional[GradScaler] = None
        
        # 进度回调
        self.progress_callbacks: List[Callable] = []
    
    def create_segmentation_model(
        self,
        base_features: int = 32,
        use_attention: bool = True
    ) -> UNet3D:
        """创建分割模型"""
        model = UNet3D(
            in_channels=1,
            out_channels=1,
            base_features=base_features,
            use_attention=use_attention,
            use_residual=True,
            deep_supervision=True
        ).to(self.device)
        
        return model
    
    def create_diffusion_model(
        self,
        timesteps: int = 1000,
        base_features: int = 64
    ) -> OCTADiffusionModel:
        """创建扩散模型"""
        model = OCTADiffusionModel(
            timesteps=timesteps,
            beta_schedule='cosine',
            base_features=base_features,
            device=self.device
        ).to(self.device)
        
        return model
    
    def prepare_dataloaders(
        self,
        octa_train: np.ndarray,
        label_train: np.ndarray,
        octa_val: np.ndarray,
        label_val: np.ndarray,
        patch_size: int = 32,
        batch_size: int = 4,
        num_workers: int = 4
    ) -> Tuple[DataLoader, DataLoader]:
        """准备数据加载器"""
        train_dataset = OCTAPatchDataset(
            octa_train, label_train,
            patch_size=patch_size,
            stride=patch_size // 2,
            augment=True
        )
        
        val_dataset = OCTAPatchDataset(
            octa_val, label_val,
            patch_size=patch_size,
            stride=patch_size,
            augment=False
        )
        
        train_loader = DataLoader(
            train_dataset,
            batch_size=batch_size,
            shuffle=True,
            num_workers=num_workers,
            pin_memory=True
        )
        
        val_loader = DataLoader(
            val_dataset,
            batch_size=batch_size,
            shuffle=False,
            num_workers=num_workers,
            pin_memory=True
        )
        
        return train_loader, val_loader
    
    def train_segmentation(
        self,
        train_loader: DataLoader,
        val_loader: DataLoader,
        epochs: int = 100,
        learning_rate: float = 1e-4,
        save_every: int = 10
    ):
        """
        训练分割网络
        
        在后台线程中运行
        """
        def train_fn():
            try:
                self._train_segmentation_impl(
                    train_loader, val_loader,
                    epochs, learning_rate, save_every
                )
            except Exception as e:
                self.state.status = "error"
                self.state.message = str(e)
        
        self.training_thread = threading.Thread(target=train_fn)
        self.training_thread.start()
    
    def _train_segmentation_impl(
        self,
        train_loader: DataLoader,
        val_loader: DataLoader,
        epochs: int,
        learning_rate: float,
        save_every: int
    ):
        """分割网络训练的实际实现"""
        # 初始化模型
        if self.model is None:
            self.model = self.create_segmentation_model()
        
        # 优化器
        self.optimizer = optim.AdamW(
            self.model.parameters(),
            lr=learning_rate,
            weight_decay=1e-5
        )
        
        # 学习率调度器
        self.scheduler = optim.lr_scheduler.CosineAnnealingLR(
            self.optimizer,
            T_max=epochs
        )
        
        # 混合精度训练
        self.scaler = GradScaler()
        
        # 损失函数
        criterion = CombinedLoss(dice_weight=0.5)
        
        # 更新状态
        self.state.status = "running"
        self.state.total_epochs = epochs
        self.state.total_steps = len(train_loader) * epochs
        
        start_time = time.time()
        
        for epoch in range(epochs):
            if self.stop_flag.is_set():
                break
            
            # 等待暂停结束
            while self.pause_flag.is_set():
                time.sleep(0.1)
            
            self.state.current_epoch = epoch + 1
            
            # 训练阶段
            self.model.train()
            train_loss = 0.0
            
            for batch_idx, (octa, label) in enumerate(train_loader):
                if self.stop_flag.is_set():
                    break
                
                octa = octa.to(self.device)
                label = label.to(self.device)
                
                self.optimizer.zero_grad()
                
                with autocast():
                    output = self.model(octa)
                    
                    if isinstance(output, tuple):
                        # 深度监督
                        main_out, ds_outs = output
                        loss = criterion(main_out, label)
                        for ds_out in ds_outs:
                            loss += 0.3 * criterion(ds_out, label)
                    else:
                        loss = criterion(output, label)
                
                self.scaler.scale(loss).backward()
                self.scaler.step(self.optimizer)
                self.scaler.update()
                
                train_loss += loss.item()
                self.state.current_step = epoch * len(train_loader) + batch_idx + 1
            
            train_loss /= len(train_loader)
            self.state.train_loss = train_loss
            self.state.train_losses.append(train_loss)
            
            # 验证阶段
            val_loss, dice_score = self._validate(val_loader, criterion)
            self.state.val_loss = val_loss
            self.state.val_losses.append(val_loss)
            self.state.dice_scores.append(dice_score)
            
            # 更新最佳模型
            if val_loss < self.state.best_loss:
                self.state.best_loss = val_loss
                self._save_checkpoint('best_segmentation.pt')
            
            # 定期保存
            if (epoch + 1) % save_every == 0:
                self._save_checkpoint(f'segmentation_epoch_{epoch+1}.pt')
            
            # 更新时间
            self.state.elapsed_time = time.time() - start_time
            self.state.eta = self.state.elapsed_time / (epoch + 1) * (epochs - epoch - 1)
            
            # 更新学习率
            self.scheduler.step()
            
            # 回调通知
            self._notify_progress()
        
        self.state.status = "completed"
        self._save_checkpoint('final_segmentation.pt')
    
    def _validate(
        self,
        val_loader: DataLoader,
        criterion: nn.Module
    ) -> Tuple[float, float]:
        """验证"""
        self.model.eval()
        val_loss = 0.0
        dice_scores = []
        
        with torch.no_grad():
            for octa, label in val_loader:
                octa = octa.to(self.device)
                label = label.to(self.device)
                
                output = self.model(octa)
                if isinstance(output, tuple):
                    output = output[0]
                
                loss = criterion(output, label)
                val_loss += loss.item()
                
                # 计算 Dice
                pred = (torch.sigmoid(output) > 0.5).float()
                intersection = (pred * label).sum()
                dice = (2 * intersection + 1) / (pred.sum() + label.sum() + 1)
                dice_scores.append(dice.item())
        
        val_loss /= len(val_loader)
        avg_dice = np.mean(dice_scores)
        
        return val_loss, avg_dice
    
    def train_diffusion(
        self,
        train_loader: DataLoader,
        val_loader: DataLoader,
        epochs: int = 100,
        learning_rate: float = 1e-4,
        save_every: int = 10
    ):
        """训练扩散模型"""
        def train_fn():
            try:
                self._train_diffusion_impl(
                    train_loader, val_loader,
                    epochs, learning_rate, save_every
                )
            except Exception as e:
                self.state.status = "error"
                self.state.message = str(e)
        
        self.training_thread = threading.Thread(target=train_fn)
        self.training_thread.start()
    
    def _train_diffusion_impl(
        self,
        train_loader: DataLoader,
        val_loader: DataLoader,
        epochs: int,
        learning_rate: float,
        save_every: int
    ):
        """扩散模型训练实现"""
        # 初始化模型
        if self.model is None or not isinstance(self.model, OCTADiffusionModel):
            self.model = self.create_diffusion_model()
        
        # 优化器
        self.optimizer = optim.AdamW(
            self.model.parameters(),
            lr=learning_rate,
            weight_decay=1e-5
        )
        
        # 更新状态
        self.state.status = "running"
        self.state.total_epochs = epochs
        
        start_time = time.time()
        
        for epoch in range(epochs):
            if self.stop_flag.is_set():
                break
            
            self.state.current_epoch = epoch + 1
            self.model.noise_net.train()
            train_loss = 0.0
            
            for batch_idx, (octa, label) in enumerate(train_loader):
                if self.stop_flag.is_set():
                    break
                
                # octa: 带拖尾 (条件)
                # label: 干净 (目标)
                octa = octa.to(self.device)
                label = label.to(self.device)
                
                self.optimizer.zero_grad()
                
                # 计算扩散损失
                loss = self.model.compute_loss(label, octa)
                
                loss.backward()
                torch.nn.utils.clip_grad_norm_(self.model.parameters(), 1.0)
                self.optimizer.step()
                
                train_loss += loss.item()
            
            train_loss /= len(train_loader)
            self.state.train_loss = train_loss
            self.state.train_losses.append(train_loss)
            
            # 定期保存
            if (epoch + 1) % save_every == 0:
                self._save_checkpoint(f'diffusion_epoch_{epoch+1}.pt')
            
            self.state.elapsed_time = time.time() - start_time
            self._notify_progress()
        
        self.state.status = "completed"
        self._save_checkpoint('final_diffusion.pt')
    
    def _save_checkpoint(self, filename: str):
        """保存检查点"""
        checkpoint = {
            'model_state_dict': self.model.state_dict(),
            'optimizer_state_dict': self.optimizer.state_dict() if self.optimizer else None,
            'state': self.state.to_dict(),
            'timestamp': datetime.now().isoformat()
        }
        
        path = self.models_dir / filename
        torch.save(checkpoint, path)
    
    def load_checkpoint(self, filename: str) -> bool:
        """加载检查点"""
        path = self.models_dir / filename
        if not path.exists():
            return False
        
        checkpoint = torch.load(path, map_location=self.device)
        
        if self.model is not None:
            self.model.load_state_dict(checkpoint['model_state_dict'])
        
        if self.optimizer is not None and checkpoint['optimizer_state_dict']:
            self.optimizer.load_state_dict(checkpoint['optimizer_state_dict'])
        
        # 恢复状态
        state_dict = checkpoint.get('state', {})
        for key, value in state_dict.items():
            if hasattr(self.state, key):
                setattr(self.state, key, value)
        
        return True
    
    def stop_training(self):
        """停止训练"""
        self.stop_flag.set()
        if self.training_thread:
            self.training_thread.join(timeout=5)
        self.state.status = "stopped"
    
    def pause_training(self):
        """暂停训练"""
        self.pause_flag.set()
        self.state.status = "paused"
    
    def resume_training(self):
        """恢复训练"""
        self.pause_flag.clear()
        self.state.status = "running"
    
    def get_state(self) -> Dict[str, Any]:
        """获取训练状态"""
        return self.state.to_dict()
    
    def add_progress_callback(self, callback: Callable):
        """添加进度回调"""
        self.progress_callbacks.append(callback)
    
    def _notify_progress(self):
        """通知进度更新"""
        state_dict = self.state.to_dict()
        for callback in self.progress_callbacks:
            try:
                callback(state_dict)
            except Exception:
                pass
</file>

<file path="docs/api_reference.md">
# OCTA 血管网络分析系统 - API 参考文档

## 基础信息

- **基础URL**: `http://localhost:8000/api`
- **内容类型**: `application/json`

## 数据管理 API

### 上传数据
```http
POST /data/upload
Content-Type: multipart/form-data
```

**参数**:
- `file`: DICOM/OCTA 文件

**响应**:
```json
{
  "id": "vol_20231201_123456_abc123",
  "filename": "octa_data.npy",
  "shape": [500, 300, 500],
  "spacing": [12.0, 12.0, 8.73],
  "vessel_fraction": 0.0523,
  "created_at": "2023-12-01T12:34:56"
}
```

### 获取数据列表
```http
GET /data/list
```

### 获取切片图像
```http
GET /data/{volume_id}/slice/{axis}/{index}?apply_correction=false
```

**参数**:
- `volume_id`: 数据 ID
- `axis`: 轴向 (x, y, z)
- `index`: 切片索引
- `apply_correction`: 是否应用畸变矫正

### 生成 3D 网格
```http
POST /data/{volume_id}/mesh
Content-Type: application/json

{
  "threshold": 0.5,
  "smooth": true
}
```

### 删除数据
```http
DELETE /data/{volume_id}
```

## 标注 API

### 创建标注项目
```http
POST /annotation/projects
Content-Type: application/json

{
  "volume_id": "vol_xxx",
  "name": "项目名称"
}
```

### 保存标注
```http
POST /annotation/projects/{project_id}/save
Content-Type: application/json

{
  "project_id": "ann_xxx",
  "layer_key": "y_150",
  "ellipses": [
    {
      "id": "ellipse_1",
      "center_x": 100,
      "center_y": 200,
      "radius_x": 10,
      "radius_y": 8,
      "rotation": 0,
      "slice_index": 150,
      "axis": "y"
    }
  ],
  "brush_strokes": []
}
```

### 撤销/重做
```http
POST /annotation/projects/{project_id}/undo
POST /annotation/projects/{project_id}/redo
```

### 生成金标准 Mask
```http
POST /annotation/projects/{project_id}/generate-mask
```

**响应**:
```json
{
  "message": "金标准 mask 已生成",
  "mask_path": "/path/to/gold_standard.npy",
  "shape": [500, 300, 500],
  "vessel_voxels": 3921500,
  "vessel_fraction": "5.23%"
}
```

## 训练 API

### 启动训练
```http
POST /training/start
Content-Type: application/json

{
  "volume_id": "vol_xxx",
  "annotation_project_id": "ann_xxx",
  "mode": "segmentation",
  "epochs": 100,
  "batch_size": 4,
  "learning_rate": 0.0001,
  "patch_size": 32,
  "diffusion_timesteps": 1000,
  "diffusion_beta_schedule": "cosine"
}
```

**训练模式**:
- `segmentation`: 仅训练 3D U-Net
- `diffusion`: 仅训练 Diffusion 模型
- `combined`: 级联训练

### 获取训练状态
```http
GET /training/status
```

**响应**:
```json
{
  "status": "running",
  "current_epoch": 25,
  "total_epochs": 100,
  "train_loss": 0.1234,
  "val_loss": 0.1456,
  "best_loss": 0.1200,
  "train_losses": [...],
  "val_losses": [...],
  "dice_scores": [...],
  "elapsed_time": 3600,
  "eta": 10800,
  "message": "训练中..."
}
```

### 控制训练
```http
POST /training/pause
POST /training/resume
POST /training/stop
```

### 检查点管理
```http
GET /training/checkpoints
DELETE /training/checkpoints/{filename}
POST /training/checkpoints/load/{filename}
```

## 推理 API

### 启动推理
```http
POST /inference/start
Content-Type: application/json

{
  "volume_id": "vol_xxx",
  "checkpoint_name": "best_segmentation.pt",
  "mode": "segmentation",
  "patch_size": 32,
  "overlap": 8,
  "threshold": 0.5,
  "use_ddim": true,
  "ddim_steps": 50
}
```

### 获取推理状态
```http
GET /inference/status/{task_id}
```

### 获取结果切片
```http
GET /inference/result/{task_id}/slice/{axis}/{index}
```

### 下载结果
```http
GET /inference/result/{task_id}/download/{format}
```

**支持格式**: `npy`, `nii`, `stl`, `ply`

## 系统 API

### 健康检查
```http
GET /health
```

### 获取配置
```http
GET /config
```

## 错误响应

所有 API 错误使用标准 HTTP 状态码，响应格式：

```json
{
  "detail": "错误描述信息"
}
```

常见状态码：
- `400`: 请求参数错误
- `404`: 资源不存在
- `500`: 服务器内部错误
</file>

<file path="docs/usage.md">
# OCTA 血管网络分析系统 - 使用指南

## 1. 快速开始

### 1.1 启动系统

**方式一：一键启动**
```bash
双击 scripts/start.bat
```

**方式二：手动启动**
```bash
# 终端1：启动后端
cd backend
python -m uvicorn api.main:app --host 127.0.0.1 --port 8000 --reload

# 终端2：启动前端
cd frontend
npm run dev
```

访问 http://localhost:5173

## 2. 功能模块

### 2.1 数据管理

**支持的数据格式**：
- DICOM 单文件 (.dcm, .dicom)
- DICOM 序列（ZIP 压缩包）
- NIfTI (.nii, .nii.gz)
- NumPy 数组 (.npy)
- MATLAB v7.3 (.mat)

**操作步骤**：
1. 进入「数据管理」页面
2. 点击上传区域或拖放文件
3. 等待数据解析完成
4. 选择数据查看切片预览

### 2.2 标注工具

**标注工具**：
- **椭圆工具**：绘制血管横截面的理想形状
- **画笔工具**：自由绘制或涂抹
- **橡皮擦**：擦除错误标注
- **平移工具**：拖动查看不同区域

**标注流程**：
1. 选择要标注的数据
2. 切换到 Y 轴（B-scan 视图）
3. 滚动到包含血管的切片
4. 使用椭圆工具标注血管横截面
5. 保存标注
6. 重复直到标注足够样本
7. 点击「生成金标准」

**技巧**：
- 开启「显示畸变矫正」可以看到校正后的图像
- 使用快捷键 Ctrl+Z / Ctrl+Y 撤销/重做
- 标注时关注血管的真实边界，忽略拖尾部分

### 2.3 模型训练

**训练模式**：
- **分割网络**：3D U-Net，快速训练
- **扩散网络**：Diffusion 模型，生成质量更高
- **级联训练**：先分割后扩散，推荐

**推荐配置**：
| 参数 | 推荐值 | 说明 |
|------|--------|------|
| Epochs | 100 | 分割网络 |
| Epochs | 50 | 扩散网络 |
| Batch Size | 4 | 8GB 显存 |
| Patch Size | 32 | 平衡速度和精度 |
| Learning Rate | 1e-4 | 默认值 |

**训练技巧**：
- 监控验证 Loss 曲线，避免过拟合
- 定期保存检查点
- 如果 Loss 不下降，尝试降低学习率

### 2.4 推理预测

**推理流程**：
1. 选择输入数据
2. 选择训练好的模型检查点
3. 配置推理参数
4. 点击「开始推理」
5. 等待推理完成
6. 对比原始和结果

**参数说明**：
- **阈值**：二值化阈值，0.5 通常效果最好
- **DDIM 采样**：加速扩散推理，推荐开启
- **DDIM 步数**：50 步通常足够

### 2.5 三维可视化

**功能**：
- 旋转：左键拖动
- 缩放：滚轮
- 平移：右键拖动

**显示模式**：
- 深度着色：浅层绿色，深层红色
- 单色：统一颜色
- 线框模式：显示网格结构

**导出格式**：
- STL：适用于 3D 打印
- PLY：包含颜色信息
- OBJ：通用 3D 格式

## 3. 几何畸变矫正

### 3.1 问题说明

OCT 成像的纵向刻度基于光学路径长度，而非物理长度。当样品表面倾斜时：
- 光程变长
- 结构在纵向被拉伸
- 圆形血管变成椭圆或带拖尾

### 3.2 矫正原理

系统采用三步矫正：
1. **表面检测**：自动估计倾斜角度
2. **倾斜校正**：根据角度压缩纵向
3. **折射率补偿**：根据组织折射率调整

### 3.3 使用方法

在标注工具中：
- 勾选「显示畸变矫正」查看校正后图像
- 对比校正前后的血管形状
- 基于校正后的图像进行标注

## 4. 常见问题

### Q: 后端启动失败？
A: 检查端口 8000 是否被占用，或检查 Python 依赖是否安装完整。

### Q: 前端白屏？
A: 确保后端服务正在运行，检查浏览器控制台错误信息。

### Q: 训练很慢？
A: 确保使用 GPU，减小 batch size 或 patch size。

### Q: 推理结果不理想？
A: 增加训练 epochs，检查标注质量，尝试调整阈值。

### Q: 内存不足？
A: 减小 batch size，使用更小的 patch size。

## 5. 技术支持

如遇问题，请提供：
- 系统信息（操作系统、Python/Node 版本）
- 错误日志
- 复现步骤

联系方式：[待补充]
</file>

<file path="frontend/electron/main.js">
/**
 * OCTA 血管网络分析系统 - Electron 主进程
 * 
 * 修复版本：使用更可靠的健康检查方式
 */

const { app, BrowserWindow, ipcMain, dialog, shell } = require('electron');
const path = require('path');
const { spawn, execSync } = require('child_process');
const fs = require('fs');

// 禁用硬件加速（解决 GPU 进程崩溃问题）
app.disableHardwareAcceleration();

// 后端进程引用
let backendProcess = null;

// 主窗口引用
let mainWindow = null;

// 开发模式标志
const isDev = process.env.NODE_ENV === 'development' || !app.isPackaged;

/**
 * 检查后端是否已经在运行（使用 fetch API）
 */
async function checkBackendRunning() {
    try {
        // 使用 AbortController 设置超时
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 2000);
        
        const response = await fetch('http://127.0.0.1:8000/health', {
            signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        return response.ok;
    } catch (error) {
        return false;
    }
}

/**
 * 等待后端启动
 */
async function waitForBackend(maxRetries = 30, interval = 1000) {
    for (let i = 0; i < maxRetries; i++) {
        const isRunning = await checkBackendRunning();
        if (isRunning) {
            console.log('后端服务已就绪');
            return true;
        }
        console.log(`等待后端启动... (${i + 1}/${maxRetries})`);
        await new Promise(resolve => setTimeout(resolve, interval));
    }
    return false;
}

/**
 * 获取虚拟环境中的 Python 路径
 */
function getVenvPythonPath(backendPath) {
    const isWindows = process.platform === 'win32';
    const venvPath = path.join(backendPath, '.venv');
    
    if (isWindows) {
        const pythonPath = path.join(venvPath, 'Scripts', 'python.exe');
        if (fs.existsSync(pythonPath)) {
            return pythonPath;
        }
    } else {
        const pythonPath = path.join(venvPath, 'bin', 'python');
        if (fs.existsSync(pythonPath)) {
            return pythonPath;
        }
    }
    
    return 'python';
}

/**
 * 创建主窗口
 */
function createWindow() {
    mainWindow = new BrowserWindow({
        width: 1600,
        height: 1000,
        minWidth: 1200,
        minHeight: 800,
        title: 'OCTA 血管网络分析系统',
        webPreferences: {
            nodeIntegration: false,
            contextIsolation: true,
            preload: path.join(__dirname, 'preload.js')
        },
        frame: true,
        backgroundColor: '#1a1a2e',
        show: false
    });

    if (isDev) {
        mainWindow.loadURL('http://localhost:5173');
        mainWindow.webContents.openDevTools();
    } else {
        mainWindow.loadFile(path.join(__dirname, '../dist/index.html'));
    }

    mainWindow.once('ready-to-show', () => {
        mainWindow.show();
    });

    mainWindow.webContents.setWindowOpenHandler(({ url }) => {
        shell.openExternal(url);
        return { action: 'deny' };
    });

    mainWindow.on('closed', () => {
        mainWindow = null;
    });
}

/**
 * 启动后端服务
 */
async function startBackend() {
    // 先检查后端是否已经在运行
    const alreadyRunning = await checkBackendRunning();
    if (alreadyRunning) {
        console.log('后端服务已经在运行，跳过启动');
        return true;
    }

    let backendPath;
    if (isDev) {
        backendPath = path.join(__dirname, '../../backend');
    } else {
        backendPath = path.join(process.resourcesPath, 'backend');
    }

    const pythonPath = getVenvPythonPath(backendPath);
    
    console.log('启动后端服务...');
    console.log('Python 路径:', pythonPath);
    console.log('后端路径:', backendPath);

    // 启动 FastAPI 服务
    backendProcess = spawn(pythonPath, ['-m', 'api.main'], {
        cwd: backendPath,
        env: {
            ...process.env,
            PYTHONPATH: backendPath,
            PYTHONUNBUFFERED: '1'
        },
        shell: false,
        windowsHide: false
    });

    backendProcess.stdout.on('data', (data) => {
        console.log(`[后端] ${data}`);
    });

    backendProcess.stderr.on('data', (data) => {
        console.log(`[后端] ${data}`);
    });

    backendProcess.on('close', (code) => {
        console.log(`后端进程退出，代码: ${code}`);
        backendProcess = null;
    });

    backendProcess.on('error', (err) => {
        console.error('启动后端失败:', err);
        backendProcess = null;
    });

    // 等待后端启动
    const started = await waitForBackend(30, 1000);
    return started;
}

/**
 * 停止后端服务
 */
function stopBackend() {
    if (backendProcess) {
        console.log('停止后端服务...');
        
        if (process.platform === 'win32') {
            try {
                execSync(`taskkill /pid ${backendProcess.pid} /T /F`, { stdio: 'ignore' });
            } catch (e) {
                // 忽略错误
            }
        } else {
            backendProcess.kill('SIGTERM');
        }
        
        backendProcess = null;
    }
}

// 应用准备就绪
app.whenReady().then(async () => {
    // 启动后端
    const backendStarted = await startBackend();
    
    if (!backendStarted) {
        // 不显示错误对话框，直接继续
        // 因为后端可能已经在运行，只是健康检查有问题
        console.log('警告：后端健康检查未通过，但仍尝试启动界面...');
    }
    
    // 无论如何都创建窗口
    createWindow();

    app.on('activate', () => {
        if (BrowserWindow.getAllWindows().length === 0) {
            createWindow();
        }
    });
});

// 所有窗口关闭时退出应用
app.on('window-all-closed', () => {
    stopBackend();
    if (process.platform !== 'darwin') {
        app.quit();
    }
});

// 应用退出前清理
app.on('before-quit', () => {
    stopBackend();
});

// ============================================================================
// IPC 通信处理
// ============================================================================

ipcMain.handle('dialog:openFile', async (event, options) => {
    const result = await dialog.showOpenDialog(mainWindow, {
        properties: ['openFile'],
        filters: options?.filters || [
            { name: 'OCTA 数据', extensions: ['npy', 'dcm', 'dicom', 'nii', 'gz', 'mat'] },
            { name: '所有文件', extensions: ['*'] }
        ]
    });
    return result;
});

ipcMain.handle('dialog:openFolder', async () => {
    const result = await dialog.showOpenDialog(mainWindow, {
        properties: ['openDirectory']
    });
    return result;
});

ipcMain.handle('dialog:saveFile', async (event, options) => {
    const result = await dialog.showSaveDialog(mainWindow, {
        filters: options?.filters || [
            { name: 'STL 文件', extensions: ['stl'] },
            { name: 'PLY 文件', extensions: ['ply'] },
            { name: 'OBJ 文件', extensions: ['obj'] }
        ]
    });
    return result;
});

ipcMain.handle('app:getInfo', () => {
    return {
        version: app.getVersion(),
        name: app.getName(),
        platform: process.platform,
        arch: process.arch,
        isDev: isDev
    };
});

ipcMain.handle('shell:showItemInFolder', (event, filepath) => {
    shell.showItemInFolder(filepath);
});
</file>

<file path="frontend/electron/preload.js">
/**
 * OCTA 血管网络分析系统 - Electron 预加载脚本
 * 
 * 在渲染进程中安全地暴露 Node.js 功能
 */

const { contextBridge, ipcRenderer } = require('electron');

// 暴露安全的 API 到渲染进程
contextBridge.exposeInMainWorld('electronAPI', {
    // 文件对话框
    openFile: (options) => ipcRenderer.invoke('dialog:openFile', options),
    openFolder: () => ipcRenderer.invoke('dialog:openFolder'),
    saveFile: (options) => ipcRenderer.invoke('dialog:saveFile', options),
    
    // 应用信息
    getAppInfo: () => ipcRenderer.invoke('app:getInfo'),
    
    // 系统操作
    showItemInFolder: (filepath) => ipcRenderer.invoke('shell:showItemInFolder', filepath),
    
    // 平台信息
    platform: process.platform
});
</file>

<file path="frontend/index.html">
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="OCTA 血管网络分析系统 - 深度学习驱动的三维血管重建" />
    <title>OCTA 血管网络分析系统</title>
    
    <!-- 预加载字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
      /* 加载动画 */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #1a1a2e;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }
      
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top-color: #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      .loading-text {
        margin-top: 20px;
        color: #94a3b8;
        font-family: Inter, sans-serif;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <!-- 加载屏幕 -->
    <div class="loading-screen" id="loading">
      <div class="loading-spinner"></div>
      <div class="loading-text">加载中...</div>
    </div>
    
    <!-- React 根节点 -->
    <div id="root"></div>
    
    <!-- 主脚本 -->
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- 隐藏加载屏幕 -->
    <script>
      window.addEventListener('load', function() {
        setTimeout(function() {
          var loading = document.getElementById('loading');
          if (loading) {
            loading.style.opacity = '0';
            loading.style.transition = 'opacity 0.3s';
            setTimeout(function() {
              loading.remove();
            }, 300);
          }
        }, 100);
      });
    </script>
  </body>
</html>
</file>

<file path="frontend/package.json">
{
  "name": "octa-vessel-analyzer",
  "version": "1.0.0",
  "description": "OCTA 血管网络分析系统 - 桌面应用",
  "main": "electron/main.js",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "electron:dev": "concurrently \"vite\" \"wait-on http://localhost:5173 && electron .\"",
    "electron:build": "npm run build && electron-builder",
    "electron:build:win": "npm run build && electron-builder --win",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "three": "^0.158.0",
    "@react-three/fiber": "^8.15.0",
    "@react-three/drei": "^9.88.0",
    "axios": "^1.6.0",
    "zustand": "^4.4.0",
    "recharts": "^2.9.0",
    "lucide-react": "^0.292.0",
    "@radix-ui/react-slider": "^1.1.0",
    "@radix-ui/react-tabs": "^1.0.0",
    "@radix-ui/react-select": "^2.0.0",
    "@radix-ui/react-dialog": "^1.0.0",
    "@radix-ui/react-progress": "^1.0.0",
    "clsx": "^2.0.0",
    "tailwind-merge": "^2.0.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.37",
    "@types/react-dom": "^18.2.15",
    "@types/three": "^0.158.0",
    "@typescript-eslint/eslint-plugin": "^6.10.0",
    "@typescript-eslint/parser": "^6.10.0",
    "@vitejs/plugin-react": "^4.1.1",
    "autoprefixer": "^10.4.16",
    "concurrently": "^8.2.0",
    "electron": "^27.0.0",
    "electron-builder": "^24.6.0",
    "eslint": "^8.53.0",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.4",
    "postcss": "^8.4.31",
    "tailwindcss": "^3.3.5",
    "typescript": "^5.2.2",
    "vite": "^5.0.0",
    "wait-on": "^7.2.0"
  },
  "build": {
    "appId": "com.octa.vessel.analyzer",
    "productName": "OCTA血管分析系统",
    "directories": {
      "output": "dist-electron"
    },
    "files": [
      "dist/**/*",
      "electron/**/*"
    ],
    "win": {
      "target": [
        {
          "target": "nsis",
          "arch": ["x64"]
        }
      ],
      "icon": "public/icon.ico"
    },
    "nsis": {
      "oneClick": false,
      "allowToChangeInstallationDirectory": true,
      "createDesktopShortcut": true,
      "createStartMenuShortcut": true,
      "shortcutName": "OCTA血管分析"
    }
  }
}
</file>

<file path="frontend/postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
</file>

<file path="frontend/src/App.tsx">
/**
 * OCTA 血管网络分析系统 - App 主组件
 * 
 * 应用程序的根组件，包含：
 * 1. 路由配置
 * 2. 全局状态管理
 * 3. 布局结构
 */

import React from 'react';
import { Routes, Route } from 'react-router-dom';
import Layout from './components/Layout';
import HomePage from './pages/HomePage';
import DataPage from './pages/DataPage';
import AnnotationPage from './pages/AnnotationPage';
import TrainingPage from './pages/TrainingPage';
import InferencePage from './pages/InferencePage';
import VisualizationPage from './pages/VisualizationPage';

const App: React.FC = () => {
  return (
    <Layout>
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/data" element={<DataPage />} />
        <Route path="/annotation" element={<AnnotationPage />} />
        <Route path="/training" element={<TrainingPage />} />
        <Route path="/inference" element={<InferencePage />} />
        <Route path="/visualization" element={<VisualizationPage />} />
      </Routes>
    </Layout>
  );
};

export default App;
</file>

<file path="frontend/src/components/Layout.tsx">
/**
 * OCTA 血管网络分析系统 - 布局组件
 * 
 * 应用程序的整体布局结构：
 * - 顶部导航栏
 * - 左侧工具栏
 * - 主内容区域
 * - 右侧状态面板（可选）
 */

import React, { useState } from 'react';
import { NavLink, useLocation } from 'react-router-dom';
import {
  Home,
  Database,
  Edit3,
  Cpu,
  Play,
  Eye,
  Settings,
  HelpCircle,
  ChevronLeft,
  ChevronRight
} from 'lucide-react';

interface LayoutProps {
  children: React.ReactNode;
}

// 导航项配置
const navItems = [
  { path: '/', icon: Home, label: '首页', description: '系统概览' },
  { path: '/data', icon: Database, label: '数据管理', description: '导入和管理OCTA数据' },
  { path: '/annotation', icon: Edit3, label: '标注工具', description: '血管横截面标注' },
  { path: '/training', icon: Cpu, label: '模型训练', description: '深度学习模型训练' },
  { path: '/inference', icon: Play, label: '推理预测', description: '应用模型进行推理' },
  { path: '/visualization', icon: Eye, label: '三维可视化', description: '血管网络3D展示' },
];

const Layout: React.FC<LayoutProps> = ({ children }) => {
  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);
  const location = useLocation();

  // 获取当前页面信息
  const currentPage = navItems.find(item => item.path === location.pathname) || navItems[0];

  return (
    <div className="flex h-screen bg-gray-900 text-white">
      {/* 左侧导航栏 */}
      <aside 
        className={`
          ${sidebarCollapsed ? 'w-16' : 'w-64'} 
          flex flex-col bg-gray-800 border-r border-gray-700 transition-all duration-300
        `}
      >
        {/* Logo */}
        <div className="h-16 flex items-center justify-center border-b border-gray-700">
          {sidebarCollapsed ? (
            <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
              <span className="text-xl font-bold">O</span>
            </div>
          ) : (
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                <span className="text-xl font-bold">O</span>
              </div>
              <div>
                <h1 className="text-lg font-bold">OCTA 分析</h1>
                <p className="text-xs text-gray-400">血管网络系统</p>
              </div>
            </div>
          )}
        </div>

        {/* 导航菜单 */}
        <nav className="flex-1 py-4 overflow-y-auto">
          {navItems.map((item) => {
            const Icon = item.icon;
            const isActive = location.pathname === item.path;

            return (
              <NavLink
                key={item.path}
                to={item.path}
                className={`
                  flex items-center gap-3 px-4 py-3 mx-2 rounded-lg transition-all
                  ${isActive 
                    ? 'bg-blue-600 text-white' 
                    : 'text-gray-300 hover:bg-gray-700 hover:text-white'
                  }
                `}
                title={sidebarCollapsed ? item.label : undefined}
              >
                <Icon size={20} className="flex-shrink-0" />
                {!sidebarCollapsed && (
                  <div className="min-w-0">
                    <div className="font-medium truncate">{item.label}</div>
                    <div className="text-xs text-gray-400 truncate">{item.description}</div>
                  </div>
                )}
              </NavLink>
            );
          })}
        </nav>

        {/* 底部工具 */}
        <div className="border-t border-gray-700 p-2">
          <button
            onClick={() => setSidebarCollapsed(!sidebarCollapsed)}
            className="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-gray-400 hover:bg-gray-700 hover:text-white transition-all"
          >
            {sidebarCollapsed ? <ChevronRight size={20} /> : <ChevronLeft size={20} />}
            {!sidebarCollapsed && <span>收起侧栏</span>}
          </button>
          
          {!sidebarCollapsed && (
            <div className="flex gap-2 mt-2">
              <button className="flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-gray-400 hover:bg-gray-700 hover:text-white transition-all">
                <Settings size={18} />
                <span>设置</span>
              </button>
              <button className="flex-1 flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-gray-400 hover:bg-gray-700 hover:text-white transition-all">
                <HelpCircle size={18} />
                <span>帮助</span>
              </button>
            </div>
          )}
        </div>
      </aside>

      {/* 主内容区域 */}
      <main className="flex-1 flex flex-col overflow-hidden">
        {/* 顶部标题栏 */}
        <header className="h-14 flex items-center justify-between px-6 border-b border-gray-700 bg-gray-800/50">
          <div>
            <h2 className="text-lg font-semibold">{currentPage.label}</h2>
            <p className="text-sm text-gray-400">{currentPage.description}</p>
          </div>
          
          {/* 状态指示器 */}
          <div className="flex items-center gap-4">
            <div className="flex items-center gap-2 text-sm">
              <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
              <span className="text-gray-400">后端服务运行中</span>
            </div>
          </div>
        </header>

        {/* 页面内容 */}
        <div className="flex-1 overflow-auto p-6">
          {children}
        </div>
      </main>
    </div>
  );
};

export default Layout;
</file>

<file path="frontend/src/main.tsx">
/**
 * OCTA 血管网络分析系统 - 主应用入口
 */

import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import App from './App';
import './styles/index.css';

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);
</file>

<file path="frontend/src/pages/AnnotationPage.tsx">
/**
 * OCTA 血管标注 - V7版本（优化版）
 * 
 * 改进：
 * 1. 支持椭圆旋转角度显示和编辑
 * 2. 多种自动拟合方法选择
 * 3. 增强的检测参数控制
 * 4. 更好的视觉反馈
 * 5. 快捷键支持
 */

import React, { useState, useEffect, useRef, useCallback } from 'react';
import {
  Circle, Brush, Eraser, ZoomIn, ZoomOut, Save, Download,
  Crosshair, Play, Wand2, Loader2, Trash2, Eye, Target, CheckCircle,
  RotateCw, Move, Settings2, Sparkles, MousePointer, Scan, Layers
} from 'lucide-react';
import { api } from '../utils/api';

type ToolType = 'ellipse' | 'brush' | 'eraser' | 'select' | 'auto-fit';
type FitMethod = 'auto' | 'edge' | 'region' | 'blob';
type DetectMethod = 'fast' | 'combined' | 'blob' | 'edge';

interface Ellipse {
  id: string;
  centerX: number;
  centerY: number;
  radiusX: number;
  radiusY: number;
  rotation: number;
  confidence?: number;
  isManual?: boolean;
  method?: string;
}

interface BrushStroke {
  id: string;
  points: { x: number; y: number }[];
  brushSize: number;
  isEraser: boolean;
}

const AnnotationPage: React.FC = () => {
  // ========================================
  // 状态管理
  // ========================================
  const [volumes, setVolumes] = useState<any[]>([]);
  const [projects, setProjects] = useState<any[]>([]);
  const [selectedVolumeId, setSelectedVolumeId] = useState('');
  const [projectId, setProjectId] = useState('');

  const [currentAxis, setCurrentAxis] = useState<'x' | 'y' | 'z'>('y');
  const [sliceIndex, setSliceIndex] = useState(0);
  const [maxSliceIndex, setMaxSliceIndex] = useState(0);
  const [zoom, setZoom] = useState(1);
  const [pan, setPan] = useState({ x: 0, y: 0 });

  const [tool, setTool] = useState<ToolType>('select');
  const [brushSize, setBrushSize] = useState(5);
  const [selectedEllipseId, setSelectedEllipseId] = useState<string | null>(null);

  const [ellipses, setEllipses] = useState<Ellipse[]>([]);
  const [strokes, setStrokes] = useState<BrushStroke[]>([]);
  const [currentStroke, setCurrentStroke] = useState<{ x: number; y: number }[]>([]);

  const [showAnnotations, setShowAnnotations] = useState(true);
  const [showConfidence, setShowConfidence] = useState(true);
  const [loadedImage, setLoadedImage] = useState<HTMLImageElement | null>(null);
  const [isDrawing, setIsDrawing] = useState(false);
  const [drawStart, setDrawStart] = useState<{ x: number; y: number } | null>(null);
  const [currentMousePos, setCurrentMousePos] = useState<{ x: number; y: number } | null>(null);

  // 自动标注参数
  const [autoLabeling, setAutoLabeling] = useState(false);
  const [backendVersion, setBackendVersion] = useState('');
  const [autoAxis, setAutoAxis] = useState('y');
  const [autoMinRadius, setAutoMinRadius] = useState(3);
  const [autoMaxRadius, setAutoMaxRadius] = useState(15);
  const [autoSensitivity, setAutoSensitivity] = useState('medium');
  const [autoRegen, setAutoRegen] = useState(true);
  const [useCLAHE, setUseCLAHE] = useState(true);
  const [detectMethod, setDetectMethod] = useState<DetectMethod>('fast');

  // 点击拟合参数
  const [fitMethod, setFitMethod] = useState<FitMethod>('auto');
  const [fitRoiSize, setFitRoiSize] = useState(50);
  const [isFitting, setIsFitting] = useState(false);

  // 椭圆编辑
  const [editingEllipse, setEditingEllipse] = useState<Ellipse | null>(null);

  const canvasRef = useRef<HTMLCanvasElement>(null);
  const containerRef = useRef<HTMLDivElement>(null);

  // ========================================
  // 数据加载
  // ========================================
  useEffect(() => {
    api.get('/data/list').then(r => setVolumes(r.data || [])).catch(() => {});
    api.get('/annotation/projects').then(r => setProjects(r.data || [])).catch(() => {});
    
    // 获取后端版本
    api.get('/annotation/version').then(r => setBackendVersion(r.data?.version || '')).catch(() => {});
  }, []);

  useEffect(() => {
    if (!selectedVolumeId) return;
    const v = volumes.find(x => x.id === selectedVolumeId);
    if (v?.shape) {
      const max = v.shape[{x:0, y:1, z:2}[currentAxis]] - 1;
      setMaxSliceIndex(max);
      setSliceIndex(Math.floor(max / 2));
    }
  }, [selectedVolumeId, currentAxis, volumes]);

  useEffect(() => {
    if (!selectedVolumeId) return;
    api.get(`/data/${selectedVolumeId}/slice/${currentAxis}/${sliceIndex}`, { responseType: 'blob' })
      .then(r => {
        const img = new Image();
        img.onload = () => setLoadedImage(img);
        img.src = URL.createObjectURL(r.data);
      })
      .catch(() => setLoadedImage(null));
  }, [selectedVolumeId, currentAxis, sliceIndex]);

  const loadLayer = useCallback(async () => {
    if (!projectId) { setEllipses([]); setStrokes([]); return; }
    try {
      const r = await api.get(`/annotation/projects/${projectId}/layer/${currentAxis}_${sliceIndex}`);
      setEllipses((r.data.ellipses || []).map((e: any) => ({
        id: e.id, centerX: e.center_x, centerY: e.center_y,
        radiusX: e.radius_x, radiusY: e.radius_y, rotation: e.rotation || 0,
        confidence: e.confidence || 1, isManual: e.is_manual, method: e.method
      })));
      setStrokes((r.data.brush_strokes || []).map((s: any) => ({
        id: s.id, points: s.points, brushSize: s.brush_size, isEraser: s.is_eraser
      })));
    } catch { setEllipses([]); setStrokes([]); }
  }, [projectId, currentAxis, sliceIndex]);

  useEffect(() => { loadLayer(); }, [loadLayer]);

  // ========================================
  // 绘制
  // ========================================
  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas || !loadedImage) return;
    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    canvas.width = loadedImage.width * zoom;
    canvas.height = loadedImage.height * zoom;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.scale(zoom, zoom);
    ctx.drawImage(loadedImage, 0, 0);

    if (showAnnotations) {
      // 绘制椭圆
      ellipses.forEach((e, i) => {
        const sel = e.id === selectedEllipseId;
        const conf = e.confidence || 1;
        
        // 根据置信度选择颜色
        let color: string;
        if (e.isManual) {
          color = '#00ffff'; // 手动标注：青色
        } else if (conf >= 0.8) {
          color = '#00ff00'; // 高置信度：绿色
        } else if (conf >= 0.6) {
          color = '#ffff00'; // 中等置信度：黄色
        } else {
          color = '#ff8800'; // 低置信度：橙色
        }

        ctx.save();
        ctx.translate(e.centerX, e.centerY);
        ctx.rotate((e.rotation || 0) * Math.PI / 180);

        // 填充
        ctx.fillStyle = sel ? 'rgba(0,255,255,0.25)' : `${color}22`;
        ctx.beginPath();
        ctx.ellipse(0, 0, Math.max(1, e.radiusX), Math.max(1, e.radiusY), 0, 0, 2 * Math.PI);
        ctx.fill();

        // 边框
        ctx.strokeStyle = sel ? '#00ffff' : color;
        ctx.lineWidth = (sel ? 3 : 2) / zoom;
        ctx.stroke();

        // 中心点
        ctx.fillStyle = '#ff0000';
        ctx.beginPath();
        ctx.arc(0, 0, 3 / zoom, 0, 2 * Math.PI);
        ctx.fill();

        // 旋转指示线（如果有旋转）
        if (Math.abs(e.rotation || 0) > 1) {
          ctx.strokeStyle = '#ff00ff';
          ctx.lineWidth = 1 / zoom;
          ctx.beginPath();
          ctx.moveTo(0, 0);
          ctx.lineTo(e.radiusX, 0);
          ctx.stroke();
        }

        ctx.restore();

        // 标签（在椭圆外部显示）
        ctx.fillStyle = '#fff';
        ctx.font = `bold ${11 / zoom}px Arial`;
        ctx.textAlign = 'center';
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 2 / zoom;
        
        const labelY = e.centerY - Math.max(e.radiusX, e.radiusY) - 10 / zoom;
        let labelText = `${i + 1}`;
        
        if (showConfidence && !e.isManual) {
          labelText += ` (${(conf * 100).toFixed(0)}%)`;
        }
        
        ctx.strokeText(labelText, e.centerX, labelY);
        ctx.fillText(labelText, e.centerX, labelY);
      });

      // 绘制画笔笔迹
      strokes.forEach(s => {
        if (s.points.length < 2) return;
        ctx.strokeStyle = s.isEraser ? 'rgba(255,0,0,0.7)' : 'rgba(0,255,0,0.7)';
        ctx.lineWidth = s.brushSize / zoom;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(s.points[0].x, s.points[0].y);
        s.points.forEach(p => ctx.lineTo(p.x, p.y));
        ctx.stroke();
      });

      // 当前笔迹
      if (currentStroke.length > 1) {
        ctx.strokeStyle = tool === 'eraser' ? 'rgba(255,0,0,0.7)' : 'rgba(0,255,0,0.7)';
        ctx.lineWidth = brushSize / zoom;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(currentStroke[0].x, currentStroke[0].y);
        currentStroke.forEach(p => ctx.lineTo(p.x, p.y));
        ctx.stroke();
      }

      // 正在绘制的椭圆预览
      if (isDrawing && tool === 'ellipse' && drawStart && currentMousePos) {
        const cx = (drawStart.x + currentMousePos.x) / 2;
        const cy = (drawStart.y + currentMousePos.y) / 2;
        const rx = Math.abs(currentMousePos.x - drawStart.x) / 2;
        const ry = Math.abs(currentMousePos.y - drawStart.y) / 2;
        ctx.strokeStyle = '#00ffff';
        ctx.setLineDash([5 / zoom, 3 / zoom]);
        ctx.lineWidth = 2 / zoom;
        ctx.beginPath();
        ctx.ellipse(cx, cy, rx, ry, 0, 0, 2 * Math.PI);
        ctx.stroke();
        ctx.setLineDash([]);
      }

      // 自动拟合工具的十字准星
      if (tool === 'auto-fit' && currentMousePos) {
        ctx.strokeStyle = '#ff00ff';
        ctx.lineWidth = 1 / zoom;
        ctx.setLineDash([3 / zoom, 3 / zoom]);
        
        const size = fitRoiSize / 2;
        ctx.strokeRect(
          currentMousePos.x - size,
          currentMousePos.y - size,
          fitRoiSize,
          fitRoiSize
        );
        
        // 十字线
        ctx.beginPath();
        ctx.moveTo(currentMousePos.x - 10 / zoom, currentMousePos.y);
        ctx.lineTo(currentMousePos.x + 10 / zoom, currentMousePos.y);
        ctx.moveTo(currentMousePos.x, currentMousePos.y - 10 / zoom);
        ctx.lineTo(currentMousePos.x, currentMousePos.y + 10 / zoom);
        ctx.stroke();
        ctx.setLineDash([]);
      }
    }
    
    ctx.restore();
  }, [loadedImage, zoom, showAnnotations, showConfidence, ellipses, strokes, currentStroke, brushSize, tool, isDrawing, drawStart, currentMousePos, selectedEllipseId, fitRoiSize]);

  // ========================================
  // 交互处理
  // ========================================
  const getCoords = (e: React.MouseEvent) => {
    const r = canvasRef.current?.getBoundingClientRect();
    return r ? { x: (e.clientX - r.left) / zoom, y: (e.clientY - r.top) / zoom } : { x: 0, y: 0 };
  };

  const handleAutoFitAtPoint = async (x: number, y: number) => {
    if (!projectId) return;
    
    setIsFitting(true);
    try {
      const r = await api.post(`/annotation/projects/${projectId}/auto-fit-at-point`, {
        slice_index: sliceIndex,
        axis: currentAxis,
        click_x: x,
        click_y: y,
        roi_size: fitRoiSize,
        method: fitMethod
      });
      
      const newEllipse: Ellipse = {
        id: `fit_${Date.now()}`,
        centerX: r.data.center_x,
        centerY: r.data.center_y,
        radiusX: r.data.radius_x,
        radiusY: r.data.radius_y,
        rotation: r.data.rotation || 0,
        confidence: r.data.confidence,
        isManual: false,
        method: r.data.method
      };
      
      setEllipses(prev => [...prev, newEllipse]);
      setSelectedEllipseId(newEllipse.id);
      
    } catch (err: any) {
      const msg = err.response?.data?.detail || '拟合失败，请尝试点击血管中心';
      console.warn('[AutoFit]', msg);
      // 可以显示一个小提示而不是 alert
    } finally {
      setIsFitting(false);
    }
  };

  const handleMouseDown = async (e: React.MouseEvent) => {
    const c = getCoords(e);

    // Alt + 点击：快速自动拟合（任何工具下都生效）
    if (e.altKey && projectId) {
      await handleAutoFitAtPoint(c.x, c.y);
      return;
    }

    // 自动拟合工具
    if (tool === 'auto-fit') {
      await handleAutoFitAtPoint(c.x, c.y);
      return;
    }

    // 选择工具
    if (tool === 'select') {
      const found = [...ellipses].reverse().find(el => {
        // 考虑旋转的点击检测
        const dx = c.x - el.centerX;
        const dy = c.y - el.centerY;
        const angle = -(el.rotation || 0) * Math.PI / 180;
        const rx = dx * Math.cos(angle) - dy * Math.sin(angle);
        const ry = dx * Math.sin(angle) + dy * Math.cos(angle);
        return (rx / el.radiusX) ** 2 + (ry / el.radiusY) ** 2 <= 1.5;
      });
      setSelectedEllipseId(found?.id || null);
      if (found) {
        setEditingEllipse({ ...found });
      } else {
        setEditingEllipse(null);
      }
      return;
    }

    setIsDrawing(true);
    if (tool === 'ellipse') {
      setDrawStart(c);
      setCurrentMousePos(c);
    } else if (tool === 'brush' || tool === 'eraser') {
      setCurrentStroke([c]);
    }
  };

  const handleMouseMove = (e: React.MouseEvent) => {
    const c = getCoords(e);
    setCurrentMousePos(c);
    if (isDrawing && (tool === 'brush' || tool === 'eraser')) {
      setCurrentStroke(prev => [...prev, c]);
    }
  };

  const handleMouseUp = (e: React.MouseEvent) => {
    if (!isDrawing) return;
    const c = getCoords(e);
    setIsDrawing(false);

    if (tool === 'ellipse' && drawStart) {
      const cx = (drawStart.x + c.x) / 2;
      const cy = (drawStart.y + c.y) / 2;
      const rx = Math.abs(c.x - drawStart.x) / 2;
      const ry = Math.abs(c.y - drawStart.y) / 2;
      if (rx > 2 && ry > 2) {
        const newEllipse: Ellipse = {
          id: `m_${Date.now()}`,
          centerX: cx,
          centerY: cy,
          radiusX: rx,
          radiusY: ry,
          rotation: 0,
          confidence: 1,
          isManual: true
        };
        setEllipses(prev => [...prev, newEllipse]);
        setSelectedEllipseId(newEllipse.id);
      }
      setDrawStart(null);
    } else if ((tool === 'brush' || tool === 'eraser') && currentStroke.length > 1) {
      setStrokes(prev => [...prev, {
        id: `s_${Date.now()}`,
        points: currentStroke,
        brushSize,
        isEraser: tool === 'eraser'
      }]);
      setCurrentStroke([]);
    }
  };

  // 键盘快捷键
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      // 删除选中的椭圆
      if ((e.key === 'Delete' || e.key === 'Backspace') && selectedEllipseId) {
        setEllipses(prev => prev.filter(el => el.id !== selectedEllipseId));
        setSelectedEllipseId(null);
        setEditingEllipse(null);
      }
      
      // 工具快捷键
      if (!e.ctrlKey && !e.altKey && !e.metaKey) {
        switch (e.key.toLowerCase()) {
          case 'v': setTool('select'); break;
          case 'e': setTool('ellipse'); break;
          case 'b': setTool('brush'); break;
          case 'x': setTool('eraser'); break;
          case 'a': setTool('auto-fit'); break;
        }
      }
      
      // 切片导航
      if (e.key === 'ArrowLeft' || e.key === ',') {
        setSliceIndex(prev => Math.max(0, prev - 1));
      }
      if (e.key === 'ArrowRight' || e.key === '.') {
        setSliceIndex(prev => Math.min(maxSliceIndex, prev + 1));
      }
      
      // Ctrl+S 保存
      if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        save();
      }
    };
    
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [selectedEllipseId, maxSliceIndex]);

  // ========================================
  // 操作函数
  // ========================================
  const save = async () => {
    if (!projectId) return alert('请选择项目');
    await api.post(`/annotation/projects/${projectId}/save`, {
      project_id: projectId,
      layer_key: `${currentAxis}_${sliceIndex}`,
      ellipses: ellipses.map(e => ({
        id: e.id,
        center_x: e.centerX,
        center_y: e.centerY,
        radius_x: e.radiusX,
        radius_y: e.radiusY,
        rotation: e.rotation || 0,
        slice_index: sliceIndex,
        axis: currentAxis,
        confidence: e.confidence,
        is_manual: e.isManual
      })),
      brush_strokes: strokes.map(s => ({
        id: s.id,
        points: s.points,
        brush_size: s.brushSize,
        is_eraser: s.isEraser,
        slice_index: sliceIndex,
        axis: currentAxis
      }))
    });
    alert('✅ 已保存');
  };

  const genMask = async () => {
    if (!projectId) return;
    const r = await api.post(`/annotation/projects/${projectId}/generate-mask`);
    alert(`✅ 生成完成\n体素数: ${r.data.vessel_voxels}\n占比: ${r.data.vessel_fraction}`);
  };

  const autoLabel = async () => {
    if (!projectId) return alert('请选择项目');
    setAutoLabeling(true);
    try {
      const r = await api.post(`/annotation/projects/${projectId}/autolabel`, {
        axis: autoAxis,
        min_radius: autoMinRadius,
        max_radius: autoMaxRadius,
        sensitivity: autoSensitivity,
        regen: autoRegen,
        min_slices: 1,
        continuity_threshold: 20,
        use_clahe: useCLAHE,
        detect_method: detectMethod
      });
      setBackendVersion(r.data.code_version || '');
      alert(`✅ 检测完成\n版本: ${r.data.code_version}\n椭圆数: ${r.data.added_ellipses}\n有旋转: ${r.data.ellipses_with_rotation}\n覆盖率: ${r.data.coverage_percent}`);
      setCurrentAxis(autoAxis as any);
      setTimeout(loadLayer, 300);
    } catch (err: any) {
      alert(err.response?.data?.detail || '检测失败');
    } finally {
      setAutoLabeling(false);
    }
  };

  const createProj = async () => {
    if (!selectedVolumeId) return alert('请选择数据');
    const name = prompt('项目名称');
    if (!name) return;
    const r = await api.post('/annotation/projects', { volume_id: selectedVolumeId, name });
    setProjects(prev => [...prev, r.data]);
    setProjectId(r.data.id);
  };

  const updateSelectedEllipse = (updates: Partial<Ellipse>) => {
    if (!selectedEllipseId) return;
    setEllipses(prev => prev.map(e => 
      e.id === selectedEllipseId ? { ...e, ...updates } : e
    ));
    if (editingEllipse) {
      setEditingEllipse({ ...editingEllipse, ...updates });
    }
  };

  // ========================================
  // 渲染
  // ========================================
  return (
    <div className="flex h-full gap-4">
      {/* 左侧面板 */}
      <div className="w-80 space-y-3 flex-shrink-0 overflow-y-auto">
        
        {/* 数据/项目选择 */}
        <div className="bg-gray-800 rounded-lg p-3 border border-gray-700 space-y-2">
          <select 
            value={selectedVolumeId} 
            onChange={e => setSelectedVolumeId(e.target.value)} 
            className="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1.5 text-sm"
          >
            <option value="">选择数据...</option>
            {volumes.map(v => <option key={v.id} value={v.id}>{v.filename}</option>)}
          </select>
          <div className="flex gap-2">
            <select 
              value={projectId} 
              onChange={e => setProjectId(e.target.value)} 
              className="flex-1 bg-gray-700 border border-gray-600 rounded px-2 py-1.5 text-sm"
            >
              <option value="">选择项目...</option>
              {projects.filter(p => !selectedVolumeId || p.volume_id === selectedVolumeId).map(p => 
                <option key={p.id} value={p.id}>{p.name}</option>
              )}
            </select>
            <button onClick={createProj} className="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm">新建</button>
          </div>
        </div>

        {/* 工具栏 */}
        <div className="bg-gray-800 rounded-lg p-3 border border-gray-700 space-y-2">
          <div className="text-xs text-gray-400 mb-1">工具 (快捷键)</div>
          <div className="grid grid-cols-5 gap-1">
            {[
              { id: 'select', icon: MousePointer, label: '选择', key: 'V' },
              { id: 'ellipse', icon: Circle, label: '椭圆', key: 'E' },
              { id: 'brush', icon: Brush, label: '画笔', key: 'B' },
              { id: 'eraser', icon: Eraser, label: '橡皮', key: 'X' },
              { id: 'auto-fit', icon: Sparkles, label: '拟合', key: 'A' },
            ].map(({ id, icon: Icon, label, key }) => (
              <button
                key={id}
                onClick={() => setTool(id as ToolType)}
                className={`flex flex-col items-center p-1.5 rounded transition-colors ${
                  tool === id ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'
                }`}
                title={`${label} (${key})`}
              >
                <Icon size={14} />
                <span className="text-[10px] mt-0.5">{key}</span>
              </button>
            ))}
          </div>
          
          {/* 自动拟合参数 */}
          {tool === 'auto-fit' && (
            <div className="mt-2 pt-2 border-t border-gray-700 space-y-2">
              <div className="flex justify-between items-center text-sm">
                <span className="text-gray-400">拟合方法</span>
                <select 
                  value={fitMethod} 
                  onChange={e => setFitMethod(e.target.value as FitMethod)}
                  className="bg-gray-700 border border-gray-600 rounded px-2 py-0.5 text-sm"
                >
                  <option value="auto">自动</option>
                  <option value="edge">边缘</option>
                  <option value="region">区域生长</option>
                  <option value="blob">Blob</option>
                </select>
              </div>
              <div className="flex justify-between items-center text-sm">
                <span className="text-gray-400">ROI 大小</span>
                <input
                  type="number"
                  value={fitRoiSize}
                  min={20}
                  max={100}
                  onChange={e => setFitRoiSize(+e.target.value || 50)}
                  className="w-16 bg-gray-700 border border-gray-600 rounded px-2 py-0.5 text-center text-sm"
                />
              </div>
            </div>
          )}
          
          {/* 删除按钮 */}
          {selectedEllipseId && (
            <button
              onClick={() => {
                setEllipses(p => p.filter(e => e.id !== selectedEllipseId));
                setSelectedEllipseId(null);
                setEditingEllipse(null);
              }}
              className="w-full py-1.5 bg-red-600 hover:bg-red-700 rounded text-sm flex items-center justify-center gap-1"
            >
              <Trash2 size={12} />
              删除选中 (Del)
            </button>
          )}
        </div>

        {/* 椭圆编辑器 */}
        {editingEllipse && (
          <div className="bg-gray-800 rounded-lg p-3 border border-blue-600 space-y-2">
            <h3 className="text-sm font-medium flex items-center gap-1">
              <Settings2 size={14} />
              椭圆编辑
            </h3>
            <div className="grid grid-cols-2 gap-2 text-sm">
              <div>
                <label className="text-gray-400 text-xs">中心 X</label>
                <input
                  type="number"
                  value={editingEllipse.centerX.toFixed(1)}
                  onChange={e => updateSelectedEllipse({ centerX: +e.target.value })}
                  className="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm"
                />
              </div>
              <div>
                <label className="text-gray-400 text-xs">中心 Y</label>
                <input
                  type="number"
                  value={editingEllipse.centerY.toFixed(1)}
                  onChange={e => updateSelectedEllipse({ centerY: +e.target.value })}
                  className="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm"
                />
              </div>
              <div>
                <label className="text-gray-400 text-xs">半径 X</label>
                <input
                  type="number"
                  value={editingEllipse.radiusX.toFixed(1)}
                  onChange={e => updateSelectedEllipse({ radiusX: +e.target.value })}
                  className="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm"
                />
              </div>
              <div>
                <label className="text-gray-400 text-xs">半径 Y</label>
                <input
                  type="number"
                  value={editingEllipse.radiusY.toFixed(1)}
                  onChange={e => updateSelectedEllipse({ radiusY: +e.target.value })}
                  className="w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm"
                />
              </div>
              <div className="col-span-2">
                <label className="text-gray-400 text-xs flex items-center gap-1">
                  <RotateCw size={10} />
                  旋转角度
                </label>
                <div className="flex items-center gap-2">
                  <input
                    type="range"
                    min={-90}
                    max={90}
                    value={editingEllipse.rotation || 0}
                    onChange={e => updateSelectedEllipse({ rotation: +e.target.value })}
                    className="flex-1"
                  />
                  <span className="text-xs w-10 text-right">{(editingEllipse.rotation || 0).toFixed(0)}°</span>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* 自动检测 */}
        <div className="bg-gray-800 rounded-lg p-3 border border-gray-700 space-y-2">
          <h3 className="font-medium text-sm flex items-center gap-1">
            <Wand2 size={14} />
            自动检测
          </h3>

          {backendVersion && (
            <div className="text-xs p-1.5 rounded bg-green-500/20 text-green-300 flex items-center gap-1">
              <CheckCircle size={12} />{backendVersion}
            </div>
          )}

          <div className="space-y-2 text-sm">
            <div className="flex justify-between items-center">
              <span className="text-gray-400">轴向</span>
              <select value={autoAxis} onChange={e => setAutoAxis(e.target.value)} className="bg-gray-700 border border-gray-600 rounded px-2 py-0.5">
                <option value="x">X</option>
                <option value="y">Y</option>
                <option value="z">Z</option>
              </select>
            </div>
            
            <div className="flex justify-between items-center">
              <span className="text-gray-400">半径范围</span>
              <div className="flex items-center gap-1">
                <input type="number" value={autoMinRadius} min={1} max={20} onChange={e => setAutoMinRadius(+e.target.value || 2)} className="w-10 bg-gray-700 border border-gray-600 rounded px-1 py-0.5 text-center" />
                <span>~</span>
                <input type="number" value={autoMaxRadius} min={5} max={50} onChange={e => setAutoMaxRadius(+e.target.value || 15)} className="w-10 bg-gray-700 border border-gray-600 rounded px-1 py-0.5 text-center" />
              </div>
            </div>
            
            <div className="flex justify-between items-center">
              <span className="text-gray-400">灵敏度</span>
              <select value={autoSensitivity} onChange={e => setAutoSensitivity(e.target.value)} className="bg-gray-700 border border-gray-600 rounded px-2 py-0.5">
                <option value="low">低</option>
                <option value="medium">中</option>
                <option value="high">高</option>
              </select>
            </div>
            
            <div className="flex justify-between items-center">
              <span className="text-gray-400">检测方法</span>
              <select value={detectMethod} onChange={e => setDetectMethod(e.target.value as DetectMethod)} className="bg-gray-700 border border-gray-600 rounded px-2 py-0.5">
                <option value="fast">⚡ 快速</option>
                <option value="combined">融合</option>
                <option value="edge">边缘</option>
                <option value="blob">Blob</option>
              </select>
            </div>
            
            <div className="flex flex-wrap gap-x-4 gap-y-1">
              <label className="flex items-center gap-1.5 text-xs">
                <input type="checkbox" checked={useCLAHE} onChange={e => setUseCLAHE(e.target.checked)} />
                CLAHE 增强
              </label>
              <label className="flex items-center gap-1.5 text-xs">
                <input type="checkbox" checked={autoRegen} onChange={e => setAutoRegen(e.target.checked)} />
                清空旧标注
              </label>
            </div>
          </div>

          <button
            onClick={autoLabel}
            disabled={autoLabeling || !projectId}
            className={`w-full py-2 rounded flex items-center justify-center gap-1 text-sm transition-colors ${
              autoLabeling ? 'bg-gray-600' : 'bg-green-600 hover:bg-green-700'
            }`}
          >
            {autoLabeling ? (
              <><Loader2 size={14} className="animate-spin" />检测中...</>
            ) : (
              <><Scan size={14} />开始全局检测</>
            )}
          </button>

          <div className="text-xs text-gray-400 border-t border-gray-700 pt-2 space-y-0.5">
            <div>💡 <strong>Alt+点击</strong> = 任意位置快速拟合</div>
            <div>💡 <strong>A 键</strong> = 切换到拟合工具</div>
          </div>
        </div>

        {/* 视图控制 */}
        <div className="bg-gray-800 rounded-lg p-3 border border-gray-700 space-y-2">
          <div className="flex gap-1">
            {(['x', 'y', 'z'] as const).map(a => (
              <button
                key={a}
                onClick={() => setCurrentAxis(a)}
                className={`flex-1 py-1.5 rounded text-sm transition-colors ${
                  currentAxis === a ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'
                }`}
              >
                {a.toUpperCase()} 轴
              </button>
            ))}
          </div>

          <div>
            <div className="flex justify-between text-xs text-gray-400 mb-0.5">
              <span>切片 (←→)</span>
              <span>{sliceIndex} / {maxSliceIndex}</span>
            </div>
            <input
              type="range"
              min={0}
              max={maxSliceIndex}
              value={sliceIndex}
              onChange={e => setSliceIndex(+e.target.value)}
              className="w-full"
            />
          </div>

          <div className="flex items-center gap-1">
            <button onClick={() => setZoom(z => Math.max(0.5, z - 0.25))} className="p-1.5 bg-gray-700 hover:bg-gray-600 rounded">
              <ZoomOut size={12} />
            </button>
            <span className="flex-1 text-center text-xs">{(zoom * 100).toFixed(0)}%</span>
            <button onClick={() => setZoom(z => Math.min(4, z + 0.25))} className="p-1.5 bg-gray-700 hover:bg-gray-600 rounded">
              <ZoomIn size={12} />
            </button>
          </div>

          <div className="flex gap-2">
            <label className="flex items-center gap-1.5 text-xs">
              <input type="checkbox" checked={showAnnotations} onChange={e => setShowAnnotations(e.target.checked)} />
              <Eye size={10} />标注
            </label>
            <label className="flex items-center gap-1.5 text-xs">
              <input type="checkbox" checked={showConfidence} onChange={e => setShowConfidence(e.target.checked)} />
              置信度
            </label>
          </div>

          <div className="text-xs border-t border-gray-700 pt-1.5 flex justify-between">
            <span className="text-gray-400">椭圆数:</span>
            <span className="text-yellow-400 font-medium">{ellipses.length}</span>
            <span className="text-gray-400">手动:</span>
            <span className="text-cyan-400 font-medium">{ellipses.filter(e => e.isManual).length}</span>
          </div>
        </div>

        {/* 操作按钮 */}
        <div className="bg-gray-800 rounded-lg p-3 border border-gray-700 space-y-1.5">
          <button
            onClick={save}
            disabled={!projectId}
            className="w-full py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded text-sm flex items-center justify-center gap-1"
          >
            <Save size={14} />
            保存 (Ctrl+S)
          </button>
          <button
            onClick={genMask}
            disabled={!projectId}
            className="w-full py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 rounded text-sm flex items-center justify-center gap-1"
          >
            <Layers size={14} />
            生成金标准
          </button>
          <button
            onClick={() => { setEllipses([]); setStrokes([]); }}
            className="w-full py-1.5 bg-red-600/70 hover:bg-red-600 rounded text-sm flex items-center justify-center gap-1"
          >
            <Trash2 size={12} />
            清空当前切片
          </button>
        </div>
      </div>

      {/* 画布区域 */}
      <div ref={containerRef} className="flex-1 bg-gray-800 rounded-lg border border-gray-700 overflow-auto relative">
        <div className="p-4 min-h-full flex items-center justify-center">
          {selectedVolumeId && loadedImage ? (
            <div className="relative">
              <canvas
                ref={canvasRef}
                onMouseDown={handleMouseDown}
                onMouseMove={handleMouseMove}
                onMouseUp={handleMouseUp}
                onMouseLeave={() => {
                  setIsDrawing(false);
                  setCurrentMousePos(null);
                }}
                className={`border border-gray-600 ${
                  tool === 'auto-fit' ? 'cursor-crosshair' :
                  tool === 'select' ? 'cursor-pointer' :
                  'cursor-crosshair'
                }`}
              />
              
              {/* 状态指示 */}
              <div className="absolute top-2 right-2 flex flex-col gap-1">
                {ellipses.length > 0 && (
                  <div className="bg-black/70 px-2 py-1 rounded text-xs text-yellow-400">
                    🎯 {ellipses.length} 椭圆
                  </div>
                )}
                {isFitting && (
                  <div className="bg-purple-600/80 px-2 py-1 rounded text-xs flex items-center gap-1">
                    <Loader2 size={10} className="animate-spin" />
                    拟合中...
                  </div>
                )}
              </div>

              {/* 当前工具提示 */}
              <div className="absolute bottom-2 left-2 bg-black/70 px-2 py-1 rounded text-xs text-gray-300">
                {tool === 'auto-fit' ? '点击血管中心自动拟合' :
                 tool === 'ellipse' ? '拖拽绘制椭圆' :
                 tool === 'select' ? '点击选择椭圆' :
                 tool === 'brush' ? '绘制血管区域' :
                 '擦除区域'
                }
              </div>
            </div>
          ) : (
            <div className="text-gray-500 text-center">
              <Crosshair size={48} className="mx-auto mb-3 opacity-50" />
              <p>{selectedVolumeId ? '加载中...' : '请选择数据'}</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default AnnotationPage;
</file>

<file path="frontend/src/pages/DataPage.tsx">
/**
 * OCTA 血管网络分析系统 - 数据管理页面
 * 
 * 功能：
 * 1. 上传 DICOM/OCTA 数据
 * 2. 查看已上传的数据列表
 * 3. 预览体数据切片
 * 4. 3D 可视化预览
 */

import React, { useState, useEffect, useCallback } from 'react';
import { 
  Upload, 
  Trash2, 
  Eye, 
  Download, 
  RefreshCw,
  FileText,
  Box,
  Layers
} from 'lucide-react';
import { api } from '../utils/api';

interface VolumeInfo {
  id: string;
  filename: string;
  shape: number[];
  spacing: number[];
  vessel_fraction: number;
  created_at: string;
}

const DataPage: React.FC = () => {
  const [volumes, setVolumes] = useState<VolumeInfo[]>([]);
  const [loading, setLoading] = useState(true);
  const [uploading, setUploading] = useState(false);
  const [selectedVolume, setSelectedVolume] = useState<VolumeInfo | null>(null);
  const [previewAxis, setPreviewAxis] = useState<'x' | 'y' | 'z'>('y');
  const [previewIndex, setPreviewIndex] = useState(0);
  const [previewImage, setPreviewImage] = useState<string | null>(null);

  // 加载数据列表
  const loadVolumes = useCallback(async () => {
    setLoading(true);
    try {
      const response = await api.get('/data/list');
      setVolumes(response.data);
    } catch (error) {
      console.error('加载数据列表失败:', error);
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    loadVolumes();
  }, [loadVolumes]);

  // 上传文件
  const handleUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (!file) return;

    setUploading(true);
    const formData = new FormData();
    formData.append('file', file);

    try {
      const response = await api.post('/data/upload', formData, {
        headers: { 'Content-Type': 'multipart/form-data' }
      });
      
      // 刷新列表
      await loadVolumes();
      
      // 选中新上传的数据
      setSelectedVolume(response.data);
    } catch (error) {
      console.error('上传失败:', error);
      alert('上传失败，请检查文件格式');
    } finally {
      setUploading(false);
    }
  };

  // 删除数据
  const handleDelete = async (volumeId: string) => {
    if (!confirm('确定要删除这个数据吗？')) return;

    try {
      await api.delete(`/data/${volumeId}`);
      await loadVolumes();
      
      if (selectedVolume?.id === volumeId) {
        setSelectedVolume(null);
      }
    } catch (error) {
      console.error('删除失败:', error);
    }
  };

  // 加载切片预览
  const loadPreview = useCallback(async () => {
    if (!selectedVolume) return;

    try {
      const response = await api.get(
        `/data/${selectedVolume.id}/slice/${previewAxis}/${previewIndex}`,
        { responseType: 'blob' }
      );
      
      const url = URL.createObjectURL(response.data);
      setPreviewImage(url);
    } catch (error) {
      console.error('加载预览失败:', error);
    }
  }, [selectedVolume, previewAxis, previewIndex]);

  useEffect(() => {
    loadPreview();
  }, [loadPreview]);

  // 获取当前轴的最大索引
  const getMaxIndex = () => {
    if (!selectedVolume) return 0;
    const axisMap = { x: 0, y: 1, z: 2 };
    return selectedVolume.shape[axisMap[previewAxis]] - 1;
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
      {/* 左侧：数据列表 */}
      <div className="lg:col-span-1 space-y-4">
        {/* 上传按钮 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <label className="block">
            <div className={`
              flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-600 
              rounded-lg cursor-pointer hover:border-blue-500 hover:bg-gray-700/50 transition-all
              ${uploading ? 'opacity-50 cursor-not-allowed' : ''}
            `}>
              <Upload size={32} className="text-gray-400 mb-2" />
              <span className="text-gray-300 font-medium">
                {uploading ? '上传中...' : '点击或拖放文件上传'}
              </span>
              <span className="text-gray-500 text-sm mt-1">
                支持 DICOM, NIfTI, NumPy, MATLAB 格式
              </span>
            </div>
            <input
              type="file"
              className="hidden"
              onChange={handleUpload}
              disabled={uploading}
              accept=".dcm,.dicom,.nii,.nii.gz,.npy,.mat,.zip"
            />
          </label>
        </div>

        {/* 数据列表 */}
        <div className="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
          <div className="flex items-center justify-between px-4 py-3 border-b border-gray-700">
            <h3 className="font-semibold">已上传数据</h3>
            <button 
              onClick={loadVolumes}
              className="p-2 hover:bg-gray-700 rounded-lg transition-colors"
            >
              <RefreshCw size={16} className={loading ? 'animate-spin' : ''} />
            </button>
          </div>
          
          <div className="max-h-96 overflow-y-auto">
            {loading ? (
              <div className="p-8 text-center text-gray-500">加载中...</div>
            ) : volumes.length === 0 ? (
              <div className="p-8 text-center text-gray-500">
                暂无数据，请上传
              </div>
            ) : (
              <div className="divide-y divide-gray-700">
                {volumes.map((vol) => (
                  <div 
                    key={vol.id}
                    className={`
                      p-4 cursor-pointer transition-colors
                      ${selectedVolume?.id === vol.id ? 'bg-blue-600/20' : 'hover:bg-gray-700/50'}
                    `}
                    onClick={() => {
                      setSelectedVolume(vol);
                      setPreviewIndex(Math.floor(vol.shape[1] / 2));
                    }}
                  >
                    <div className="flex items-start justify-between">
                      <div className="flex items-center gap-3">
                        <Box className="text-blue-400" size={20} />
                        <div>
                          <div className="font-medium truncate max-w-[180px]">
                            {vol.filename}
                          </div>
                          <div className="text-sm text-gray-400">
                            {vol.shape.join(' × ')}
                          </div>
                        </div>
                      </div>
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          handleDelete(vol.id);
                        }}
                        className="p-1 hover:bg-red-500/20 rounded text-gray-400 hover:text-red-400"
                      >
                        <Trash2 size={16} />
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      </div>

      {/* 右侧：预览和详情 */}
      <div className="lg:col-span-2 space-y-4">
        {selectedVolume ? (
          <>
            {/* 数据详情 */}
            <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
              <h3 className="font-semibold mb-4">数据详情</h3>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                  <div className="text-gray-400 text-sm">文件名</div>
                  <div className="font-medium truncate">{selectedVolume.filename}</div>
                </div>
                <div>
                  <div className="text-gray-400 text-sm">尺寸</div>
                  <div className="font-medium">{selectedVolume.shape.join(' × ')}</div>
                </div>
                <div>
                  <div className="text-gray-400 text-sm">体素间距</div>
                  <div className="font-medium">
                    {selectedVolume.spacing.map(s => s.toFixed(2)).join(' × ')} μm
                  </div>
                </div>
                <div>
                  <div className="text-gray-400 text-sm">血管占比</div>
                  <div className="font-medium">
                    {(selectedVolume.vessel_fraction * 100).toFixed(2)}%
                  </div>
                </div>
              </div>
            </div>

            {/* 切片预览 */}
            <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-semibold">切片预览</h3>
                <div className="flex items-center gap-2">
                  {(['x', 'y', 'z'] as const).map((axis) => (
                    <button
                      key={axis}
                      onClick={() => {
                        setPreviewAxis(axis);
                        const axisMap = { x: 0, y: 1, z: 2 };
                        setPreviewIndex(Math.floor(selectedVolume.shape[axisMap[axis]] / 2));
                      }}
                      className={`
                        px-3 py-1 rounded-lg text-sm font-medium transition-colors
                        ${previewAxis === axis 
                          ? 'bg-blue-600 text-white' 
                          : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                        }
                      `}
                    >
                      {axis.toUpperCase()} 轴
                    </button>
                  ))}
                </div>
              </div>

              {/* 切片索引滑块 */}
              <div className="mb-4">
                <div className="flex items-center justify-between text-sm text-gray-400 mb-2">
                  <span>切片索引</span>
                  <span>{previewIndex} / {getMaxIndex()}</span>
                </div>
                <input
                  type="range"
                  min={0}
                  max={getMaxIndex()}
                  value={previewIndex}
                  onChange={(e) => setPreviewIndex(parseInt(e.target.value))}
                  className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                />
              </div>

              {/* 预览图像 */}
              <div className="aspect-square bg-black rounded-lg overflow-hidden flex items-center justify-center">
                {previewImage ? (
                  <img 
                    src={previewImage} 
                    alt="切片预览" 
                    className="max-w-full max-h-full object-contain"
                  />
                ) : (
                  <div className="text-gray-500">加载中...</div>
                )}
              </div>
            </div>

            {/* 操作按钮 */}
            <div className="flex gap-3">
              <button className="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                <Eye size={18} />
                3D 预览
              </button>
              <button className="flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors">
                <Download size={18} />
                导出
              </button>
              <button className="flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors">
                <Layers size={18} />
                生成网格
              </button>
            </div>
          </>
        ) : (
          <div className="bg-gray-800 rounded-xl p-8 border border-gray-700 text-center">
            <FileText size={48} className="mx-auto text-gray-600 mb-4" />
            <h3 className="text-lg font-medium text-gray-400">选择一个数据查看详情</h3>
            <p className="text-gray-500 mt-2">
              从左侧列表选择已上传的数据，或上传新的数据文件
            </p>
          </div>
        )}
      </div>
    </div>
  );
};

export default DataPage;
</file>

<file path="frontend/src/pages/HomePage.tsx">
/**
 * OCTA 血管网络分析系统 - 首页
 * 
 * 显示系统概览和快速入口
 */

import React, { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { 
  Database, 
  Edit3, 
  Cpu, 
  Play, 
  Eye,
  ArrowRight,
  FolderOpen,
  Activity
} from 'lucide-react';
import { api } from '../utils/api';

interface SystemStatus {
  status: string;
  data_dir_exists: boolean;
  uploads_count: number;
  models_count: number;
}

const HomePage: React.FC = () => {
  const [systemStatus, setSystemStatus] = useState<SystemStatus | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchStatus = async () => {
      try {
        const response = await api.get('/health');
        setSystemStatus(response.data);
      } catch (error) {
        console.error('获取系统状态失败:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchStatus();
  }, []);

  const features = [
    {
      title: '数据管理',
      description: '导入 DICOM/OCTA 数据，构建 3D 血管网络',
      icon: Database,
      path: '/data',
      color: 'from-blue-500 to-cyan-500'
    },
    {
      title: '标注工具',
      description: '血管横截面手动标注，生成金标准数据',
      icon: Edit3,
      path: '/annotation',
      color: 'from-purple-500 to-pink-500'
    },
    {
      title: '模型训练',
      description: '3D U-Net + Diffusion 深度学习训练',
      icon: Cpu,
      path: '/training',
      color: 'from-orange-500 to-red-500'
    },
    {
      title: '推理预测',
      description: '使用训练好的模型消除拖尾伪影',
      icon: Play,
      path: '/inference',
      color: 'from-green-500 to-teal-500'
    },
    {
      title: '三维可视化',
      description: '交互式血管网络 3D 展示和导出',
      icon: Eye,
      path: '/visualization',
      color: 'from-indigo-500 to-purple-500'
    }
  ];

  return (
    <div className="max-w-6xl mx-auto space-y-8">
      {/* 欢迎区域 */}
      <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-8 text-white">
        <h1 className="text-3xl font-bold mb-4">
          欢迎使用 OCTA 血管网络分析系统
        </h1>
        <p className="text-lg text-blue-100 mb-6 max-w-2xl">
          本系统提供完整的 OCTA 数据处理流程，包括数据导入、标注、深度学习训练和三维可视化。
          通过先进的 3D U-Net 和 Diffusion 模型，自动消除血管拖尾伪影，生成高质量的三维血管网络。
        </p>
        <Link 
          to="/data"
          className="inline-flex items-center gap-2 bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-blue-50 transition-colors"
        >
          <FolderOpen size={20} />
          开始导入数据
          <ArrowRight size={20} />
        </Link>
      </div>

      {/* 系统状态 */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
          <div className="flex items-center gap-3 mb-2">
            <div className={`w-3 h-3 rounded-full ${
              systemStatus?.status === 'healthy' ? 'bg-green-500' : 'bg-yellow-500'
            }`}></div>
            <span className="text-gray-400">系统状态</span>
          </div>
          <p className="text-2xl font-bold">
            {loading ? '检测中...' : systemStatus?.status === 'healthy' ? '正常运行' : '异常'}
          </p>
        </div>
        
        <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
          <div className="flex items-center gap-3 mb-2">
            <Activity size={20} className="text-blue-500" />
            <span className="text-gray-400">已上传数据</span>
          </div>
          <p className="text-2xl font-bold">
            {loading ? '-' : systemStatus?.uploads_count || 0} 个
          </p>
        </div>
        
        <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
          <div className="flex items-center gap-3 mb-2">
            <Cpu size={20} className="text-purple-500" />
            <span className="text-gray-400">训练模型</span>
          </div>
          <p className="text-2xl font-bold">
            {loading ? '-' : systemStatus?.models_count || 0} 个
          </p>
        </div>
      </div>

      {/* 功能入口 */}
      <div>
        <h2 className="text-xl font-semibold mb-4">功能模块</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {features.map((feature) => {
            const Icon = feature.icon;
            return (
              <Link
                key={feature.path}
                to={feature.path}
                className="group bg-gray-800 rounded-xl p-6 border border-gray-700 hover:border-gray-600 transition-all hover:-translate-y-1"
              >
                <div className={`w-12 h-12 rounded-lg bg-gradient-to-br ${feature.color} flex items-center justify-center mb-4`}>
                  <Icon size={24} className="text-white" />
                </div>
                <h3 className="text-lg font-semibold mb-2 group-hover:text-blue-400 transition-colors">
                  {feature.title}
                </h3>
                <p className="text-gray-400 text-sm">
                  {feature.description}
                </p>
              </Link>
            );
          })}
        </div>
      </div>

      {/* 工作流程说明 */}
      <div className="bg-gray-800 rounded-xl p-6 border border-gray-700">
        <h2 className="text-xl font-semibold mb-4">推荐工作流程</h2>
        <div className="flex flex-col md:flex-row items-start md:items-center gap-4">
          {[
            { step: 1, title: '导入数据', desc: '上传 DICOM/OCTA' },
            { step: 2, title: '手动标注', desc: '创建金标准' },
            { step: 3, title: '训练模型', desc: 'U-Net + Diffusion' },
            { step: 4, title: '推理预测', desc: '消除拖尾' },
            { step: 5, title: '可视化', desc: '3D 展示导出' },
          ].map((item, idx, arr) => (
            <React.Fragment key={item.step}>
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-sm font-bold">
                  {item.step}
                </div>
                <div>
                  <div className="font-medium">{item.title}</div>
                  <div className="text-sm text-gray-400">{item.desc}</div>
                </div>
              </div>
              {idx < arr.length - 1 && (
                <ArrowRight className="hidden md:block text-gray-600" size={20} />
              )}
            </React.Fragment>
          ))}
        </div>
      </div>
    </div>
  );
};

export default HomePage;
</file>

<file path="frontend/src/pages/InferencePage.tsx">
/**
 * OCTA 血管网络分析系统 - 推理预测页面
 * 
 * 功能：
 * 1. 选择数据和模型
 * 2. 执行推理
 * 3. 对比显示原始/处理后结果
 * 4. 导出结果
 */

import React, { useState, useEffect, useCallback } from 'react';
import { 
  Play, 
  Download, 
  RefreshCw,
  Layers,
  Eye,
  SplitSquareHorizontal,
  ChevronLeft,
  ChevronRight,
  Check,
  Loader2
} from 'lucide-react';
import { api } from '../utils/api';

interface InferenceTask {
  id: string;
  volume_id: string;
  checkpoint_name: string;
  mode: string;
  status: string;
  created_at: string;
  completed_at?: string;
  metrics?: {
    vessel_voxels: number;
    vessel_fraction: number;
  };
}

const InferencePage: React.FC = () => {
  // 数据状态
  const [volumes, setVolumes] = useState<any[]>([]);
  const [checkpoints, setCheckpoints] = useState<any[]>([]);
  const [tasks, setTasks] = useState<InferenceTask[]>([]);
  
  // 配置
  const [config, setConfig] = useState({
    volume_id: '',
    checkpoint_name: '',
    mode: 'segmentation',
    patch_size: 32,
    overlap: 8,
    threshold: 0.5,
    use_ddim: true,
    ddim_steps: 50
  });
  
  // 当前任务
  const [currentTask, setCurrentTask] = useState<InferenceTask | null>(null);
  const [isRunning, setIsRunning] = useState(false);
  
  // 对比视图
  const [compareMode, setCompareMode] = useState<'slider' | 'side-by-side'>('slider');
  const [sliderPosition, setSliderPosition] = useState(50);
  const [viewAxis, setViewAxis] = useState<'x' | 'y' | 'z'>('y');
  const [sliceIndex, setSliceIndex] = useState(0);
  const [maxSliceIndex, setMaxSliceIndex] = useState(100);
  
  const [originalImage, setOriginalImage] = useState<string>('');
  const [resultImage, setResultImage] = useState<string>('');

  // 加载数据
  useEffect(() => {
    const loadData = async () => {
      try {
        const [volRes, ckptRes, taskRes] = await Promise.all([
          api.get('/data/list'),
          api.get('/training/checkpoints'),
          api.get('/inference/list')
        ]);
        setVolumes(volRes.data);
        setCheckpoints(ckptRes.data);
        setTasks(taskRes.data);
      } catch (error) {
        console.error('加载数据失败:', error);
      }
    };
    loadData();
  }, []);

  // 选择数据后更新切片范围
  useEffect(() => {
    if (!config.volume_id) return;
    
    const volume = volumes.find(v => v.id === config.volume_id);
    if (volume) {
      const axisMap = { x: 0, y: 1, z: 2 };
      const max = volume.shape[axisMap[viewAxis]] - 1;
      setMaxSliceIndex(max);
      setSliceIndex(Math.floor(max / 2));
    }
  }, [config.volume_id, viewAxis, volumes]);

  // 加载对比图像
  const loadCompareImages = useCallback(async () => {
    if (!config.volume_id || !currentTask?.id) return;
    
    try {
      // 加载原始图像
      const origRes = await api.get(
        `/data/${config.volume_id}/slice/${viewAxis}/${sliceIndex}`,
        { responseType: 'blob' }
      );
      setOriginalImage(URL.createObjectURL(origRes.data));
      
      // 加载结果图像
      const resultRes = await api.get(
        `/inference/result/${currentTask.id}/slice/${viewAxis}/${sliceIndex}`,
        { responseType: 'blob' }
      );
      setResultImage(URL.createObjectURL(resultRes.data));
    } catch (error) {
      console.error('加载图像失败:', error);
    }
  }, [config.volume_id, currentTask, viewAxis, sliceIndex]);

  useEffect(() => {
    loadCompareImages();
  }, [loadCompareImages]);

  // 开始推理
  const startInference = async () => {
    if (!config.volume_id || !config.checkpoint_name) {
      alert('请选择数据和模型');
      return;
    }
    
    setIsRunning(true);
    
    try {
      const response = await api.post('/inference/start', config);
      setCurrentTask(response.data);
      
      // 轮询状态
      const pollInterval = setInterval(async () => {
        try {
          const statusRes = await api.get(`/inference/status/${response.data.id}`);
          setCurrentTask(statusRes.data);
          
          if (statusRes.data.status === 'completed' || statusRes.data.status === 'error') {
            clearInterval(pollInterval);
            setIsRunning(false);
            
            // 刷新任务列表
            const taskRes = await api.get('/inference/list');
            setTasks(taskRes.data);
          }
        } catch (error) {
          console.error('获取状态失败:', error);
        }
      }, 2000);
      
    } catch (error: any) {
      alert(error.response?.data?.detail || '启动推理失败');
      setIsRunning(false);
    }
  };

  // 导出结果
  const exportResult = async (format: string) => {
    if (!currentTask?.id) return;
    
    try {
      const response = await api.get(
        `/inference/result/${currentTask.id}/download/${format}`,
        { responseType: 'blob' }
      );
      
      const url = URL.createObjectURL(response.data);
      const a = document.createElement('a');
      a.href = url;
      a.download = `result_${currentTask.id}.${format}`;
      a.click();
      URL.revokeObjectURL(url);
    } catch (error) {
      console.error('导出失败:', error);
      alert('导出失败');
    }
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-4 gap-6 h-full">
      {/* 左侧：配置面板 */}
      <div className="lg:col-span-1 space-y-4">
        {/* 数据选择 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <h3 className="font-semibold mb-4">推理配置</h3>
          
          <div className="space-y-4">
            <div>
              <label className="block text-sm text-gray-400 mb-1">输入数据</label>
              <select
                value={config.volume_id}
                onChange={(e) => setConfig({ ...config, volume_id: e.target.value })}
                className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
              >
                <option value="">选择数据...</option>
                {volumes.map(vol => (
                  <option key={vol.id} value={vol.id}>{vol.filename}</option>
                ))}
              </select>
            </div>
            
            <div>
              <label className="block text-sm text-gray-400 mb-1">模型检查点</label>
              <select
                value={config.checkpoint_name}
                onChange={(e) => setConfig({ ...config, checkpoint_name: e.target.value })}
                className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
              >
                <option value="">选择模型...</option>
                {checkpoints.map(ckpt => (
                  <option key={ckpt.name} value={ckpt.name}>{ckpt.name}</option>
                ))}
              </select>
            </div>
            
            <div>
              <label className="block text-sm text-gray-400 mb-1">推理模式</label>
              <select
                value={config.mode}
                onChange={(e) => setConfig({ ...config, mode: e.target.value })}
                className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
              >
                <option value="segmentation">仅分割网络</option>
                <option value="diffusion">仅扩散网络</option>
                <option value="combined">级联推理</option>
              </select>
            </div>
            
            <div>
              <label className="block text-sm text-gray-400 mb-1">阈值</label>
              <input
                type="range"
                min={0}
                max={1}
                step={0.05}
                value={config.threshold}
                onChange={(e) => setConfig({ ...config, threshold: parseFloat(e.target.value) })}
                className="w-full"
              />
              <div className="text-center text-sm text-gray-400">{config.threshold}</div>
            </div>
            
            {config.mode !== 'segmentation' && (
              <div className="space-y-2">
                <label className="flex items-center gap-2">
                  <input
                    type="checkbox"
                    checked={config.use_ddim}
                    onChange={(e) => setConfig({ ...config, use_ddim: e.target.checked })}
                  />
                  <span className="text-sm">使用 DDIM 加速采样</span>
                </label>
                
                {config.use_ddim && (
                  <div>
                    <label className="block text-sm text-gray-400 mb-1">DDIM 步数</label>
                    <input
                      type="number"
                      value={config.ddim_steps}
                      onChange={(e) => setConfig({ ...config, ddim_steps: parseInt(e.target.value) })}
                      className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
                    />
                  </div>
                )}
              </div>
            )}
          </div>
        </div>

        {/* 开始推理按钮 */}
        <button
          onClick={startInference}
          disabled={isRunning || !config.volume_id || !config.checkpoint_name}
          className={`
            w-full flex items-center justify-center gap-2 py-3 rounded-lg transition-colors
            ${isRunning 
              ? 'bg-gray-600 cursor-not-allowed' 
              : 'bg-blue-600 hover:bg-blue-700'
            }
          `}
        >
          {isRunning ? (
            <>
              <Loader2 size={18} className="animate-spin" />
              推理中...
            </>
          ) : (
            <>
              <Play size={18} />
              开始推理
            </>
          )}
        </button>

        {/* 任务状态 */}
        {currentTask && (
          <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
            <h3 className="font-semibold mb-3">当前任务</h3>
            <div className="space-y-2 text-sm">
              <div className="flex justify-between">
                <span className="text-gray-400">状态</span>
                <span className={
                  currentTask.status === 'completed' ? 'text-green-500' :
                  currentTask.status === 'running' ? 'text-blue-500' :
                  currentTask.status === 'error' ? 'text-red-500' : 'text-gray-400'
                }>
                  {currentTask.status}
                </span>
              </div>
              {currentTask.metrics && (
                <>
                  <div className="flex justify-between">
                    <span className="text-gray-400">血管体素</span>
                    <span>{currentTask.metrics.vessel_voxels.toLocaleString()}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-400">占比</span>
                    <span>{(currentTask.metrics.vessel_fraction * 100).toFixed(2)}%</span>
                  </div>
                </>
              )}
            </div>
          </div>
        )}

        {/* 导出按钮 */}
        {currentTask?.status === 'completed' && (
          <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
            <h3 className="font-semibold mb-3">导出结果</h3>
            <div className="grid grid-cols-2 gap-2">
              <button
                onClick={() => exportResult('npy')}
                className="flex items-center justify-center gap-1 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"
              >
                <Download size={14} />
                NumPy
              </button>
              <button
                onClick={() => exportResult('nii')}
                className="flex items-center justify-center gap-1 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"
              >
                <Download size={14} />
                NIfTI
              </button>
              <button
                onClick={() => exportResult('stl')}
                className="flex items-center justify-center gap-1 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"
              >
                <Layers size={14} />
                STL
              </button>
              <button
                onClick={() => exportResult('ply')}
                className="flex items-center justify-center gap-1 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"
              >
                <Layers size={14} />
                PLY
              </button>
            </div>
          </div>
        )}

        {/* 历史任务 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <div className="flex items-center justify-between mb-3">
            <h3 className="font-semibold">历史任务</h3>
            <button
              onClick={async () => {
                const res = await api.get('/inference/list');
                setTasks(res.data);
              }}
              className="p-1 hover:bg-gray-700 rounded"
            >
              <RefreshCw size={14} />
            </button>
          </div>
          
          <div className="space-y-2 max-h-48 overflow-y-auto">
            {tasks.length > 0 ? (
              tasks.map(task => (
                <div
                  key={task.id}
                  onClick={() => {
                    setCurrentTask(task);
                    setConfig({ ...config, volume_id: task.volume_id });
                  }}
                  className={`
                    p-2 rounded-lg cursor-pointer transition-colors
                    ${currentTask?.id === task.id 
                      ? 'bg-blue-600/20 border border-blue-600' 
                      : 'bg-gray-700/50 hover:bg-gray-700'
                    }
                  `}
                >
                  <div className="text-sm font-medium truncate">{task.id}</div>
                  <div className="flex items-center gap-2 text-xs text-gray-400">
                    <span className={
                      task.status === 'completed' ? 'text-green-500' : 'text-gray-500'
                    }>
                      {task.status}
                    </span>
                    <span>{task.mode}</span>
                  </div>
                </div>
              ))
            ) : (
              <div className="text-center text-gray-500 py-4 text-sm">
                暂无历史任务
              </div>
            )}
          </div>
        </div>
      </div>

      {/* 右侧：对比视图 */}
      <div className="lg:col-span-3 space-y-4">
        {/* 视图控制 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <div className="flex items-center justify-between flex-wrap gap-4">
            {/* 对比模式 */}
            <div className="flex items-center gap-2">
              <span className="text-sm text-gray-400">对比模式:</span>
              <button
                onClick={() => setCompareMode('slider')}
                className={`p-2 rounded-lg transition-colors ${
                  compareMode === 'slider' ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'
                }`}
                title="滑动对比"
              >
                <SplitSquareHorizontal size={18} />
              </button>
              <button
                onClick={() => setCompareMode('side-by-side')}
                className={`p-2 rounded-lg transition-colors ${
                  compareMode === 'side-by-side' ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'
                }`}
                title="并排对比"
              >
                <Eye size={18} />
              </button>
            </div>
            
            {/* 轴向选择 */}
            <div className="flex items-center gap-2">
              {(['x', 'y', 'z'] as const).map(axis => (
                <button
                  key={axis}
                  onClick={() => setViewAxis(axis)}
                  className={`
                    px-3 py-1 rounded-lg text-sm font-medium transition-colors
                    ${viewAxis === axis
                      ? 'bg-blue-600 text-white'
                      : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                    }
                  `}
                >
                  {axis.toUpperCase()} 轴
                </button>
              ))}
            </div>
            
            {/* 切片导航 */}
            <div className="flex items-center gap-2">
              <button
                onClick={() => setSliceIndex(Math.max(0, sliceIndex - 1))}
                className="p-2 bg-gray-700 rounded-lg hover:bg-gray-600"
              >
                <ChevronLeft size={18} />
              </button>
              <span className="text-sm min-w-[80px] text-center">
                {sliceIndex} / {maxSliceIndex}
              </span>
              <button
                onClick={() => setSliceIndex(Math.min(maxSliceIndex, sliceIndex + 1))}
                className="p-2 bg-gray-700 rounded-lg hover:bg-gray-600"
              >
                <ChevronRight size={18} />
              </button>
            </div>
          </div>
          
          {/* 切片滑块 */}
          <div className="mt-4">
            <input
              type="range"
              min={0}
              max={maxSliceIndex}
              value={sliceIndex}
              onChange={(e) => setSliceIndex(parseInt(e.target.value))}
              className="w-full"
            />
          </div>
        </div>

        {/* 对比显示区域 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700 flex-1">
          {currentTask?.status === 'completed' ? (
            compareMode === 'slider' ? (
              // 滑动对比模式
              <div className="relative aspect-square max-h-[600px] mx-auto overflow-hidden">
                {/* 原始图像（底层） */}
                <div className="absolute inset-0">
                  <img 
                    src={originalImage} 
                    alt="原始" 
                    className="w-full h-full object-contain"
                  />
                  <div className="absolute top-2 left-2 bg-black/50 px-2 py-1 rounded text-xs">
                    原始
                  </div>
                </div>
                
                {/* 结果图像（通过 clip 显示） */}
                <div 
                  className="absolute inset-0"
                  style={{ 
                    clipPath: `inset(0 ${100 - sliderPosition}% 0 0)` 
                  }}
                >
                  <img 
                    src={resultImage} 
                    alt="结果" 
                    className="w-full h-full object-contain"
                  />
                  <div className="absolute top-2 left-2 bg-green-600/50 px-2 py-1 rounded text-xs">
                    处理后
                  </div>
                </div>
                
                {/* 滑块 */}
                <div
                  className="absolute top-0 bottom-0 w-1 bg-white cursor-ew-resize"
                  style={{ left: `${sliderPosition}%` }}
                  onMouseDown={(e) => {
                    const container = e.currentTarget.parentElement;
                    if (!container) return;
                    
                    const handleMove = (moveEvent: MouseEvent) => {
                      const rect = container.getBoundingClientRect();
                      const x = moveEvent.clientX - rect.left;
                      const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
                      setSliderPosition(percent);
                    };
                    
                    const handleUp = () => {
                      document.removeEventListener('mousemove', handleMove);
                      document.removeEventListener('mouseup', handleUp);
                    };
                    
                    document.addEventListener('mousemove', handleMove);
                    document.addEventListener('mouseup', handleUp);
                  }}
                >
                  <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 bg-white rounded-full shadow-lg flex items-center justify-center">
                    <SplitSquareHorizontal size={14} className="text-gray-800" />
                  </div>
                </div>
              </div>
            ) : (
              // 并排对比模式
              <div className="grid grid-cols-2 gap-4">
                <div className="relative aspect-square bg-black rounded-lg overflow-hidden">
                  <img 
                    src={originalImage} 
                    alt="原始" 
                    className="w-full h-full object-contain"
                  />
                  <div className="absolute top-2 left-2 bg-black/50 px-2 py-1 rounded text-xs">
                    原始
                  </div>
                </div>
                <div className="relative aspect-square bg-black rounded-lg overflow-hidden">
                  <img 
                    src={resultImage} 
                    alt="结果" 
                    className="w-full h-full object-contain"
                  />
                  <div className="absolute top-2 left-2 bg-green-600/50 px-2 py-1 rounded text-xs">
                    处理后
                  </div>
                </div>
              </div>
            )
          ) : (
            <div className="h-96 flex flex-col items-center justify-center text-gray-500">
              {isRunning ? (
                <>
                  <Loader2 size={48} className="animate-spin mb-4" />
                  <p>正在处理中，请稍候...</p>
                </>
              ) : (
                <>
                  <Eye size={48} className="mb-4" />
                  <p>选择数据和模型后点击开始推理</p>
                  <p className="text-sm mt-2">推理完成后可在此查看对比结果</p>
                </>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default InferencePage;
</file>

<file path="frontend/src/pages/TrainingPage.tsx">
/**
 * OCTA 血管网络分析系统 - 模型训练页面
 * 
 * 功能：
 * 1. 配置训练参数
 * 2. 启动/停止训练
 * 3. 实时显示训练进度
 * 4. 显示 Loss 曲线
 */

import React, { useState, useEffect, useCallback } from 'react';
import { 
  Play, 
  Pause, 
  Square, 
  RefreshCw,
  Settings,
  Activity,
  TrendingDown,
  Clock,
  CheckCircle,
  AlertCircle
} from 'lucide-react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';
import { api } from '../utils/api';

interface TrainingState {
  status: string;
  current_epoch: number;
  total_epochs: number;
  current_step: number;
  total_steps: number;
  train_loss: number;
  val_loss: number;
  best_loss: number;
  train_losses: number[];
  val_losses: number[];
  dice_scores: number[];
  elapsed_time: number;
  eta: number;
  message: string;
}

const TrainingPage: React.FC = () => {
  // 数据状态
  const [volumes, setVolumes] = useState<any[]>([]);
  const [projects, setProjects] = useState<any[]>([]);
  const [checkpoints, setCheckpoints] = useState<any[]>([]);
  
  // 配置
  const [config, setConfig] = useState({
    volume_id: '',
    annotation_project_id: '',
    mode: 'segmentation',
    epochs: 100,
    batch_size: 4,
    learning_rate: 0.0001,
    patch_size: 32,
    diffusion_timesteps: 1000,
    diffusion_beta_schedule: 'cosine'
  });
  
  // 训练状态
  const [trainingState, setTrainingState] = useState<TrainingState | null>(null);
  const [isPolling, setIsPolling] = useState(false);

  // 加载数据
  useEffect(() => {
    const loadData = async () => {
      try {
        const [volRes, projRes, ckptRes] = await Promise.all([
          api.get('/data/list'),
          api.get('/annotation/projects'),
          api.get('/training/checkpoints')
        ]);
        setVolumes(volRes.data);
        setProjects(projRes.data);
        setCheckpoints(ckptRes.data);
      } catch (error) {
        console.error('加载数据失败:', error);
      }
    };
    loadData();
  }, []);

  // 轮询训练状态
  const pollStatus = useCallback(async () => {
    try {
      const response = await api.get('/training/status');
      setTrainingState(response.data);
      
      // 如果训练正在进行，继续轮询
      if (response.data.status === 'running') {
        setIsPolling(true);
      } else {
        setIsPolling(false);
      }
    } catch (error) {
      console.error('获取状态失败:', error);
    }
  }, []);

  useEffect(() => {
    pollStatus();
  }, [pollStatus]);

  useEffect(() => {
    let interval: NodeJS.Timeout;
    if (isPolling) {
      interval = setInterval(pollStatus, 2000);
    }
    return () => clearInterval(interval);
  }, [isPolling, pollStatus]);

  // 启动训练
  const startTraining = async () => {
    if (!config.volume_id || !config.annotation_project_id) {
      alert('请选择训练数据和标注项目');
      return;
    }
    
    try {
      await api.post('/training/start', config);
      setIsPolling(true);
      pollStatus();
    } catch (error: any) {
      alert(error.response?.data?.detail || '启动训练失败');
    }
  };

  // 暂停训练
  const pauseTraining = async () => {
    try {
      await api.post('/training/pause');
      pollStatus();
    } catch (error) {
      console.error('暂停失败:', error);
    }
  };

  // 恢复训练
  const resumeTraining = async () => {
    try {
      await api.post('/training/resume');
      setIsPolling(true);
    } catch (error) {
      console.error('恢复失败:', error);
    }
  };

  // 停止训练
  const stopTraining = async () => {
    if (!confirm('确定要停止训练吗？')) return;
    
    try {
      await api.post('/training/stop');
      setIsPolling(false);
      pollStatus();
    } catch (error) {
      console.error('停止失败:', error);
    }
  };

  // 格式化时间
  const formatTime = (seconds: number): string => {
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = Math.floor(seconds % 60);
    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
  };

  // 准备图表数据
  const chartData = trainingState?.train_losses.map((loss, idx) => ({
    epoch: idx + 1,
    train_loss: loss,
    val_loss: trainingState.val_losses[idx] || null,
    dice: trainingState.dice_scores[idx] || null
  })) || [];

  // 状态颜色
  const getStatusColor = (status: string) => {
    switch (status) {
      case 'running': return 'text-green-500';
      case 'paused': return 'text-yellow-500';
      case 'completed': return 'text-blue-500';
      case 'error': return 'text-red-500';
      default: return 'text-gray-500';
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'running': return <Activity className="animate-pulse" />;
      case 'paused': return <Pause />;
      case 'completed': return <CheckCircle />;
      case 'error': return <AlertCircle />;
      default: return <Clock />;
    }
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
      {/* 左侧：配置面板 */}
      <div className="lg:col-span-1 space-y-4">
        {/* 数据选择 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <h3 className="font-semibold mb-4 flex items-center gap-2">
            <Settings size={18} />
            训练配置
          </h3>
          
          <div className="space-y-4">
            {/* 数据选择 */}
            <div>
              <label className="block text-sm text-gray-400 mb-1">训练数据</label>
              <select
                value={config.volume_id}
                onChange={(e) => setConfig({ ...config, volume_id: e.target.value })}
                className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
              >
                <option value="">选择数据...</option>
                {volumes.map(vol => (
                  <option key={vol.id} value={vol.id}>{vol.filename}</option>
                ))}
              </select>
            </div>
            
            {/* 标注项目 */}
            <div>
              <label className="block text-sm text-gray-400 mb-1">标注项目</label>
              <select
                value={config.annotation_project_id}
                onChange={(e) => setConfig({ ...config, annotation_project_id: e.target.value })}
                className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
              >
                <option value="">选择项目...</option>
                {projects.map(proj => (
                  <option key={proj.id} value={proj.id}>{proj.name}</option>
                ))}
              </select>
            </div>
            
            {/* 训练模式 */}
            <div>
              <label className="block text-sm text-gray-400 mb-1">训练模式</label>
              <select
                value={config.mode}
                onChange={(e) => setConfig({ ...config, mode: e.target.value })}
                className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
              >
                <option value="segmentation">仅分割网络 (3D U-Net)</option>
                <option value="diffusion">仅扩散网络 (Diffusion)</option>
                <option value="combined">级联训练 (分割 + 扩散)</option>
              </select>
            </div>
          </div>
        </div>

        {/* 超参数 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <h3 className="font-semibold mb-4">超参数</h3>
          
          <div className="space-y-4">
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm text-gray-400 mb-1">Epochs</label>
                <input
                  type="number"
                  value={config.epochs}
                  onChange={(e) => setConfig({ ...config, epochs: parseInt(e.target.value) })}
                  className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
                />
              </div>
              <div>
                <label className="block text-sm text-gray-400 mb-1">Batch Size</label>
                <input
                  type="number"
                  value={config.batch_size}
                  onChange={(e) => setConfig({ ...config, batch_size: parseInt(e.target.value) })}
                  className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
                />
              </div>
            </div>
            
            <div>
              <label className="block text-sm text-gray-400 mb-1">学习率</label>
              <input
                type="number"
                step="0.0001"
                value={config.learning_rate}
                onChange={(e) => setConfig({ ...config, learning_rate: parseFloat(e.target.value) })}
                className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
              />
            </div>
            
            <div>
              <label className="block text-sm text-gray-400 mb-1">Patch Size</label>
              <select
                value={config.patch_size}
                onChange={(e) => setConfig({ ...config, patch_size: parseInt(e.target.value) })}
                className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
              >
                <option value={32}>32×32×32</option>
                <option value={48}>48×48×48</option>
                <option value={64}>64×64×64</option>
              </select>
            </div>
            
            {config.mode !== 'segmentation' && (
              <>
                <div>
                  <label className="block text-sm text-gray-400 mb-1">Diffusion 步数</label>
                  <input
                    type="number"
                    value={config.diffusion_timesteps}
                    onChange={(e) => setConfig({ ...config, diffusion_timesteps: parseInt(e.target.value) })}
                    className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
                  />
                </div>
                
                <div>
                  <label className="block text-sm text-gray-400 mb-1">噪声调度</label>
                  <select
                    value={config.diffusion_beta_schedule}
                    onChange={(e) => setConfig({ ...config, diffusion_beta_schedule: e.target.value })}
                    className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
                  >
                    <option value="cosine">余弦 (推荐)</option>
                    <option value="linear">线性</option>
                    <option value="quadratic">二次</option>
                  </select>
                </div>
              </>
            )}
          </div>
        </div>

        {/* 控制按钮 */}
        <div className="flex gap-2">
          {trainingState?.status === 'running' ? (
            <>
              <button
                onClick={pauseTraining}
                className="flex-1 flex items-center justify-center gap-2 py-3 bg-yellow-600 hover:bg-yellow-700 rounded-lg transition-colors"
              >
                <Pause size={18} />
                暂停
              </button>
              <button
                onClick={stopTraining}
                className="flex-1 flex items-center justify-center gap-2 py-3 bg-red-600 hover:bg-red-700 rounded-lg transition-colors"
              >
                <Square size={18} />
                停止
              </button>
            </>
          ) : trainingState?.status === 'paused' ? (
            <>
              <button
                onClick={resumeTraining}
                className="flex-1 flex items-center justify-center gap-2 py-3 bg-green-600 hover:bg-green-700 rounded-lg transition-colors"
              >
                <Play size={18} />
                继续
              </button>
              <button
                onClick={stopTraining}
                className="flex-1 flex items-center justify-center gap-2 py-3 bg-red-600 hover:bg-red-700 rounded-lg transition-colors"
              >
                <Square size={18} />
                停止
              </button>
            </>
          ) : (
            <button
              onClick={startTraining}
              className="flex-1 flex items-center justify-center gap-2 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors"
            >
              <Play size={18} />
              开始训练
            </button>
          )}
        </div>
      </div>

      {/* 右侧：训练状态和图表 */}
      <div className="lg:col-span-2 space-y-4">
        {/* 状态概览 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <div className="flex items-center justify-between mb-4">
            <h3 className="font-semibold">训练状态</h3>
            <div className={`flex items-center gap-2 ${getStatusColor(trainingState?.status || 'idle')}`}>
              {getStatusIcon(trainingState?.status || 'idle')}
              <span className="capitalize">{trainingState?.status || 'idle'}</span>
            </div>
          </div>
          
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div className="bg-gray-700/50 rounded-lg p-3">
              <div className="text-sm text-gray-400">Epoch</div>
              <div className="text-xl font-bold">
                {trainingState?.current_epoch || 0} / {trainingState?.total_epochs || config.epochs}
              </div>
            </div>
            <div className="bg-gray-700/50 rounded-lg p-3">
              <div className="text-sm text-gray-400">训练 Loss</div>
              <div className="text-xl font-bold">
                {trainingState?.train_loss?.toFixed(4) || '-'}
              </div>
            </div>
            <div className="bg-gray-700/50 rounded-lg p-3">
              <div className="text-sm text-gray-400">验证 Loss</div>
              <div className="text-xl font-bold">
                {trainingState?.val_loss?.toFixed(4) || '-'}
              </div>
            </div>
            <div className="bg-gray-700/50 rounded-lg p-3">
              <div className="text-sm text-gray-400">最佳 Loss</div>
              <div className="text-xl font-bold text-green-500">
                {trainingState?.best_loss < Infinity ? trainingState.best_loss.toFixed(4) : '-'}
              </div>
            </div>
          </div>
          
          {/* 进度条 */}
          {trainingState?.status === 'running' && (
            <div className="mt-4">
              <div className="flex justify-between text-sm text-gray-400 mb-2">
                <span>训练进度</span>
                <span>{((trainingState.current_epoch / trainingState.total_epochs) * 100).toFixed(1)}%</span>
              </div>
              <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                <div 
                  className="h-full bg-blue-600 transition-all"
                  style={{ width: `${(trainingState.current_epoch / trainingState.total_epochs) * 100}%` }}
                />
              </div>
              <div className="flex justify-between text-sm text-gray-400 mt-2">
                <span>已用时间: {formatTime(trainingState.elapsed_time)}</span>
                <span>预计剩余: {formatTime(trainingState.eta)}</span>
              </div>
            </div>
          )}
        </div>

        {/* Loss 曲线 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <h3 className="font-semibold mb-4 flex items-center gap-2">
            <TrendingDown size={18} />
            Loss 曲线
          </h3>
          
          {chartData.length > 0 ? (
            <div className="h-64">
              <ResponsiveContainer width="100%" height="100%">
                <LineChart data={chartData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                  <XAxis dataKey="epoch" stroke="#9CA3AF" />
                  <YAxis stroke="#9CA3AF" />
                  <Tooltip 
                    contentStyle={{ 
                      backgroundColor: '#1F2937', 
                      border: '1px solid #374151',
                      borderRadius: '8px'
                    }} 
                  />
                  <Legend />
                  <Line 
                    type="monotone" 
                    dataKey="train_loss" 
                    stroke="#3B82F6" 
                    name="训练 Loss"
                    dot={false}
                  />
                  <Line 
                    type="monotone" 
                    dataKey="val_loss" 
                    stroke="#10B981" 
                    name="验证 Loss"
                    dot={false}
                  />
                </LineChart>
              </ResponsiveContainer>
            </div>
          ) : (
            <div className="h-64 flex items-center justify-center text-gray-500">
              开始训练后将显示 Loss 曲线
            </div>
          )}
        </div>

        {/* 模型检查点 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <div className="flex items-center justify-between mb-4">
            <h3 className="font-semibold">模型检查点</h3>
            <button 
              onClick={async () => {
                const res = await api.get('/training/checkpoints');
                setCheckpoints(res.data);
              }}
              className="p-2 hover:bg-gray-700 rounded-lg"
            >
              <RefreshCw size={16} />
            </button>
          </div>
          
          {checkpoints.length > 0 ? (
            <div className="space-y-2 max-h-48 overflow-y-auto">
              {checkpoints.map(ckpt => (
                <div 
                  key={ckpt.name}
                  className="flex items-center justify-between p-3 bg-gray-700/50 rounded-lg"
                >
                  <div>
                    <div className="font-medium">{ckpt.name}</div>
                    <div className="text-sm text-gray-400">
                      {ckpt.size_mb.toFixed(2)} MB
                    </div>
                  </div>
                  <div className="text-sm text-gray-400">
                    {new Date(ckpt.modified_at).toLocaleString()}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center text-gray-500 py-8">
              暂无检查点
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default TrainingPage;
</file>

<file path="frontend/src/pages/VisualizationPage.tsx">
/**
 * OCTA 血管网络分析系统 - 三维可视化页面
 * 
 * 功能：
 * 1. 3D 血管网络渲染
 * 2. 交互控制（旋转、缩放、平移）
 * 3. 显示模式切换
 * 4. 网格导出
 */

import React, { useState, useEffect, useRef, Suspense } from 'react';
import { Canvas, useThree, useFrame } from '@react-three/fiber';
import { OrbitControls, PerspectiveCamera, Environment } from '@react-three/drei';
import * as THREE from 'three';
import { 
  Box, 
  Layers, 
  Sun,
  Moon,
  RotateCcw,
  Download,
  Settings,
  Eye,
  Grid,
  Maximize2
} from 'lucide-react';
import { api } from '../utils/api';

// ============================================================================
// 3D 组件
// ============================================================================

interface VesselMeshProps {
  meshUrl: string | null;
  color: string;
  opacity: number;
  wireframe: boolean;
}

const VesselMesh: React.FC<VesselMeshProps> = ({ meshUrl, color, opacity, wireframe }) => {
  const meshRef = useRef<THREE.Mesh>(null);
  const [geometry, setGeometry] = useState<THREE.BufferGeometry | null>(null);

  useEffect(() => {
    if (!meshUrl) return;

    // 加载网格数据
    const loadMesh = async () => {
      try {
        const response = await fetch(meshUrl);
        const data = await response.json();
        
        // 创建几何体
        const geo = new THREE.BufferGeometry();
        geo.setAttribute('position', new THREE.Float32BufferAttribute(data.vertices.flat(), 3));
        geo.setIndex(data.faces.flat());
        geo.computeVertexNormals();
        
        // 居中
        geo.center();
        
        setGeometry(geo);
      } catch (error) {
        console.error('加载网格失败:', error);
      }
    };

    loadMesh();
  }, [meshUrl]);

  // 自动旋转
  useFrame((state) => {
    if (meshRef.current && !state.controls) {
      meshRef.current.rotation.y += 0.002;
    }
  });

  if (!geometry) return null;

  return (
    <mesh ref={meshRef} geometry={geometry}>
      <meshStandardMaterial
        color={color}
        transparent={opacity < 1}
        opacity={opacity}
        wireframe={wireframe}
        side={THREE.DoubleSide}
      />
    </mesh>
  );
};

// 坐标轴辅助线
const AxesHelper: React.FC<{ size: number }> = ({ size }) => {
  return <primitive object={new THREE.AxesHelper(size)} />;
};

// 网格辅助线
const GridHelper: React.FC<{ size: number; divisions: number }> = ({ size, divisions }) => {
  return <primitive object={new THREE.GridHelper(size, divisions, '#444', '#333')} />;
};

// 场景控制器
const SceneController: React.FC<{ onReset: () => void }> = ({ onReset }) => {
  const { camera, controls } = useThree();
  
  useEffect(() => {
    if (controls) {
      (controls as any).addEventListener('change', () => {
        // 可以在这里添加控制变化的处理
      });
    }
  }, [controls]);

  return null;
};

// ============================================================================
// 主页面组件
// ============================================================================

const VisualizationPage: React.FC = () => {
  // 数据状态
  const [volumes, setVolumes] = useState<any[]>([]);
  const [inferenceResults, setInferenceResults] = useState<any[]>([]);
  const [selectedSource, setSelectedSource] = useState<string>('');
  const [sourceType, setSourceType] = useState<'volume' | 'inference'>('volume');
  
  // 网格状态
  const [meshUrl, setMeshUrl] = useState<string | null>(null);
  const [isGenerating, setIsGenerating] = useState(false);
  
  // 显示设置
  const [settings, setSettings] = useState({
    color: '#ff6b6b',
    opacity: 1.0,
    wireframe: false,
    showAxes: true,
    showGrid: true,
    autoRotate: true,
    backgroundColor: '#1a1a2e',
    threshold: 0.5
  });

  // 加载数据列表
  useEffect(() => {
    const loadData = async () => {
      try {
        const [volRes, infRes] = await Promise.all([
          api.get('/data/list'),
          api.get('/inference/list')
        ]);
        setVolumes(volRes.data);
        setInferenceResults(infRes.data.filter((r: any) => r.status === 'completed'));
      } catch (error) {
        console.error('加载数据失败:', error);
      }
    };
    loadData();
  }, []);

  // 生成网格
  const generateMesh = async () => {
    if (!selectedSource) return;
    
    setIsGenerating(true);
    
    try {
      let response;
      
      if (sourceType === 'volume') {
        response = await api.post(`/data/${selectedSource}/mesh`, {
          threshold: settings.threshold,
          smooth: true
        });
      } else {
        // 从推理结果生成
        response = await api.post(`/inference/result/${selectedSource}/mesh`, {
          threshold: settings.threshold,
          smooth: true
        });
      }
      
      // 获取网格数据 URL
      setMeshUrl(`${api.defaults.baseURL}/data/${selectedSource}/mesh-data`);
    } catch (error) {
      console.error('生成网格失败:', error);
      alert('生成网格失败');
    } finally {
      setIsGenerating(false);
    }
  };

  // 导出网格
  const exportMesh = async (format: string) => {
    if (!selectedSource) return;
    
    try {
      const response = await api.get(
        sourceType === 'volume'
          ? `/data/${selectedSource}/export/${format}`
          : `/inference/result/${selectedSource}/download/${format}`,
        { responseType: 'blob' }
      );
      
      const url = URL.createObjectURL(response.data);
      const a = document.createElement('a');
      a.href = url;
      a.download = `vessel_mesh.${format}`;
      a.click();
      URL.revokeObjectURL(url);
    } catch (error) {
      console.error('导出失败:', error);
    }
  };

  // 重置视图
  const resetView = () => {
    // 触发 Canvas 重新渲染
    setMeshUrl(meshUrl);
  };

  return (
    <div className="flex h-full gap-4">
      {/* 左侧：控制面板 */}
      <div className="w-72 space-y-4 flex-shrink-0 overflow-y-auto">
        {/* 数据源选择 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <h3 className="font-semibold mb-4 flex items-center gap-2">
            <Box size={18} />
            数据源
          </h3>
          
          <div className="space-y-3">
            <div className="flex gap-2">
              <button
                onClick={() => setSourceType('volume')}
                className={`flex-1 py-2 rounded-lg text-sm transition-colors ${
                  sourceType === 'volume' 
                    ? 'bg-blue-600' 
                    : 'bg-gray-700 hover:bg-gray-600'
                }`}
              >
                原始数据
              </button>
              <button
                onClick={() => setSourceType('inference')}
                className={`flex-1 py-2 rounded-lg text-sm transition-colors ${
                  sourceType === 'inference' 
                    ? 'bg-blue-600' 
                    : 'bg-gray-700 hover:bg-gray-600'
                }`}
              >
                推理结果
              </button>
            </div>
            
            <select
              value={selectedSource}
              onChange={(e) => setSelectedSource(e.target.value)}
              className="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"
            >
              <option value="">选择数据...</option>
              {sourceType === 'volume' 
                ? volumes.map(vol => (
                    <option key={vol.id} value={vol.id}>{vol.filename}</option>
                  ))
                : inferenceResults.map(res => (
                    <option key={res.task_id} value={res.task_id}>{res.task_id}</option>
                  ))
              }
            </select>
            
            <div>
              <label className="block text-sm text-gray-400 mb-1">阈值</label>
              <div className="flex items-center gap-2">
                <input
                  type="range"
                  min={0}
                  max={1}
                  step={0.05}
                  value={settings.threshold}
                  onChange={(e) => setSettings({ ...settings, threshold: parseFloat(e.target.value) })}
                  className="flex-1"
                />
                <span className="text-sm w-12 text-right">{settings.threshold}</span>
              </div>
            </div>
            
            <button
              onClick={generateMesh}
              disabled={!selectedSource || isGenerating}
              className={`w-full py-2 rounded-lg transition-colors ${
                isGenerating 
                  ? 'bg-gray-600 cursor-not-allowed' 
                  : 'bg-blue-600 hover:bg-blue-700'
              }`}
            >
              {isGenerating ? '生成中...' : '生成 3D 网格'}
            </button>
          </div>
        </div>

        {/* 显示设置 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <h3 className="font-semibold mb-4 flex items-center gap-2">
            <Settings size={18} />
            显示设置
          </h3>
          
          <div className="space-y-4">
            {/* 颜色 */}
            <div>
              <label className="block text-sm text-gray-400 mb-1">血管颜色</label>
              <div className="flex gap-2">
                {['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dfe6e9'].map(color => (
                  <button
                    key={color}
                    onClick={() => setSettings({ ...settings, color })}
                    className={`w-8 h-8 rounded-lg transition-transform ${
                      settings.color === color ? 'ring-2 ring-white scale-110' : ''
                    }`}
                    style={{ backgroundColor: color }}
                  />
                ))}
              </div>
            </div>
            
            {/* 透明度 */}
            <div>
              <label className="block text-sm text-gray-400 mb-1">透明度</label>
              <input
                type="range"
                min={0.1}
                max={1}
                step={0.1}
                value={settings.opacity}
                onChange={(e) => setSettings({ ...settings, opacity: parseFloat(e.target.value) })}
                className="w-full"
              />
            </div>
            
            {/* 切换选项 */}
            <div className="space-y-2">
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={settings.wireframe}
                  onChange={(e) => setSettings({ ...settings, wireframe: e.target.checked })}
                />
                <span className="text-sm">线框模式</span>
              </label>
              
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={settings.showAxes}
                  onChange={(e) => setSettings({ ...settings, showAxes: e.target.checked })}
                />
                <span className="text-sm">显示坐标轴</span>
              </label>
              
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={settings.showGrid}
                  onChange={(e) => setSettings({ ...settings, showGrid: e.target.checked })}
                />
                <span className="text-sm">显示网格</span>
              </label>
              
              <label className="flex items-center gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={settings.autoRotate}
                  onChange={(e) => setSettings({ ...settings, autoRotate: e.target.checked })}
                />
                <span className="text-sm">自动旋转</span>
              </label>
            </div>
            
            {/* 背景颜色 */}
            <div>
              <label className="block text-sm text-gray-400 mb-1">背景</label>
              <div className="flex gap-2">
                <button
                  onClick={() => setSettings({ ...settings, backgroundColor: '#1a1a2e' })}
                  className={`flex-1 py-2 rounded-lg text-sm flex items-center justify-center gap-1 ${
                    settings.backgroundColor === '#1a1a2e' 
                      ? 'bg-gray-600 ring-1 ring-white' 
                      : 'bg-gray-700 hover:bg-gray-600'
                  }`}
                >
                  <Moon size={14} />
                  深色
                </button>
                <button
                  onClick={() => setSettings({ ...settings, backgroundColor: '#f5f5f5' })}
                  className={`flex-1 py-2 rounded-lg text-sm flex items-center justify-center gap-1 ${
                    settings.backgroundColor === '#f5f5f5' 
                      ? 'bg-gray-600 ring-1 ring-white' 
                      : 'bg-gray-700 hover:bg-gray-600'
                  }`}
                >
                  <Sun size={14} />
                  浅色
                </button>
              </div>
            </div>
          </div>
        </div>

        {/* 导出 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <h3 className="font-semibold mb-4 flex items-center gap-2">
            <Download size={18} />
            导出网格
          </h3>
          
          <div className="grid grid-cols-2 gap-2">
            <button
              onClick={() => exportMesh('stl')}
              disabled={!meshUrl}
              className="py-2 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 rounded-lg text-sm"
            >
              STL
            </button>
            <button
              onClick={() => exportMesh('ply')}
              disabled={!meshUrl}
              className="py-2 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 rounded-lg text-sm"
            >
              PLY
            </button>
            <button
              onClick={() => exportMesh('obj')}
              disabled={!meshUrl}
              className="py-2 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 rounded-lg text-sm"
            >
              OBJ
            </button>
            <button
              onClick={() => exportMesh('nii')}
              disabled={!selectedSource}
              className="py-2 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 rounded-lg text-sm"
            >
              NIfTI
            </button>
          </div>
        </div>

        {/* 视图控制 */}
        <div className="bg-gray-800 rounded-xl p-4 border border-gray-700">
          <div className="flex gap-2">
            <button
              onClick={resetView}
              className="flex-1 flex items-center justify-center gap-2 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"
            >
              <RotateCcw size={14} />
              重置视图
            </button>
            <button
              className="flex-1 flex items-center justify-center gap-2 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"
            >
              <Maximize2 size={14} />
              全屏
            </button>
          </div>
        </div>
      </div>

      {/* 右侧：3D 视图 */}
      <div className="flex-1 bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
        <Canvas
          style={{ background: settings.backgroundColor }}
          camera={{ position: [5, 5, 5], fov: 50 }}
        >
          <Suspense fallback={null}>
            {/* 光照 */}
            <ambientLight intensity={0.5} />
            <directionalLight position={[10, 10, 5]} intensity={1} />
            <directionalLight position={[-10, -10, -5]} intensity={0.3} />
            
            {/* 相机控制 */}
            <OrbitControls 
              enableDamping 
              dampingFactor={0.05}
              autoRotate={settings.autoRotate}
              autoRotateSpeed={1}
            />
            
            {/* 辅助元素 */}
            {settings.showAxes && <AxesHelper size={3} />}
            {settings.showGrid && <GridHelper size={10} divisions={10} />}
            
            {/* 血管网格 */}
            {meshUrl && (
              <VesselMesh
                meshUrl={meshUrl}
                color={settings.color}
                opacity={settings.opacity}
                wireframe={settings.wireframe}
              />
            )}
            
            {/* 环境 */}
            <Environment preset="studio" />
          </Suspense>
        </Canvas>
        
        {/* 操作提示 */}
        <div className="absolute bottom-4 left-4 text-xs text-gray-400 bg-black/30 px-3 py-2 rounded-lg">
          <div>左键拖拽: 旋转</div>
          <div>右键拖拽: 平移</div>
          <div>滚轮: 缩放</div>
        </div>
        
        {/* 无数据提示 */}
        {!meshUrl && (
          <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div className="text-center text-gray-500">
              <Layers size={64} className="mx-auto mb-4" />
              <p>选择数据并生成 3D 网格</p>
              <p className="text-sm mt-2">支持原始 OCTA 数据或推理结果</p>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default VisualizationPage;
</file>

<file path="frontend/src/styles/index.css">
/**
 * OCTA 血管网络分析系统 - 全局样式
 */

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ============================================================================
   基础样式
   ============================================================================ */

:root {
  /* 颜色变量 */
  --color-primary: #3b82f6;
  --color-secondary: #8b5cf6;
  --color-success: #10b981;
  --color-warning: #f59e0b;
  --color-danger: #ef4444;
  
  /* 背景色 */
  --bg-primary: #1a1a2e;
  --bg-secondary: #16213e;
  --bg-tertiary: #0f3460;
  
  /* 文字色 */
  --text-primary: #ffffff;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body, #root {
  height: 100%;
  width: 100%;
  overflow: hidden;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background-color: var(--bg-primary);
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ============================================================================
   滚动条样式
   ============================================================================ */

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* ============================================================================
   表单元素样式
   ============================================================================ */

input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  height: 6px;
  background: #374151;
  border-radius: 3px;
  cursor: pointer;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  background: #3b82f6;
  border-radius: 50%;
  cursor: pointer;
  transition: transform 0.15s ease;
}

input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.1);
}

input[type="range"]::-moz-range-thumb {
  width: 16px;
  height: 16px;
  background: #3b82f6;
  border: none;
  border-radius: 50%;
  cursor: pointer;
}

input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  background: #374151;
  border: 2px solid #4b5563;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

input[type="checkbox"]:checked {
  background: #3b82f6;
  border-color: #3b82f6;
  background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
  background-size: 14px;
  background-position: center;
  background-repeat: no-repeat;
}

select {
  -webkit-appearance: none;
  appearance: none;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 0.5rem center;
  background-repeat: no-repeat;
  background-size: 1.5em 1.5em;
  padding-right: 2.5rem;
  cursor: pointer;
}

/* ============================================================================
   动画
   ============================================================================ */

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideIn {
  from {
    transform: translateY(-10px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.animate-spin {
  animation: spin 1s linear infinite;
}

.animate-pulse {
  animation: pulse 2s ease-in-out infinite;
}

.animate-fadeIn {
  animation: fadeIn 0.3s ease-out;
}

.animate-slideIn {
  animation: slideIn 0.3s ease-out;
}

/* ============================================================================
   工具类
   ============================================================================ */

.no-select {
  user-select: none;
  -webkit-user-select: none;
}

.truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.glass {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

/* ============================================================================
   Canvas 样式
   ============================================================================ */

canvas {
  display: block;
}

.canvas-container {
  position: relative;
  width: 100%;
  height: 100%;
}

/* ============================================================================
   响应式
   ============================================================================ */

@media (max-width: 768px) {
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    z-index: 50;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }
  
  .sidebar.open {
    transform: translateX(0);
  }
}

/* ============================================================================
   打印样式
   ============================================================================ */

@media print {
  body {
    background: white;
    color: black;
  }
  
  .no-print {
    display: none !important;
  }
}
</file>

<file path="frontend/src/utils/api.ts">
/**
 * OCTA 血管网络分析系统 - API 工具
 * 
 * 封装与后端通信的 axios 实例和常用方法
 */

import axios, { AxiosInstance, AxiosError } from 'axios';

// API 基础配置
const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000/api';

// 创建 axios 实例
export const api: AxiosInstance = axios.create({
  baseURL: API_BASE_URL,
  timeout: 600000, // 5 分钟超时（用于大文件上传和推理）
  headers: {
    'Content-Type': 'application/json',
  },
});

// 请求拦截器
api.interceptors.request.use(
  (config) => {
    // 可以在这里添加认证 token 等
    console.log(`[API] ${config.method?.toUpperCase()} ${config.url}`);
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 响应拦截器
api.interceptors.response.use(
  (response) => {
    return response;
  },
  (error: AxiosError) => {
    if (error.response) {
      // 服务器返回错误
      console.error(`[API Error] ${error.response.status}:`, error.response.data);
      
      if (error.response.status === 500) {
        console.error('服务器内部错误');
      }
    } else if (error.request) {
      // 请求发送失败
      console.error('[API Error] 网络错误，无法连接到服务器');
    } else {
      console.error('[API Error]', error.message);
    }
    
    return Promise.reject(error);
  }
);

// ============================================================================
// API 方法封装
// ============================================================================

// 数据管理
export const dataApi = {
  // 上传文件
  upload: async (file: File, onProgress?: (percent: number) => void) => {
    const formData = new FormData();
    formData.append('file', file);
    
    return api.post('/data/upload', formData, {
      headers: { 'Content-Type': 'multipart/form-data' },
      onUploadProgress: (event) => {
        if (event.total && onProgress) {
          onProgress(Math.round((event.loaded * 100) / event.total));
        }
      },
    });
  },
  
  // 获取数据列表
  list: () => api.get('/data/list'),
  
  // 获取数据详情
  get: (volumeId: string) => api.get(`/data/${volumeId}`),
  
  // 删除数据
  delete: (volumeId: string) => api.delete(`/data/${volumeId}`),
  
  // 获取切片
  getSlice: (volumeId: string, axis: string, index: number, applyCorrection = false) => 
    api.get(`/data/${volumeId}/slice/${axis}/${index}`, {
      responseType: 'blob',
      params: { apply_correction: applyCorrection },
    }),
  
  // 生成网格
  generateMesh: (volumeId: string, threshold = 0.5, smooth = true) =>
    api.post(`/data/${volumeId}/mesh`, { threshold, smooth }),
  
  // 导出数据
  export: (volumeId: string, format: string) =>
    api.get(`/data/${volumeId}/export/${format}`, { responseType: 'blob' }),
};

// 标注管理
export const annotationApi = {
  // 创建项目
  createProject: (volumeId: string, name: string) =>
    api.post('/annotation/projects', { volume_id: volumeId, name }),
  
  // 获取项目列表
  listProjects: () => api.get('/annotation/projects'),
  
  // 获取项目详情
  getProject: (projectId: string) => api.get(`/annotation/projects/${projectId}`),
  
  // 删除项目
  deleteProject: (projectId: string) => api.delete(`/annotation/projects/${projectId}`),
  
  // 保存标注
  saveAnnotation: (projectId: string, layerKey: string, ellipses: any[], brushStrokes: any[]) =>
    api.post(`/annotation/projects/${projectId}/save`, {
      project_id: projectId,
      layer_key: layerKey,
      ellipses,
      brush_strokes: brushStrokes,
    }),
  
  // 获取标注层
  getLayer: (projectId: string, layerKey: string) =>
    api.get(`/annotation/projects/${projectId}/layer/${layerKey}`),
  
  // 撤销
  undo: (projectId: string) => api.post(`/annotation/projects/${projectId}/undo`),
  
  // 重做
  redo: (projectId: string) => api.post(`/annotation/projects/${projectId}/redo`),
  
  // 生成金标准
  generateMask: (projectId: string) =>
    api.post(`/annotation/projects/${projectId}/generate-mask`),
  
  // 椭圆拟合
  fitEllipse: (points: { x: number; y: number }[]) =>
    api.post('/annotation/fit-ellipse', points),
};

// 训练管理
export const trainingApi = {
  // 开始训练
  start: (config: any) => api.post('/training/start', config),
  
  // 停止训练
  stop: () => api.post('/training/stop'),
  
  // 暂停训练
  pause: () => api.post('/training/pause'),
  
  // 恢复训练
  resume: () => api.post('/training/resume'),
  
  // 获取状态
  getStatus: () => api.get('/training/status'),
  
  // 获取日志
  getLogs: (limit = 100) => api.get('/training/logs', { params: { limit } }),
  
  // 获取检查点列表
  listCheckpoints: () => api.get('/training/checkpoints'),
  
  // 删除检查点
  deleteCheckpoint: (filename: string) => api.delete(`/training/checkpoints/${filename}`),
  
  // 加载检查点
  loadCheckpoint: (filename: string) => api.post(`/training/checkpoints/load/${filename}`),
  
  // 验证数据
  validateData: (volumeId: string, projectId: string) =>
    api.post('/training/validate-data', null, {
      params: { volume_id: volumeId, annotation_project_id: projectId },
    }),
  
  // 获取推荐配置
  getRecommendedConfig: (volumeId: string) =>
    api.get('/training/recommended-config', { params: { volume_id: volumeId } }),
};

// 推理管理
export const inferenceApi = {
  // 开始推理
  start: (config: any) => api.post('/inference/start', config),
  
  // 获取任务状态
  getStatus: (taskId: string) => api.get(`/inference/status/${taskId}`),
  
  // 获取任务列表
  list: () => api.get('/inference/list'),
  
  // 获取结果切片
  getResultSlice: (taskId: string, axis: string, index: number) =>
    api.get(`/inference/result/${taskId}/slice/${axis}/${index}`, { responseType: 'blob' }),
  
  // 下载结果
  downloadResult: (taskId: string, format: string) =>
    api.get(`/inference/result/${taskId}/download/${format}`, { responseType: 'blob' }),
  
  // 删除结果
  deleteResult: (taskId: string) => api.delete(`/inference/result/${taskId}`),
};

// 系统 API
export const systemApi = {
  // 健康检查
  health: () => api.get('/health'),
  
  // 获取配置
  getConfig: () => api.get('/config'),
};

export default api;
</file>

<file path="frontend/tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        // 自定义颜色
        primary: {
          50: '#eff6ff',
          100: '#dbeafe',
          200: '#bfdbfe',
          300: '#93c5fd',
          400: '#60a5fa',
          500: '#3b82f6',
          600: '#2563eb',
          700: '#1d4ed8',
          800: '#1e40af',
          900: '#1e3a8a',
        },
        dark: {
          100: '#1e293b',
          200: '#1a1a2e',
          300: '#16213e',
          400: '#0f3460',
          500: '#0a1929',
        },
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
        mono: ['JetBrains Mono', 'Consolas', 'monospace'],
      },
      animation: {
        'spin-slow': 'spin 3s linear infinite',
        'pulse-slow': 'pulse 3s ease-in-out infinite',
      },
      boxShadow: {
        'glow': '0 0 20px rgba(59, 130, 246, 0.3)',
        'glow-lg': '0 0 40px rgba(59, 130, 246, 0.4)',
      },
    },
  },
  plugins: [],
};
</file>

<file path="frontend/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,

    /* Paths */
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
</file>

<file path="frontend/tsconfig.node.json">
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="frontend/vite.config.ts">
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  
  server: {
    port: 5173,
    host: true,
    // 代理后端 API
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
      },
    },
  },
  
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    // Electron 需要相对路径
    base: './',
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'three-vendor': ['three', '@react-three/fiber', '@react-three/drei'],
          'chart-vendor': ['recharts'],
        },
      },
    },
  },
  
  optimizeDeps: {
    include: ['react', 'react-dom', 'three'],
  },
});
</file>

<file path="README_zh.md">
# OCTA 血管网络分析系统

## 项目概述

本系统是一个完整的 OCTA（光学相干断层扫描血管成像）数据处理和分析平台，集成了：
- 3D 血管网络可视化
- 血管横截面手动标注（含几何畸变矫正）
- 基于 3D U-Net + Diffusion 模型的拖尾伪影消除
- 三维重建与导出

## 系统架构

```
octa-vessel-analyzer/
├── backend/                    # Python 后端服务
│   ├── api/                    # FastAPI 路由和接口
│   │   ├── __init__.py
│   │   ├── main.py            # API 入口
│   │   ├── data_routes.py     # 数据上传/处理接口
│   │   ├── annotation_routes.py   # 标注相关接口
│   │   ├── training_routes.py     # 训练相关接口
│   │   └── inference_routes.py    # 推理相关接口
│   ├── core/                   # 核心处理模块
│   │   ├── __init__.py
│   │   ├── dicom_reader.py    # DICOM/OCTA 数据读取
│   │   ├── distortion_correction.py  # 几何畸变矫正（重点改进）
│   │   ├── volume_processor.py    # 体数据处理
│   │   └── mesh_generator.py      # 网格生成
│   ├── models/                 # 深度学习模型
│   │   ├── __init__.py
│   │   ├── unet3d.py          # 3D U-Net 分割网络
│   │   ├── diffusion.py       # 3D Diffusion 模型
│   │   └── combined.py        # 联合模型
│   ├── training/               # 训练模块
│   │   ├── __init__.py
│   │   ├── trainer.py         # 训练管理器
│   │   ├── dataset.py         # 数据集定义
│   │   └── losses.py          # 损失函数
│   ├── data/                   # 数据存储
│   │   ├── uploads/           # 上传的原始数据
│   │   ├── processed/         # 处理后的数据
│   │   ├── annotations/       # 标注数据
│   │   └── models/            # 模型检查点
│   └── utils/                  # 工具函数
│       ├── __init__.py
│       └── helpers.py
├── frontend/                   # Electron + React 前端
│   ├── src/
│   │   ├── components/        # React 组件
│   │   ├── pages/             # 页面组件
│   │   ├── hooks/             # 自定义 Hooks
│   │   ├── utils/             # 工具函数
│   │   ├── types/             # TypeScript 类型定义
│   │   └── styles/            # 样式文件
│   ├── public/
│   ├── electron/              # Electron 主进程
│   └── package.json
├── scripts/                    # 打包部署脚本
│   ├── build_windows.bat      # Windows 打包脚本
│   └── setup.py               # Python 环境设置
└── docs/                       # 文档
    └── usage.md
```

## 核心功能

### 功能1: 3D 血管网络可视化
- 支持 DICOM / OCTA 数据导入
- 交互式 3D 渲染（旋转、缩放、平移）
- 多种显示模式（体渲染、表面渲染、MIP）
- 轴向切片浏览

### 功能2: 血管横截面标注（含畸变矫正）
- B-scan 标注工作区
- 圆形/椭圆 ROI 标注工具
- **几何畸变矫正**（解决 OCT 纵向拉伸问题）
- 标注结果导出为 3D 金标准 mask

### 功能3: 深度学习训练与推理
- 3D U-Net 分割网络
- 3D Diffusion 模型精修
- 可视化训练进度和 Loss 曲线
- 模型检查点管理

### 功能4: 三维重建与导出
- Marching Cubes 表面提取
- 多格式导出（NIfTI、STL、PLY）

## 系统要求

- **操作系统**: Windows 10/11 64位
- **Python**: 3.9 或更高版本
- **Node.js**: 18.0 或更高版本
- **GPU**: 推荐 NVIDIA GPU（8GB+ 显存），支持 CUDA 11.8+
- **内存**: 至少 16GB RAM

## 安装部署

### 方法1: 一键启动（推荐）

双击运行 `scripts/start.bat`，脚本会自动：
- 检查并安装后端 Python 依赖
- 检查并安装前端 Node.js 依赖
- 启动后端 API 服务（端口 8000）
- 启动前端开发服务器（端口 5173）

然后访问 http://localhost:5173 即可使用系统。

### 方法2: 从源码手动运行

```bash
# 1. 克隆仓库
git clone <repo_url>
cd octa-vessel-analyzer

# 2. 安装后端依赖
cd backend
pip install -r requirements.txt

# 3. 启动后端服务（新终端窗口）
python -m uvicorn api.main:app --host 127.0.0.1 --port 8000 --reload

# 4. 安装前端依赖（新终端窗口）
cd ../frontend
npm install

# 5. 启动前端（开发模式）
npm run dev

# 或启动 Electron 桌面应用
npm run electron:dev
```

### 方法3: 打包为桌面应用

运行打包脚本生成 Windows 安装程序：

```bash
scripts\build_windows.bat
```

打包完成后，在 `dist` 目录中可以找到安装程序。

## 使用指南

### 步骤1: 导入数据

1. 点击左侧导航栏的「数据管理」
2. 点击「上传」按钮，选择 DICOM/OCTA 文件
3. 支持格式：.dcm, .dicom, .nii, .nii.gz, .npy, .mat, .zip

### 步骤2: 标注金标准

1. 进入「标注工具」页面
2. 选择要标注的数据
3. 使用椭圆工具标注血管横截面（消除拖尾）
4. 保存标注并生成金标准 mask

### 步骤3: 训练模型

1. 进入「模型训练」页面
2. 选择训练数据和标注项目
3. 配置训练参数（epochs, batch_size 等）
4. 点击「开始训练」
5. 实时查看 Loss 曲线和训练进度

### 步骤4: 推理预测

1. 进入「推理预测」页面
2. 选择输入数据和模型检查点
3. 点击「开始推理」
4. 对比原始和结果切片
5. 导出结果（NIfTI, STL 等格式）

### 步骤5: 三维可视化

1. 进入「三维可视化」页面
2. 选择数据源生成 3D 网格
3. 交互式浏览血管网络
4. 导出网格文件

## OCT 几何畸变矫正原理

### 问题描述
OCT 成像系统的纵向（深度）刻度基于**光学路径长度**（Optical Path Length, OPL），而非物理长度：

\[
\text{OPL} = n \times d
\]

其中 \(n\) 是介质折射率，\(d\) 是物理距离。

当样品表面存在倾斜时，光束斜向穿透样品，光程变长，导致：
1. 结构在纵向被拉长
2. 圆形血管截面变成椭圆形或带拖尾

### 矫正方法
本系统采用以下策略：
1. **倾角估计**：从 B-scan 中自动估计表面倾斜角度
2. **各向异性缩放**：根据倾角对纵向进行压缩矫正
3. **折射率补偿**：根据组织折射率调整深度刻度

详见 `backend/core/distortion_correction.py`

## 许可证
MIT License
</file>

<file path="scripts/build-windows.bat">
@echo off
echo.
echo ============================================
echo   OCTA Vessel Analyzer - Build for Windows
echo ============================================
echo.

:: Check if npm is available
npm --version >nul 2>&1
if errorlevel 1 (
    echo [ERROR] npm not found. Please install Node.js first.
    pause
    exit /b 1
)

:: Build frontend
echo [1/3] Building frontend...
cd /d "%~dp0..\frontend"
call npm run build
if errorlevel 1 (
    echo [ERROR] Frontend build failed!
    pause
    exit /b 1
)
echo [OK] Frontend built successfully

:: Package with Electron Builder
echo [2/3] Packaging with Electron Builder...
call npm run electron:build:win
if errorlevel 1 (
    echo [ERROR] Electron packaging failed!
    pause
    exit /b 1
)
echo [OK] Electron package created

:: Copy backend files
echo [3/3] Preparing backend files...
cd /d "%~dp0.."
if not exist "dist-electron\win-unpacked\resources\backend" (
    mkdir "dist-electron\win-unpacked\resources\backend"
)
xcopy /E /Y "backend\*" "dist-electron\win-unpacked\resources\backend\"
echo [OK] Backend files copied

echo.
echo ============================================
echo   Build Complete!
echo ============================================
echo.
echo Output directory: dist-electron\
echo.
echo The installer is located at:
echo   dist-electron\OCTA Vessel Analyzer Setup.exe
echo.
pause
</file>

<file path="scripts/dev-start.bat">
@echo off
echo.
echo ============================================
echo   OCTA Vessel Analyzer - Development Mode
echo ============================================
echo.

:: Start backend in new window
echo Starting backend server...
cd /d "%~dp0..\backend"
start "Backend Server" cmd /k "python -m api.main"

:: Wait for backend
echo Waiting for backend...
timeout /t 3 /nobreak >nul

:: Start frontend dev server in new window
echo Starting frontend dev server...
cd /d "%~dp0..\frontend"
start "Frontend Dev" cmd /k "npm run dev"

echo.
echo ============================================
echo   Development servers started!
echo ============================================
echo.
echo Backend API: http://localhost:8000
echo Frontend:    http://localhost:5173
echo API Docs:    http://localhost:8000/docs
echo.
echo Press any key to exit this window...
echo (Servers will continue running in their own windows)
echo.
pause
</file>

<file path="scripts/install.bat">
@echo off
echo.
echo ============================================
echo   OCTA Vessel Analyzer - Installation
echo ============================================
echo.

:: Check Python
echo [1/4] Checking Python...
python --version >nul 2>&1
if errorlevel 1 (
    echo [ERROR] Python not found. Please install Python 3.9+
    echo Download: https://www.python.org/downloads/
    pause
    exit /b 1
)
echo [OK] Python is installed

:: Check Node.js
echo [2/4] Checking Node.js...
node --version >nul 2>&1
if errorlevel 1 (
    echo [ERROR] Node.js not found. Please install Node.js 18+
    echo Download: https://nodejs.org/
    pause
    exit /b 1
)
echo [OK] Node.js is installed

:: Install Python dependencies
echo [3/4] Installing Python dependencies...
cd /d "%~dp0..\backend"
pip install -r requirements.txt
if errorlevel 1 (
    echo [WARNING] Some Python packages may not be installed correctly
)
echo [OK] Python dependencies installed

:: Install Node.js dependencies
echo [4/4] Installing Node.js dependencies...
cd /d "%~dp0..\frontend"
call npm install
if errorlevel 1 (
    echo [WARNING] Some Node.js packages may not be installed correctly
)
echo [OK] Node.js dependencies installed

:: Create data directories
echo.
echo Creating data directories...
cd /d "%~dp0..\backend"
if not exist "data" mkdir "data"
if not exist "data\uploads" mkdir "data\uploads"
if not exist "data\processed" mkdir "data\processed"
if not exist "data\annotations" mkdir "data\annotations"
if not exist "data\models" mkdir "data\models"
if not exist "data\results" mkdir "data\results"
echo [OK] Data directories created

echo.
echo ============================================
echo   Installation Complete!
echo ============================================
echo.
echo Usage:
echo   1. Run start.bat to launch the application
echo   2. Or run dev-start.bat for development mode
echo.
echo See INSTALL.md for more information
echo.
pause
</file>

<file path="scripts/start.bat">
@echo off
chcp 437 >nul 2>&1
setlocal EnableDelayedExpansion

echo.
echo ============================================
echo   OCTA Vessel Analyzer - Smart Launcher
echo ============================================
echo.

:: Set paths
set "ROOT_DIR=%~dp0.."
set "BACKEND_DIR=%ROOT_DIR%\backend"
set "FRONTEND_DIR=%ROOT_DIR%\frontend"
set "VENV_PYTHON=%BACKEND_DIR%\.venv\Scripts\python.exe"

:: ============================================
:: Step 1: Check virtual environment
:: ============================================
echo [1/6] Checking virtual environment...

if not exist "%VENV_PYTHON%" (
    echo [ERROR] Virtual environment not found!
    echo Please run install.bat first.
    echo.
    pause
    exit /b 1
)
echo [OK] Virtual environment found

:: ============================================
:: Step 2: Clean up old processes
:: ============================================
echo [2/6] Cleaning up old processes...

:: Kill processes on port 8000
for /f "tokens=5" %%a in ('netstat -ano 2^>nul ^| findstr :8000 ^| findstr LISTENING') do (
    taskkill /F /PID %%a >nul 2>&1
)

:: Kill processes on port 5173
for /f "tokens=5" %%a in ('netstat -ano 2^>nul ^| findstr :5173 ^| findstr LISTENING') do (
    taskkill /F /PID %%a >nul 2>&1
)

echo [OK] Ports cleared

:: ============================================
:: Step 3: Start backend server
:: ============================================
echo [3/6] Starting backend server...

cd /d "%BACKEND_DIR%"
start "OCTA Backend" cmd /c ""%VENV_PYTHON%" -m api.main"

:: ============================================
:: Step 4: Wait for backend
:: ============================================
echo [4/6] Waiting for backend to start...

set "BACKEND_READY=0"
set "MAX_WAIT=30"
set "WAIT_COUNT=0"

:wait_backend
if %WAIT_COUNT% GEQ %MAX_WAIT% (
    echo [ERROR] Backend failed to start after %MAX_WAIT% seconds
    pause
    exit /b 1
)

curl -s http://localhost:8000/health >nul 2>&1
if %ERRORLEVEL% EQU 0 (
    set "BACKEND_READY=1"
    goto backend_ready
)

set /a WAIT_COUNT+=1
echo     Waiting... (%WAIT_COUNT%/%MAX_WAIT%)
timeout /t 1 /nobreak >nul
goto wait_backend

:backend_ready
echo [OK] Backend is running on http://localhost:8000

:: ============================================
:: Step 5: Start frontend (Vite + Electron)
:: ============================================
echo [5/6] Starting frontend...

cd /d "%FRONTEND_DIR%"
start "OCTA Frontend" cmd /c "npm run dev"

:: ============================================
:: Step 6: Wait for Vite and start Electron
:: ============================================
echo [6/6] Waiting for Vite to start...

set "VITE_READY=0"
set "WAIT_COUNT=0"

:wait_vite
if %WAIT_COUNT% GEQ %MAX_WAIT% (
    echo [ERROR] Vite failed to start after %MAX_WAIT% seconds
    pause
    exit /b 1
)

curl -s http://localhost:5173 >nul 2>&1
if %ERRORLEVEL% EQU 0 (
    set "VITE_READY=1"
    goto vite_ready
)

set /a WAIT_COUNT+=1
echo     Waiting... (%WAIT_COUNT%/%MAX_WAIT%)
timeout /t 1 /nobreak >nul
goto wait_vite

:vite_ready
echo [OK] Vite is running on http://localhost:5173

:: Start Electron
echo.
echo Starting Electron app...
cd /d "%FRONTEND_DIR%"
start "OCTA Electron" cmd /c "npx electron ."

echo.
echo ============================================
echo   Application Started Successfully!
echo ============================================
echo.
echo   Backend:  http://localhost:8000
echo   Frontend: http://localhost:5173
echo   API Docs: http://localhost:8000/docs
echo.
echo   You can also open the frontend in browser:
echo   http://localhost:5173
echo.
echo   Press any key to exit this launcher...
echo   (Application windows will keep running)
echo.
pause >nul
</file>

</files>
